<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>ODINVERSE ‚Äî Connect Wallet</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- QRCode lib (npm CDN) -->
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<!-- WalletConnect Provider UMD via SDK Dapp -->
<script src="https://cdn.jsdelivr.net/npm/@multiversx/sdk-dapp@latest/dist/sdk-dapp.umd.js"></script>

<style>
body { background:#0e0e0e; color:#fff; font-family:Arial, sans-serif; text-align:center; padding:50px;}
button { padding:14px 28px; font-size:16px; border:none; border-radius:8px; background:#ff9800; cursor:pointer;}
button:disabled { opacity:0.6; cursor:default; }
.status { margin-top:15px; font-size:16px; }
#qr { margin-top:20px; }
</style>
</head>
<body>

<h1>‚öîÔ∏è ODINVERSE</h1>
<p>Le projet NFT Viking ultime sur MultiversX</p>

<button id="connectBtn">üîê Connect Wallet</button>
<p class="status" id="status">‚ùå Non connect√©</p>
<p class="status" id="address"></p>
<canvas id="qr"></canvas>

<script>
const connectBtn = document.getElementById("connectBtn");
const statusEl = document.getElementById("status");
const addressEl = document.getElementById("address");
const qrCanvas = document.getElementById("qr");

let provider;

connectBtn.onclick = async () => {
    try {
        statusEl.innerText = "üîÑ Connexion en cours...";
        addressEl.innerText = "";
        qrCanvas.style.display = "block";

        const { init, getWalletConnectProvider, getAccount } = window.mvxSdkDapp;

        // ‚ö° Initialisation SDK Dapp
        await init({ environment: "mainnet" }); // "T"=Testnet, "D"=Devnet, "1"=Mainnet

        // üîê Configuration WalletConnect V2
        const projectId = "f4f84c031236a02d1fda5167859868f4"; // Remplace par ton Project ID WalletConnect
        const relayUrl = "wss://relay.walletconnect.com";
        const chainId = "1"; // Mainnet

        const callbacks = {
            onClientLogin: async () => {
                qrCanvas.style.display = "none";
                const address = await provider.getAddress();
                statusEl.innerText = "‚úÖ Wallet connect√©";
                addressEl.innerText = "üü¢ " + address;
                connectBtn.disabled = true;
                connectBtn.innerText = "üîì Wallet connect√©";
            },
            onClientLogout: async () => {
                statusEl.innerText = "‚ùå D√©connect√©";
                addressEl.innerText = "";
                connectBtn.disabled = false;
                connectBtn.innerText = "üîê Connect Wallet";
            },
            onClientEvent: (event) => {
                console.log("WalletConnect Event:", event);
            }
        };

        // üîß Cr√©ation provider
        provider = getWalletConnectProvider({
            projectId,
            chain: chainId,
            relayUrl,
            callbacks
        });

        await provider.init();

        // üì≤ Connexion
        const { uri, approval } = await provider.connect();

        // üé® G√©n√©rer QR code
        QRCode.toCanvas(qrCanvas, uri, function (error) {
            if (error) console.error(error);
        });

        // ‚è≥ Attendre que l'utilisateur confirme le wallet
        await provider.login({ approval });

    } catch (err) {
        console.error(err);
        statusEl.innerText = "‚ùå Erreur : " + err.message;
    }
};
</script>

</body>
</html>

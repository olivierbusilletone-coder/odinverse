<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Viking WalletConnect Test</title>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@multiversx/sdk-wallet-connect-provider/dist/walletConnectProvider.umd.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { background:#1a1a1a; color:#f5f5dc; font-family: 'Cinzel', serif; text-align:center; }
.viking-container { margin:auto; margin-top:100px; padding:30px; max-width:400px; background:rgba(0,0,0,0.7); border-radius:15px; }
#MyWalletConnectQRContainer svg { width:100%; height:auto; }
button { margin:10px; }
</style>
</head>
<body>

<div class="viking-container">
  <h1>⚔️ Viking MultiversX ⚔️</h1>
  <button id="connectBtn" class="btn btn-warning btn-lg">Connect Wallet</button>
  <button id="disconnectBtn" class="btn btn-danger btn-lg" style="display:none;">Disconnect</button>
  <div id="walletInfo">
    <p id="status">Status: Not connected</p>
    <p id="address"></p>
  </div>
  <div id="MyWalletConnectQRContainer" style="margin-top:20px;"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
const statusEl = document.getElementById("status");
const addressEl = document.getElementById("address");
const connectBtn = document.getElementById("connectBtn");
const disconnectBtn = document.getElementById("disconnectBtn");
const qrContainer = document.getElementById("MyWalletConnectQRContainer");

let provider = null;

// ⚠️ Remplacez par votre Project ID WalletConnect 2.0
const projectId = "f4f84c031236a02d1fda5167859868f4"; 
const relayUrl = "wss://relay.walletconnect.com";
const chainId = "T"; // Testnet

const callbacks = {
  onClientLogin: async function () {
    const address = await provider.getAddress();
    statusEl.textContent = "Status: Connected";
    addressEl.textContent = "Address: " + address;
    connectBtn.style.display = "none";
    disconnectBtn.style.display = "inline-block";
    qrContainer.innerHTML = ""; // On enlève le QR code
  },
  onClientLogout: async function () {
    statusEl.textContent = "Status: Not connected";
    addressEl.textContent = "";
    connectBtn.style.display = "inline-block";
    disconnectBtn.style.display = "none";
  }
};

// Instanciation du provider
provider = new window.WalletConnectV2Provider(callbacks, chainId, relayUrl, projectId);

async function showQR(uri) {
  const svg = await QRCode.toString(uri, { type: "svg" });
  qrContainer.innerHTML = svg;
}

connectBtn.addEventListener("click", async () => {
  try {
    await provider.init();
    const { uri, approval } = await provider.connect();
    await showQR(uri);
    await provider.login({ approval });
  } catch (e) {
    console.error("Erreur WalletConnect:", e);
    alert("Erreur WalletConnect : " + e.message);
  }
});

disconnectBtn.addEventListener("click", async () => {
  await provider.logout();
});
</script>
</body>
</html>

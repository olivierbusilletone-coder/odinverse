(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const Ys of document.querySelectorAll('link[rel="modulepreload"]'))zs(Ys);new MutationObserver(Ys=>{for(const Zs of Ys)if(Zs.type==="childList")for(const _u of Zs.addedNodes)_u.tagName==="LINK"&&_u.rel==="modulepreload"&&zs(_u)}).observe(document,{childList:!0,subtree:!0});function Hs(Ys){const Zs={};return Ys.integrity&&(Zs.integrity=Ys.integrity),Ys.referrerPolicy&&(Zs.referrerPolicy=Ys.referrerPolicy),Ys.crossOrigin==="use-credentials"?Zs.credentials="include":Ys.crossOrigin==="anonymous"?Zs.credentials="omit":Zs.credentials="same-origin",Zs}function zs(Ys){if(Ys.ep)return;Ys.ep=!0;const Zs=Hs(Ys);fetch(Ys.href,Zs)}})();const scriptRel="modulepreload",assetsURL=function(Z){return"/"+Z},seen={},__vitePreload=function(t,Hs,zs){if(!Hs||Hs.length===0)return t();const Ys=document.getElementsByTagName("link");return Promise.all(Hs.map(Zs=>{if(Zs=assetsURL(Zs),Zs in seen)return;seen[Zs]=!0;const _u=Zs.endsWith(".css"),Eu=_u?'[rel="stylesheet"]':"";if(!!zs)for(let $u=Ys.length-1;$u>=0;$u--){const vu=Ys[$u];if(vu.href===Zs&&(!_u||vu.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${Zs}"]${Eu}`))return;const Au=document.createElement("link");if(Au.rel=_u?"stylesheet":scriptRel,_u||(Au.as="script",Au.crossOrigin=""),Au.href=Zs,document.head.appendChild(Au),_u)return new Promise(($u,vu)=>{Au.addEventListener("load",$u),Au.addEventListener("error",()=>vu(new Error(`Unable to preload CSS for ${Zs}`)))})})).then(()=>t()).catch(Zs=>{const _u=new Event("vite:preloadError",{cancelable:!0});if(_u.payload=Zs,window.dispatchEvent(_u),!_u.defaultPrevented)throw Zs})};function getDefaultExportFromCjs$1(Z){return Z&&Z.__esModule&&Object.prototype.hasOwnProperty.call(Z,"default")?Z.default:Z}var browser$3={exports:{}},process=browser$3.exports={},cachedSetTimeout,cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?cachedSetTimeout=setTimeout:cachedSetTimeout=defaultSetTimout}catch{cachedSetTimeout=defaultSetTimout}try{typeof clearTimeout=="function"?cachedClearTimeout=clearTimeout:cachedClearTimeout=defaultClearTimeout}catch{cachedClearTimeout=defaultClearTimeout}})();function runTimeout(Z){if(cachedSetTimeout===setTimeout)return setTimeout(Z,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(Z,0);try{return cachedSetTimeout(Z,0)}catch{try{return cachedSetTimeout.call(null,Z,0)}catch{return cachedSetTimeout.call(this,Z,0)}}}function runClearTimeout(Z){if(cachedClearTimeout===clearTimeout)return clearTimeout(Z);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(Z);try{return cachedClearTimeout(Z)}catch{try{return cachedClearTimeout.call(null,Z)}catch{return cachedClearTimeout.call(this,Z)}}}var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){!draining||!currentQueue||(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var Z=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(Z)}}process.nextTick=function(Z){var t=new Array(arguments.length-1);if(arguments.length>1)for(var Hs=1;Hs<arguments.length;Hs++)t[Hs-1]=arguments[Hs];queue.push(new Item(Z,t)),queue.length===1&&!draining&&runTimeout(drainQueue)};function Item(Z,t){this.fun=Z,this.array=t}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=!0;process.env={};process.argv=[];process.version="";process.versions={};function noop$4(){}process.on=noop$4;process.addListener=noop$4;process.once=noop$4;process.off=noop$4;process.removeListener=noop$4;process.removeAllListeners=noop$4;process.emit=noop$4;process.prependListener=noop$4;process.prependOnceListener=noop$4;process.listeners=function(Z){return[]};process.binding=function(Z){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(Z){throw new Error("process.chdir is not supported")};process.umask=function(){return 0};var browserExports$1=browser$3.exports;const process$1=getDefaultExportFromCjs$1(browserExports$1);var buffer={},base64Js={};base64Js.byteLength=byteLength;base64Js.toByteArray=toByteArray;base64Js.fromByteArray=fromByteArray;var lookup=[],revLookup=[],Arr=typeof Uint8Array<"u"?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i$3=0,len=code.length;i$3<len;++i$3)lookup[i$3]=code[i$3],revLookup[code.charCodeAt(i$3)]=i$3;revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function getLens(Z){var t=Z.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var Hs=Z.indexOf("=");Hs===-1&&(Hs=t);var zs=Hs===t?0:4-Hs%4;return[Hs,zs]}function byteLength(Z){var t=getLens(Z),Hs=t[0],zs=t[1];return(Hs+zs)*3/4-zs}function _byteLength(Z,t,Hs){return(t+Hs)*3/4-Hs}function toByteArray(Z){var t,Hs=getLens(Z),zs=Hs[0],Ys=Hs[1],Zs=new Arr(_byteLength(Z,zs,Ys)),_u=0,Eu=Ys>0?zs-4:zs,Iu;for(Iu=0;Iu<Eu;Iu+=4)t=revLookup[Z.charCodeAt(Iu)]<<18|revLookup[Z.charCodeAt(Iu+1)]<<12|revLookup[Z.charCodeAt(Iu+2)]<<6|revLookup[Z.charCodeAt(Iu+3)],Zs[_u++]=t>>16&255,Zs[_u++]=t>>8&255,Zs[_u++]=t&255;return Ys===2&&(t=revLookup[Z.charCodeAt(Iu)]<<2|revLookup[Z.charCodeAt(Iu+1)]>>4,Zs[_u++]=t&255),Ys===1&&(t=revLookup[Z.charCodeAt(Iu)]<<10|revLookup[Z.charCodeAt(Iu+1)]<<4|revLookup[Z.charCodeAt(Iu+2)]>>2,Zs[_u++]=t>>8&255,Zs[_u++]=t&255),Zs}function tripletToBase64(Z){return lookup[Z>>18&63]+lookup[Z>>12&63]+lookup[Z>>6&63]+lookup[Z&63]}function encodeChunk(Z,t,Hs){for(var zs,Ys=[],Zs=t;Zs<Hs;Zs+=3)zs=(Z[Zs]<<16&16711680)+(Z[Zs+1]<<8&65280)+(Z[Zs+2]&255),Ys.push(tripletToBase64(zs));return Ys.join("")}function fromByteArray(Z){for(var t,Hs=Z.length,zs=Hs%3,Ys=[],Zs=16383,_u=0,Eu=Hs-zs;_u<Eu;_u+=Zs)Ys.push(encodeChunk(Z,_u,_u+Zs>Eu?Eu:_u+Zs));return zs===1?(t=Z[Hs-1],Ys.push(lookup[t>>2]+lookup[t<<4&63]+"==")):zs===2&&(t=(Z[Hs-2]<<8)+Z[Hs-1],Ys.push(lookup[t>>10]+lookup[t>>4&63]+lookup[t<<2&63]+"=")),Ys.join("")}var ieee754={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ieee754.read=function(Z,t,Hs,zs,Ys){var Zs,_u,Eu=Ys*8-zs-1,Iu=(1<<Eu)-1,Au=Iu>>1,$u=-7,vu=Hs?Ys-1:0,Su=Hs?-1:1,Ru=Z[t+vu];for(vu+=Su,Zs=Ru&(1<<-$u)-1,Ru>>=-$u,$u+=Eu;$u>0;Zs=Zs*256+Z[t+vu],vu+=Su,$u-=8);for(_u=Zs&(1<<-$u)-1,Zs>>=-$u,$u+=zs;$u>0;_u=_u*256+Z[t+vu],vu+=Su,$u-=8);if(Zs===0)Zs=1-Au;else{if(Zs===Iu)return _u?NaN:(Ru?-1:1)*(1/0);_u=_u+Math.pow(2,zs),Zs=Zs-Au}return(Ru?-1:1)*_u*Math.pow(2,Zs-zs)};ieee754.write=function(Z,t,Hs,zs,Ys,Zs){var _u,Eu,Iu,Au=Zs*8-Ys-1,$u=(1<<Au)-1,vu=$u>>1,Su=Ys===23?Math.pow(2,-24)-Math.pow(2,-77):0,Ru=zs?0:Zs-1,Pu=zs?1:-1,Cu=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(Eu=isNaN(t)?1:0,_u=$u):(_u=Math.floor(Math.log(t)/Math.LN2),t*(Iu=Math.pow(2,-_u))<1&&(_u--,Iu*=2),_u+vu>=1?t+=Su/Iu:t+=Su*Math.pow(2,1-vu),t*Iu>=2&&(_u++,Iu/=2),_u+vu>=$u?(Eu=0,_u=$u):_u+vu>=1?(Eu=(t*Iu-1)*Math.pow(2,Ys),_u=_u+vu):(Eu=t*Math.pow(2,vu-1)*Math.pow(2,Ys),_u=0));Ys>=8;Z[Hs+Ru]=Eu&255,Ru+=Pu,Eu/=256,Ys-=8);for(_u=_u<<Ys|Eu,Au+=Ys;Au>0;Z[Hs+Ru]=_u&255,Ru+=Pu,_u/=256,Au-=8);Z[Hs+Ru-Pu]|=Cu*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(Z){const t=base64Js,Hs=ieee754,zs=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;Z.Buffer=$u,Z.SlowBuffer=tl,Z.INSPECT_MAX_BYTES=50;const Ys=2147483647;Z.kMaxLength=Ys;const{Uint8Array:Zs,ArrayBuffer:_u,SharedArrayBuffer:Eu}=globalThis;$u.TYPED_ARRAY_SUPPORT=Iu(),!$u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function Iu(){try{const Ku=new Zs(1),xu={foo:function(){return 42}};return Object.setPrototypeOf(xu,Zs.prototype),Object.setPrototypeOf(Ku,xu),Ku.foo()===42}catch{return!1}}Object.defineProperty($u.prototype,"parent",{enumerable:!0,get:function(){if($u.isBuffer(this))return this.buffer}}),Object.defineProperty($u.prototype,"offset",{enumerable:!0,get:function(){if($u.isBuffer(this))return this.byteOffset}});function Au(Ku){if(Ku>Ys)throw new RangeError('The value "'+Ku+'" is invalid for option "size"');const xu=new Zs(Ku);return Object.setPrototypeOf(xu,$u.prototype),xu}function $u(Ku,xu,Nu){if(typeof Ku=="number"){if(typeof xu=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return Pu(Ku)}return vu(Ku,xu,Nu)}$u.poolSize=8192;function vu(Ku,xu,Nu){if(typeof Ku=="string")return Cu(Ku,xu);if(_u.isView(Ku))return Fu(Ku);if(Ku==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Ku);if(Gl(Ku,_u)||Ku&&Gl(Ku.buffer,_u)||typeof Eu<"u"&&(Gl(Ku,Eu)||Ku&&Gl(Ku.buffer,Eu)))return zu(Ku,xu,Nu);if(typeof Ku=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const rl=Ku.valueOf&&Ku.valueOf();if(rl!=null&&rl!==Ku)return $u.from(rl,xu,Nu);const ml=Hu(Ku);if(ml)return ml;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof Ku[Symbol.toPrimitive]=="function")return $u.from(Ku[Symbol.toPrimitive]("string"),xu,Nu);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Ku)}$u.from=function(Ku,xu,Nu){return vu(Ku,xu,Nu)},Object.setPrototypeOf($u.prototype,Zs.prototype),Object.setPrototypeOf($u,Zs);function Su(Ku){if(typeof Ku!="number")throw new TypeError('"size" argument must be of type number');if(Ku<0)throw new RangeError('The value "'+Ku+'" is invalid for option "size"')}function Ru(Ku,xu,Nu){return Su(Ku),Ku<=0?Au(Ku):xu!==void 0?typeof Nu=="string"?Au(Ku).fill(xu,Nu):Au(Ku).fill(xu):Au(Ku)}$u.alloc=function(Ku,xu,Nu){return Ru(Ku,xu,Nu)};function Pu(Ku){return Su(Ku),Au(Ku<0?0:Wu(Ku)|0)}$u.allocUnsafe=function(Ku){return Pu(Ku)},$u.allocUnsafeSlow=function(Ku){return Pu(Ku)};function Cu(Ku,xu){if((typeof xu!="string"||xu==="")&&(xu="utf8"),!$u.isEncoding(xu))throw new TypeError("Unknown encoding: "+xu);const Nu=Xu(Ku,xu)|0;let rl=Au(Nu);const ml=rl.write(Ku,xu);return ml!==Nu&&(rl=rl.slice(0,ml)),rl}function Bu(Ku){const xu=Ku.length<0?0:Wu(Ku.length)|0,Nu=Au(xu);for(let rl=0;rl<xu;rl+=1)Nu[rl]=Ku[rl]&255;return Nu}function Fu(Ku){if(Gl(Ku,Zs)){const xu=new Zs(Ku);return zu(xu.buffer,xu.byteOffset,xu.byteLength)}return Bu(Ku)}function zu(Ku,xu,Nu){if(xu<0||Ku.byteLength<xu)throw new RangeError('"offset" is outside of buffer bounds');if(Ku.byteLength<xu+(Nu||0))throw new RangeError('"length" is outside of buffer bounds');let rl;return xu===void 0&&Nu===void 0?rl=new Zs(Ku):Nu===void 0?rl=new Zs(Ku,xu):rl=new Zs(Ku,xu,Nu),Object.setPrototypeOf(rl,$u.prototype),rl}function Hu(Ku){if($u.isBuffer(Ku)){const xu=Wu(Ku.length)|0,Nu=Au(xu);return Nu.length===0||Ku.copy(Nu,0,0,xu),Nu}if(Ku.length!==void 0)return typeof Ku.length!="number"||Ql(Ku.length)?Au(0):Bu(Ku);if(Ku.type==="Buffer"&&Array.isArray(Ku.data))return Bu(Ku.data)}function Wu(Ku){if(Ku>=Ys)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Ys.toString(16)+" bytes");return Ku|0}function tl(Ku){return+Ku!=Ku&&(Ku=0),$u.alloc(+Ku)}$u.isBuffer=function(xu){return xu!=null&&xu._isBuffer===!0&&xu!==$u.prototype},$u.compare=function(xu,Nu){if(Gl(xu,Zs)&&(xu=$u.from(xu,xu.offset,xu.byteLength)),Gl(Nu,Zs)&&(Nu=$u.from(Nu,Nu.offset,Nu.byteLength)),!$u.isBuffer(xu)||!$u.isBuffer(Nu))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(xu===Nu)return 0;let rl=xu.length,ml=Nu.length;for(let Il=0,Cl=Math.min(rl,ml);Il<Cl;++Il)if(xu[Il]!==Nu[Il]){rl=xu[Il],ml=Nu[Il];break}return rl<ml?-1:ml<rl?1:0},$u.isEncoding=function(xu){switch(String(xu).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},$u.concat=function(xu,Nu){if(!Array.isArray(xu))throw new TypeError('"list" argument must be an Array of Buffers');if(xu.length===0)return $u.alloc(0);let rl;if(Nu===void 0)for(Nu=0,rl=0;rl<xu.length;++rl)Nu+=xu[rl].length;const ml=$u.allocUnsafe(Nu);let Il=0;for(rl=0;rl<xu.length;++rl){let Cl=xu[rl];if(Gl(Cl,Zs))Il+Cl.length>ml.length?($u.isBuffer(Cl)||(Cl=$u.from(Cl)),Cl.copy(ml,Il)):Zs.prototype.set.call(ml,Cl,Il);else if($u.isBuffer(Cl))Cl.copy(ml,Il);else throw new TypeError('"list" argument must be an Array of Buffers');Il+=Cl.length}return ml};function Xu(Ku,xu){if($u.isBuffer(Ku))return Ku.length;if(_u.isView(Ku)||Gl(Ku,_u))return Ku.byteLength;if(typeof Ku!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof Ku);const Nu=Ku.length,rl=arguments.length>2&&arguments[2]===!0;if(!rl&&Nu===0)return 0;let ml=!1;for(;;)switch(xu){case"ascii":case"latin1":case"binary":return Nu;case"utf8":case"utf-8":return wl(Ku).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Nu*2;case"hex":return Nu>>>1;case"base64":return Fl(Ku).length;default:if(ml)return rl?-1:wl(Ku).length;xu=(""+xu).toLowerCase(),ml=!0}}$u.byteLength=Xu;function ju(Ku,xu,Nu){let rl=!1;if((xu===void 0||xu<0)&&(xu=0),xu>this.length||((Nu===void 0||Nu>this.length)&&(Nu=this.length),Nu<=0)||(Nu>>>=0,xu>>>=0,Nu<=xu))return"";for(Ku||(Ku="utf8");;)switch(Ku){case"hex":return ol(this,xu,Nu);case"utf8":case"utf-8":return dl(this,xu,Nu);case"ascii":return _l(this,xu,Nu);case"latin1":case"binary":return Rl(this,xu,Nu);case"base64":return Zu(this,xu,Nu);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return gl(this,xu,Nu);default:if(rl)throw new TypeError("Unknown encoding: "+Ku);Ku=(Ku+"").toLowerCase(),rl=!0}}$u.prototype._isBuffer=!0;function ku(Ku,xu,Nu){const rl=Ku[xu];Ku[xu]=Ku[Nu],Ku[Nu]=rl}$u.prototype.swap16=function(){const xu=this.length;if(xu%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let Nu=0;Nu<xu;Nu+=2)ku(this,Nu,Nu+1);return this},$u.prototype.swap32=function(){const xu=this.length;if(xu%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let Nu=0;Nu<xu;Nu+=4)ku(this,Nu,Nu+3),ku(this,Nu+1,Nu+2);return this},$u.prototype.swap64=function(){const xu=this.length;if(xu%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let Nu=0;Nu<xu;Nu+=8)ku(this,Nu,Nu+7),ku(this,Nu+1,Nu+6),ku(this,Nu+2,Nu+5),ku(this,Nu+3,Nu+4);return this},$u.prototype.toString=function(){const xu=this.length;return xu===0?"":arguments.length===0?dl(this,0,xu):ju.apply(this,arguments)},$u.prototype.toLocaleString=$u.prototype.toString,$u.prototype.equals=function(xu){if(!$u.isBuffer(xu))throw new TypeError("Argument must be a Buffer");return this===xu?!0:$u.compare(this,xu)===0},$u.prototype.inspect=function(){let xu="";const Nu=Z.INSPECT_MAX_BYTES;return xu=this.toString("hex",0,Nu).replace(/(.{2})/g,"$1 ").trim(),this.length>Nu&&(xu+=" ... "),"<Buffer "+xu+">"},zs&&($u.prototype[zs]=$u.prototype.inspect),$u.prototype.compare=function(xu,Nu,rl,ml,Il){if(Gl(xu,Zs)&&(xu=$u.from(xu,xu.offset,xu.byteLength)),!$u.isBuffer(xu))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof xu);if(Nu===void 0&&(Nu=0),rl===void 0&&(rl=xu?xu.length:0),ml===void 0&&(ml=0),Il===void 0&&(Il=this.length),Nu<0||rl>xu.length||ml<0||Il>this.length)throw new RangeError("out of range index");if(ml>=Il&&Nu>=rl)return 0;if(ml>=Il)return-1;if(Nu>=rl)return 1;if(Nu>>>=0,rl>>>=0,ml>>>=0,Il>>>=0,this===xu)return 0;let Cl=Il-ml,Ml=rl-Nu;const eh=Math.min(Cl,Ml),Xl=this.slice(ml,Il),th=xu.slice(Nu,rl);for(let Yl=0;Yl<eh;++Yl)if(Xl[Yl]!==th[Yl]){Cl=Xl[Yl],Ml=th[Yl];break}return Cl<Ml?-1:Ml<Cl?1:0};function Uu(Ku,xu,Nu,rl,ml){if(Ku.length===0)return-1;if(typeof Nu=="string"?(rl=Nu,Nu=0):Nu>2147483647?Nu=2147483647:Nu<-2147483648&&(Nu=-2147483648),Nu=+Nu,Ql(Nu)&&(Nu=ml?0:Ku.length-1),Nu<0&&(Nu=Ku.length+Nu),Nu>=Ku.length){if(ml)return-1;Nu=Ku.length-1}else if(Nu<0)if(ml)Nu=0;else return-1;if(typeof xu=="string"&&(xu=$u.from(xu,rl)),$u.isBuffer(xu))return xu.length===0?-1:Gu(Ku,xu,Nu,rl,ml);if(typeof xu=="number")return xu=xu&255,typeof Zs.prototype.indexOf=="function"?ml?Zs.prototype.indexOf.call(Ku,xu,Nu):Zs.prototype.lastIndexOf.call(Ku,xu,Nu):Gu(Ku,[xu],Nu,rl,ml);throw new TypeError("val must be string, number or Buffer")}function Gu(Ku,xu,Nu,rl,ml){let Il=1,Cl=Ku.length,Ml=xu.length;if(rl!==void 0&&(rl=String(rl).toLowerCase(),rl==="ucs2"||rl==="ucs-2"||rl==="utf16le"||rl==="utf-16le")){if(Ku.length<2||xu.length<2)return-1;Il=2,Cl/=2,Ml/=2,Nu/=2}function eh(th,Yl){return Il===1?th[Yl]:th.readUInt16BE(Yl*Il)}let Xl;if(ml){let th=-1;for(Xl=Nu;Xl<Cl;Xl++)if(eh(Ku,Xl)===eh(xu,th===-1?0:Xl-th)){if(th===-1&&(th=Xl),Xl-th+1===Ml)return th*Il}else th!==-1&&(Xl-=Xl-th),th=-1}else for(Nu+Ml>Cl&&(Nu=Cl-Ml),Xl=Nu;Xl>=0;Xl--){let th=!0;for(let Yl=0;Yl<Ml;Yl++)if(eh(Ku,Xl+Yl)!==eh(xu,Yl)){th=!1;break}if(th)return Xl}return-1}$u.prototype.includes=function(xu,Nu,rl){return this.indexOf(xu,Nu,rl)!==-1},$u.prototype.indexOf=function(xu,Nu,rl){return Uu(this,xu,Nu,rl,!0)},$u.prototype.lastIndexOf=function(xu,Nu,rl){return Uu(this,xu,Nu,rl,!1)};function Yu(Ku,xu,Nu,rl){Nu=Number(Nu)||0;const ml=Ku.length-Nu;rl?(rl=Number(rl),rl>ml&&(rl=ml)):rl=ml;const Il=xu.length;rl>Il/2&&(rl=Il/2);let Cl;for(Cl=0;Cl<rl;++Cl){const Ml=parseInt(xu.substr(Cl*2,2),16);if(Ql(Ml))return Cl;Ku[Nu+Cl]=Ml}return Cl}function Qu(Ku,xu,Nu,rl){return ql(wl(xu,Ku.length-Nu),Ku,Nu,rl)}function Lu(Ku,xu,Nu,rl){return ql(Dl(xu),Ku,Nu,rl)}function cl(Ku,xu,Nu,rl){return ql(Fl(xu),Ku,Nu,rl)}function el(Ku,xu,Nu,rl){return ql(Ll(xu,Ku.length-Nu),Ku,Nu,rl)}$u.prototype.write=function(xu,Nu,rl,ml){if(Nu===void 0)ml="utf8",rl=this.length,Nu=0;else if(rl===void 0&&typeof Nu=="string")ml=Nu,rl=this.length,Nu=0;else if(isFinite(Nu))Nu=Nu>>>0,isFinite(rl)?(rl=rl>>>0,ml===void 0&&(ml="utf8")):(ml=rl,rl=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Il=this.length-Nu;if((rl===void 0||rl>Il)&&(rl=Il),xu.length>0&&(rl<0||Nu<0)||Nu>this.length)throw new RangeError("Attempt to write outside buffer bounds");ml||(ml="utf8");let Cl=!1;for(;;)switch(ml){case"hex":return Yu(this,xu,Nu,rl);case"utf8":case"utf-8":return Qu(this,xu,Nu,rl);case"ascii":case"latin1":case"binary":return Lu(this,xu,Nu,rl);case"base64":return cl(this,xu,Nu,rl);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return el(this,xu,Nu,rl);default:if(Cl)throw new TypeError("Unknown encoding: "+ml);ml=(""+ml).toLowerCase(),Cl=!0}},$u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Zu(Ku,xu,Nu){return xu===0&&Nu===Ku.length?t.fromByteArray(Ku):t.fromByteArray(Ku.slice(xu,Nu))}function dl(Ku,xu,Nu){Nu=Math.min(Ku.length,Nu);const rl=[];let ml=xu;for(;ml<Nu;){const Il=Ku[ml];let Cl=null,Ml=Il>239?4:Il>223?3:Il>191?2:1;if(ml+Ml<=Nu){let eh,Xl,th,Yl;switch(Ml){case 1:Il<128&&(Cl=Il);break;case 2:eh=Ku[ml+1],(eh&192)===128&&(Yl=(Il&31)<<6|eh&63,Yl>127&&(Cl=Yl));break;case 3:eh=Ku[ml+1],Xl=Ku[ml+2],(eh&192)===128&&(Xl&192)===128&&(Yl=(Il&15)<<12|(eh&63)<<6|Xl&63,Yl>2047&&(Yl<55296||Yl>57343)&&(Cl=Yl));break;case 4:eh=Ku[ml+1],Xl=Ku[ml+2],th=Ku[ml+3],(eh&192)===128&&(Xl&192)===128&&(th&192)===128&&(Yl=(Il&15)<<18|(eh&63)<<12|(Xl&63)<<6|th&63,Yl>65535&&Yl<1114112&&(Cl=Yl))}}Cl===null?(Cl=65533,Ml=1):Cl>65535&&(Cl-=65536,rl.push(Cl>>>10&1023|55296),Cl=56320|Cl&1023),rl.push(Cl),ml+=Ml}return hl(rl)}const El=4096;function hl(Ku){const xu=Ku.length;if(xu<=El)return String.fromCharCode.apply(String,Ku);let Nu="",rl=0;for(;rl<xu;)Nu+=String.fromCharCode.apply(String,Ku.slice(rl,rl+=El));return Nu}function _l(Ku,xu,Nu){let rl="";Nu=Math.min(Ku.length,Nu);for(let ml=xu;ml<Nu;++ml)rl+=String.fromCharCode(Ku[ml]&127);return rl}function Rl(Ku,xu,Nu){let rl="";Nu=Math.min(Ku.length,Nu);for(let ml=xu;ml<Nu;++ml)rl+=String.fromCharCode(Ku[ml]);return rl}function ol(Ku,xu,Nu){const rl=Ku.length;(!xu||xu<0)&&(xu=0),(!Nu||Nu<0||Nu>rl)&&(Nu=rl);let ml="";for(let Il=xu;Il<Nu;++Il)ml+=Hl[Ku[Il]];return ml}function gl(Ku,xu,Nu){const rl=Ku.slice(xu,Nu);let ml="";for(let Il=0;Il<rl.length-1;Il+=2)ml+=String.fromCharCode(rl[Il]+rl[Il+1]*256);return ml}$u.prototype.slice=function(xu,Nu){const rl=this.length;xu=~~xu,Nu=Nu===void 0?rl:~~Nu,xu<0?(xu+=rl,xu<0&&(xu=0)):xu>rl&&(xu=rl),Nu<0?(Nu+=rl,Nu<0&&(Nu=0)):Nu>rl&&(Nu=rl),Nu<xu&&(Nu=xu);const ml=this.subarray(xu,Nu);return Object.setPrototypeOf(ml,$u.prototype),ml};function nl(Ku,xu,Nu){if(Ku%1!==0||Ku<0)throw new RangeError("offset is not uint");if(Ku+xu>Nu)throw new RangeError("Trying to access beyond buffer length")}$u.prototype.readUintLE=$u.prototype.readUIntLE=function(xu,Nu,rl){xu=xu>>>0,Nu=Nu>>>0,rl||nl(xu,Nu,this.length);let ml=this[xu],Il=1,Cl=0;for(;++Cl<Nu&&(Il*=256);)ml+=this[xu+Cl]*Il;return ml},$u.prototype.readUintBE=$u.prototype.readUIntBE=function(xu,Nu,rl){xu=xu>>>0,Nu=Nu>>>0,rl||nl(xu,Nu,this.length);let ml=this[xu+--Nu],Il=1;for(;Nu>0&&(Il*=256);)ml+=this[xu+--Nu]*Il;return ml},$u.prototype.readUint8=$u.prototype.readUInt8=function(xu,Nu){return xu=xu>>>0,Nu||nl(xu,1,this.length),this[xu]},$u.prototype.readUint16LE=$u.prototype.readUInt16LE=function(xu,Nu){return xu=xu>>>0,Nu||nl(xu,2,this.length),this[xu]|this[xu+1]<<8},$u.prototype.readUint16BE=$u.prototype.readUInt16BE=function(xu,Nu){return xu=xu>>>0,Nu||nl(xu,2,this.length),this[xu]<<8|this[xu+1]},$u.prototype.readUint32LE=$u.prototype.readUInt32LE=function(xu,Nu){return xu=xu>>>0,Nu||nl(xu,4,this.length),(this[xu]|this[xu+1]<<8|this[xu+2]<<16)+this[xu+3]*16777216},$u.prototype.readUint32BE=$u.prototype.readUInt32BE=function(xu,Nu){return xu=xu>>>0,Nu||nl(xu,4,this.length),this[xu]*16777216+(this[xu+1]<<16|this[xu+2]<<8|this[xu+3])},$u.prototype.readBigUInt64LE=jl(function(xu){xu=xu>>>0,yl(xu,"offset");const Nu=this[xu],rl=this[xu+7];(Nu===void 0||rl===void 0)&&fl(xu,this.length-8);const ml=Nu+this[++xu]*2**8+this[++xu]*2**16+this[++xu]*2**24,Il=this[++xu]+this[++xu]*2**8+this[++xu]*2**16+rl*2**24;return BigInt(ml)+(BigInt(Il)<<BigInt(32))}),$u.prototype.readBigUInt64BE=jl(function(xu){xu=xu>>>0,yl(xu,"offset");const Nu=this[xu],rl=this[xu+7];(Nu===void 0||rl===void 0)&&fl(xu,this.length-8);const ml=Nu*2**24+this[++xu]*2**16+this[++xu]*2**8+this[++xu],Il=this[++xu]*2**24+this[++xu]*2**16+this[++xu]*2**8+rl;return(BigInt(ml)<<BigInt(32))+BigInt(Il)}),$u.prototype.readIntLE=function(xu,Nu,rl){xu=xu>>>0,Nu=Nu>>>0,rl||nl(xu,Nu,this.length);let ml=this[xu],Il=1,Cl=0;for(;++Cl<Nu&&(Il*=256);)ml+=this[xu+Cl]*Il;return Il*=128,ml>=Il&&(ml-=Math.pow(2,8*Nu)),ml},$u.prototype.readIntBE=function(xu,Nu,rl){xu=xu>>>0,Nu=Nu>>>0,rl||nl(xu,Nu,this.length);let ml=Nu,Il=1,Cl=this[xu+--ml];for(;ml>0&&(Il*=256);)Cl+=this[xu+--ml]*Il;return Il*=128,Cl>=Il&&(Cl-=Math.pow(2,8*Nu)),Cl},$u.prototype.readInt8=function(xu,Nu){return xu=xu>>>0,Nu||nl(xu,1,this.length),this[xu]&128?(255-this[xu]+1)*-1:this[xu]},$u.prototype.readInt16LE=function(xu,Nu){xu=xu>>>0,Nu||nl(xu,2,this.length);const rl=this[xu]|this[xu+1]<<8;return rl&32768?rl|4294901760:rl},$u.prototype.readInt16BE=function(xu,Nu){xu=xu>>>0,Nu||nl(xu,2,this.length);const rl=this[xu+1]|this[xu]<<8;return rl&32768?rl|4294901760:rl},$u.prototype.readInt32LE=function(xu,Nu){return xu=xu>>>0,Nu||nl(xu,4,this.length),this[xu]|this[xu+1]<<8|this[xu+2]<<16|this[xu+3]<<24},$u.prototype.readInt32BE=function(xu,Nu){return xu=xu>>>0,Nu||nl(xu,4,this.length),this[xu]<<24|this[xu+1]<<16|this[xu+2]<<8|this[xu+3]},$u.prototype.readBigInt64LE=jl(function(xu){xu=xu>>>0,yl(xu,"offset");const Nu=this[xu],rl=this[xu+7];(Nu===void 0||rl===void 0)&&fl(xu,this.length-8);const ml=this[xu+4]+this[xu+5]*2**8+this[xu+6]*2**16+(rl<<24);return(BigInt(ml)<<BigInt(32))+BigInt(Nu+this[++xu]*2**8+this[++xu]*2**16+this[++xu]*2**24)}),$u.prototype.readBigInt64BE=jl(function(xu){xu=xu>>>0,yl(xu,"offset");const Nu=this[xu],rl=this[xu+7];(Nu===void 0||rl===void 0)&&fl(xu,this.length-8);const ml=(Nu<<24)+this[++xu]*2**16+this[++xu]*2**8+this[++xu];return(BigInt(ml)<<BigInt(32))+BigInt(this[++xu]*2**24+this[++xu]*2**16+this[++xu]*2**8+rl)}),$u.prototype.readFloatLE=function(xu,Nu){return xu=xu>>>0,Nu||nl(xu,4,this.length),Hs.read(this,xu,!0,23,4)},$u.prototype.readFloatBE=function(xu,Nu){return xu=xu>>>0,Nu||nl(xu,4,this.length),Hs.read(this,xu,!1,23,4)},$u.prototype.readDoubleLE=function(xu,Nu){return xu=xu>>>0,Nu||nl(xu,8,this.length),Hs.read(this,xu,!0,52,8)},$u.prototype.readDoubleBE=function(xu,Nu){return xu=xu>>>0,Nu||nl(xu,8,this.length),Hs.read(this,xu,!1,52,8)};function Sl(Ku,xu,Nu,rl,ml,Il){if(!$u.isBuffer(Ku))throw new TypeError('"buffer" argument must be a Buffer instance');if(xu>ml||xu<Il)throw new RangeError('"value" argument is out of bounds');if(Nu+rl>Ku.length)throw new RangeError("Index out of range")}$u.prototype.writeUintLE=$u.prototype.writeUIntLE=function(xu,Nu,rl,ml){if(xu=+xu,Nu=Nu>>>0,rl=rl>>>0,!ml){const Ml=Math.pow(2,8*rl)-1;Sl(this,xu,Nu,rl,Ml,0)}let Il=1,Cl=0;for(this[Nu]=xu&255;++Cl<rl&&(Il*=256);)this[Nu+Cl]=xu/Il&255;return Nu+rl},$u.prototype.writeUintBE=$u.prototype.writeUIntBE=function(xu,Nu,rl,ml){if(xu=+xu,Nu=Nu>>>0,rl=rl>>>0,!ml){const Ml=Math.pow(2,8*rl)-1;Sl(this,xu,Nu,rl,Ml,0)}let Il=rl-1,Cl=1;for(this[Nu+Il]=xu&255;--Il>=0&&(Cl*=256);)this[Nu+Il]=xu/Cl&255;return Nu+rl},$u.prototype.writeUint8=$u.prototype.writeUInt8=function(xu,Nu,rl){return xu=+xu,Nu=Nu>>>0,rl||Sl(this,xu,Nu,1,255,0),this[Nu]=xu&255,Nu+1},$u.prototype.writeUint16LE=$u.prototype.writeUInt16LE=function(xu,Nu,rl){return xu=+xu,Nu=Nu>>>0,rl||Sl(this,xu,Nu,2,65535,0),this[Nu]=xu&255,this[Nu+1]=xu>>>8,Nu+2},$u.prototype.writeUint16BE=$u.prototype.writeUInt16BE=function(xu,Nu,rl){return xu=+xu,Nu=Nu>>>0,rl||Sl(this,xu,Nu,2,65535,0),this[Nu]=xu>>>8,this[Nu+1]=xu&255,Nu+2},$u.prototype.writeUint32LE=$u.prototype.writeUInt32LE=function(xu,Nu,rl){return xu=+xu,Nu=Nu>>>0,rl||Sl(this,xu,Nu,4,4294967295,0),this[Nu+3]=xu>>>24,this[Nu+2]=xu>>>16,this[Nu+1]=xu>>>8,this[Nu]=xu&255,Nu+4},$u.prototype.writeUint32BE=$u.prototype.writeUInt32BE=function(xu,Nu,rl){return xu=+xu,Nu=Nu>>>0,rl||Sl(this,xu,Nu,4,4294967295,0),this[Nu]=xu>>>24,this[Nu+1]=xu>>>16,this[Nu+2]=xu>>>8,this[Nu+3]=xu&255,Nu+4};function ll(Ku,xu,Nu,rl,ml){pl(xu,rl,ml,Ku,Nu,7);let Il=Number(xu&BigInt(4294967295));Ku[Nu++]=Il,Il=Il>>8,Ku[Nu++]=Il,Il=Il>>8,Ku[Nu++]=Il,Il=Il>>8,Ku[Nu++]=Il;let Cl=Number(xu>>BigInt(32)&BigInt(4294967295));return Ku[Nu++]=Cl,Cl=Cl>>8,Ku[Nu++]=Cl,Cl=Cl>>8,Ku[Nu++]=Cl,Cl=Cl>>8,Ku[Nu++]=Cl,Nu}function ul(Ku,xu,Nu,rl,ml){pl(xu,rl,ml,Ku,Nu,7);let Il=Number(xu&BigInt(4294967295));Ku[Nu+7]=Il,Il=Il>>8,Ku[Nu+6]=Il,Il=Il>>8,Ku[Nu+5]=Il,Il=Il>>8,Ku[Nu+4]=Il;let Cl=Number(xu>>BigInt(32)&BigInt(4294967295));return Ku[Nu+3]=Cl,Cl=Cl>>8,Ku[Nu+2]=Cl,Cl=Cl>>8,Ku[Nu+1]=Cl,Cl=Cl>>8,Ku[Nu]=Cl,Nu+8}$u.prototype.writeBigUInt64LE=jl(function(xu,Nu=0){return ll(this,xu,Nu,BigInt(0),BigInt("0xffffffffffffffff"))}),$u.prototype.writeBigUInt64BE=jl(function(xu,Nu=0){return ul(this,xu,Nu,BigInt(0),BigInt("0xffffffffffffffff"))}),$u.prototype.writeIntLE=function(xu,Nu,rl,ml){if(xu=+xu,Nu=Nu>>>0,!ml){const eh=Math.pow(2,8*rl-1);Sl(this,xu,Nu,rl,eh-1,-eh)}let Il=0,Cl=1,Ml=0;for(this[Nu]=xu&255;++Il<rl&&(Cl*=256);)xu<0&&Ml===0&&this[Nu+Il-1]!==0&&(Ml=1),this[Nu+Il]=(xu/Cl>>0)-Ml&255;return Nu+rl},$u.prototype.writeIntBE=function(xu,Nu,rl,ml){if(xu=+xu,Nu=Nu>>>0,!ml){const eh=Math.pow(2,8*rl-1);Sl(this,xu,Nu,rl,eh-1,-eh)}let Il=rl-1,Cl=1,Ml=0;for(this[Nu+Il]=xu&255;--Il>=0&&(Cl*=256);)xu<0&&Ml===0&&this[Nu+Il+1]!==0&&(Ml=1),this[Nu+Il]=(xu/Cl>>0)-Ml&255;return Nu+rl},$u.prototype.writeInt8=function(xu,Nu,rl){return xu=+xu,Nu=Nu>>>0,rl||Sl(this,xu,Nu,1,127,-128),xu<0&&(xu=255+xu+1),this[Nu]=xu&255,Nu+1},$u.prototype.writeInt16LE=function(xu,Nu,rl){return xu=+xu,Nu=Nu>>>0,rl||Sl(this,xu,Nu,2,32767,-32768),this[Nu]=xu&255,this[Nu+1]=xu>>>8,Nu+2},$u.prototype.writeInt16BE=function(xu,Nu,rl){return xu=+xu,Nu=Nu>>>0,rl||Sl(this,xu,Nu,2,32767,-32768),this[Nu]=xu>>>8,this[Nu+1]=xu&255,Nu+2},$u.prototype.writeInt32LE=function(xu,Nu,rl){return xu=+xu,Nu=Nu>>>0,rl||Sl(this,xu,Nu,4,2147483647,-2147483648),this[Nu]=xu&255,this[Nu+1]=xu>>>8,this[Nu+2]=xu>>>16,this[Nu+3]=xu>>>24,Nu+4},$u.prototype.writeInt32BE=function(xu,Nu,rl){return xu=+xu,Nu=Nu>>>0,rl||Sl(this,xu,Nu,4,2147483647,-2147483648),xu<0&&(xu=4294967295+xu+1),this[Nu]=xu>>>24,this[Nu+1]=xu>>>16,this[Nu+2]=xu>>>8,this[Nu+3]=xu&255,Nu+4},$u.prototype.writeBigInt64LE=jl(function(xu,Nu=0){return ll(this,xu,Nu,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),$u.prototype.writeBigInt64BE=jl(function(xu,Nu=0){return ul(this,xu,Nu,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Al(Ku,xu,Nu,rl,ml,Il){if(Nu+rl>Ku.length)throw new RangeError("Index out of range");if(Nu<0)throw new RangeError("Index out of range")}function Tl(Ku,xu,Nu,rl,ml){return xu=+xu,Nu=Nu>>>0,ml||Al(Ku,xu,Nu,4),Hs.write(Ku,xu,Nu,rl,23,4),Nu+4}$u.prototype.writeFloatLE=function(xu,Nu,rl){return Tl(this,xu,Nu,!0,rl)},$u.prototype.writeFloatBE=function(xu,Nu,rl){return Tl(this,xu,Nu,!1,rl)};function qu(Ku,xu,Nu,rl,ml){return xu=+xu,Nu=Nu>>>0,ml||Al(Ku,xu,Nu,8),Hs.write(Ku,xu,Nu,rl,52,8),Nu+8}$u.prototype.writeDoubleLE=function(xu,Nu,rl){return qu(this,xu,Nu,!0,rl)},$u.prototype.writeDoubleBE=function(xu,Nu,rl){return qu(this,xu,Nu,!1,rl)},$u.prototype.copy=function(xu,Nu,rl,ml){if(!$u.isBuffer(xu))throw new TypeError("argument should be a Buffer");if(rl||(rl=0),!ml&&ml!==0&&(ml=this.length),Nu>=xu.length&&(Nu=xu.length),Nu||(Nu=0),ml>0&&ml<rl&&(ml=rl),ml===rl||xu.length===0||this.length===0)return 0;if(Nu<0)throw new RangeError("targetStart out of bounds");if(rl<0||rl>=this.length)throw new RangeError("Index out of range");if(ml<0)throw new RangeError("sourceEnd out of bounds");ml>this.length&&(ml=this.length),xu.length-Nu<ml-rl&&(ml=xu.length-Nu+rl);const Il=ml-rl;return this===xu&&typeof Zs.prototype.copyWithin=="function"?this.copyWithin(Nu,rl,ml):Zs.prototype.set.call(xu,this.subarray(rl,ml),Nu),Il},$u.prototype.fill=function(xu,Nu,rl,ml){if(typeof xu=="string"){if(typeof Nu=="string"?(ml=Nu,Nu=0,rl=this.length):typeof rl=="string"&&(ml=rl,rl=this.length),ml!==void 0&&typeof ml!="string")throw new TypeError("encoding must be a string");if(typeof ml=="string"&&!$u.isEncoding(ml))throw new TypeError("Unknown encoding: "+ml);if(xu.length===1){const Cl=xu.charCodeAt(0);(ml==="utf8"&&Cl<128||ml==="latin1")&&(xu=Cl)}}else typeof xu=="number"?xu=xu&255:typeof xu=="boolean"&&(xu=Number(xu));if(Nu<0||this.length<Nu||this.length<rl)throw new RangeError("Out of range index");if(rl<=Nu)return this;Nu=Nu>>>0,rl=rl===void 0?this.length:rl>>>0,xu||(xu=0);let Il;if(typeof xu=="number")for(Il=Nu;Il<rl;++Il)this[Il]=xu;else{const Cl=$u.isBuffer(xu)?xu:$u.from(xu,ml),Ml=Cl.length;if(Ml===0)throw new TypeError('The value "'+xu+'" is invalid for argument "value"');for(Il=0;Il<rl-Nu;++Il)this[Il+Nu]=Cl[Il%Ml]}return this};const Ou={};function Vu(Ku,xu,Nu){Ou[Ku]=class extends Nu{constructor(){super(),Object.defineProperty(this,"message",{value:xu.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${Ku}]`,this.stack,delete this.name}get code(){return Ku}set code(ml){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:ml,writable:!0})}toString(){return`${this.name} [${Ku}]: ${this.message}`}}}Vu("ERR_BUFFER_OUT_OF_BOUNDS",function(Ku){return Ku?`${Ku} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Vu("ERR_INVALID_ARG_TYPE",function(Ku,xu){return`The "${Ku}" argument must be of type number. Received type ${typeof xu}`},TypeError),Vu("ERR_OUT_OF_RANGE",function(Ku,xu,Nu){let rl=`The value of "${Ku}" is out of range.`,ml=Nu;return Number.isInteger(Nu)&&Math.abs(Nu)>2**32?ml=il(String(Nu)):typeof Nu=="bigint"&&(ml=String(Nu),(Nu>BigInt(2)**BigInt(32)||Nu<-(BigInt(2)**BigInt(32)))&&(ml=il(ml)),ml+="n"),rl+=` It must be ${xu}. Received ${ml}`,rl},RangeError);function il(Ku){let xu="",Nu=Ku.length;const rl=Ku[0]==="-"?1:0;for(;Nu>=rl+4;Nu-=3)xu=`_${Ku.slice(Nu-3,Nu)}${xu}`;return`${Ku.slice(0,Nu)}${xu}`}function sl(Ku,xu,Nu){yl(xu,"offset"),(Ku[xu]===void 0||Ku[xu+Nu]===void 0)&&fl(xu,Ku.length-(Nu+1))}function pl(Ku,xu,Nu,rl,ml,Il){if(Ku>Nu||Ku<xu){const Cl=typeof xu=="bigint"?"n":"";let Ml;throw Il>3?xu===0||xu===BigInt(0)?Ml=`>= 0${Cl} and < 2${Cl} ** ${(Il+1)*8}${Cl}`:Ml=`>= -(2${Cl} ** ${(Il+1)*8-1}${Cl}) and < 2 ** ${(Il+1)*8-1}${Cl}`:Ml=`>= ${xu}${Cl} and <= ${Nu}${Cl}`,new Ou.ERR_OUT_OF_RANGE("value",Ml,Ku)}sl(rl,ml,Il)}function yl(Ku,xu){if(typeof Ku!="number")throw new Ou.ERR_INVALID_ARG_TYPE(xu,"number",Ku)}function fl(Ku,xu,Nu){throw Math.floor(Ku)!==Ku?(yl(Ku,Nu),new Ou.ERR_OUT_OF_RANGE(Nu||"offset","an integer",Ku)):xu<0?new Ou.ERR_BUFFER_OUT_OF_BOUNDS:new Ou.ERR_OUT_OF_RANGE(Nu||"offset",`>= ${Nu?1:0} and <= ${xu}`,Ku)}const bl=/[^+/0-9A-Za-z-_]/g;function al(Ku){if(Ku=Ku.split("=")[0],Ku=Ku.trim().replace(bl,""),Ku.length<2)return"";for(;Ku.length%4!==0;)Ku=Ku+"=";return Ku}function wl(Ku,xu){xu=xu||1/0;let Nu;const rl=Ku.length;let ml=null;const Il=[];for(let Cl=0;Cl<rl;++Cl){if(Nu=Ku.charCodeAt(Cl),Nu>55295&&Nu<57344){if(!ml){if(Nu>56319){(xu-=3)>-1&&Il.push(239,191,189);continue}else if(Cl+1===rl){(xu-=3)>-1&&Il.push(239,191,189);continue}ml=Nu;continue}if(Nu<56320){(xu-=3)>-1&&Il.push(239,191,189),ml=Nu;continue}Nu=(ml-55296<<10|Nu-56320)+65536}else ml&&(xu-=3)>-1&&Il.push(239,191,189);if(ml=null,Nu<128){if((xu-=1)<0)break;Il.push(Nu)}else if(Nu<2048){if((xu-=2)<0)break;Il.push(Nu>>6|192,Nu&63|128)}else if(Nu<65536){if((xu-=3)<0)break;Il.push(Nu>>12|224,Nu>>6&63|128,Nu&63|128)}else if(Nu<1114112){if((xu-=4)<0)break;Il.push(Nu>>18|240,Nu>>12&63|128,Nu>>6&63|128,Nu&63|128)}else throw new Error("Invalid code point")}return Il}function Dl(Ku){const xu=[];for(let Nu=0;Nu<Ku.length;++Nu)xu.push(Ku.charCodeAt(Nu)&255);return xu}function Ll(Ku,xu){let Nu,rl,ml;const Il=[];for(let Cl=0;Cl<Ku.length&&!((xu-=2)<0);++Cl)Nu=Ku.charCodeAt(Cl),rl=Nu>>8,ml=Nu%256,Il.push(ml),Il.push(rl);return Il}function Fl(Ku){return t.toByteArray(al(Ku))}function ql(Ku,xu,Nu,rl){let ml;for(ml=0;ml<rl&&!(ml+Nu>=xu.length||ml>=Ku.length);++ml)xu[ml+Nu]=Ku[ml];return ml}function Gl(Ku,xu){return Ku instanceof xu||Ku!=null&&Ku.constructor!=null&&Ku.constructor.name!=null&&Ku.constructor.name===xu.name}function Ql(Ku){return Ku!==Ku}const Hl=function(){const Ku="0123456789abcdef",xu=new Array(256);for(let Nu=0;Nu<16;++Nu){const rl=Nu*16;for(let ml=0;ml<16;++ml)xu[rl+ml]=Ku[Nu]+Ku[ml]}return xu}();function jl(Ku){return typeof BigInt>"u"?rh:Ku}function rh(){throw new Error("BigInt not supported")}})(buffer);const Buffer$1=buffer.Buffer,Blob$1=buffer.Blob,BlobOptions=buffer.BlobOptions,Buffer$1$1=buffer.Buffer,File=buffer.File,FileOptions=buffer.FileOptions,INSPECT_MAX_BYTES=buffer.INSPECT_MAX_BYTES,SlowBuffer=buffer.SlowBuffer,TranscodeEncoding=buffer.TranscodeEncoding,atob$1=buffer.atob,btoa$1=buffer.btoa,constants$3=buffer.constants,isAscii=buffer.isAscii,isUtf8=buffer.isUtf8,kMaxLength=buffer.kMaxLength,kStringMaxLength=buffer.kStringMaxLength,resolveObjectURL=buffer.resolveObjectURL,transcode=buffer.transcode,dist$2=Object.freeze(Object.defineProperty({__proto__:null,Blob:Blob$1,BlobOptions,Buffer:Buffer$1$1,File,FileOptions,INSPECT_MAX_BYTES,SlowBuffer,TranscodeEncoding,atob:atob$1,btoa:btoa$1,constants:constants$3,default:Buffer$1,isAscii,isUtf8,kMaxLength,kStringMaxLength,resolveObjectURL,transcode},Symbol.toStringTag,{value:"Module"}));var commonjsGlobal$2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function getDefaultExportFromCjs(Z){return Z&&Z.__esModule&&Object.prototype.hasOwnProperty.call(Z,"default")?Z.default:Z}function getAugmentedNamespace(Z){if(Z.__esModule)return Z;var t=Z.default;if(typeof t=="function"){var Hs=function zs(){return this instanceof zs?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};Hs.prototype=t.prototype}else Hs={};return Object.defineProperty(Hs,"__esModule",{value:!0}),Object.keys(Z).forEach(function(zs){var Ys=Object.getOwnPropertyDescriptor(Z,zs);Object.defineProperty(Hs,zs,Ys.get?Ys:{enumerable:!0,get:function(){return Z[zs]}})}),Hs}var browser$2={},canPromise$1=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},qrcode={},utils$4={};let toSJISFunction;const CODEWORDS_COUNT=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];utils$4.getSymbolSize=function(t){if(!t)throw new Error('"version" cannot be null or undefined');if(t<1||t>40)throw new Error('"version" should be in range from 1 to 40');return t*4+17};utils$4.getSymbolTotalCodewords=function(t){return CODEWORDS_COUNT[t]};utils$4.getBCHDigit=function(Z){let t=0;for(;Z!==0;)t++,Z>>>=1;return t};utils$4.setToSJISFunction=function(t){if(typeof t!="function")throw new Error('"toSJISFunc" is not a valid function.');toSJISFunction=t};utils$4.isKanjiModeEnabled=function(){return typeof toSJISFunction<"u"};utils$4.toSJIS=function(t){return toSJISFunction(t)};var errorCorrectionLevel={};(function(Z){Z.L={bit:1},Z.M={bit:0},Z.Q={bit:3},Z.H={bit:2};function t(Hs){if(typeof Hs!="string")throw new Error("Param is not a string");switch(Hs.toLowerCase()){case"l":case"low":return Z.L;case"m":case"medium":return Z.M;case"q":case"quartile":return Z.Q;case"h":case"high":return Z.H;default:throw new Error("Unknown EC Level: "+Hs)}}Z.isValid=function(zs){return zs&&typeof zs.bit<"u"&&zs.bit>=0&&zs.bit<4},Z.from=function(zs,Ys){if(Z.isValid(zs))return zs;try{return t(zs)}catch{return Ys}}})(errorCorrectionLevel);function BitBuffer$1(){this.buffer=[],this.length=0}BitBuffer$1.prototype={get:function(Z){const t=Math.floor(Z/8);return(this.buffer[t]>>>7-Z%8&1)===1},put:function(Z,t){for(let Hs=0;Hs<t;Hs++)this.putBit((Z>>>t-Hs-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(Z){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),Z&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var bitBuffer=BitBuffer$1;function BitMatrix$1(Z){if(!Z||Z<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=Z,this.data=new Uint8Array(Z*Z),this.reservedBit=new Uint8Array(Z*Z)}BitMatrix$1.prototype.set=function(Z,t,Hs,zs){const Ys=Z*this.size+t;this.data[Ys]=Hs,zs&&(this.reservedBit[Ys]=!0)};BitMatrix$1.prototype.get=function(Z,t){return this.data[Z*this.size+t]};BitMatrix$1.prototype.xor=function(Z,t,Hs){this.data[Z*this.size+t]^=Hs};BitMatrix$1.prototype.isReserved=function(Z,t){return this.reservedBit[Z*this.size+t]};var bitMatrix=BitMatrix$1,alignmentPattern={};(function(Z){const t=utils$4.getSymbolSize;Z.getRowColCoords=function(zs){if(zs===1)return[];const Ys=Math.floor(zs/7)+2,Zs=t(zs),_u=Zs===145?26:Math.ceil((Zs-13)/(2*Ys-2))*2,Eu=[Zs-7];for(let Iu=1;Iu<Ys-1;Iu++)Eu[Iu]=Eu[Iu-1]-_u;return Eu.push(6),Eu.reverse()},Z.getPositions=function(zs){const Ys=[],Zs=Z.getRowColCoords(zs),_u=Zs.length;for(let Eu=0;Eu<_u;Eu++)for(let Iu=0;Iu<_u;Iu++)Eu===0&&Iu===0||Eu===0&&Iu===_u-1||Eu===_u-1&&Iu===0||Ys.push([Zs[Eu],Zs[Iu]]);return Ys}})(alignmentPattern);var finderPattern={};const getSymbolSize=utils$4.getSymbolSize,FINDER_PATTERN_SIZE=7;finderPattern.getPositions=function(t){const Hs=getSymbolSize(t);return[[0,0],[Hs-FINDER_PATTERN_SIZE,0],[0,Hs-FINDER_PATTERN_SIZE]]};var maskPattern={};(function(Z){Z.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const t={N1:3,N2:3,N3:40,N4:10};Z.isValid=function(Ys){return Ys!=null&&Ys!==""&&!isNaN(Ys)&&Ys>=0&&Ys<=7},Z.from=function(Ys){return Z.isValid(Ys)?parseInt(Ys,10):void 0},Z.getPenaltyN1=function(Ys){const Zs=Ys.size;let _u=0,Eu=0,Iu=0,Au=null,$u=null;for(let vu=0;vu<Zs;vu++){Eu=Iu=0,Au=$u=null;for(let Su=0;Su<Zs;Su++){let Ru=Ys.get(vu,Su);Ru===Au?Eu++:(Eu>=5&&(_u+=t.N1+(Eu-5)),Au=Ru,Eu=1),Ru=Ys.get(Su,vu),Ru===$u?Iu++:(Iu>=5&&(_u+=t.N1+(Iu-5)),$u=Ru,Iu=1)}Eu>=5&&(_u+=t.N1+(Eu-5)),Iu>=5&&(_u+=t.N1+(Iu-5))}return _u},Z.getPenaltyN2=function(Ys){const Zs=Ys.size;let _u=0;for(let Eu=0;Eu<Zs-1;Eu++)for(let Iu=0;Iu<Zs-1;Iu++){const Au=Ys.get(Eu,Iu)+Ys.get(Eu,Iu+1)+Ys.get(Eu+1,Iu)+Ys.get(Eu+1,Iu+1);(Au===4||Au===0)&&_u++}return _u*t.N2},Z.getPenaltyN3=function(Ys){const Zs=Ys.size;let _u=0,Eu=0,Iu=0;for(let Au=0;Au<Zs;Au++){Eu=Iu=0;for(let $u=0;$u<Zs;$u++)Eu=Eu<<1&2047|Ys.get(Au,$u),$u>=10&&(Eu===1488||Eu===93)&&_u++,Iu=Iu<<1&2047|Ys.get($u,Au),$u>=10&&(Iu===1488||Iu===93)&&_u++}return _u*t.N3},Z.getPenaltyN4=function(Ys){let Zs=0;const _u=Ys.data.length;for(let Iu=0;Iu<_u;Iu++)Zs+=Ys.data[Iu];return Math.abs(Math.ceil(Zs*100/_u/5)-10)*t.N4};function Hs(zs,Ys,Zs){switch(zs){case Z.Patterns.PATTERN000:return(Ys+Zs)%2===0;case Z.Patterns.PATTERN001:return Ys%2===0;case Z.Patterns.PATTERN010:return Zs%3===0;case Z.Patterns.PATTERN011:return(Ys+Zs)%3===0;case Z.Patterns.PATTERN100:return(Math.floor(Ys/2)+Math.floor(Zs/3))%2===0;case Z.Patterns.PATTERN101:return Ys*Zs%2+Ys*Zs%3===0;case Z.Patterns.PATTERN110:return(Ys*Zs%2+Ys*Zs%3)%2===0;case Z.Patterns.PATTERN111:return(Ys*Zs%3+(Ys+Zs)%2)%2===0;default:throw new Error("bad maskPattern:"+zs)}}Z.applyMask=function(Ys,Zs){const _u=Zs.size;for(let Eu=0;Eu<_u;Eu++)for(let Iu=0;Iu<_u;Iu++)Zs.isReserved(Iu,Eu)||Zs.xor(Iu,Eu,Hs(Ys,Iu,Eu))},Z.getBestMask=function(Ys,Zs){const _u=Object.keys(Z.Patterns).length;let Eu=0,Iu=1/0;for(let Au=0;Au<_u;Au++){Zs(Au),Z.applyMask(Au,Ys);const $u=Z.getPenaltyN1(Ys)+Z.getPenaltyN2(Ys)+Z.getPenaltyN3(Ys)+Z.getPenaltyN4(Ys);Z.applyMask(Au,Ys),$u<Iu&&(Iu=$u,Eu=Au)}return Eu}})(maskPattern);var errorCorrectionCode={};const ECLevel$1=errorCorrectionLevel,EC_BLOCKS_TABLE=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],EC_CODEWORDS_TABLE=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];errorCorrectionCode.getBlocksCount=function(t,Hs){switch(Hs){case ECLevel$1.L:return EC_BLOCKS_TABLE[(t-1)*4+0];case ECLevel$1.M:return EC_BLOCKS_TABLE[(t-1)*4+1];case ECLevel$1.Q:return EC_BLOCKS_TABLE[(t-1)*4+2];case ECLevel$1.H:return EC_BLOCKS_TABLE[(t-1)*4+3];default:return}};errorCorrectionCode.getTotalCodewordsCount=function(t,Hs){switch(Hs){case ECLevel$1.L:return EC_CODEWORDS_TABLE[(t-1)*4+0];case ECLevel$1.M:return EC_CODEWORDS_TABLE[(t-1)*4+1];case ECLevel$1.Q:return EC_CODEWORDS_TABLE[(t-1)*4+2];case ECLevel$1.H:return EC_CODEWORDS_TABLE[(t-1)*4+3];default:return}};var polynomial={},galoisField={};const EXP_TABLE=new Uint8Array(512),LOG_TABLE=new Uint8Array(256);(function(){let t=1;for(let Hs=0;Hs<255;Hs++)EXP_TABLE[Hs]=t,LOG_TABLE[t]=Hs,t<<=1,t&256&&(t^=285);for(let Hs=255;Hs<512;Hs++)EXP_TABLE[Hs]=EXP_TABLE[Hs-255]})();galoisField.log=function(t){if(t<1)throw new Error("log("+t+")");return LOG_TABLE[t]};galoisField.exp=function(t){return EXP_TABLE[t]};galoisField.mul=function(t,Hs){return t===0||Hs===0?0:EXP_TABLE[LOG_TABLE[t]+LOG_TABLE[Hs]]};(function(Z){const t=galoisField;Z.mul=function(zs,Ys){const Zs=new Uint8Array(zs.length+Ys.length-1);for(let _u=0;_u<zs.length;_u++)for(let Eu=0;Eu<Ys.length;Eu++)Zs[_u+Eu]^=t.mul(zs[_u],Ys[Eu]);return Zs},Z.mod=function(zs,Ys){let Zs=new Uint8Array(zs);for(;Zs.length-Ys.length>=0;){const _u=Zs[0];for(let Iu=0;Iu<Ys.length;Iu++)Zs[Iu]^=t.mul(Ys[Iu],_u);let Eu=0;for(;Eu<Zs.length&&Zs[Eu]===0;)Eu++;Zs=Zs.slice(Eu)}return Zs},Z.generateECPolynomial=function(zs){let Ys=new Uint8Array([1]);for(let Zs=0;Zs<zs;Zs++)Ys=Z.mul(Ys,new Uint8Array([1,t.exp(Zs)]));return Ys}})(polynomial);const Polynomial=polynomial;function ReedSolomonEncoder$1(Z){this.genPoly=void 0,this.degree=Z,this.degree&&this.initialize(this.degree)}ReedSolomonEncoder$1.prototype.initialize=function(t){this.degree=t,this.genPoly=Polynomial.generateECPolynomial(this.degree)};ReedSolomonEncoder$1.prototype.encode=function(t){if(!this.genPoly)throw new Error("Encoder not initialized");const Hs=new Uint8Array(t.length+this.degree);Hs.set(t);const zs=Polynomial.mod(Hs,this.genPoly),Ys=this.degree-zs.length;if(Ys>0){const Zs=new Uint8Array(this.degree);return Zs.set(zs,Ys),Zs}return zs};var reedSolomonEncoder=ReedSolomonEncoder$1,version$4={},mode={},versionCheck={};versionCheck.isValid=function(t){return!isNaN(t)&&t>=1&&t<=40};var regex={};const numeric="[0-9]+",alphanumeric="[A-Z $%*+\\-./:]+";let kanji="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";kanji=kanji.replace(/u/g,"\\u");const byte="(?:(?![A-Z0-9 $%*+\\-./:]|"+kanji+`)(?:.|[\r
]))+`;regex.KANJI=new RegExp(kanji,"g");regex.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");regex.BYTE=new RegExp(byte,"g");regex.NUMERIC=new RegExp(numeric,"g");regex.ALPHANUMERIC=new RegExp(alphanumeric,"g");const TEST_KANJI=new RegExp("^"+kanji+"$"),TEST_NUMERIC=new RegExp("^"+numeric+"$"),TEST_ALPHANUMERIC=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");regex.testKanji=function(t){return TEST_KANJI.test(t)};regex.testNumeric=function(t){return TEST_NUMERIC.test(t)};regex.testAlphanumeric=function(t){return TEST_ALPHANUMERIC.test(t)};(function(Z){const t=versionCheck,Hs=regex;Z.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},Z.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},Z.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},Z.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},Z.MIXED={bit:-1},Z.getCharCountIndicator=function(Zs,_u){if(!Zs.ccBits)throw new Error("Invalid mode: "+Zs);if(!t.isValid(_u))throw new Error("Invalid version: "+_u);return _u>=1&&_u<10?Zs.ccBits[0]:_u<27?Zs.ccBits[1]:Zs.ccBits[2]},Z.getBestModeForData=function(Zs){return Hs.testNumeric(Zs)?Z.NUMERIC:Hs.testAlphanumeric(Zs)?Z.ALPHANUMERIC:Hs.testKanji(Zs)?Z.KANJI:Z.BYTE},Z.toString=function(Zs){if(Zs&&Zs.id)return Zs.id;throw new Error("Invalid mode")},Z.isValid=function(Zs){return Zs&&Zs.bit&&Zs.ccBits};function zs(Ys){if(typeof Ys!="string")throw new Error("Param is not a string");switch(Ys.toLowerCase()){case"numeric":return Z.NUMERIC;case"alphanumeric":return Z.ALPHANUMERIC;case"kanji":return Z.KANJI;case"byte":return Z.BYTE;default:throw new Error("Unknown mode: "+Ys)}}Z.from=function(Zs,_u){if(Z.isValid(Zs))return Zs;try{return zs(Zs)}catch{return _u}}})(mode);(function(Z){const t=utils$4,Hs=errorCorrectionCode,zs=errorCorrectionLevel,Ys=mode,Zs=versionCheck,_u=7973,Eu=t.getBCHDigit(_u);function Iu(Su,Ru,Pu){for(let Cu=1;Cu<=40;Cu++)if(Ru<=Z.getCapacity(Cu,Pu,Su))return Cu}function Au(Su,Ru){return Ys.getCharCountIndicator(Su,Ru)+4}function $u(Su,Ru){let Pu=0;return Su.forEach(function(Cu){const Bu=Au(Cu.mode,Ru);Pu+=Bu+Cu.getBitsLength()}),Pu}function vu(Su,Ru){for(let Pu=1;Pu<=40;Pu++)if($u(Su,Pu)<=Z.getCapacity(Pu,Ru,Ys.MIXED))return Pu}Z.from=function(Ru,Pu){return Zs.isValid(Ru)?parseInt(Ru,10):Pu},Z.getCapacity=function(Ru,Pu,Cu){if(!Zs.isValid(Ru))throw new Error("Invalid QR Code version");typeof Cu>"u"&&(Cu=Ys.BYTE);const Bu=t.getSymbolTotalCodewords(Ru),Fu=Hs.getTotalCodewordsCount(Ru,Pu),zu=(Bu-Fu)*8;if(Cu===Ys.MIXED)return zu;const Hu=zu-Au(Cu,Ru);switch(Cu){case Ys.NUMERIC:return Math.floor(Hu/10*3);case Ys.ALPHANUMERIC:return Math.floor(Hu/11*2);case Ys.KANJI:return Math.floor(Hu/13);case Ys.BYTE:default:return Math.floor(Hu/8)}},Z.getBestVersionForData=function(Ru,Pu){let Cu;const Bu=zs.from(Pu,zs.M);if(Array.isArray(Ru)){if(Ru.length>1)return vu(Ru,Bu);if(Ru.length===0)return 1;Cu=Ru[0]}else Cu=Ru;return Iu(Cu.mode,Cu.getLength(),Bu)},Z.getEncodedBits=function(Ru){if(!Zs.isValid(Ru)||Ru<7)throw new Error("Invalid QR Code version");let Pu=Ru<<12;for(;t.getBCHDigit(Pu)-Eu>=0;)Pu^=_u<<t.getBCHDigit(Pu)-Eu;return Ru<<12|Pu}})(version$4);var formatInfo={};const Utils$3=utils$4,G15=1335,G15_MASK=21522,G15_BCH=Utils$3.getBCHDigit(G15);formatInfo.getEncodedBits=function(t,Hs){const zs=t.bit<<3|Hs;let Ys=zs<<10;for(;Utils$3.getBCHDigit(Ys)-G15_BCH>=0;)Ys^=G15<<Utils$3.getBCHDigit(Ys)-G15_BCH;return(zs<<10|Ys)^G15_MASK};var segments={};const Mode$4=mode;function NumericData(Z){this.mode=Mode$4.NUMERIC,this.data=Z.toString()}NumericData.getBitsLength=function(t){return 10*Math.floor(t/3)+(t%3?t%3*3+1:0)};NumericData.prototype.getLength=function(){return this.data.length};NumericData.prototype.getBitsLength=function(){return NumericData.getBitsLength(this.data.length)};NumericData.prototype.write=function(t){let Hs,zs,Ys;for(Hs=0;Hs+3<=this.data.length;Hs+=3)zs=this.data.substr(Hs,3),Ys=parseInt(zs,10),t.put(Ys,10);const Zs=this.data.length-Hs;Zs>0&&(zs=this.data.substr(Hs),Ys=parseInt(zs,10),t.put(Ys,Zs*3+1))};var numericData=NumericData;const Mode$3=mode,ALPHA_NUM_CHARS=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function AlphanumericData(Z){this.mode=Mode$3.ALPHANUMERIC,this.data=Z}AlphanumericData.getBitsLength=function(t){return 11*Math.floor(t/2)+6*(t%2)};AlphanumericData.prototype.getLength=function(){return this.data.length};AlphanumericData.prototype.getBitsLength=function(){return AlphanumericData.getBitsLength(this.data.length)};AlphanumericData.prototype.write=function(t){let Hs;for(Hs=0;Hs+2<=this.data.length;Hs+=2){let zs=ALPHA_NUM_CHARS.indexOf(this.data[Hs])*45;zs+=ALPHA_NUM_CHARS.indexOf(this.data[Hs+1]),t.put(zs,11)}this.data.length%2&&t.put(ALPHA_NUM_CHARS.indexOf(this.data[Hs]),6)};var alphanumericData=AlphanumericData;const Mode$2=mode;function ByteData(Z){this.mode=Mode$2.BYTE,typeof Z=="string"?this.data=new TextEncoder().encode(Z):this.data=new Uint8Array(Z)}ByteData.getBitsLength=function(t){return t*8};ByteData.prototype.getLength=function(){return this.data.length};ByteData.prototype.getBitsLength=function(){return ByteData.getBitsLength(this.data.length)};ByteData.prototype.write=function(Z){for(let t=0,Hs=this.data.length;t<Hs;t++)Z.put(this.data[t],8)};var byteData=ByteData;const Mode$1=mode,Utils$2=utils$4;function KanjiData(Z){this.mode=Mode$1.KANJI,this.data=Z}KanjiData.getBitsLength=function(t){return t*13};KanjiData.prototype.getLength=function(){return this.data.length};KanjiData.prototype.getBitsLength=function(){return KanjiData.getBitsLength(this.data.length)};KanjiData.prototype.write=function(Z){let t;for(t=0;t<this.data.length;t++){let Hs=Utils$2.toSJIS(this.data[t]);if(Hs>=33088&&Hs<=40956)Hs-=33088;else if(Hs>=57408&&Hs<=60351)Hs-=49472;else throw new Error("Invalid SJIS character: "+this.data[t]+`
Make sure your charset is UTF-8`);Hs=(Hs>>>8&255)*192+(Hs&255),Z.put(Hs,13)}};var kanjiData=KanjiData,dijkstra={exports:{}};(function(Z){var t={single_source_shortest_paths:function(Hs,zs,Ys){var Zs={},_u={};_u[zs]=0;var Eu=t.PriorityQueue.make();Eu.push(zs,0);for(var Iu,Au,$u,vu,Su,Ru,Pu,Cu,Bu;!Eu.empty();){Iu=Eu.pop(),Au=Iu.value,vu=Iu.cost,Su=Hs[Au]||{};for($u in Su)Su.hasOwnProperty($u)&&(Ru=Su[$u],Pu=vu+Ru,Cu=_u[$u],Bu=typeof _u[$u]>"u",(Bu||Cu>Pu)&&(_u[$u]=Pu,Eu.push($u,Pu),Zs[$u]=Au))}if(typeof Ys<"u"&&typeof _u[Ys]>"u"){var Fu=["Could not find a path from ",zs," to ",Ys,"."].join("");throw new Error(Fu)}return Zs},extract_shortest_path_from_predecessor_list:function(Hs,zs){for(var Ys=[],Zs=zs;Zs;)Ys.push(Zs),Hs[Zs],Zs=Hs[Zs];return Ys.reverse(),Ys},find_path:function(Hs,zs,Ys){var Zs=t.single_source_shortest_paths(Hs,zs,Ys);return t.extract_shortest_path_from_predecessor_list(Zs,Ys)},PriorityQueue:{make:function(Hs){var zs=t.PriorityQueue,Ys={},Zs;Hs=Hs||{};for(Zs in zs)zs.hasOwnProperty(Zs)&&(Ys[Zs]=zs[Zs]);return Ys.queue=[],Ys.sorter=Hs.sorter||zs.default_sorter,Ys},default_sorter:function(Hs,zs){return Hs.cost-zs.cost},push:function(Hs,zs){var Ys={value:Hs,cost:zs};this.queue.push(Ys),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};Z.exports=t})(dijkstra);var dijkstraExports=dijkstra.exports;(function(Z){const t=mode,Hs=numericData,zs=alphanumericData,Ys=byteData,Zs=kanjiData,_u=regex,Eu=utils$4,Iu=dijkstraExports;function Au(Fu){return unescape(encodeURIComponent(Fu)).length}function $u(Fu,zu,Hu){const Wu=[];let tl;for(;(tl=Fu.exec(Hu))!==null;)Wu.push({data:tl[0],index:tl.index,mode:zu,length:tl[0].length});return Wu}function vu(Fu){const zu=$u(_u.NUMERIC,t.NUMERIC,Fu),Hu=$u(_u.ALPHANUMERIC,t.ALPHANUMERIC,Fu);let Wu,tl;return Eu.isKanjiModeEnabled()?(Wu=$u(_u.BYTE,t.BYTE,Fu),tl=$u(_u.KANJI,t.KANJI,Fu)):(Wu=$u(_u.BYTE_KANJI,t.BYTE,Fu),tl=[]),zu.concat(Hu,Wu,tl).sort(function(ju,ku){return ju.index-ku.index}).map(function(ju){return{data:ju.data,mode:ju.mode,length:ju.length}})}function Su(Fu,zu){switch(zu){case t.NUMERIC:return Hs.getBitsLength(Fu);case t.ALPHANUMERIC:return zs.getBitsLength(Fu);case t.KANJI:return Zs.getBitsLength(Fu);case t.BYTE:return Ys.getBitsLength(Fu)}}function Ru(Fu){return Fu.reduce(function(zu,Hu){const Wu=zu.length-1>=0?zu[zu.length-1]:null;return Wu&&Wu.mode===Hu.mode?(zu[zu.length-1].data+=Hu.data,zu):(zu.push(Hu),zu)},[])}function Pu(Fu){const zu=[];for(let Hu=0;Hu<Fu.length;Hu++){const Wu=Fu[Hu];switch(Wu.mode){case t.NUMERIC:zu.push([Wu,{data:Wu.data,mode:t.ALPHANUMERIC,length:Wu.length},{data:Wu.data,mode:t.BYTE,length:Wu.length}]);break;case t.ALPHANUMERIC:zu.push([Wu,{data:Wu.data,mode:t.BYTE,length:Wu.length}]);break;case t.KANJI:zu.push([Wu,{data:Wu.data,mode:t.BYTE,length:Au(Wu.data)}]);break;case t.BYTE:zu.push([{data:Wu.data,mode:t.BYTE,length:Au(Wu.data)}])}}return zu}function Cu(Fu,zu){const Hu={},Wu={start:{}};let tl=["start"];for(let Xu=0;Xu<Fu.length;Xu++){const ju=Fu[Xu],ku=[];for(let Uu=0;Uu<ju.length;Uu++){const Gu=ju[Uu],Yu=""+Xu+Uu;ku.push(Yu),Hu[Yu]={node:Gu,lastCount:0},Wu[Yu]={};for(let Qu=0;Qu<tl.length;Qu++){const Lu=tl[Qu];Hu[Lu]&&Hu[Lu].node.mode===Gu.mode?(Wu[Lu][Yu]=Su(Hu[Lu].lastCount+Gu.length,Gu.mode)-Su(Hu[Lu].lastCount,Gu.mode),Hu[Lu].lastCount+=Gu.length):(Hu[Lu]&&(Hu[Lu].lastCount=Gu.length),Wu[Lu][Yu]=Su(Gu.length,Gu.mode)+4+t.getCharCountIndicator(Gu.mode,zu))}}tl=ku}for(let Xu=0;Xu<tl.length;Xu++)Wu[tl[Xu]].end=0;return{map:Wu,table:Hu}}function Bu(Fu,zu){let Hu;const Wu=t.getBestModeForData(Fu);if(Hu=t.from(zu,Wu),Hu!==t.BYTE&&Hu.bit<Wu.bit)throw new Error('"'+Fu+'" cannot be encoded with mode '+t.toString(Hu)+`.
 Suggested mode is: `+t.toString(Wu));switch(Hu===t.KANJI&&!Eu.isKanjiModeEnabled()&&(Hu=t.BYTE),Hu){case t.NUMERIC:return new Hs(Fu);case t.ALPHANUMERIC:return new zs(Fu);case t.KANJI:return new Zs(Fu);case t.BYTE:return new Ys(Fu)}}Z.fromArray=function(zu){return zu.reduce(function(Hu,Wu){return typeof Wu=="string"?Hu.push(Bu(Wu,null)):Wu.data&&Hu.push(Bu(Wu.data,Wu.mode)),Hu},[])},Z.fromString=function(zu,Hu){const Wu=vu(zu,Eu.isKanjiModeEnabled()),tl=Pu(Wu),Xu=Cu(tl,Hu),ju=Iu.find_path(Xu.map,"start","end"),ku=[];for(let Uu=1;Uu<ju.length-1;Uu++)ku.push(Xu.table[ju[Uu]].node);return Z.fromArray(Ru(ku))},Z.rawSplit=function(zu){return Z.fromArray(vu(zu,Eu.isKanjiModeEnabled()))}})(segments);const Utils$1=utils$4,ECLevel=errorCorrectionLevel,BitBuffer=bitBuffer,BitMatrix=bitMatrix,AlignmentPattern=alignmentPattern,FinderPattern=finderPattern,MaskPattern=maskPattern,ECCode=errorCorrectionCode,ReedSolomonEncoder=reedSolomonEncoder,Version=version$4,FormatInfo=formatInfo,Mode=mode,Segments=segments;function setupFinderPattern(Z,t){const Hs=Z.size,zs=FinderPattern.getPositions(t);for(let Ys=0;Ys<zs.length;Ys++){const Zs=zs[Ys][0],_u=zs[Ys][1];for(let Eu=-1;Eu<=7;Eu++)if(!(Zs+Eu<=-1||Hs<=Zs+Eu))for(let Iu=-1;Iu<=7;Iu++)_u+Iu<=-1||Hs<=_u+Iu||(Eu>=0&&Eu<=6&&(Iu===0||Iu===6)||Iu>=0&&Iu<=6&&(Eu===0||Eu===6)||Eu>=2&&Eu<=4&&Iu>=2&&Iu<=4?Z.set(Zs+Eu,_u+Iu,!0,!0):Z.set(Zs+Eu,_u+Iu,!1,!0))}}function setupTimingPattern(Z){const t=Z.size;for(let Hs=8;Hs<t-8;Hs++){const zs=Hs%2===0;Z.set(Hs,6,zs,!0),Z.set(6,Hs,zs,!0)}}function setupAlignmentPattern(Z,t){const Hs=AlignmentPattern.getPositions(t);for(let zs=0;zs<Hs.length;zs++){const Ys=Hs[zs][0],Zs=Hs[zs][1];for(let _u=-2;_u<=2;_u++)for(let Eu=-2;Eu<=2;Eu++)_u===-2||_u===2||Eu===-2||Eu===2||_u===0&&Eu===0?Z.set(Ys+_u,Zs+Eu,!0,!0):Z.set(Ys+_u,Zs+Eu,!1,!0)}}function setupVersionInfo(Z,t){const Hs=Z.size,zs=Version.getEncodedBits(t);let Ys,Zs,_u;for(let Eu=0;Eu<18;Eu++)Ys=Math.floor(Eu/3),Zs=Eu%3+Hs-8-3,_u=(zs>>Eu&1)===1,Z.set(Ys,Zs,_u,!0),Z.set(Zs,Ys,_u,!0)}function setupFormatInfo(Z,t,Hs){const zs=Z.size,Ys=FormatInfo.getEncodedBits(t,Hs);let Zs,_u;for(Zs=0;Zs<15;Zs++)_u=(Ys>>Zs&1)===1,Zs<6?Z.set(Zs,8,_u,!0):Zs<8?Z.set(Zs+1,8,_u,!0):Z.set(zs-15+Zs,8,_u,!0),Zs<8?Z.set(8,zs-Zs-1,_u,!0):Zs<9?Z.set(8,15-Zs-1+1,_u,!0):Z.set(8,15-Zs-1,_u,!0);Z.set(zs-8,8,1,!0)}function setupData(Z,t){const Hs=Z.size;let zs=-1,Ys=Hs-1,Zs=7,_u=0;for(let Eu=Hs-1;Eu>0;Eu-=2)for(Eu===6&&Eu--;;){for(let Iu=0;Iu<2;Iu++)if(!Z.isReserved(Ys,Eu-Iu)){let Au=!1;_u<t.length&&(Au=(t[_u]>>>Zs&1)===1),Z.set(Ys,Eu-Iu,Au),Zs--,Zs===-1&&(_u++,Zs=7)}if(Ys+=zs,Ys<0||Hs<=Ys){Ys-=zs,zs=-zs;break}}}function createData(Z,t,Hs){const zs=new BitBuffer;Hs.forEach(function(Iu){zs.put(Iu.mode.bit,4),zs.put(Iu.getLength(),Mode.getCharCountIndicator(Iu.mode,Z)),Iu.write(zs)});const Ys=Utils$1.getSymbolTotalCodewords(Z),Zs=ECCode.getTotalCodewordsCount(Z,t),_u=(Ys-Zs)*8;for(zs.getLengthInBits()+4<=_u&&zs.put(0,4);zs.getLengthInBits()%8!==0;)zs.putBit(0);const Eu=(_u-zs.getLengthInBits())/8;for(let Iu=0;Iu<Eu;Iu++)zs.put(Iu%2?17:236,8);return createCodewords(zs,Z,t)}function createCodewords(Z,t,Hs){const zs=Utils$1.getSymbolTotalCodewords(t),Ys=ECCode.getTotalCodewordsCount(t,Hs),Zs=zs-Ys,_u=ECCode.getBlocksCount(t,Hs),Eu=zs%_u,Iu=_u-Eu,Au=Math.floor(zs/_u),$u=Math.floor(Zs/_u),vu=$u+1,Su=Au-$u,Ru=new ReedSolomonEncoder(Su);let Pu=0;const Cu=new Array(_u),Bu=new Array(_u);let Fu=0;const zu=new Uint8Array(Z.buffer);for(let ju=0;ju<_u;ju++){const ku=ju<Iu?$u:vu;Cu[ju]=zu.slice(Pu,Pu+ku),Bu[ju]=Ru.encode(Cu[ju]),Pu+=ku,Fu=Math.max(Fu,ku)}const Hu=new Uint8Array(zs);let Wu=0,tl,Xu;for(tl=0;tl<Fu;tl++)for(Xu=0;Xu<_u;Xu++)tl<Cu[Xu].length&&(Hu[Wu++]=Cu[Xu][tl]);for(tl=0;tl<Su;tl++)for(Xu=0;Xu<_u;Xu++)Hu[Wu++]=Bu[Xu][tl];return Hu}function createSymbol(Z,t,Hs,zs){let Ys;if(Array.isArray(Z))Ys=Segments.fromArray(Z);else if(typeof Z=="string"){let Au=t;if(!Au){const $u=Segments.rawSplit(Z);Au=Version.getBestVersionForData($u,Hs)}Ys=Segments.fromString(Z,Au||40)}else throw new Error("Invalid data");const Zs=Version.getBestVersionForData(Ys,Hs);if(!Zs)throw new Error("The amount of data is too big to be stored in a QR Code");if(!t)t=Zs;else if(t<Zs)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+Zs+`.
`);const _u=createData(t,Hs,Ys),Eu=Utils$1.getSymbolSize(t),Iu=new BitMatrix(Eu);return setupFinderPattern(Iu,t),setupTimingPattern(Iu),setupAlignmentPattern(Iu,t),setupFormatInfo(Iu,Hs,0),t>=7&&setupVersionInfo(Iu,t),setupData(Iu,_u),isNaN(zs)&&(zs=MaskPattern.getBestMask(Iu,setupFormatInfo.bind(null,Iu,Hs))),MaskPattern.applyMask(zs,Iu),setupFormatInfo(Iu,Hs,zs),{modules:Iu,version:t,errorCorrectionLevel:Hs,maskPattern:zs,segments:Ys}}qrcode.create=function(t,Hs){if(typeof t>"u"||t==="")throw new Error("No input text");let zs=ECLevel.M,Ys,Zs;return typeof Hs<"u"&&(zs=ECLevel.from(Hs.errorCorrectionLevel,ECLevel.M),Ys=Version.from(Hs.version),Zs=MaskPattern.from(Hs.maskPattern),Hs.toSJISFunc&&Utils$1.setToSJISFunction(Hs.toSJISFunc)),createSymbol(t,Ys,zs,Zs)};var canvas={},utils$3={};(function(Z){function t(Hs){if(typeof Hs=="number"&&(Hs=Hs.toString()),typeof Hs!="string")throw new Error("Color should be defined as hex string");let zs=Hs.slice().replace("#","").split("");if(zs.length<3||zs.length===5||zs.length>8)throw new Error("Invalid hex color: "+Hs);(zs.length===3||zs.length===4)&&(zs=Array.prototype.concat.apply([],zs.map(function(Zs){return[Zs,Zs]}))),zs.length===6&&zs.push("F","F");const Ys=parseInt(zs.join(""),16);return{r:Ys>>24&255,g:Ys>>16&255,b:Ys>>8&255,a:Ys&255,hex:"#"+zs.slice(0,6).join("")}}Z.getOptions=function(zs){zs||(zs={}),zs.color||(zs.color={});const Ys=typeof zs.margin>"u"||zs.margin===null||zs.margin<0?4:zs.margin,Zs=zs.width&&zs.width>=21?zs.width:void 0,_u=zs.scale||4;return{width:Zs,scale:Zs?4:_u,margin:Ys,color:{dark:t(zs.color.dark||"#000000ff"),light:t(zs.color.light||"#ffffffff")},type:zs.type,rendererOpts:zs.rendererOpts||{}}},Z.getScale=function(zs,Ys){return Ys.width&&Ys.width>=zs+Ys.margin*2?Ys.width/(zs+Ys.margin*2):Ys.scale},Z.getImageWidth=function(zs,Ys){const Zs=Z.getScale(zs,Ys);return Math.floor((zs+Ys.margin*2)*Zs)},Z.qrToImageData=function(zs,Ys,Zs){const _u=Ys.modules.size,Eu=Ys.modules.data,Iu=Z.getScale(_u,Zs),Au=Math.floor((_u+Zs.margin*2)*Iu),$u=Zs.margin*Iu,vu=[Zs.color.light,Zs.color.dark];for(let Su=0;Su<Au;Su++)for(let Ru=0;Ru<Au;Ru++){let Pu=(Su*Au+Ru)*4,Cu=Zs.color.light;if(Su>=$u&&Ru>=$u&&Su<Au-$u&&Ru<Au-$u){const Bu=Math.floor((Su-$u)/Iu),Fu=Math.floor((Ru-$u)/Iu);Cu=vu[Eu[Bu*_u+Fu]?1:0]}zs[Pu++]=Cu.r,zs[Pu++]=Cu.g,zs[Pu++]=Cu.b,zs[Pu]=Cu.a}}})(utils$3);(function(Z){const t=utils$3;function Hs(Ys,Zs,_u){Ys.clearRect(0,0,Zs.width,Zs.height),Zs.style||(Zs.style={}),Zs.height=_u,Zs.width=_u,Zs.style.height=_u+"px",Zs.style.width=_u+"px"}function zs(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}Z.render=function(Zs,_u,Eu){let Iu=Eu,Au=_u;typeof Iu>"u"&&(!_u||!_u.getContext)&&(Iu=_u,_u=void 0),_u||(Au=zs()),Iu=t.getOptions(Iu);const $u=t.getImageWidth(Zs.modules.size,Iu),vu=Au.getContext("2d"),Su=vu.createImageData($u,$u);return t.qrToImageData(Su.data,Zs,Iu),Hs(vu,Au,$u),vu.putImageData(Su,0,0),Au},Z.renderToDataURL=function(Zs,_u,Eu){let Iu=Eu;typeof Iu>"u"&&(!_u||!_u.getContext)&&(Iu=_u,_u=void 0),Iu||(Iu={});const Au=Z.render(Zs,_u,Iu),$u=Iu.type||"image/png",vu=Iu.rendererOpts||{};return Au.toDataURL($u,vu.quality)}})(canvas);var svgTag={};const Utils=utils$3;function getColorAttrib(Z,t){const Hs=Z.a/255,zs=t+'="'+Z.hex+'"';return Hs<1?zs+" "+t+'-opacity="'+Hs.toFixed(2).slice(1)+'"':zs}function svgCmd(Z,t,Hs){let zs=Z+t;return typeof Hs<"u"&&(zs+=" "+Hs),zs}function qrToPath(Z,t,Hs){let zs="",Ys=0,Zs=!1,_u=0;for(let Eu=0;Eu<Z.length;Eu++){const Iu=Math.floor(Eu%t),Au=Math.floor(Eu/t);!Iu&&!Zs&&(Zs=!0),Z[Eu]?(_u++,Eu>0&&Iu>0&&Z[Eu-1]||(zs+=Zs?svgCmd("M",Iu+Hs,.5+Au+Hs):svgCmd("m",Ys,0),Ys=0,Zs=!1),Iu+1<t&&Z[Eu+1]||(zs+=svgCmd("h",_u),_u=0)):Ys++}return zs}svgTag.render=function(t,Hs,zs){const Ys=Utils.getOptions(Hs),Zs=t.modules.size,_u=t.modules.data,Eu=Zs+Ys.margin*2,Iu=Ys.color.light.a?"<path "+getColorAttrib(Ys.color.light,"fill")+' d="M0 0h'+Eu+"v"+Eu+'H0z"/>':"",Au="<path "+getColorAttrib(Ys.color.dark,"stroke")+' d="'+qrToPath(_u,Zs,Ys.margin)+'"/>',$u='viewBox="0 0 '+Eu+" "+Eu+'"',Su='<svg xmlns="http://www.w3.org/2000/svg" '+(Ys.width?'width="'+Ys.width+'" height="'+Ys.width+'" ':"")+$u+' shape-rendering="crispEdges">'+Iu+Au+`</svg>
`;return typeof zs=="function"&&zs(null,Su),Su};const canPromise=canPromise$1,QRCode=qrcode,CanvasRenderer=canvas,SvgRenderer=svgTag;function renderCanvas(Z,t,Hs,zs,Ys){const Zs=[].slice.call(arguments,1),_u=Zs.length,Eu=typeof Zs[_u-1]=="function";if(!Eu&&!canPromise())throw new Error("Callback required as last argument");if(Eu){if(_u<2)throw new Error("Too few arguments provided");_u===2?(Ys=Hs,Hs=t,t=zs=void 0):_u===3&&(t.getContext&&typeof Ys>"u"?(Ys=zs,zs=void 0):(Ys=zs,zs=Hs,Hs=t,t=void 0))}else{if(_u<1)throw new Error("Too few arguments provided");return _u===1?(Hs=t,t=zs=void 0):_u===2&&!t.getContext&&(zs=Hs,Hs=t,t=void 0),new Promise(function(Iu,Au){try{const $u=QRCode.create(Hs,zs);Iu(Z($u,t,zs))}catch($u){Au($u)}})}try{const Iu=QRCode.create(Hs,zs);Ys(null,Z(Iu,t,zs))}catch(Iu){Ys(Iu)}}browser$2.create=QRCode.create;browser$2.toCanvas=renderCanvas.bind(null,CanvasRenderer.render);browser$2.toDataURL=renderCanvas.bind(null,CanvasRenderer.renderToDataURL);browser$2.toString=renderCanvas.bind(null,function(Z,t,Hs){return SvgRenderer.render(Z,Hs)});var out$1={},walletConnectV2Provider={},message={},address={},ALPHABET$1="qpzry9x8gf2tvdw0s3jn54khce6mua7l",ALPHABET_MAP={};for(var z$4=0;z$4<ALPHABET$1.length;z$4++){var x$5=ALPHABET$1.charAt(z$4);if(ALPHABET_MAP[x$5]!==void 0)throw new TypeError(x$5+" is ambiguous");ALPHABET_MAP[x$5]=z$4}function polymodStep(Z){var t=Z>>25;return(Z&33554431)<<5^-(t>>0&1)&996825010^-(t>>1&1)&642813549^-(t>>2&1)&513874426^-(t>>3&1)&1027748829^-(t>>4&1)&705979059}function prefixChk(Z){for(var t=1,Hs=0;Hs<Z.length;++Hs){var zs=Z.charCodeAt(Hs);if(zs<33||zs>126)return"Invalid prefix ("+Z+")";t=polymodStep(t)^zs>>5}for(t=polymodStep(t),Hs=0;Hs<Z.length;++Hs){var Ys=Z.charCodeAt(Hs);t=polymodStep(t)^Ys&31}return t}function encode$3(Z,t,Hs){if(Hs=Hs||90,Z.length+7+t.length>Hs)throw new TypeError("Exceeds length limit");Z=Z.toLowerCase();var zs=prefixChk(Z);if(typeof zs=="string")throw new Error(zs);for(var Ys=Z+"1",Zs=0;Zs<t.length;++Zs){var _u=t[Zs];if(_u>>5)throw new Error("Non 5-bit word");zs=polymodStep(zs)^_u,Ys+=ALPHABET$1.charAt(_u)}for(Zs=0;Zs<6;++Zs)zs=polymodStep(zs);for(zs^=1,Zs=0;Zs<6;++Zs){var Eu=zs>>(5-Zs)*5&31;Ys+=ALPHABET$1.charAt(Eu)}return Ys}function __decode(Z,t){if(t=t||90,Z.length<8)return Z+" too short";if(Z.length>t)return"Exceeds length limit";var Hs=Z.toLowerCase(),zs=Z.toUpperCase();if(Z!==Hs&&Z!==zs)return"Mixed-case string "+Z;Z=Hs;var Ys=Z.lastIndexOf("1");if(Ys===-1)return"No separator character for "+Z;if(Ys===0)return"Missing prefix for "+Z;var Zs=Z.slice(0,Ys),_u=Z.slice(Ys+1);if(_u.length<6)return"Data too short";var Eu=prefixChk(Zs);if(typeof Eu=="string")return Eu;for(var Iu=[],Au=0;Au<_u.length;++Au){var $u=_u.charAt(Au),vu=ALPHABET_MAP[$u];if(vu===void 0)return"Unknown character "+$u;Eu=polymodStep(Eu)^vu,!(Au+6>=_u.length)&&Iu.push(vu)}return Eu!==1?"Invalid checksum for "+Z:{prefix:Zs,words:Iu}}function decodeUnsafe(){var Z=__decode.apply(null,arguments);if(typeof Z=="object")return Z}function decode$3(Z){var t=__decode.apply(null,arguments);if(typeof t=="object")return t;throw new Error(t)}function convert$1(Z,t,Hs,zs){for(var Ys=0,Zs=0,_u=(1<<Hs)-1,Eu=[],Iu=0;Iu<Z.length;++Iu)for(Ys=Ys<<t|Z[Iu],Zs+=t;Zs>=Hs;)Zs-=Hs,Eu.push(Ys>>Zs&_u);if(zs)Zs>0&&Eu.push(Ys<<Hs-Zs&_u);else{if(Zs>=t)return"Excess padding";if(Ys<<Hs-Zs&_u)return"Non-zero padding"}return Eu}function toWordsUnsafe(Z){var t=convert$1(Z,8,5,!0);if(Array.isArray(t))return t}function toWords(Z){var t=convert$1(Z,8,5,!0);if(Array.isArray(t))return t;throw new Error(t)}function fromWordsUnsafe(Z){var t=convert$1(Z,5,8,!1);if(Array.isArray(t))return t}function fromWords(Z){var t=convert$1(Z,5,8,!1);if(Array.isArray(t))return t;throw new Error(t)}var bech32$1={decodeUnsafe,decode:decode$3,encode:encode$3,toWordsUnsafe,toWords,fromWordsUnsafe,fromWords},bignumber={exports:{}};(function(Z){(function(t){var Hs,zs=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Ys=Math.ceil,Zs=Math.floor,_u="[BigNumber Error] ",Eu=_u+"Number primitive has more than 15 significant digits: ",Iu=1e14,Au=14,$u=9007199254740991,vu=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Su=1e7,Ru=1e9;function Pu(Xu){var ju,ku,Uu,Gu=nl.prototype={constructor:nl,toString:null,valueOf:null},Yu=new nl(1),Qu=20,Lu=4,cl=-7,el=21,Zu=-1e7,dl=1e7,El=!1,hl=1,_l=0,Rl={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},ol="0123456789abcdefghijklmnopqrstuvwxyz",gl=!0;function nl(qu,Ou){var Vu,il,sl,pl,yl,fl,bl,al,wl=this;if(!(wl instanceof nl))return new nl(qu,Ou);if(Ou==null){if(qu&&qu._isBigNumber===!0){wl.s=qu.s,!qu.c||qu.e>dl?wl.c=wl.e=null:qu.e<Zu?wl.c=[wl.e=0]:(wl.e=qu.e,wl.c=qu.c.slice());return}if((fl=typeof qu=="number")&&qu*0==0){if(wl.s=1/qu<0?(qu=-qu,-1):1,qu===~~qu){for(pl=0,yl=qu;yl>=10;yl/=10,pl++);pl>dl?wl.c=wl.e=null:(wl.e=pl,wl.c=[qu]);return}al=String(qu)}else{if(!zs.test(al=String(qu)))return Uu(wl,al,fl);wl.s=al.charCodeAt(0)==45?(al=al.slice(1),-1):1}(pl=al.indexOf("."))>-1&&(al=al.replace(".","")),(yl=al.search(/e/i))>0?(pl<0&&(pl=yl),pl+=+al.slice(yl+1),al=al.substring(0,yl)):pl<0&&(pl=al.length)}else{if(zu(Ou,2,ol.length,"Base"),Ou==10&&gl)return wl=new nl(qu),Al(wl,Qu+wl.e+1,Lu);if(al=String(qu),fl=typeof qu=="number"){if(qu*0!=0)return Uu(wl,al,fl,Ou);if(wl.s=1/qu<0?(al=al.slice(1),-1):1,nl.DEBUG&&al.replace(/^0\.0*|\./,"").length>15)throw Error(Eu+qu)}else wl.s=al.charCodeAt(0)===45?(al=al.slice(1),-1):1;for(Vu=ol.slice(0,Ou),pl=yl=0,bl=al.length;yl<bl;yl++)if(Vu.indexOf(il=al.charAt(yl))<0){if(il=="."){if(yl>pl){pl=bl;continue}}else if(!sl&&(al==al.toUpperCase()&&(al=al.toLowerCase())||al==al.toLowerCase()&&(al=al.toUpperCase()))){sl=!0,yl=-1,pl=0;continue}return Uu(wl,String(qu),fl,Ou)}fl=!1,al=ku(al,Ou,10,wl.s),(pl=al.indexOf("."))>-1?al=al.replace(".",""):pl=al.length}for(yl=0;al.charCodeAt(yl)===48;yl++);for(bl=al.length;al.charCodeAt(--bl)===48;);if(al=al.slice(yl,++bl)){if(bl-=yl,fl&&nl.DEBUG&&bl>15&&(qu>$u||qu!==Zs(qu)))throw Error(Eu+wl.s*qu);if((pl=pl-yl-1)>dl)wl.c=wl.e=null;else if(pl<Zu)wl.c=[wl.e=0];else{if(wl.e=pl,wl.c=[],yl=(pl+1)%Au,pl<0&&(yl+=Au),yl<bl){for(yl&&wl.c.push(+al.slice(0,yl)),bl-=Au;yl<bl;)wl.c.push(+al.slice(yl,yl+=Au));yl=Au-(al=al.slice(yl)).length}else yl-=bl;for(;yl--;al+="0");wl.c.push(+al)}}else wl.c=[wl.e=0]}nl.clone=Pu,nl.ROUND_UP=0,nl.ROUND_DOWN=1,nl.ROUND_CEIL=2,nl.ROUND_FLOOR=3,nl.ROUND_HALF_UP=4,nl.ROUND_HALF_DOWN=5,nl.ROUND_HALF_EVEN=6,nl.ROUND_HALF_CEIL=7,nl.ROUND_HALF_FLOOR=8,nl.EUCLID=9,nl.config=nl.set=function(qu){var Ou,Vu;if(qu!=null)if(typeof qu=="object"){if(qu.hasOwnProperty(Ou="DECIMAL_PLACES")&&(Vu=qu[Ou],zu(Vu,0,Ru,Ou),Qu=Vu),qu.hasOwnProperty(Ou="ROUNDING_MODE")&&(Vu=qu[Ou],zu(Vu,0,8,Ou),Lu=Vu),qu.hasOwnProperty(Ou="EXPONENTIAL_AT")&&(Vu=qu[Ou],Vu&&Vu.pop?(zu(Vu[0],-Ru,0,Ou),zu(Vu[1],0,Ru,Ou),cl=Vu[0],el=Vu[1]):(zu(Vu,-Ru,Ru,Ou),cl=-(el=Vu<0?-Vu:Vu))),qu.hasOwnProperty(Ou="RANGE"))if(Vu=qu[Ou],Vu&&Vu.pop)zu(Vu[0],-Ru,-1,Ou),zu(Vu[1],1,Ru,Ou),Zu=Vu[0],dl=Vu[1];else if(zu(Vu,-Ru,Ru,Ou),Vu)Zu=-(dl=Vu<0?-Vu:Vu);else throw Error(_u+Ou+" cannot be zero: "+Vu);if(qu.hasOwnProperty(Ou="CRYPTO"))if(Vu=qu[Ou],Vu===!!Vu)if(Vu)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))El=Vu;else throw El=!Vu,Error(_u+"crypto unavailable");else El=Vu;else throw Error(_u+Ou+" not true or false: "+Vu);if(qu.hasOwnProperty(Ou="MODULO_MODE")&&(Vu=qu[Ou],zu(Vu,0,9,Ou),hl=Vu),qu.hasOwnProperty(Ou="POW_PRECISION")&&(Vu=qu[Ou],zu(Vu,0,Ru,Ou),_l=Vu),qu.hasOwnProperty(Ou="FORMAT"))if(Vu=qu[Ou],typeof Vu=="object")Rl=Vu;else throw Error(_u+Ou+" not an object: "+Vu);if(qu.hasOwnProperty(Ou="ALPHABET"))if(Vu=qu[Ou],typeof Vu=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(Vu))gl=Vu.slice(0,10)=="0123456789",ol=Vu;else throw Error(_u+Ou+" invalid: "+Vu)}else throw Error(_u+"Object expected: "+qu);return{DECIMAL_PLACES:Qu,ROUNDING_MODE:Lu,EXPONENTIAL_AT:[cl,el],RANGE:[Zu,dl],CRYPTO:El,MODULO_MODE:hl,POW_PRECISION:_l,FORMAT:Rl,ALPHABET:ol}},nl.isBigNumber=function(qu){if(!qu||qu._isBigNumber!==!0)return!1;if(!nl.DEBUG)return!0;var Ou,Vu,il=qu.c,sl=qu.e,pl=qu.s;e:if({}.toString.call(il)=="[object Array]"){if((pl===1||pl===-1)&&sl>=-Ru&&sl<=Ru&&sl===Zs(sl)){if(il[0]===0){if(sl===0&&il.length===1)return!0;break e}if(Ou=(sl+1)%Au,Ou<1&&(Ou+=Au),String(il[0]).length==Ou){for(Ou=0;Ou<il.length;Ou++)if(Vu=il[Ou],Vu<0||Vu>=Iu||Vu!==Zs(Vu))break e;if(Vu!==0)return!0}}}else if(il===null&&sl===null&&(pl===null||pl===1||pl===-1))return!0;throw Error(_u+"Invalid BigNumber: "+qu)},nl.maximum=nl.max=function(){return ll(arguments,-1)},nl.minimum=nl.min=function(){return ll(arguments,1)},nl.random=function(){var qu=9007199254740992,Ou=Math.random()*qu&2097151?function(){return Zs(Math.random()*qu)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(Vu){var il,sl,pl,yl,fl,bl=0,al=[],wl=new nl(Yu);if(Vu==null?Vu=Qu:zu(Vu,0,Ru),yl=Ys(Vu/Au),El)if(crypto.getRandomValues){for(il=crypto.getRandomValues(new Uint32Array(yl*=2));bl<yl;)fl=il[bl]*131072+(il[bl+1]>>>11),fl>=9e15?(sl=crypto.getRandomValues(new Uint32Array(2)),il[bl]=sl[0],il[bl+1]=sl[1]):(al.push(fl%1e14),bl+=2);bl=yl/2}else if(crypto.randomBytes){for(il=crypto.randomBytes(yl*=7);bl<yl;)fl=(il[bl]&31)*281474976710656+il[bl+1]*1099511627776+il[bl+2]*4294967296+il[bl+3]*16777216+(il[bl+4]<<16)+(il[bl+5]<<8)+il[bl+6],fl>=9e15?crypto.randomBytes(7).copy(il,bl):(al.push(fl%1e14),bl+=7);bl=yl/7}else throw El=!1,Error(_u+"crypto unavailable");if(!El)for(;bl<yl;)fl=Ou(),fl<9e15&&(al[bl++]=fl%1e14);for(yl=al[--bl],Vu%=Au,yl&&Vu&&(fl=vu[Au-Vu],al[bl]=Zs(yl/fl)*fl);al[bl]===0;al.pop(),bl--);if(bl<0)al=[pl=0];else{for(pl=-1;al[0]===0;al.splice(0,1),pl-=Au);for(bl=1,fl=al[0];fl>=10;fl/=10,bl++);bl<Au&&(pl-=Au-bl)}return wl.e=pl,wl.c=al,wl}}(),nl.sum=function(){for(var qu=1,Ou=arguments,Vu=new nl(Ou[0]);qu<Ou.length;)Vu=Vu.plus(Ou[qu++]);return Vu},ku=function(){var qu="0123456789";function Ou(Vu,il,sl,pl){for(var yl,fl=[0],bl,al=0,wl=Vu.length;al<wl;){for(bl=fl.length;bl--;fl[bl]*=il);for(fl[0]+=pl.indexOf(Vu.charAt(al++)),yl=0;yl<fl.length;yl++)fl[yl]>sl-1&&(fl[yl+1]==null&&(fl[yl+1]=0),fl[yl+1]+=fl[yl]/sl|0,fl[yl]%=sl)}return fl.reverse()}return function(Vu,il,sl,pl,yl){var fl,bl,al,wl,Dl,Ll,Fl,ql,Gl=Vu.indexOf("."),Ql=Qu,Hl=Lu;for(Gl>=0&&(wl=_l,_l=0,Vu=Vu.replace(".",""),ql=new nl(il),Ll=ql.pow(Vu.length-Gl),_l=wl,ql.c=Ou(tl(Bu(Ll.c),Ll.e,"0"),10,sl,qu),ql.e=ql.c.length),Fl=Ou(Vu,il,sl,yl?(fl=ol,qu):(fl=qu,ol)),al=wl=Fl.length;Fl[--wl]==0;Fl.pop());if(!Fl[0])return fl.charAt(0);if(Gl<0?--al:(Ll.c=Fl,Ll.e=al,Ll.s=pl,Ll=ju(Ll,ql,Ql,Hl,sl),Fl=Ll.c,Dl=Ll.r,al=Ll.e),bl=al+Ql+1,Gl=Fl[bl],wl=sl/2,Dl=Dl||bl<0||Fl[bl+1]!=null,Dl=Hl<4?(Gl!=null||Dl)&&(Hl==0||Hl==(Ll.s<0?3:2)):Gl>wl||Gl==wl&&(Hl==4||Dl||Hl==6&&Fl[bl-1]&1||Hl==(Ll.s<0?8:7)),bl<1||!Fl[0])Vu=Dl?tl(fl.charAt(1),-Ql,fl.charAt(0)):fl.charAt(0);else{if(Fl.length=bl,Dl)for(--sl;++Fl[--bl]>sl;)Fl[bl]=0,bl||(++al,Fl=[1].concat(Fl));for(wl=Fl.length;!Fl[--wl];);for(Gl=0,Vu="";Gl<=wl;Vu+=fl.charAt(Fl[Gl++]));Vu=tl(Vu,al,fl.charAt(0))}return Vu}}(),ju=function(){function qu(il,sl,pl){var yl,fl,bl,al,wl=0,Dl=il.length,Ll=sl%Su,Fl=sl/Su|0;for(il=il.slice();Dl--;)bl=il[Dl]%Su,al=il[Dl]/Su|0,yl=Fl*bl+al*Ll,fl=Ll*bl+yl%Su*Su+wl,wl=(fl/pl|0)+(yl/Su|0)+Fl*al,il[Dl]=fl%pl;return wl&&(il=[wl].concat(il)),il}function Ou(il,sl,pl,yl){var fl,bl;if(pl!=yl)bl=pl>yl?1:-1;else for(fl=bl=0;fl<pl;fl++)if(il[fl]!=sl[fl]){bl=il[fl]>sl[fl]?1:-1;break}return bl}function Vu(il,sl,pl,yl){for(var fl=0;pl--;)il[pl]-=fl,fl=il[pl]<sl[pl]?1:0,il[pl]=fl*yl+il[pl]-sl[pl];for(;!il[0]&&il.length>1;il.splice(0,1));}return function(il,sl,pl,yl,fl){var bl,al,wl,Dl,Ll,Fl,ql,Gl,Ql,Hl,jl,rh,Ku,xu,Nu,rl,ml,Il=il.s==sl.s?1:-1,Cl=il.c,Ml=sl.c;if(!Cl||!Cl[0]||!Ml||!Ml[0])return new nl(!il.s||!sl.s||(Cl?Ml&&Cl[0]==Ml[0]:!Ml)?NaN:Cl&&Cl[0]==0||!Ml?Il*0:Il/0);for(Gl=new nl(Il),Ql=Gl.c=[],al=il.e-sl.e,Il=pl+al+1,fl||(fl=Iu,al=Cu(il.e/Au)-Cu(sl.e/Au),Il=Il/Au|0),wl=0;Ml[wl]==(Cl[wl]||0);wl++);if(Ml[wl]>(Cl[wl]||0)&&al--,Il<0)Ql.push(1),Dl=!0;else{for(xu=Cl.length,rl=Ml.length,wl=0,Il+=2,Ll=Zs(fl/(Ml[0]+1)),Ll>1&&(Ml=qu(Ml,Ll,fl),Cl=qu(Cl,Ll,fl),rl=Ml.length,xu=Cl.length),Ku=rl,Hl=Cl.slice(0,rl),jl=Hl.length;jl<rl;Hl[jl++]=0);ml=Ml.slice(),ml=[0].concat(ml),Nu=Ml[0],Ml[1]>=fl/2&&Nu++;do{if(Ll=0,bl=Ou(Ml,Hl,rl,jl),bl<0){if(rh=Hl[0],rl!=jl&&(rh=rh*fl+(Hl[1]||0)),Ll=Zs(rh/Nu),Ll>1)for(Ll>=fl&&(Ll=fl-1),Fl=qu(Ml,Ll,fl),ql=Fl.length,jl=Hl.length;Ou(Fl,Hl,ql,jl)==1;)Ll--,Vu(Fl,rl<ql?ml:Ml,ql,fl),ql=Fl.length,bl=1;else Ll==0&&(bl=Ll=1),Fl=Ml.slice(),ql=Fl.length;if(ql<jl&&(Fl=[0].concat(Fl)),Vu(Hl,Fl,jl,fl),jl=Hl.length,bl==-1)for(;Ou(Ml,Hl,rl,jl)<1;)Ll++,Vu(Hl,rl<jl?ml:Ml,jl,fl),jl=Hl.length}else bl===0&&(Ll++,Hl=[0]);Ql[wl++]=Ll,Hl[0]?Hl[jl++]=Cl[Ku]||0:(Hl=[Cl[Ku]],jl=1)}while((Ku++<xu||Hl[0]!=null)&&Il--);Dl=Hl[0]!=null,Ql[0]||Ql.splice(0,1)}if(fl==Iu){for(wl=1,Il=Ql[0];Il>=10;Il/=10,wl++);Al(Gl,pl+(Gl.e=wl+al*Au-1)+1,yl,Dl)}else Gl.e=al,Gl.r=+Dl;return Gl}}();function Sl(qu,Ou,Vu,il){var sl,pl,yl,fl,bl;if(Vu==null?Vu=Lu:zu(Vu,0,8),!qu.c)return qu.toString();if(sl=qu.c[0],yl=qu.e,Ou==null)bl=Bu(qu.c),bl=il==1||il==2&&(yl<=cl||yl>=el)?Wu(bl,yl):tl(bl,yl,"0");else if(qu=Al(new nl(qu),Ou,Vu),pl=qu.e,bl=Bu(qu.c),fl=bl.length,il==1||il==2&&(Ou<=pl||pl<=cl)){for(;fl<Ou;bl+="0",fl++);bl=Wu(bl,pl)}else if(Ou-=yl+(il===2&&pl>yl),bl=tl(bl,pl,"0"),pl+1>fl){if(--Ou>0)for(bl+=".";Ou--;bl+="0");}else if(Ou+=pl-fl,Ou>0)for(pl+1==fl&&(bl+=".");Ou--;bl+="0");return qu.s<0&&sl?"-"+bl:bl}function ll(qu,Ou){for(var Vu,il,sl=1,pl=new nl(qu[0]);sl<qu.length;sl++)il=new nl(qu[sl]),(!il.s||(Vu=Fu(pl,il))===Ou||Vu===0&&pl.s===Ou)&&(pl=il);return pl}function ul(qu,Ou,Vu){for(var il=1,sl=Ou.length;!Ou[--sl];Ou.pop());for(sl=Ou[0];sl>=10;sl/=10,il++);return(Vu=il+Vu*Au-1)>dl?qu.c=qu.e=null:Vu<Zu?qu.c=[qu.e=0]:(qu.e=Vu,qu.c=Ou),qu}Uu=function(){var qu=/^(-?)0([xbo])(?=\w[\w.]*$)/i,Ou=/^([^.]+)\.$/,Vu=/^\.([^.]+)$/,il=/^-?(Infinity|NaN)$/,sl=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(pl,yl,fl,bl){var al,wl=fl?yl:yl.replace(sl,"");if(il.test(wl))pl.s=isNaN(wl)?null:wl<0?-1:1;else{if(!fl&&(wl=wl.replace(qu,function(Dl,Ll,Fl){return al=(Fl=Fl.toLowerCase())=="x"?16:Fl=="b"?2:8,!bl||bl==al?Ll:Dl}),bl&&(al=bl,wl=wl.replace(Ou,"$1").replace(Vu,"0.$1")),yl!=wl))return new nl(wl,al);if(nl.DEBUG)throw Error(_u+"Not a"+(bl?" base "+bl:"")+" number: "+yl);pl.s=null}pl.c=pl.e=null}}();function Al(qu,Ou,Vu,il){var sl,pl,yl,fl,bl,al,wl,Dl=qu.c,Ll=vu;if(Dl){e:{for(sl=1,fl=Dl[0];fl>=10;fl/=10,sl++);if(pl=Ou-sl,pl<0)pl+=Au,yl=Ou,bl=Dl[al=0],wl=Zs(bl/Ll[sl-yl-1]%10);else if(al=Ys((pl+1)/Au),al>=Dl.length)if(il){for(;Dl.length<=al;Dl.push(0));bl=wl=0,sl=1,pl%=Au,yl=pl-Au+1}else break e;else{for(bl=fl=Dl[al],sl=1;fl>=10;fl/=10,sl++);pl%=Au,yl=pl-Au+sl,wl=yl<0?0:Zs(bl/Ll[sl-yl-1]%10)}if(il=il||Ou<0||Dl[al+1]!=null||(yl<0?bl:bl%Ll[sl-yl-1]),il=Vu<4?(wl||il)&&(Vu==0||Vu==(qu.s<0?3:2)):wl>5||wl==5&&(Vu==4||il||Vu==6&&(pl>0?yl>0?bl/Ll[sl-yl]:0:Dl[al-1])%10&1||Vu==(qu.s<0?8:7)),Ou<1||!Dl[0])return Dl.length=0,il?(Ou-=qu.e+1,Dl[0]=Ll[(Au-Ou%Au)%Au],qu.e=-Ou||0):Dl[0]=qu.e=0,qu;if(pl==0?(Dl.length=al,fl=1,al--):(Dl.length=al+1,fl=Ll[Au-pl],Dl[al]=yl>0?Zs(bl/Ll[sl-yl]%Ll[yl])*fl:0),il)for(;;)if(al==0){for(pl=1,yl=Dl[0];yl>=10;yl/=10,pl++);for(yl=Dl[0]+=fl,fl=1;yl>=10;yl/=10,fl++);pl!=fl&&(qu.e++,Dl[0]==Iu&&(Dl[0]=1));break}else{if(Dl[al]+=fl,Dl[al]!=Iu)break;Dl[al--]=0,fl=1}for(pl=Dl.length;Dl[--pl]===0;Dl.pop());}qu.e>dl?qu.c=qu.e=null:qu.e<Zu&&(qu.c=[qu.e=0])}return qu}function Tl(qu){var Ou,Vu=qu.e;return Vu===null?qu.toString():(Ou=Bu(qu.c),Ou=Vu<=cl||Vu>=el?Wu(Ou,Vu):tl(Ou,Vu,"0"),qu.s<0?"-"+Ou:Ou)}return Gu.absoluteValue=Gu.abs=function(){var qu=new nl(this);return qu.s<0&&(qu.s=1),qu},Gu.comparedTo=function(qu,Ou){return Fu(this,new nl(qu,Ou))},Gu.decimalPlaces=Gu.dp=function(qu,Ou){var Vu,il,sl,pl=this;if(qu!=null)return zu(qu,0,Ru),Ou==null?Ou=Lu:zu(Ou,0,8),Al(new nl(pl),qu+pl.e+1,Ou);if(!(Vu=pl.c))return null;if(il=((sl=Vu.length-1)-Cu(this.e/Au))*Au,sl=Vu[sl])for(;sl%10==0;sl/=10,il--);return il<0&&(il=0),il},Gu.dividedBy=Gu.div=function(qu,Ou){return ju(this,new nl(qu,Ou),Qu,Lu)},Gu.dividedToIntegerBy=Gu.idiv=function(qu,Ou){return ju(this,new nl(qu,Ou),0,1)},Gu.exponentiatedBy=Gu.pow=function(qu,Ou){var Vu,il,sl,pl,yl,fl,bl,al,wl,Dl=this;if(qu=new nl(qu),qu.c&&!qu.isInteger())throw Error(_u+"Exponent not an integer: "+Tl(qu));if(Ou!=null&&(Ou=new nl(Ou)),fl=qu.e>14,!Dl.c||!Dl.c[0]||Dl.c[0]==1&&!Dl.e&&Dl.c.length==1||!qu.c||!qu.c[0])return wl=new nl(Math.pow(+Tl(Dl),fl?qu.s*(2-Hu(qu)):+Tl(qu))),Ou?wl.mod(Ou):wl;if(bl=qu.s<0,Ou){if(Ou.c?!Ou.c[0]:!Ou.s)return new nl(NaN);il=!bl&&Dl.isInteger()&&Ou.isInteger(),il&&(Dl=Dl.mod(Ou))}else{if(qu.e>9&&(Dl.e>0||Dl.e<-1||(Dl.e==0?Dl.c[0]>1||fl&&Dl.c[1]>=24e7:Dl.c[0]<8e13||fl&&Dl.c[0]<=9999975e7)))return pl=Dl.s<0&&Hu(qu)?-0:0,Dl.e>-1&&(pl=1/pl),new nl(bl?1/pl:pl);_l&&(pl=Ys(_l/Au+2))}for(fl?(Vu=new nl(.5),bl&&(qu.s=1),al=Hu(qu)):(sl=Math.abs(+Tl(qu)),al=sl%2),wl=new nl(Yu);;){if(al){if(wl=wl.times(Dl),!wl.c)break;pl?wl.c.length>pl&&(wl.c.length=pl):il&&(wl=wl.mod(Ou))}if(sl){if(sl=Zs(sl/2),sl===0)break;al=sl%2}else if(qu=qu.times(Vu),Al(qu,qu.e+1,1),qu.e>14)al=Hu(qu);else{if(sl=+Tl(qu),sl===0)break;al=sl%2}Dl=Dl.times(Dl),pl?Dl.c&&Dl.c.length>pl&&(Dl.c.length=pl):il&&(Dl=Dl.mod(Ou))}return il?wl:(bl&&(wl=Yu.div(wl)),Ou?wl.mod(Ou):pl?Al(wl,_l,Lu,yl):wl)},Gu.integerValue=function(qu){var Ou=new nl(this);return qu==null?qu=Lu:zu(qu,0,8),Al(Ou,Ou.e+1,qu)},Gu.isEqualTo=Gu.eq=function(qu,Ou){return Fu(this,new nl(qu,Ou))===0},Gu.isFinite=function(){return!!this.c},Gu.isGreaterThan=Gu.gt=function(qu,Ou){return Fu(this,new nl(qu,Ou))>0},Gu.isGreaterThanOrEqualTo=Gu.gte=function(qu,Ou){return(Ou=Fu(this,new nl(qu,Ou)))===1||Ou===0},Gu.isInteger=function(){return!!this.c&&Cu(this.e/Au)>this.c.length-2},Gu.isLessThan=Gu.lt=function(qu,Ou){return Fu(this,new nl(qu,Ou))<0},Gu.isLessThanOrEqualTo=Gu.lte=function(qu,Ou){return(Ou=Fu(this,new nl(qu,Ou)))===-1||Ou===0},Gu.isNaN=function(){return!this.s},Gu.isNegative=function(){return this.s<0},Gu.isPositive=function(){return this.s>0},Gu.isZero=function(){return!!this.c&&this.c[0]==0},Gu.minus=function(qu,Ou){var Vu,il,sl,pl,yl=this,fl=yl.s;if(qu=new nl(qu,Ou),Ou=qu.s,!fl||!Ou)return new nl(NaN);if(fl!=Ou)return qu.s=-Ou,yl.plus(qu);var bl=yl.e/Au,al=qu.e/Au,wl=yl.c,Dl=qu.c;if(!bl||!al){if(!wl||!Dl)return wl?(qu.s=-Ou,qu):new nl(Dl?yl:NaN);if(!wl[0]||!Dl[0])return Dl[0]?(qu.s=-Ou,qu):new nl(wl[0]?yl:Lu==3?-0:0)}if(bl=Cu(bl),al=Cu(al),wl=wl.slice(),fl=bl-al){for((pl=fl<0)?(fl=-fl,sl=wl):(al=bl,sl=Dl),sl.reverse(),Ou=fl;Ou--;sl.push(0));sl.reverse()}else for(il=(pl=(fl=wl.length)<(Ou=Dl.length))?fl:Ou,fl=Ou=0;Ou<il;Ou++)if(wl[Ou]!=Dl[Ou]){pl=wl[Ou]<Dl[Ou];break}if(pl&&(sl=wl,wl=Dl,Dl=sl,qu.s=-qu.s),Ou=(il=Dl.length)-(Vu=wl.length),Ou>0)for(;Ou--;wl[Vu++]=0);for(Ou=Iu-1;il>fl;){if(wl[--il]<Dl[il]){for(Vu=il;Vu&&!wl[--Vu];wl[Vu]=Ou);--wl[Vu],wl[il]+=Iu}wl[il]-=Dl[il]}for(;wl[0]==0;wl.splice(0,1),--al);return wl[0]?ul(qu,wl,al):(qu.s=Lu==3?-1:1,qu.c=[qu.e=0],qu)},Gu.modulo=Gu.mod=function(qu,Ou){var Vu,il,sl=this;return qu=new nl(qu,Ou),!sl.c||!qu.s||qu.c&&!qu.c[0]?new nl(NaN):!qu.c||sl.c&&!sl.c[0]?new nl(sl):(hl==9?(il=qu.s,qu.s=1,Vu=ju(sl,qu,0,3),qu.s=il,Vu.s*=il):Vu=ju(sl,qu,0,hl),qu=sl.minus(Vu.times(qu)),!qu.c[0]&&hl==1&&(qu.s=sl.s),qu)},Gu.multipliedBy=Gu.times=function(qu,Ou){var Vu,il,sl,pl,yl,fl,bl,al,wl,Dl,Ll,Fl,ql,Gl,Ql,Hl=this,jl=Hl.c,rh=(qu=new nl(qu,Ou)).c;if(!jl||!rh||!jl[0]||!rh[0])return!Hl.s||!qu.s||jl&&!jl[0]&&!rh||rh&&!rh[0]&&!jl?qu.c=qu.e=qu.s=null:(qu.s*=Hl.s,!jl||!rh?qu.c=qu.e=null:(qu.c=[0],qu.e=0)),qu;for(il=Cu(Hl.e/Au)+Cu(qu.e/Au),qu.s*=Hl.s,bl=jl.length,Dl=rh.length,bl<Dl&&(ql=jl,jl=rh,rh=ql,sl=bl,bl=Dl,Dl=sl),sl=bl+Dl,ql=[];sl--;ql.push(0));for(Gl=Iu,Ql=Su,sl=Dl;--sl>=0;){for(Vu=0,Ll=rh[sl]%Ql,Fl=rh[sl]/Ql|0,yl=bl,pl=sl+yl;pl>sl;)al=jl[--yl]%Ql,wl=jl[yl]/Ql|0,fl=Fl*al+wl*Ll,al=Ll*al+fl%Ql*Ql+ql[pl]+Vu,Vu=(al/Gl|0)+(fl/Ql|0)+Fl*wl,ql[pl--]=al%Gl;ql[pl]=Vu}return Vu?++il:ql.splice(0,1),ul(qu,ql,il)},Gu.negated=function(){var qu=new nl(this);return qu.s=-qu.s||null,qu},Gu.plus=function(qu,Ou){var Vu,il=this,sl=il.s;if(qu=new nl(qu,Ou),Ou=qu.s,!sl||!Ou)return new nl(NaN);if(sl!=Ou)return qu.s=-Ou,il.minus(qu);var pl=il.e/Au,yl=qu.e/Au,fl=il.c,bl=qu.c;if(!pl||!yl){if(!fl||!bl)return new nl(sl/0);if(!fl[0]||!bl[0])return bl[0]?qu:new nl(fl[0]?il:sl*0)}if(pl=Cu(pl),yl=Cu(yl),fl=fl.slice(),sl=pl-yl){for(sl>0?(yl=pl,Vu=bl):(sl=-sl,Vu=fl),Vu.reverse();sl--;Vu.push(0));Vu.reverse()}for(sl=fl.length,Ou=bl.length,sl-Ou<0&&(Vu=bl,bl=fl,fl=Vu,Ou=sl),sl=0;Ou;)sl=(fl[--Ou]=fl[Ou]+bl[Ou]+sl)/Iu|0,fl[Ou]=Iu===fl[Ou]?0:fl[Ou]%Iu;return sl&&(fl=[sl].concat(fl),++yl),ul(qu,fl,yl)},Gu.precision=Gu.sd=function(qu,Ou){var Vu,il,sl,pl=this;if(qu!=null&&qu!==!!qu)return zu(qu,1,Ru),Ou==null?Ou=Lu:zu(Ou,0,8),Al(new nl(pl),qu,Ou);if(!(Vu=pl.c))return null;if(sl=Vu.length-1,il=sl*Au+1,sl=Vu[sl]){for(;sl%10==0;sl/=10,il--);for(sl=Vu[0];sl>=10;sl/=10,il++);}return qu&&pl.e+1>il&&(il=pl.e+1),il},Gu.shiftedBy=function(qu){return zu(qu,-$u,$u),this.times("1e"+qu)},Gu.squareRoot=Gu.sqrt=function(){var qu,Ou,Vu,il,sl,pl=this,yl=pl.c,fl=pl.s,bl=pl.e,al=Qu+4,wl=new nl("0.5");if(fl!==1||!yl||!yl[0])return new nl(!fl||fl<0&&(!yl||yl[0])?NaN:yl?pl:1/0);if(fl=Math.sqrt(+Tl(pl)),fl==0||fl==1/0?(Ou=Bu(yl),(Ou.length+bl)%2==0&&(Ou+="0"),fl=Math.sqrt(+Ou),bl=Cu((bl+1)/2)-(bl<0||bl%2),fl==1/0?Ou="5e"+bl:(Ou=fl.toExponential(),Ou=Ou.slice(0,Ou.indexOf("e")+1)+bl),Vu=new nl(Ou)):Vu=new nl(fl+""),Vu.c[0]){for(bl=Vu.e,fl=bl+al,fl<3&&(fl=0);;)if(sl=Vu,Vu=wl.times(sl.plus(ju(pl,sl,al,1))),Bu(sl.c).slice(0,fl)===(Ou=Bu(Vu.c)).slice(0,fl))if(Vu.e<bl&&--fl,Ou=Ou.slice(fl-3,fl+1),Ou=="9999"||!il&&Ou=="4999"){if(!il&&(Al(sl,sl.e+Qu+2,0),sl.times(sl).eq(pl))){Vu=sl;break}al+=4,fl+=4,il=1}else{(!+Ou||!+Ou.slice(1)&&Ou.charAt(0)=="5")&&(Al(Vu,Vu.e+Qu+2,1),qu=!Vu.times(Vu).eq(pl));break}}return Al(Vu,Vu.e+Qu+1,Lu,qu)},Gu.toExponential=function(qu,Ou){return qu!=null&&(zu(qu,0,Ru),qu++),Sl(this,qu,Ou,1)},Gu.toFixed=function(qu,Ou){return qu!=null&&(zu(qu,0,Ru),qu=qu+this.e+1),Sl(this,qu,Ou)},Gu.toFormat=function(qu,Ou,Vu){var il,sl=this;if(Vu==null)qu!=null&&Ou&&typeof Ou=="object"?(Vu=Ou,Ou=null):qu&&typeof qu=="object"?(Vu=qu,qu=Ou=null):Vu=Rl;else if(typeof Vu!="object")throw Error(_u+"Argument not an object: "+Vu);if(il=sl.toFixed(qu,Ou),sl.c){var pl,yl=il.split("."),fl=+Vu.groupSize,bl=+Vu.secondaryGroupSize,al=Vu.groupSeparator||"",wl=yl[0],Dl=yl[1],Ll=sl.s<0,Fl=Ll?wl.slice(1):wl,ql=Fl.length;if(bl&&(pl=fl,fl=bl,bl=pl,ql-=pl),fl>0&&ql>0){for(pl=ql%fl||fl,wl=Fl.substr(0,pl);pl<ql;pl+=fl)wl+=al+Fl.substr(pl,fl);bl>0&&(wl+=al+Fl.slice(pl)),Ll&&(wl="-"+wl)}il=Dl?wl+(Vu.decimalSeparator||"")+((bl=+Vu.fractionGroupSize)?Dl.replace(new RegExp("\\d{"+bl+"}\\B","g"),"$&"+(Vu.fractionGroupSeparator||"")):Dl):wl}return(Vu.prefix||"")+il+(Vu.suffix||"")},Gu.toFraction=function(qu){var Ou,Vu,il,sl,pl,yl,fl,bl,al,wl,Dl,Ll,Fl=this,ql=Fl.c;if(qu!=null&&(fl=new nl(qu),!fl.isInteger()&&(fl.c||fl.s!==1)||fl.lt(Yu)))throw Error(_u+"Argument "+(fl.isInteger()?"out of range: ":"not an integer: ")+Tl(fl));if(!ql)return new nl(Fl);for(Ou=new nl(Yu),al=Vu=new nl(Yu),il=bl=new nl(Yu),Ll=Bu(ql),pl=Ou.e=Ll.length-Fl.e-1,Ou.c[0]=vu[(yl=pl%Au)<0?Au+yl:yl],qu=!qu||fl.comparedTo(Ou)>0?pl>0?Ou:al:fl,yl=dl,dl=1/0,fl=new nl(Ll),bl.c[0]=0;wl=ju(fl,Ou,0,1),sl=Vu.plus(wl.times(il)),sl.comparedTo(qu)!=1;)Vu=il,il=sl,al=bl.plus(wl.times(sl=al)),bl=sl,Ou=fl.minus(wl.times(sl=Ou)),fl=sl;return sl=ju(qu.minus(Vu),il,0,1),bl=bl.plus(sl.times(al)),Vu=Vu.plus(sl.times(il)),bl.s=al.s=Fl.s,pl=pl*2,Dl=ju(al,il,pl,Lu).minus(Fl).abs().comparedTo(ju(bl,Vu,pl,Lu).minus(Fl).abs())<1?[al,il]:[bl,Vu],dl=yl,Dl},Gu.toNumber=function(){return+Tl(this)},Gu.toPrecision=function(qu,Ou){return qu!=null&&zu(qu,1,Ru),Sl(this,qu,Ou,2)},Gu.toString=function(qu){var Ou,Vu=this,il=Vu.s,sl=Vu.e;return sl===null?il?(Ou="Infinity",il<0&&(Ou="-"+Ou)):Ou="NaN":(qu==null?Ou=sl<=cl||sl>=el?Wu(Bu(Vu.c),sl):tl(Bu(Vu.c),sl,"0"):qu===10&&gl?(Vu=Al(new nl(Vu),Qu+sl+1,Lu),Ou=tl(Bu(Vu.c),Vu.e,"0")):(zu(qu,2,ol.length,"Base"),Ou=ku(tl(Bu(Vu.c),sl,"0"),10,qu,il,!0)),il<0&&Vu.c[0]&&(Ou="-"+Ou)),Ou},Gu.valueOf=Gu.toJSON=function(){return Tl(this)},Gu._isBigNumber=!0,Xu!=null&&nl.set(Xu),nl}function Cu(Xu){var ju=Xu|0;return Xu>0||Xu===ju?ju:ju-1}function Bu(Xu){for(var ju,ku,Uu=1,Gu=Xu.length,Yu=Xu[0]+"";Uu<Gu;){for(ju=Xu[Uu++]+"",ku=Au-ju.length;ku--;ju="0"+ju);Yu+=ju}for(Gu=Yu.length;Yu.charCodeAt(--Gu)===48;);return Yu.slice(0,Gu+1||1)}function Fu(Xu,ju){var ku,Uu,Gu=Xu.c,Yu=ju.c,Qu=Xu.s,Lu=ju.s,cl=Xu.e,el=ju.e;if(!Qu||!Lu)return null;if(ku=Gu&&!Gu[0],Uu=Yu&&!Yu[0],ku||Uu)return ku?Uu?0:-Lu:Qu;if(Qu!=Lu)return Qu;if(ku=Qu<0,Uu=cl==el,!Gu||!Yu)return Uu?0:!Gu^ku?1:-1;if(!Uu)return cl>el^ku?1:-1;for(Lu=(cl=Gu.length)<(el=Yu.length)?cl:el,Qu=0;Qu<Lu;Qu++)if(Gu[Qu]!=Yu[Qu])return Gu[Qu]>Yu[Qu]^ku?1:-1;return cl==el?0:cl>el^ku?1:-1}function zu(Xu,ju,ku,Uu){if(Xu<ju||Xu>ku||Xu!==Zs(Xu))throw Error(_u+(Uu||"Argument")+(typeof Xu=="number"?Xu<ju||Xu>ku?" out of range: ":" not an integer: ":" not a primitive number: ")+String(Xu))}function Hu(Xu){var ju=Xu.c.length-1;return Cu(Xu.e/Au)==ju&&Xu.c[ju]%2!=0}function Wu(Xu,ju){return(Xu.length>1?Xu.charAt(0)+"."+Xu.slice(1):Xu)+(ju<0?"e":"e+")+ju}function tl(Xu,ju,ku){var Uu,Gu;if(ju<0){for(Gu=ku+".";++ju;Gu+=ku);Xu=Gu+Xu}else if(Uu=Xu.length,++ju>Uu){for(Gu=ku,ju-=Uu;--ju;Gu+=ku);Xu+=Gu}else ju<Uu&&(Xu=Xu.slice(0,ju)+"."+Xu.slice(ju));return Xu}Hs=Pu(),Hs.default=Hs.BigNumber=Hs,Z.exports?Z.exports=Hs:(t||(t=typeof self<"u"&&self?self:window),t.BigNumber=Hs)})(commonjsGlobal$2)})(bignumber);var bignumberExports=bignumber.exports,codec={},utils$2={},utils_codec={},hasRequiredUtils_codec;function requireUtils_codec(){if(hasRequiredUtils_codec)return utils_codec;hasRequiredUtils_codec=1;var Z=commonjsGlobal$2&&commonjsGlobal$2.__createBinding||(Object.create?function(Ru,Pu,Cu,Bu){Bu===void 0&&(Bu=Cu),Object.defineProperty(Ru,Bu,{enumerable:!0,get:function(){return Pu[Cu]}})}:function(Ru,Pu,Cu,Bu){Bu===void 0&&(Bu=Cu),Ru[Bu]=Pu[Cu]}),t=commonjsGlobal$2&&commonjsGlobal$2.__setModuleDefault||(Object.create?function(Ru,Pu){Object.defineProperty(Ru,"default",{enumerable:!0,value:Pu})}:function(Ru,Pu){Ru.default=Pu}),Hs=commonjsGlobal$2&&commonjsGlobal$2.__importStar||function(Ru){if(Ru&&Ru.__esModule)return Ru;var Pu={};if(Ru!=null)for(var Cu in Ru)Cu!=="default"&&Object.prototype.hasOwnProperty.call(Ru,Cu)&&Z(Pu,Ru,Cu);return t(Pu,Ru),Pu},zs=commonjsGlobal$2&&commonjsGlobal$2.__importDefault||function(Ru){return Ru&&Ru.__esModule?Ru:{default:Ru}};Object.defineProperty(utils_codec,"__esModule",{value:!0}),utils_codec.bigIntToHex=utils_codec.byteArrayToHex=utils_codec.boolToHex=utils_codec.utf8ToHex=utils_codec.zeroPadStringIfOddLength=utils_codec.isPaddedHex=utils_codec.numberToPaddedHex=void 0;const Ys=zs(bignumberExports),Zs=Hs(requireUtils$1());function _u(Ru){let Pu;typeof Ru=="bigint"||typeof Ru=="number"?Pu=Ru:Pu=new Ys.default(Ru);const Cu=Pu.toString(16);return Iu(Cu)}utils_codec.numberToPaddedHex=_u;function Eu(Ru){Ru=Ru||"";let Pu=Buffer$1.from(Ru,"hex").toString("hex");return Ru.toUpperCase()==Pu.toUpperCase()}utils_codec.isPaddedHex=Eu;function Iu(Ru){return Ru=Ru||"",Ru.length%2==1?"0"+Ru:Ru}utils_codec.zeroPadStringIfOddLength=Iu;function Au(Ru){const Pu=Buffer$1.from(Ru).toString("hex");return Iu(Pu)}utils_codec.utf8ToHex=Au;function $u(Ru){return Au(Ru.toString())}utils_codec.boolToHex=$u;function vu(Ru){const Pu=Buffer$1.from(Ru).toString("hex");return Iu(Pu)}utils_codec.byteArrayToHex=vu;function Su(Ru){return Ru==0?"":Zs.getHexMagnitudeOfBigInt(Ru)}return utils_codec.bigIntToHex=Su,utils_codec}var hasRequiredUtils$1;function requireUtils$1(){if(hasRequiredUtils$1)return utils$2;hasRequiredUtils$1=1;var Z=commonjsGlobal$2&&commonjsGlobal$2.__importDefault||function(vu){return vu&&vu.__esModule?vu:{default:vu}};Object.defineProperty(utils$2,"__esModule",{value:!0}),utils$2.prependByteToBuffer=utils$2.flipBufferBitsInPlace=utils$2.getHexMagnitudeOfBigInt=utils$2.bigIntToBuffer=utils$2.bufferToBigInt=utils$2.cloneBuffer=utils$2.isMsbZero=utils$2.isMsbOne=void 0;const t=Z(bignumberExports),Hs=requireUtils_codec();function zs(vu,Su=0){return vu[Su]>>7==1}utils$2.isMsbOne=zs;function Ys(vu,Su=0){return!zs(vu,Su)}utils$2.isMsbZero=Ys;function Zs(vu){let Su=Buffer$1.alloc(vu.length);return vu.copy(Su),Su}utils$2.cloneBuffer=Zs;function _u(vu){let Su=vu.toString("hex");return new t.default(`0x${Su}`,16)}utils$2.bufferToBigInt=_u;function Eu(vu){let Su=Iu(vu);return Buffer$1.from(Su,"hex")}utils$2.bigIntToBuffer=Eu;function Iu(vu){return vu=new t.default(vu),vu?(vu.isNegative()&&(vu=vu.multipliedBy(new t.default(-1))),Hs.numberToPaddedHex(vu)):""}utils$2.getHexMagnitudeOfBigInt=Iu;function Au(vu){for(let Su=0;Su<vu.length;Su++)vu[Su]=~vu[Su]}utils$2.flipBufferBitsInPlace=Au;function $u(vu,Su){return Buffer$1.concat([Buffer$1.from([Su]),vu])}return utils$2.prependByteToBuffer=$u,utils$2}(function(Z){var t=commonjsGlobal$2&&commonjsGlobal$2.__createBinding||(Object.create?function(Ru,Pu,Cu,Bu){Bu===void 0&&(Bu=Cu),Object.defineProperty(Ru,Bu,{enumerable:!0,get:function(){return Pu[Cu]}})}:function(Ru,Pu,Cu,Bu){Bu===void 0&&(Bu=Cu),Ru[Bu]=Pu[Cu]}),Hs=commonjsGlobal$2&&commonjsGlobal$2.__setModuleDefault||(Object.create?function(Ru,Pu){Object.defineProperty(Ru,"default",{enumerable:!0,value:Pu})}:function(Ru,Pu){Ru.default=Pu}),zs=commonjsGlobal$2&&commonjsGlobal$2.__importStar||function(Ru){if(Ru&&Ru.__esModule)return Ru;var Pu={};if(Ru!=null)for(var Cu in Ru)Cu!=="default"&&Object.prototype.hasOwnProperty.call(Ru,Cu)&&t(Pu,Ru,Cu);return Hs(Pu,Ru),Pu},Ys=commonjsGlobal$2&&commonjsGlobal$2.__importDefault||function(Ru){return Ru&&Ru.__esModule?Ru:{default:Ru}};Object.defineProperty(Z,"__esModule",{value:!0}),Z.bufferToHex=Z.utf8ToHex=Z.bigIntToHex=Z.bigIntToBuffer=Z.bufferToBigInt=Z.stringToBuffer=void 0;const Zs=Ys(bignumberExports),_u=zs(requireUtils$1()),Eu=zs(requireUtils_codec());function Iu(Ru){return Buffer$1.from(Ru)}Z.stringToBuffer=Iu;function Au(Ru){return Ru.length==0?new Zs.default(0):_u.bufferToBigInt(Ru)}Z.bufferToBigInt=Au;function $u(Ru){return Ru==0?Buffer$1.from([]):_u.bigIntToBuffer(Ru)}Z.bigIntToBuffer=$u;var vu=requireUtils_codec();Object.defineProperty(Z,"bigIntToHex",{enumerable:!0,get:function(){return vu.bigIntToHex}}),Object.defineProperty(Z,"utf8ToHex",{enumerable:!0,get:function(){return vu.utf8ToHex}});function Su(Ru){const Pu=Ru.toString("hex");return Eu.zeroPadStringIfOddLength(Pu)}Z.bufferToHex=Su})(codec);var config$1={};Object.defineProperty(config$1,"__esModule",{value:!0});config$1.LibraryConfig=void 0;class LibraryConfig{}config$1.LibraryConfig=LibraryConfig;LibraryConfig.DefaultAddressHrp="erd";var constants$2={};Object.defineProperty(constants$2,"__esModule",{value:!0});constants$2.EXTRA_GAS_LIMIT_FOR_RELAYED_TRANSACTIONS=constants$2.EXTRA_GAS_LIMIT_FOR_GUARDED_TRANSACTIONS=constants$2.EGLD_IDENTIFIER_FOR_MULTI_ESDTNFT_TRANSFER=constants$2.UNKNOWN_SIGNER=constants$2.SDK_JS_SIGNER=constants$2.METACHAIN_ID=constants$2.WasmVirtualMachine=constants$2.CURRENT_NUMBER_OF_SHARDS_WITHOUT_META=constants$2.HEX_TRANSACTION_HASH_LENGTH=constants$2.MESSAGE_PREFIX=constants$2.DEFAULT_MESSAGE_VERSION=constants$2.STAKING_SMART_CONTRACT_ADDRESS_HEX=constants$2.GOVERNANCE_CONTRACT_ADDRESS_HEX=constants$2.ESDT_CONTRACT_ADDRESS_HEX=constants$2.DELEGATION_MANAGER_SC_ADDRESS_HEX=constants$2.CONTRACT_DEPLOY_ADDRESS_HEX=constants$2.VM_TYPE_WASM_VM=constants$2.ARGUMENTS_SEPARATOR=constants$2.ESDT_TRANSFER_VALUE=constants$2.MULTI_ESDTNFT_TRANSFER_FUNCTION_NAME=constants$2.ESDTNFT_TRANSFER_FUNCTION_NAME=constants$2.ESDT_TRANSFER_FUNCTION_NAME=constants$2.ESDT_TRANSFER_GAS_LIMIT=constants$2.MIN_TRANSACTION_VERSION_THAT_SUPPORTS_OPTIONS=constants$2.TRANSACTION_VERSION_DEFAULT=constants$2.TRANSACTION_OPTIONS_TX_GUARDED=constants$2.TRANSACTION_OPTIONS_TX_HASH_SIGN=constants$2.TRANSACTION_OPTIONS_DEFAULT=constants$2.TRANSACTION_MIN_GAS_PRICE=void 0;constants$2.TRANSACTION_MIN_GAS_PRICE=1e9;constants$2.TRANSACTION_OPTIONS_DEFAULT=0;constants$2.TRANSACTION_OPTIONS_TX_HASH_SIGN=1;constants$2.TRANSACTION_OPTIONS_TX_GUARDED=2;constants$2.TRANSACTION_VERSION_DEFAULT=2;constants$2.MIN_TRANSACTION_VERSION_THAT_SUPPORTS_OPTIONS=2;constants$2.ESDT_TRANSFER_GAS_LIMIT=5e5;constants$2.ESDT_TRANSFER_FUNCTION_NAME="ESDTTransfer";constants$2.ESDTNFT_TRANSFER_FUNCTION_NAME="ESDTNFTTransfer";constants$2.MULTI_ESDTNFT_TRANSFER_FUNCTION_NAME="MultiESDTNFTTransfer";constants$2.ESDT_TRANSFER_VALUE="0";constants$2.ARGUMENTS_SEPARATOR="@";constants$2.VM_TYPE_WASM_VM=new Uint8Array([5,0]);constants$2.CONTRACT_DEPLOY_ADDRESS_HEX="0000000000000000000000000000000000000000000000000000000000000000";constants$2.DELEGATION_MANAGER_SC_ADDRESS_HEX="000000000000000000010000000000000000000000000000000000000004ffff";constants$2.ESDT_CONTRACT_ADDRESS_HEX="000000000000000000010000000000000000000000000000000000000002ffff";constants$2.GOVERNANCE_CONTRACT_ADDRESS_HEX="000000000000000000010000000000000000000000000000000000000003ffff";constants$2.STAKING_SMART_CONTRACT_ADDRESS_HEX="000000000000000000010000000000000000000000000000000000000001ffff";constants$2.DEFAULT_MESSAGE_VERSION=1;constants$2.MESSAGE_PREFIX=`Elrond Signed Message:
`;constants$2.HEX_TRANSACTION_HASH_LENGTH=64;constants$2.CURRENT_NUMBER_OF_SHARDS_WITHOUT_META=3;constants$2.WasmVirtualMachine="0500";constants$2.METACHAIN_ID=4294967295;constants$2.SDK_JS_SIGNER="sdk-js";constants$2.UNKNOWN_SIGNER="unknown";constants$2.EGLD_IDENTIFIER_FOR_MULTI_ESDTNFT_TRANSFER="EGLD-000000";constants$2.EXTRA_GAS_LIMIT_FOR_GUARDED_TRANSACTIONS=5e4;constants$2.EXTRA_GAS_LIMIT_FOR_RELAYED_TRANSACTIONS=5e4;var errors$5={};Object.defineProperty(errors$5,"__esModule",{value:!0});errors$5.ErrEstimateTransactionCost=errors$5.ErrGasLimitCannotBeEstimated=errors$5.ExpectedAccountConditionNotReachedError=errors$5.ErrInvalidNetworkProviderKind=errors$5.ErrContractQuery=errors$5.ErrNetworkProvider=errors$5.ErrBadAddress=errors$5.ErrSignerCannotSign=errors$5.ErrBadPEM=errors$5.ErrBadMnemonicEntropy=errors$5.ErrWrongMnemonic=errors$5.ErrSmartContractQuery=errors$5.ErrParseTransactionOutcome=errors$5.ErrInvalidInnerTransaction=errors$5.ErrBadUsage=errors$5.ErrInvalidTokenIdentifier=errors$5.ErrIsCompletedFieldIsMissingOnTransaction=errors$5.ErrNotImplemented=errors$5.ErrContractInteraction=errors$5.ErrCodec=errors$5.ErrCannotParseTransactionOutcome=errors$5.ErrCannotParseContractResults=errors$5.ErrMissingFieldOnEnum=errors$5.ErrMissingFieldOnStruct=errors$5.ErrTypingSystem=errors$5.ErrMock=errors$5.ErrContractHasNoAddress=errors$5.ErrContract=errors$5.ErrExpectedTransactionEventsNotFound=errors$5.ErrExpectedTransactionStatusNotReached=errors$5.ErrTransactionWatcherTimeout=errors$5.ErrAsyncTimerAborted=errors$5.ErrAsyncTimerAlreadyRunning=errors$5.ErrInvalidFunctionName=errors$5.ErrSignatureCannotCreate=errors$5.ErrTransactionOptionsInvalid=errors$5.ErrTransactionVersionInvalid=errors$5.ErrNonceInvalid=errors$5.ErrNotEnoughGas=errors$5.ErrAddressEmpty=errors$5.ErrAddressBadHrp=errors$5.ErrAddressCannotCreate=errors$5.ErrUnexpectedCondition=errors$5.ErrInvariantFailed=errors$5.ErrBadType=errors$5.ErrUnsupportedOperation=errors$5.ErrInvalidArgument=errors$5.Err=void 0;let Err$2=class extends Error{constructor(t,Hs){super(t),this.inner=void 0,this.inner=Hs}summary(){const t=[];t.push({name:this.name,message:this.message});let Hs=this.inner;for(;Hs;)t.push({name:Hs.name,message:Hs.message}),Hs=Hs.inner;return t}};errors$5.Err=Err$2;class ErrInvalidArgument extends Err$2{constructor(t,Hs){super(`Invalid argument: ${t}`,Hs)}}errors$5.ErrInvalidArgument=ErrInvalidArgument;class ErrUnsupportedOperation extends Err$2{constructor(t,Hs="not specified"){super(`Operation "${t}" not supported. Reason: ${Hs}`)}}errors$5.ErrUnsupportedOperation=ErrUnsupportedOperation;class ErrBadType extends Err$2{constructor(t,Hs,zs){super(`Bad type of "${t}": ${zs}. Expected type: ${Hs}`)}}errors$5.ErrBadType=ErrBadType;class ErrInvariantFailed extends Err$2{constructor(t){super(`Invariant failed: [${t}]`)}}errors$5.ErrInvariantFailed=ErrInvariantFailed;class ErrUnexpectedCondition extends Err$2{constructor(t){super(`Unexpected condition: [${t}]`)}}errors$5.ErrUnexpectedCondition=ErrUnexpectedCondition;class ErrAddressCannotCreate extends Err$2{constructor(t,Hs){const zs=`Cannot create address from: ${t}`;super(zs,Hs)}}errors$5.ErrAddressCannotCreate=ErrAddressCannotCreate;class ErrAddressBadHrp extends Err$2{constructor(t,Hs){super(`Wrong address HRP. Expected: ${t}, got ${Hs}`)}}errors$5.ErrAddressBadHrp=ErrAddressBadHrp;class ErrAddressEmpty extends Err$2{constructor(){super("Address is empty")}}errors$5.ErrAddressEmpty=ErrAddressEmpty;class ErrNotEnoughGas extends Err$2{constructor(t){super(`Not enough gas provided: ${t}`)}}errors$5.ErrNotEnoughGas=ErrNotEnoughGas;class ErrNonceInvalid extends Err$2{constructor(t){super(`Invalid nonce: ${t}`)}}errors$5.ErrNonceInvalid=ErrNonceInvalid;class ErrTransactionVersionInvalid extends Err$2{constructor(t){super(`Invalid transaction version: ${t}`)}}errors$5.ErrTransactionVersionInvalid=ErrTransactionVersionInvalid;class ErrTransactionOptionsInvalid extends Err$2{constructor(t){super(`Invalid transaction options: ${t}`)}}errors$5.ErrTransactionOptionsInvalid=ErrTransactionOptionsInvalid;class ErrSignatureCannotCreate extends Err$2{constructor(t,Hs){const zs=`Cannot create signature from: ${t}`;super(zs,Hs)}}errors$5.ErrSignatureCannotCreate=ErrSignatureCannotCreate;class ErrInvalidFunctionName extends Err$2{constructor(){super("Invalid function name")}}errors$5.ErrInvalidFunctionName=ErrInvalidFunctionName;class ErrAsyncTimerAlreadyRunning extends Err$2{constructor(){super("Async timer already running")}}errors$5.ErrAsyncTimerAlreadyRunning=ErrAsyncTimerAlreadyRunning;class ErrAsyncTimerAborted extends Err$2{constructor(){super("Async timer aborted")}}errors$5.ErrAsyncTimerAborted=ErrAsyncTimerAborted;class ErrTransactionWatcherTimeout extends Err$2{constructor(){super("TransactionWatcher has timed out")}}errors$5.ErrTransactionWatcherTimeout=ErrTransactionWatcherTimeout;class ErrExpectedTransactionStatusNotReached extends Err$2{constructor(){super("Expected transaction status not reached")}}errors$5.ErrExpectedTransactionStatusNotReached=ErrExpectedTransactionStatusNotReached;class ErrExpectedTransactionEventsNotFound extends Err$2{constructor(){super("Expected transaction events not found")}}errors$5.ErrExpectedTransactionEventsNotFound=ErrExpectedTransactionEventsNotFound;class ErrContract extends Err$2{constructor(t){super(t)}}errors$5.ErrContract=ErrContract;class ErrContractHasNoAddress extends ErrContract{constructor(){super(`
The smart contract has no address set. Make sure you provide the address in the constructor, or call setAddress() appropriately.
If you need to recompute the address of the contract, make use of SmartContract.computeAddress() (static method).
`)}}errors$5.ErrContractHasNoAddress=ErrContractHasNoAddress;class ErrMock extends Err$2{constructor(t){super(t)}}errors$5.ErrMock=ErrMock;class ErrTypingSystem extends Err$2{constructor(t){super(t)}}errors$5.ErrTypingSystem=ErrTypingSystem;class ErrMissingFieldOnStruct extends Err$2{constructor(t,Hs){super(`field ${t} does not exist on struct ${Hs}`)}}errors$5.ErrMissingFieldOnStruct=ErrMissingFieldOnStruct;class ErrMissingFieldOnEnum extends Err$2{constructor(t,Hs){super(`field ${t} does not exist on enum ${Hs}`)}}errors$5.ErrMissingFieldOnEnum=ErrMissingFieldOnEnum;class ErrCannotParseContractResults extends Err$2{constructor(t){super(`cannot parse contract results: ${t}`)}}errors$5.ErrCannotParseContractResults=ErrCannotParseContractResults;class ErrCannotParseTransactionOutcome extends Err$2{constructor(t,Hs){super(`cannot parse outcome of transaction ${t}: ${Hs}`)}}errors$5.ErrCannotParseTransactionOutcome=ErrCannotParseTransactionOutcome;class ErrCodec extends Err$2{constructor(t){super(t)}}errors$5.ErrCodec=ErrCodec;class ErrContractInteraction extends Err$2{constructor(t){super(t)}}errors$5.ErrContractInteraction=ErrContractInteraction;let ErrNotImplemented$1=class extends Err$2{constructor(){super("Method not yet implemented")}};errors$5.ErrNotImplemented=ErrNotImplemented$1;class ErrIsCompletedFieldIsMissingOnTransaction extends Err$2{constructor(){super("The transaction watcher requires the `isCompleted` property to be defined on the transaction object. Perhaps you've used the sdk-network-provider's `ProxyNetworkProvider.getTransaction()` and in that case you should also pass `withProcessStatus=true`.")}}errors$5.ErrIsCompletedFieldIsMissingOnTransaction=ErrIsCompletedFieldIsMissingOnTransaction;class ErrInvalidTokenIdentifier extends Err$2{constructor(t){super(t)}}errors$5.ErrInvalidTokenIdentifier=ErrInvalidTokenIdentifier;class ErrBadUsage extends Err$2{constructor(t){super(t)}}errors$5.ErrBadUsage=ErrBadUsage;class ErrInvalidInnerTransaction extends Err$2{constructor(t){super(t)}}errors$5.ErrInvalidInnerTransaction=ErrInvalidInnerTransaction;class ErrParseTransactionOutcome extends Err$2{constructor(t){super(t)}}errors$5.ErrParseTransactionOutcome=ErrParseTransactionOutcome;class ErrSmartContractQuery extends Err$2{constructor(t,Hs){super(Hs),this.returnCode=t}}errors$5.ErrSmartContractQuery=ErrSmartContractQuery;class ErrWrongMnemonic extends Err$2{constructor(){super("Wrong mnemonic format")}}errors$5.ErrWrongMnemonic=ErrWrongMnemonic;class ErrBadMnemonicEntropy extends Err$2{constructor(t){super("Bad mnemonic entropy",t)}}errors$5.ErrBadMnemonicEntropy=ErrBadMnemonicEntropy;class ErrBadPEM extends Err$2{constructor(t){super(t?`Bad PEM: ${t}`:"Bad PEM")}}errors$5.ErrBadPEM=ErrBadPEM;class ErrSignerCannotSign extends Err$2{constructor(t){super("Cannot sign",t)}}errors$5.ErrSignerCannotSign=ErrSignerCannotSign;let ErrBadAddress$1=class extends Err$2{constructor(t,Hs){super(`Bad address: ${t}`,Hs)}};errors$5.ErrBadAddress=ErrBadAddress$1;class ErrNetworkProvider extends Err$2{constructor(t,Hs,zs){const Ys=`Request error on url [${t}]: [${Hs}]`;super(Ys,zs)}}errors$5.ErrNetworkProvider=ErrNetworkProvider;class ErrContractQuery extends Err$2{constructor(t){super(t.message.replace("executeQuery:",""))}}errors$5.ErrContractQuery=ErrContractQuery;class ErrInvalidNetworkProviderKind extends Err$2{constructor(){super("Invalid network provider kind. Choose between `api` and `proxy`.")}}errors$5.ErrInvalidNetworkProviderKind=ErrInvalidNetworkProviderKind;class ExpectedAccountConditionNotReachedError extends Err$2{constructor(){super("The expected account condition was not reached.")}}errors$5.ExpectedAccountConditionNotReachedError=ExpectedAccountConditionNotReachedError;class ErrGasLimitCannotBeEstimated extends Err$2{constructor(t){super(`Failed to estimate gas limit: [${t}]`,t)}}errors$5.ErrGasLimitCannotBeEstimated=ErrGasLimitCannotBeEstimated;class ErrEstimateTransactionCost extends Err$2{constructor(t){super(t)}}errors$5.ErrEstimateTransactionCost=ErrEstimateTransactionCost;var readableBrowser={exports:{}},events={exports:{}},R$3=typeof Reflect=="object"?Reflect:null,ReflectApply=R$3&&typeof R$3.apply=="function"?R$3.apply:function(t,Hs,zs){return Function.prototype.apply.call(t,Hs,zs)},ReflectOwnKeys;R$3&&typeof R$3.ownKeys=="function"?ReflectOwnKeys=R$3.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:ReflectOwnKeys=function(t){return Object.getOwnPropertyNames(t)};function ProcessEmitWarning(Z){console&&console.warn&&console.warn(Z)}var NumberIsNaN=Number.isNaN||function(t){return t!==t};function EventEmitter(){EventEmitter.init.call(this)}events.exports=EventEmitter;events.exports.once=once$2;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=void 0;EventEmitter.prototype._eventsCount=0;EventEmitter.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(Z){if(typeof Z!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Z)}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(Z){if(typeof Z!="number"||Z<0||NumberIsNaN(Z))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Z+".");defaultMaxListeners=Z}});EventEmitter.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||NumberIsNaN(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function _getMaxListeners(Z){return Z._maxListeners===void 0?EventEmitter.defaultMaxListeners:Z._maxListeners}EventEmitter.prototype.getMaxListeners=function(){return _getMaxListeners(this)};EventEmitter.prototype.emit=function(t){for(var Hs=[],zs=1;zs<arguments.length;zs++)Hs.push(arguments[zs]);var Ys=t==="error",Zs=this._events;if(Zs!==void 0)Ys=Ys&&Zs.error===void 0;else if(!Ys)return!1;if(Ys){var _u;if(Hs.length>0&&(_u=Hs[0]),_u instanceof Error)throw _u;var Eu=new Error("Unhandled error."+(_u?" ("+_u.message+")":""));throw Eu.context=_u,Eu}var Iu=Zs[t];if(Iu===void 0)return!1;if(typeof Iu=="function")ReflectApply(Iu,this,Hs);else for(var Au=Iu.length,$u=arrayClone(Iu,Au),zs=0;zs<Au;++zs)ReflectApply($u[zs],this,Hs);return!0};function _addListener(Z,t,Hs,zs){var Ys,Zs,_u;if(checkListener(Hs),Zs=Z._events,Zs===void 0?(Zs=Z._events=Object.create(null),Z._eventsCount=0):(Zs.newListener!==void 0&&(Z.emit("newListener",t,Hs.listener?Hs.listener:Hs),Zs=Z._events),_u=Zs[t]),_u===void 0)_u=Zs[t]=Hs,++Z._eventsCount;else if(typeof _u=="function"?_u=Zs[t]=zs?[Hs,_u]:[_u,Hs]:zs?_u.unshift(Hs):_u.push(Hs),Ys=_getMaxListeners(Z),Ys>0&&_u.length>Ys&&!_u.warned){_u.warned=!0;var Eu=new Error("Possible EventEmitter memory leak detected. "+_u.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");Eu.name="MaxListenersExceededWarning",Eu.emitter=Z,Eu.type=t,Eu.count=_u.length,ProcessEmitWarning(Eu)}return Z}EventEmitter.prototype.addListener=function(t,Hs){return _addListener(this,t,Hs,!1)};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.prependListener=function(t,Hs){return _addListener(this,t,Hs,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(Z,t,Hs){var zs={fired:!1,wrapFn:void 0,target:Z,type:t,listener:Hs},Ys=onceWrapper.bind(zs);return Ys.listener=Hs,zs.wrapFn=Ys,Ys}EventEmitter.prototype.once=function(t,Hs){return checkListener(Hs),this.on(t,_onceWrap(this,t,Hs)),this};EventEmitter.prototype.prependOnceListener=function(t,Hs){return checkListener(Hs),this.prependListener(t,_onceWrap(this,t,Hs)),this};EventEmitter.prototype.removeListener=function(t,Hs){var zs,Ys,Zs,_u,Eu;if(checkListener(Hs),Ys=this._events,Ys===void 0)return this;if(zs=Ys[t],zs===void 0)return this;if(zs===Hs||zs.listener===Hs)--this._eventsCount===0?this._events=Object.create(null):(delete Ys[t],Ys.removeListener&&this.emit("removeListener",t,zs.listener||Hs));else if(typeof zs!="function"){for(Zs=-1,_u=zs.length-1;_u>=0;_u--)if(zs[_u]===Hs||zs[_u].listener===Hs){Eu=zs[_u].listener,Zs=_u;break}if(Zs<0)return this;Zs===0?zs.shift():spliceOne(zs,Zs),zs.length===1&&(Ys[t]=zs[0]),Ys.removeListener!==void 0&&this.emit("removeListener",t,Eu||Hs)}return this};EventEmitter.prototype.off=EventEmitter.prototype.removeListener;EventEmitter.prototype.removeAllListeners=function(t){var Hs,zs,Ys;if(zs=this._events,zs===void 0)return this;if(zs.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):zs[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete zs[t]),this;if(arguments.length===0){var Zs=Object.keys(zs),_u;for(Ys=0;Ys<Zs.length;++Ys)_u=Zs[Ys],_u!=="removeListener"&&this.removeAllListeners(_u);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(Hs=zs[t],typeof Hs=="function")this.removeListener(t,Hs);else if(Hs!==void 0)for(Ys=Hs.length-1;Ys>=0;Ys--)this.removeListener(t,Hs[Ys]);return this};function _listeners(Z,t,Hs){var zs=Z._events;if(zs===void 0)return[];var Ys=zs[t];return Ys===void 0?[]:typeof Ys=="function"?Hs?[Ys.listener||Ys]:[Ys]:Hs?unwrapListeners(Ys):arrayClone(Ys,Ys.length)}EventEmitter.prototype.listeners=function(t){return _listeners(this,t,!0)};EventEmitter.prototype.rawListeners=function(t){return _listeners(this,t,!1)};EventEmitter.listenerCount=function(Z,t){return typeof Z.listenerCount=="function"?Z.listenerCount(t):listenerCount.call(Z,t)};EventEmitter.prototype.listenerCount=listenerCount;function listenerCount(Z){var t=this._events;if(t!==void 0){var Hs=t[Z];if(typeof Hs=="function")return 1;if(Hs!==void 0)return Hs.length}return 0}EventEmitter.prototype.eventNames=function(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(Z,t){for(var Hs=new Array(t),zs=0;zs<t;++zs)Hs[zs]=Z[zs];return Hs}function spliceOne(Z,t){for(;t+1<Z.length;t++)Z[t]=Z[t+1];Z.pop()}function unwrapListeners(Z){for(var t=new Array(Z.length),Hs=0;Hs<t.length;++Hs)t[Hs]=Z[Hs].listener||Z[Hs];return t}function once$2(Z,t){return new Promise(function(Hs,zs){function Ys(_u){Z.removeListener(t,Zs),zs(_u)}function Zs(){typeof Z.removeListener=="function"&&Z.removeListener("error",Ys),Hs([].slice.call(arguments))}eventTargetAgnosticAddListener(Z,t,Zs,{once:!0}),t!=="error"&&addErrorHandlerIfEventEmitter(Z,Ys,{once:!0})})}function addErrorHandlerIfEventEmitter(Z,t,Hs){typeof Z.on=="function"&&eventTargetAgnosticAddListener(Z,"error",t,Hs)}function eventTargetAgnosticAddListener(Z,t,Hs,zs){if(typeof Z.on=="function")zs.once?Z.once(t,Hs):Z.on(t,Hs);else if(typeof Z.addEventListener=="function")Z.addEventListener(t,function Ys(Zs){zs.once&&Z.removeEventListener(t,Ys),Hs(Zs)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Z)}var eventsExports=events.exports;const Nt$3=getDefaultExportFromCjs(eventsExports);var streamBrowser=eventsExports.EventEmitter;const require$$0$1=getAugmentedNamespace(dist$2);var util$3={},types$1={},shams$1=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},Hs=Symbol("test"),zs=Object(Hs);if(typeof Hs=="string"||Object.prototype.toString.call(Hs)!=="[object Symbol]"||Object.prototype.toString.call(zs)!=="[object Symbol]")return!1;var Ys=42;t[Hs]=Ys;for(var Zs in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var _u=Object.getOwnPropertySymbols(t);if(_u.length!==1||_u[0]!==Hs||!Object.prototype.propertyIsEnumerable.call(t,Hs))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var Eu=Object.getOwnPropertyDescriptor(t,Hs);if(Eu.value!==Ys||Eu.enumerable!==!0)return!1}return!0},hasSymbols$2=shams$1,shams=function(){return hasSymbols$2()&&!!Symbol.toStringTag},esObjectAtoms=Object,esErrors=Error,_eval=EvalError,range=RangeError,ref=ReferenceError,syntax=SyntaxError,type=TypeError,uri=URIError,abs$1=Math.abs,floor$1=Math.floor,max$2=Math.max,min$1=Math.min,pow$1=Math.pow,round$1=Math.round,_isNaN=Number.isNaN||function(t){return t!==t},$isNaN=_isNaN,sign$1=function(t){return $isNaN(t)||t===0?t:t<0?-1:1},gOPD$4=Object.getOwnPropertyDescriptor,$gOPD$1=gOPD$4;if($gOPD$1)try{$gOPD$1([],"length")}catch{$gOPD$1=null}var gopd$1=$gOPD$1,$defineProperty$3=Object.defineProperty||!1;if($defineProperty$3)try{$defineProperty$3({},"a",{value:1})}catch{$defineProperty$3=!1}var esDefineProperty=$defineProperty$3,hasSymbols$1,hasRequiredHasSymbols;function requireHasSymbols(){if(hasRequiredHasSymbols)return hasSymbols$1;hasRequiredHasSymbols=1;var Z=typeof Symbol<"u"&&Symbol,t=shams$1;return hasSymbols$1=function(){return typeof Z!="function"||typeof Symbol!="function"||typeof Z("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:t()},hasSymbols$1}var Reflect_getPrototypeOf,hasRequiredReflect_getPrototypeOf;function requireReflect_getPrototypeOf(){return hasRequiredReflect_getPrototypeOf||(hasRequiredReflect_getPrototypeOf=1,Reflect_getPrototypeOf=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Reflect_getPrototypeOf}var Object_getPrototypeOf,hasRequiredObject_getPrototypeOf;function requireObject_getPrototypeOf(){if(hasRequiredObject_getPrototypeOf)return Object_getPrototypeOf;hasRequiredObject_getPrototypeOf=1;var Z=esObjectAtoms;return Object_getPrototypeOf=Z.getPrototypeOf||null,Object_getPrototypeOf}var ERROR_MESSAGE="Function.prototype.bind called on incompatible ",toStr$3=Object.prototype.toString,max$1=Math.max,funcType="[object Function]",concatty=function(t,Hs){for(var zs=[],Ys=0;Ys<t.length;Ys+=1)zs[Ys]=t[Ys];for(var Zs=0;Zs<Hs.length;Zs+=1)zs[Zs+t.length]=Hs[Zs];return zs},slicy=function(t,Hs){for(var zs=[],Ys=Hs||0,Zs=0;Ys<t.length;Ys+=1,Zs+=1)zs[Zs]=t[Ys];return zs},joiny=function(Z,t){for(var Hs="",zs=0;zs<Z.length;zs+=1)Hs+=Z[zs],zs+1<Z.length&&(Hs+=t);return Hs},implementation$1=function(t){var Hs=this;if(typeof Hs!="function"||toStr$3.apply(Hs)!==funcType)throw new TypeError(ERROR_MESSAGE+Hs);for(var zs=slicy(arguments,1),Ys,Zs=function(){if(this instanceof Ys){var $u=Hs.apply(this,concatty(zs,arguments));return Object($u)===$u?$u:this}return Hs.apply(t,concatty(zs,arguments))},_u=max$1(0,Hs.length-zs.length),Eu=[],Iu=0;Iu<_u;Iu++)Eu[Iu]="$"+Iu;if(Ys=Function("binder","return function ("+joiny(Eu,",")+"){ return binder.apply(this,arguments); }")(Zs),Hs.prototype){var Au=function(){};Au.prototype=Hs.prototype,Ys.prototype=new Au,Au.prototype=null}return Ys},implementation=implementation$1,functionBind=Function.prototype.bind||implementation,functionCall=Function.prototype.call,functionApply,hasRequiredFunctionApply;function requireFunctionApply(){return hasRequiredFunctionApply||(hasRequiredFunctionApply=1,functionApply=Function.prototype.apply),functionApply}var reflectApply$1=typeof Reflect<"u"&&Reflect&&Reflect.apply,bind$3=functionBind,$apply$2=requireFunctionApply(),$call$2=functionCall,$reflectApply=reflectApply$1,actualApply$1=$reflectApply||bind$3.call($call$2,$apply$2),bind$2=functionBind,$TypeError$4=type,$call$1=functionCall,$actualApply=actualApply$1,callBindApplyHelpers=function(t){if(t.length<1||typeof t[0]!="function")throw new $TypeError$4("a function is required");return $actualApply(bind$2,$call$1,t)},callBind$2=callBindApplyHelpers,gOPD$3=gopd$1,hasProtoAccessor;try{hasProtoAccessor=[].__proto__===Array.prototype}catch(Z){if(!Z||typeof Z!="object"||!("code"in Z)||Z.code!=="ERR_PROTO_ACCESS")throw Z}var desc=!!hasProtoAccessor&&gOPD$3&&gOPD$3(Object.prototype,"__proto__"),$Object$1=Object,$getPrototypeOf=$Object$1.getPrototypeOf,get$1=desc&&typeof desc.get=="function"?callBind$2([desc.get]):typeof $getPrototypeOf=="function"?function(t){return $getPrototypeOf(t==null?t:$Object$1(t))}:!1,reflectGetProto=requireReflect_getPrototypeOf(),originalGetProto=requireObject_getPrototypeOf(),getDunderProto=get$1,getProto$3=reflectGetProto?function(t){return reflectGetProto(t)}:originalGetProto?function(t){if(!t||typeof t!="object"&&typeof t!="function")throw new TypeError("getProto: not an object");return originalGetProto(t)}:getDunderProto?function(t){return getDunderProto(t)}:null,hasown,hasRequiredHasown;function requireHasown(){if(hasRequiredHasown)return hasown;hasRequiredHasown=1;var Z=Function.prototype.call,t=Object.prototype.hasOwnProperty,Hs=functionBind;return hasown=Hs.call(Z,t),hasown}var undefined$1,$Object=esObjectAtoms,$Error=esErrors,$EvalError=_eval,$RangeError=range,$ReferenceError=ref,$SyntaxError$1=syntax,$TypeError$3=type,$URIError=uri,abs=abs$1,floor=floor$1,max=max$2,min=min$1,pow=pow$1,round=round$1,sign=sign$1,$Function=Function,getEvalledConstructor=function(Z){try{return $Function('"use strict"; return ('+Z+").constructor;")()}catch{}},$gOPD=gopd$1,$defineProperty$2=esDefineProperty,throwTypeError=function(){throw new $TypeError$3},ThrowTypeError=$gOPD?function(){try{return arguments.callee,throwTypeError}catch{try{return $gOPD(arguments,"callee").get}catch{return throwTypeError}}}():throwTypeError,hasSymbols=requireHasSymbols()(),getProto$2=getProto$3,$ObjectGPO=requireObject_getPrototypeOf(),$ReflectGPO=requireReflect_getPrototypeOf(),$apply$1=requireFunctionApply(),$call=functionCall,needsEval={},TypedArray=typeof Uint8Array>"u"||!getProto$2?undefined$1:getProto$2(Uint8Array),INTRINSICS={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?undefined$1:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?undefined$1:ArrayBuffer,"%ArrayIteratorPrototype%":hasSymbols&&getProto$2?getProto$2([][Symbol.iterator]()):undefined$1,"%AsyncFromSyncIteratorPrototype%":undefined$1,"%AsyncFunction%":needsEval,"%AsyncGenerator%":needsEval,"%AsyncGeneratorFunction%":needsEval,"%AsyncIteratorPrototype%":needsEval,"%Atomics%":typeof Atomics>"u"?undefined$1:Atomics,"%BigInt%":typeof BigInt>"u"?undefined$1:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?undefined$1:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?undefined$1:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?undefined$1:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":$Error,"%eval%":eval,"%EvalError%":$EvalError,"%Float16Array%":typeof Float16Array>"u"?undefined$1:Float16Array,"%Float32Array%":typeof Float32Array>"u"?undefined$1:Float32Array,"%Float64Array%":typeof Float64Array>"u"?undefined$1:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?undefined$1:FinalizationRegistry,"%Function%":$Function,"%GeneratorFunction%":needsEval,"%Int8Array%":typeof Int8Array>"u"?undefined$1:Int8Array,"%Int16Array%":typeof Int16Array>"u"?undefined$1:Int16Array,"%Int32Array%":typeof Int32Array>"u"?undefined$1:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":hasSymbols&&getProto$2?getProto$2(getProto$2([][Symbol.iterator]())):undefined$1,"%JSON%":typeof JSON=="object"?JSON:undefined$1,"%Map%":typeof Map>"u"?undefined$1:Map,"%MapIteratorPrototype%":typeof Map>"u"||!hasSymbols||!getProto$2?undefined$1:getProto$2(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":$Object,"%Object.getOwnPropertyDescriptor%":$gOPD,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?undefined$1:Promise,"%Proxy%":typeof Proxy>"u"?undefined$1:Proxy,"%RangeError%":$RangeError,"%ReferenceError%":$ReferenceError,"%Reflect%":typeof Reflect>"u"?undefined$1:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?undefined$1:Set,"%SetIteratorPrototype%":typeof Set>"u"||!hasSymbols||!getProto$2?undefined$1:getProto$2(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?undefined$1:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":hasSymbols&&getProto$2?getProto$2(""[Symbol.iterator]()):undefined$1,"%Symbol%":hasSymbols?Symbol:undefined$1,"%SyntaxError%":$SyntaxError$1,"%ThrowTypeError%":ThrowTypeError,"%TypedArray%":TypedArray,"%TypeError%":$TypeError$3,"%Uint8Array%":typeof Uint8Array>"u"?undefined$1:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?undefined$1:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?undefined$1:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?undefined$1:Uint32Array,"%URIError%":$URIError,"%WeakMap%":typeof WeakMap>"u"?undefined$1:WeakMap,"%WeakRef%":typeof WeakRef>"u"?undefined$1:WeakRef,"%WeakSet%":typeof WeakSet>"u"?undefined$1:WeakSet,"%Function.prototype.call%":$call,"%Function.prototype.apply%":$apply$1,"%Object.defineProperty%":$defineProperty$2,"%Object.getPrototypeOf%":$ObjectGPO,"%Math.abs%":abs,"%Math.floor%":floor,"%Math.max%":max,"%Math.min%":min,"%Math.pow%":pow,"%Math.round%":round,"%Math.sign%":sign,"%Reflect.getPrototypeOf%":$ReflectGPO};if(getProto$2)try{null.error}catch(Z){var errorProto=getProto$2(getProto$2(Z));INTRINSICS["%Error.prototype%"]=errorProto}var doEval=function Z(t){var Hs;if(t==="%AsyncFunction%")Hs=getEvalledConstructor("async function () {}");else if(t==="%GeneratorFunction%")Hs=getEvalledConstructor("function* () {}");else if(t==="%AsyncGeneratorFunction%")Hs=getEvalledConstructor("async function* () {}");else if(t==="%AsyncGenerator%"){var zs=Z("%AsyncGeneratorFunction%");zs&&(Hs=zs.prototype)}else if(t==="%AsyncIteratorPrototype%"){var Ys=Z("%AsyncGenerator%");Ys&&getProto$2&&(Hs=getProto$2(Ys.prototype))}return INTRINSICS[t]=Hs,Hs},LEGACY_ALIASES={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},bind$1=functionBind,hasOwn$1=requireHasown(),$concat=bind$1.call($call,Array.prototype.concat),$spliceApply=bind$1.call($apply$1,Array.prototype.splice),$replace=bind$1.call($call,String.prototype.replace),$strSlice=bind$1.call($call,String.prototype.slice),$exec$2=bind$1.call($call,RegExp.prototype.exec),rePropName=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,reEscapeChar=/\\(\\)?/g,stringToPath=function(t){var Hs=$strSlice(t,0,1),zs=$strSlice(t,-1);if(Hs==="%"&&zs!=="%")throw new $SyntaxError$1("invalid intrinsic syntax, expected closing `%`");if(zs==="%"&&Hs!=="%")throw new $SyntaxError$1("invalid intrinsic syntax, expected opening `%`");var Ys=[];return $replace(t,rePropName,function(Zs,_u,Eu,Iu){Ys[Ys.length]=Eu?$replace(Iu,reEscapeChar,"$1"):_u||Zs}),Ys},getBaseIntrinsic=function(t,Hs){var zs=t,Ys;if(hasOwn$1(LEGACY_ALIASES,zs)&&(Ys=LEGACY_ALIASES[zs],zs="%"+Ys[0]+"%"),hasOwn$1(INTRINSICS,zs)){var Zs=INTRINSICS[zs];if(Zs===needsEval&&(Zs=doEval(zs)),typeof Zs>"u"&&!Hs)throw new $TypeError$3("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:Ys,name:zs,value:Zs}}throw new $SyntaxError$1("intrinsic "+t+" does not exist!")},getIntrinsic=function(t,Hs){if(typeof t!="string"||t.length===0)throw new $TypeError$3("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof Hs!="boolean")throw new $TypeError$3('"allowMissing" argument must be a boolean');if($exec$2(/^%?[^%]*%?$/,t)===null)throw new $SyntaxError$1("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var zs=stringToPath(t),Ys=zs.length>0?zs[0]:"",Zs=getBaseIntrinsic("%"+Ys+"%",Hs),_u=Zs.name,Eu=Zs.value,Iu=!1,Au=Zs.alias;Au&&(Ys=Au[0],$spliceApply(zs,$concat([0,1],Au)));for(var $u=1,vu=!0;$u<zs.length;$u+=1){var Su=zs[$u],Ru=$strSlice(Su,0,1),Pu=$strSlice(Su,-1);if((Ru==='"'||Ru==="'"||Ru==="`"||Pu==='"'||Pu==="'"||Pu==="`")&&Ru!==Pu)throw new $SyntaxError$1("property names with quotes must have matching quotes");if((Su==="constructor"||!vu)&&(Iu=!0),Ys+="."+Su,_u="%"+Ys+"%",hasOwn$1(INTRINSICS,_u))Eu=INTRINSICS[_u];else if(Eu!=null){if(!(Su in Eu)){if(!Hs)throw new $TypeError$3("base intrinsic for "+t+" exists, but the property is not available.");return}if($gOPD&&$u+1>=zs.length){var Cu=$gOPD(Eu,Su);vu=!!Cu,vu&&"get"in Cu&&!("originalValue"in Cu.get)?Eu=Cu.get:Eu=Eu[Su]}else vu=hasOwn$1(Eu,Su),Eu=Eu[Su];vu&&!Iu&&(INTRINSICS[_u]=Eu)}}return Eu},GetIntrinsic$1=getIntrinsic,callBindBasic=callBindApplyHelpers,$indexOf$1=callBindBasic([GetIntrinsic$1("%String.prototype.indexOf%")]),callBound$5=function(t,Hs){var zs=GetIntrinsic$1(t,!!Hs);return typeof zs=="function"&&$indexOf$1(t,".prototype.")>-1?callBindBasic([zs]):zs},hasToStringTag$4=shams(),callBound$4=callBound$5,$toString$2=callBound$4("Object.prototype.toString"),isStandardArguments=function(t){return hasToStringTag$4&&t&&typeof t=="object"&&Symbol.toStringTag in t?!1:$toString$2(t)==="[object Arguments]"},isLegacyArguments=function(t){return isStandardArguments(t)?!0:t!==null&&typeof t=="object"&&"length"in t&&typeof t.length=="number"&&t.length>=0&&$toString$2(t)!=="[object Array]"&&"callee"in t&&$toString$2(t.callee)==="[object Function]"},supportsStandardArguments=function(){return isStandardArguments(arguments)}();isStandardArguments.isLegacyArguments=isLegacyArguments;var isArguments=supportsStandardArguments?isStandardArguments:isLegacyArguments,callBound$3=callBound$5,hasToStringTag$3=shams(),hasOwn=requireHasown(),gOPD$2=gopd$1,fn$2;if(hasToStringTag$3){var $exec$1=callBound$3("RegExp.prototype.exec"),isRegexMarker={},throwRegexMarker=function(){throw isRegexMarker},badStringifier={toString:throwRegexMarker,valueOf:throwRegexMarker};typeof Symbol.toPrimitive=="symbol"&&(badStringifier[Symbol.toPrimitive]=throwRegexMarker),fn$2=function(t){if(!t||typeof t!="object")return!1;var Hs=gOPD$2(t,"lastIndex"),zs=Hs&&hasOwn(Hs,"value");if(!zs)return!1;try{$exec$1(t,badStringifier)}catch(Ys){return Ys===isRegexMarker}}}else{var $toString$1=callBound$3("Object.prototype.toString"),regexClass="[object RegExp]";fn$2=function(t){return!t||typeof t!="object"&&typeof t!="function"?!1:$toString$1(t)===regexClass}}var isRegex$1=fn$2,callBound$2=callBound$5,isRegex=isRegex$1,$exec=callBound$2("RegExp.prototype.exec"),$TypeError$2=type,safeRegexTest$1=function(t){if(!isRegex(t))throw new $TypeError$2("`regex` must be a RegExp");return function(zs){return $exec(t,zs)!==null}},generatorFunction,hasRequiredGeneratorFunction;function requireGeneratorFunction(){if(hasRequiredGeneratorFunction)return generatorFunction;hasRequiredGeneratorFunction=1;const Z=(function*(){}).constructor;return generatorFunction=()=>Z,generatorFunction}var callBound$1=callBound$5,safeRegexTest=safeRegexTest$1,isFnRegex=safeRegexTest(/^\s*(?:function)?\*/),hasToStringTag$2=shams(),getProto$1=getProto$3,toStr$2=callBound$1("Object.prototype.toString"),fnToStr$1=callBound$1("Function.prototype.toString"),getGeneratorFunction=requireGeneratorFunction(),isGeneratorFunction=function(t){if(typeof t!="function")return!1;if(isFnRegex(fnToStr$1(t)))return!0;if(!hasToStringTag$2){var Hs=toStr$2(t);return Hs==="[object GeneratorFunction]"}if(!getProto$1)return!1;var zs=getGeneratorFunction();return zs&&getProto$1(t)===zs.prototype},fnToStr=Function.prototype.toString,reflectApply=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,badArrayLike,isCallableMarker;if(typeof reflectApply=="function"&&typeof Object.defineProperty=="function")try{badArrayLike=Object.defineProperty({},"length",{get:function(){throw isCallableMarker}}),isCallableMarker={},reflectApply(function(){throw 42},null,badArrayLike)}catch(Z){Z!==isCallableMarker&&(reflectApply=null)}else reflectApply=null;var constructorRegex=/^\s*class\b/,isES6ClassFn=function(t){try{var Hs=fnToStr.call(t);return constructorRegex.test(Hs)}catch{return!1}},tryFunctionObject=function(t){try{return isES6ClassFn(t)?!1:(fnToStr.call(t),!0)}catch{return!1}},toStr$1=Object.prototype.toString,objectClass="[object Object]",fnClass="[object Function]",genClass="[object GeneratorFunction]",ddaClass="[object HTMLAllCollection]",ddaClass2="[object HTML document.all class]",ddaClass3="[object HTMLCollection]",hasToStringTag$1=typeof Symbol=="function"&&!!Symbol.toStringTag,isIE68=!(0 in[,]),isDDA=function(){return!1};if(typeof document=="object"){var all=document.all;toStr$1.call(all)===toStr$1.call(document.all)&&(isDDA=function(t){if((isIE68||!t)&&(typeof t>"u"||typeof t=="object"))try{var Hs=toStr$1.call(t);return(Hs===ddaClass||Hs===ddaClass2||Hs===ddaClass3||Hs===objectClass)&&t("")==null}catch{}return!1})}var isCallable$1=reflectApply?function(t){if(isDDA(t))return!0;if(!t||typeof t!="function"&&typeof t!="object")return!1;try{reflectApply(t,null,badArrayLike)}catch(Hs){if(Hs!==isCallableMarker)return!1}return!isES6ClassFn(t)&&tryFunctionObject(t)}:function(t){if(isDDA(t))return!0;if(!t||typeof t!="function"&&typeof t!="object")return!1;if(hasToStringTag$1)return tryFunctionObject(t);if(isES6ClassFn(t))return!1;var Hs=toStr$1.call(t);return Hs!==fnClass&&Hs!==genClass&&!/^\[object HTML/.test(Hs)?!1:tryFunctionObject(t)},isCallable=isCallable$1,toStr=Object.prototype.toString,hasOwnProperty=Object.prototype.hasOwnProperty,forEachArray=function(t,Hs,zs){for(var Ys=0,Zs=t.length;Ys<Zs;Ys++)hasOwnProperty.call(t,Ys)&&(zs==null?Hs(t[Ys],Ys,t):Hs.call(zs,t[Ys],Ys,t))},forEachString=function(t,Hs,zs){for(var Ys=0,Zs=t.length;Ys<Zs;Ys++)zs==null?Hs(t.charAt(Ys),Ys,t):Hs.call(zs,t.charAt(Ys),Ys,t)},forEachObject=function(t,Hs,zs){for(var Ys in t)hasOwnProperty.call(t,Ys)&&(zs==null?Hs(t[Ys],Ys,t):Hs.call(zs,t[Ys],Ys,t))};function isArray$1(Z){return toStr.call(Z)==="[object Array]"}var forEach$2=function(t,Hs,zs){if(!isCallable(Hs))throw new TypeError("iterator must be a function");var Ys;arguments.length>=3&&(Ys=zs),isArray$1(t)?forEachArray(t,Hs,Ys):typeof t=="string"?forEachString(t,Hs,Ys):forEachObject(t,Hs,Ys)},possibleTypedArrayNames=["Float16Array","Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],possibleNames=possibleTypedArrayNames,g$2=globalThis,availableTypedArrays$1=function(){for(var t=[],Hs=0;Hs<possibleNames.length;Hs++)typeof g$2[possibleNames[Hs]]=="function"&&(t[t.length]=possibleNames[Hs]);return t},callBind$1={exports:{}},$defineProperty$1=esDefineProperty,$SyntaxError=syntax,$TypeError$1=type,gopd=gopd$1,defineDataProperty=function(t,Hs,zs){if(!t||typeof t!="object"&&typeof t!="function")throw new $TypeError$1("`obj` must be an object or a function`");if(typeof Hs!="string"&&typeof Hs!="symbol")throw new $TypeError$1("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new $TypeError$1("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new $TypeError$1("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new $TypeError$1("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new $TypeError$1("`loose`, if provided, must be a boolean");var Ys=arguments.length>3?arguments[3]:null,Zs=arguments.length>4?arguments[4]:null,_u=arguments.length>5?arguments[5]:null,Eu=arguments.length>6?arguments[6]:!1,Iu=!!gopd&&gopd(t,Hs);if($defineProperty$1)$defineProperty$1(t,Hs,{configurable:_u===null&&Iu?Iu.configurable:!_u,enumerable:Ys===null&&Iu?Iu.enumerable:!Ys,value:zs,writable:Zs===null&&Iu?Iu.writable:!Zs});else if(Eu||!Ys&&!Zs&&!_u)t[Hs]=zs;else throw new $SyntaxError("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},$defineProperty=esDefineProperty,hasPropertyDescriptors=function(){return!!$defineProperty};hasPropertyDescriptors.hasArrayLengthDefineBug=function(){if(!$defineProperty)return null;try{return $defineProperty([],"length",{value:1}).length!==1}catch{return!0}};var hasPropertyDescriptors_1=hasPropertyDescriptors,GetIntrinsic=getIntrinsic,define=defineDataProperty,hasDescriptors=hasPropertyDescriptors_1(),gOPD$1=gopd$1,$TypeError=type,$floor=GetIntrinsic("%Math.floor%"),setFunctionLength=function(t,Hs){if(typeof t!="function")throw new $TypeError("`fn` is not a function");if(typeof Hs!="number"||Hs<0||Hs>4294967295||$floor(Hs)!==Hs)throw new $TypeError("`length` must be a positive 32-bit integer");var zs=arguments.length>2&&!!arguments[2],Ys=!0,Zs=!0;if("length"in t&&gOPD$1){var _u=gOPD$1(t,"length");_u&&!_u.configurable&&(Ys=!1),_u&&!_u.writable&&(Zs=!1)}return(Ys||Zs||!zs)&&(hasDescriptors?define(t,"length",Hs,!0,!0):define(t,"length",Hs)),t},bind=functionBind,$apply=requireFunctionApply(),actualApply=actualApply$1,applyBind=function(){return actualApply(bind,$apply,arguments)};(function(Z){var t=setFunctionLength,Hs=esDefineProperty,zs=callBindApplyHelpers,Ys=applyBind;Z.exports=function(_u){var Eu=zs(arguments),Iu=_u.length-(arguments.length-1);return t(Eu,1+(Iu>0?Iu:0),!0)},Hs?Hs(Z.exports,"apply",{value:Ys}):Z.exports.apply=Ys})(callBind$1);var callBindExports=callBind$1.exports,forEach$1=forEach$2,availableTypedArrays=availableTypedArrays$1,callBind=callBindExports,callBound=callBound$5,gOPD=gopd$1,getProto=getProto$3,$toString=callBound("Object.prototype.toString"),hasToStringTag=shams(),g$1=globalThis,typedArrays=availableTypedArrays(),$slice=callBound("String.prototype.slice"),$indexOf=callBound("Array.prototype.indexOf",!0)||function(t,Hs){for(var zs=0;zs<t.length;zs+=1)if(t[zs]===Hs)return zs;return-1},cache={__proto__:null};hasToStringTag&&gOPD&&getProto?forEach$1(typedArrays,function(Z){var t=new g$1[Z];if(Symbol.toStringTag in t&&getProto){var Hs=getProto(t),zs=gOPD(Hs,Symbol.toStringTag);if(!zs&&Hs){var Ys=getProto(Hs);zs=gOPD(Ys,Symbol.toStringTag)}cache["$"+Z]=callBind(zs.get)}}):forEach$1(typedArrays,function(Z){var t=new g$1[Z],Hs=t.slice||t.set;Hs&&(cache["$"+Z]=callBind(Hs))});var tryTypedArrays=function(t){var Hs=!1;return forEach$1(cache,function(zs,Ys){if(!Hs)try{"$"+zs(t)===Ys&&(Hs=$slice(Ys,1))}catch{}}),Hs},trySlices=function(t){var Hs=!1;return forEach$1(cache,function(zs,Ys){if(!Hs)try{zs(t),Hs=$slice(Ys,1)}catch{}}),Hs},whichTypedArray=function(t){if(!t||typeof t!="object")return!1;if(!hasToStringTag){var Hs=$slice($toString(t),8,-1);return $indexOf(typedArrays,Hs)>-1?Hs:Hs!=="Object"?!1:trySlices(t)}return gOPD?tryTypedArrays(t):null},isTypedArray,hasRequiredIsTypedArray;function requireIsTypedArray(){if(hasRequiredIsTypedArray)return isTypedArray;hasRequiredIsTypedArray=1;var Z=whichTypedArray;return isTypedArray=function(Hs){return!!Z(Hs)},isTypedArray}(function(Z){var t=isArguments,Hs=isGeneratorFunction,zs=whichTypedArray,Ys=requireIsTypedArray();function Zs(al){return al.call.bind(al)}var _u=typeof BigInt<"u",Eu=typeof Symbol<"u",Iu=Zs(Object.prototype.toString),Au=Zs(Number.prototype.valueOf),$u=Zs(String.prototype.valueOf),vu=Zs(Boolean.prototype.valueOf);if(_u)var Su=Zs(BigInt.prototype.valueOf);if(Eu)var Ru=Zs(Symbol.prototype.valueOf);function Pu(al,wl){if(typeof al!="object")return!1;try{return wl(al),!0}catch{return!1}}Z.isArgumentsObject=t,Z.isGeneratorFunction=Hs,Z.isTypedArray=Ys;function Cu(al){return typeof Promise<"u"&&al instanceof Promise||al!==null&&typeof al=="object"&&typeof al.then=="function"&&typeof al.catch=="function"}Z.isPromise=Cu;function Bu(al){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(al):Ys(al)||gl(al)}Z.isArrayBufferView=Bu;function Fu(al){return zs(al)==="Uint8Array"}Z.isUint8Array=Fu;function zu(al){return zs(al)==="Uint8ClampedArray"}Z.isUint8ClampedArray=zu;function Hu(al){return zs(al)==="Uint16Array"}Z.isUint16Array=Hu;function Wu(al){return zs(al)==="Uint32Array"}Z.isUint32Array=Wu;function tl(al){return zs(al)==="Int8Array"}Z.isInt8Array=tl;function Xu(al){return zs(al)==="Int16Array"}Z.isInt16Array=Xu;function ju(al){return zs(al)==="Int32Array"}Z.isInt32Array=ju;function ku(al){return zs(al)==="Float32Array"}Z.isFloat32Array=ku;function Uu(al){return zs(al)==="Float64Array"}Z.isFloat64Array=Uu;function Gu(al){return zs(al)==="BigInt64Array"}Z.isBigInt64Array=Gu;function Yu(al){return zs(al)==="BigUint64Array"}Z.isBigUint64Array=Yu;function Qu(al){return Iu(al)==="[object Map]"}Qu.working=typeof Map<"u"&&Qu(new Map);function Lu(al){return typeof Map>"u"?!1:Qu.working?Qu(al):al instanceof Map}Z.isMap=Lu;function cl(al){return Iu(al)==="[object Set]"}cl.working=typeof Set<"u"&&cl(new Set);function el(al){return typeof Set>"u"?!1:cl.working?cl(al):al instanceof Set}Z.isSet=el;function Zu(al){return Iu(al)==="[object WeakMap]"}Zu.working=typeof WeakMap<"u"&&Zu(new WeakMap);function dl(al){return typeof WeakMap>"u"?!1:Zu.working?Zu(al):al instanceof WeakMap}Z.isWeakMap=dl;function El(al){return Iu(al)==="[object WeakSet]"}El.working=typeof WeakSet<"u"&&El(new WeakSet);function hl(al){return El(al)}Z.isWeakSet=hl;function _l(al){return Iu(al)==="[object ArrayBuffer]"}_l.working=typeof ArrayBuffer<"u"&&_l(new ArrayBuffer);function Rl(al){return typeof ArrayBuffer>"u"?!1:_l.working?_l(al):al instanceof ArrayBuffer}Z.isArrayBuffer=Rl;function ol(al){return Iu(al)==="[object DataView]"}ol.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&ol(new DataView(new ArrayBuffer(1),0,1));function gl(al){return typeof DataView>"u"?!1:ol.working?ol(al):al instanceof DataView}Z.isDataView=gl;var nl=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function Sl(al){return Iu(al)==="[object SharedArrayBuffer]"}function ll(al){return typeof nl>"u"?!1:(typeof Sl.working>"u"&&(Sl.working=Sl(new nl)),Sl.working?Sl(al):al instanceof nl)}Z.isSharedArrayBuffer=ll;function ul(al){return Iu(al)==="[object AsyncFunction]"}Z.isAsyncFunction=ul;function Al(al){return Iu(al)==="[object Map Iterator]"}Z.isMapIterator=Al;function Tl(al){return Iu(al)==="[object Set Iterator]"}Z.isSetIterator=Tl;function qu(al){return Iu(al)==="[object Generator]"}Z.isGeneratorObject=qu;function Ou(al){return Iu(al)==="[object WebAssembly.Module]"}Z.isWebAssemblyCompiledModule=Ou;function Vu(al){return Pu(al,Au)}Z.isNumberObject=Vu;function il(al){return Pu(al,$u)}Z.isStringObject=il;function sl(al){return Pu(al,vu)}Z.isBooleanObject=sl;function pl(al){return _u&&Pu(al,Su)}Z.isBigIntObject=pl;function yl(al){return Eu&&Pu(al,Ru)}Z.isSymbolObject=yl;function fl(al){return Vu(al)||il(al)||sl(al)||pl(al)||yl(al)}Z.isBoxedPrimitive=fl;function bl(al){return typeof Uint8Array<"u"&&(Rl(al)||ll(al))}Z.isAnyArrayBuffer=bl,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(al){Object.defineProperty(Z,al,{enumerable:!1,value:function(){throw new Error(al+" is not supported in userland")}})})})(types$1);var isBufferBrowser=function(t){return t&&typeof t=="object"&&typeof t.copy=="function"&&typeof t.fill=="function"&&typeof t.readUInt8=="function"},inherits_browser={exports:{}};typeof Object.create=="function"?inherits_browser.exports=function(t,Hs){Hs&&(t.super_=Hs,t.prototype=Object.create(Hs.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:inherits_browser.exports=function(t,Hs){if(Hs){t.super_=Hs;var zs=function(){};zs.prototype=Hs.prototype,t.prototype=new zs,t.prototype.constructor=t}};var inherits_browserExports=inherits_browser.exports;(function(Z){var t=Object.getOwnPropertyDescriptors||function(gl){for(var nl=Object.keys(gl),Sl={},ll=0;ll<nl.length;ll++)Sl[nl[ll]]=Object.getOwnPropertyDescriptor(gl,nl[ll]);return Sl},Hs=/%[sdj%]/g;Z.format=function(ol){if(!tl(ol)){for(var gl=[],nl=0;nl<arguments.length;nl++)gl.push(_u(arguments[nl]));return gl.join(" ")}for(var nl=1,Sl=arguments,ll=Sl.length,ul=String(ol).replace(Hs,function(Tl){if(Tl==="%%")return"%";if(nl>=ll)return Tl;switch(Tl){case"%s":return String(Sl[nl++]);case"%d":return Number(Sl[nl++]);case"%j":try{return JSON.stringify(Sl[nl++])}catch{return"[Circular]"}default:return Tl}}),Al=Sl[nl];nl<ll;Al=Sl[++nl])zu(Al)||!Uu(Al)?ul+=" "+Al:ul+=" "+_u(Al);return ul},Z.deprecate=function(ol,gl){if(typeof process$1<"u"&&process$1.noDeprecation===!0)return ol;if(typeof process$1>"u")return function(){return Z.deprecate(ol,gl).apply(this,arguments)};var nl=!1;function Sl(){if(!nl){if(process$1.throwDeprecation)throw new Error(gl);process$1.traceDeprecation?console.trace(gl):console.error(gl),nl=!0}return ol.apply(this,arguments)}return Sl};var zs={},Ys=/^$/;if({}.NODE_DEBUG){var Zs={}.NODE_DEBUG;Zs=Zs.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),Ys=new RegExp("^"+Zs+"$","i")}Z.debuglog=function(ol){if(ol=ol.toUpperCase(),!zs[ol])if(Ys.test(ol)){var gl=process$1.pid;zs[ol]=function(){var nl=Z.format.apply(Z,arguments);console.error("%s %d: %s",ol,gl,nl)}}else zs[ol]=function(){};return zs[ol]};function _u(ol,gl){var nl={seen:[],stylize:Iu};return arguments.length>=3&&(nl.depth=arguments[2]),arguments.length>=4&&(nl.colors=arguments[3]),Fu(gl)?nl.showHidden=gl:gl&&Z._extend(nl,gl),ju(nl.showHidden)&&(nl.showHidden=!1),ju(nl.depth)&&(nl.depth=2),ju(nl.colors)&&(nl.colors=!1),ju(nl.customInspect)&&(nl.customInspect=!0),nl.colors&&(nl.stylize=Eu),$u(nl,ol,nl.depth)}Z.inspect=_u,_u.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},_u.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function Eu(ol,gl){var nl=_u.styles[gl];return nl?"\x1B["+_u.colors[nl][0]+"m"+ol+"\x1B["+_u.colors[nl][1]+"m":ol}function Iu(ol,gl){return ol}function Au(ol){var gl={};return ol.forEach(function(nl,Sl){gl[nl]=!0}),gl}function $u(ol,gl,nl){if(ol.customInspect&&gl&&Qu(gl.inspect)&&gl.inspect!==Z.inspect&&!(gl.constructor&&gl.constructor.prototype===gl)){var Sl=gl.inspect(nl,ol);return tl(Sl)||(Sl=$u(ol,Sl,nl)),Sl}var ll=vu(ol,gl);if(ll)return ll;var ul=Object.keys(gl),Al=Au(ul);if(ol.showHidden&&(ul=Object.getOwnPropertyNames(gl)),Yu(gl)&&(ul.indexOf("message")>=0||ul.indexOf("description")>=0))return Su(gl);if(ul.length===0){if(Qu(gl)){var Tl=gl.name?": "+gl.name:"";return ol.stylize("[Function"+Tl+"]","special")}if(ku(gl))return ol.stylize(RegExp.prototype.toString.call(gl),"regexp");if(Gu(gl))return ol.stylize(Date.prototype.toString.call(gl),"date");if(Yu(gl))return Su(gl)}var qu="",Ou=!1,Vu=["{","}"];if(Bu(gl)&&(Ou=!0,Vu=["[","]"]),Qu(gl)){var il=gl.name?": "+gl.name:"";qu=" [Function"+il+"]"}if(ku(gl)&&(qu=" "+RegExp.prototype.toString.call(gl)),Gu(gl)&&(qu=" "+Date.prototype.toUTCString.call(gl)),Yu(gl)&&(qu=" "+Su(gl)),ul.length===0&&(!Ou||gl.length==0))return Vu[0]+qu+Vu[1];if(nl<0)return ku(gl)?ol.stylize(RegExp.prototype.toString.call(gl),"regexp"):ol.stylize("[Object]","special");ol.seen.push(gl);var sl;return Ou?sl=Ru(ol,gl,nl,Al,ul):sl=ul.map(function(pl){return Pu(ol,gl,nl,Al,pl,Ou)}),ol.seen.pop(),Cu(sl,qu,Vu)}function vu(ol,gl){if(ju(gl))return ol.stylize("undefined","undefined");if(tl(gl)){var nl="'"+JSON.stringify(gl).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ol.stylize(nl,"string")}if(Wu(gl))return ol.stylize(""+gl,"number");if(Fu(gl))return ol.stylize(""+gl,"boolean");if(zu(gl))return ol.stylize("null","null")}function Su(ol){return"["+Error.prototype.toString.call(ol)+"]"}function Ru(ol,gl,nl,Sl,ll){for(var ul=[],Al=0,Tl=gl.length;Al<Tl;++Al)El(gl,String(Al))?ul.push(Pu(ol,gl,nl,Sl,String(Al),!0)):ul.push("");return ll.forEach(function(qu){qu.match(/^\d+$/)||ul.push(Pu(ol,gl,nl,Sl,qu,!0))}),ul}function Pu(ol,gl,nl,Sl,ll,ul){var Al,Tl,qu;if(qu=Object.getOwnPropertyDescriptor(gl,ll)||{value:gl[ll]},qu.get?qu.set?Tl=ol.stylize("[Getter/Setter]","special"):Tl=ol.stylize("[Getter]","special"):qu.set&&(Tl=ol.stylize("[Setter]","special")),El(Sl,ll)||(Al="["+ll+"]"),Tl||(ol.seen.indexOf(qu.value)<0?(zu(nl)?Tl=$u(ol,qu.value,null):Tl=$u(ol,qu.value,nl-1),Tl.indexOf(`
`)>-1&&(ul?Tl=Tl.split(`
`).map(function(Ou){return"  "+Ou}).join(`
`).slice(2):Tl=`
`+Tl.split(`
`).map(function(Ou){return"   "+Ou}).join(`
`))):Tl=ol.stylize("[Circular]","special")),ju(Al)){if(ul&&ll.match(/^\d+$/))return Tl;Al=JSON.stringify(""+ll),Al.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(Al=Al.slice(1,-1),Al=ol.stylize(Al,"name")):(Al=Al.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),Al=ol.stylize(Al,"string"))}return Al+": "+Tl}function Cu(ol,gl,nl){var Sl=ol.reduce(function(ll,ul){return ul.indexOf(`
`)>=0,ll+ul.replace(/\u001b\[\d\d?m/g,"").length+1},0);return Sl>60?nl[0]+(gl===""?"":gl+`
 `)+" "+ol.join(`,
  `)+" "+nl[1]:nl[0]+gl+" "+ol.join(", ")+" "+nl[1]}Z.types=types$1;function Bu(ol){return Array.isArray(ol)}Z.isArray=Bu;function Fu(ol){return typeof ol=="boolean"}Z.isBoolean=Fu;function zu(ol){return ol===null}Z.isNull=zu;function Hu(ol){return ol==null}Z.isNullOrUndefined=Hu;function Wu(ol){return typeof ol=="number"}Z.isNumber=Wu;function tl(ol){return typeof ol=="string"}Z.isString=tl;function Xu(ol){return typeof ol=="symbol"}Z.isSymbol=Xu;function ju(ol){return ol===void 0}Z.isUndefined=ju;function ku(ol){return Uu(ol)&&cl(ol)==="[object RegExp]"}Z.isRegExp=ku,Z.types.isRegExp=ku;function Uu(ol){return typeof ol=="object"&&ol!==null}Z.isObject=Uu;function Gu(ol){return Uu(ol)&&cl(ol)==="[object Date]"}Z.isDate=Gu,Z.types.isDate=Gu;function Yu(ol){return Uu(ol)&&(cl(ol)==="[object Error]"||ol instanceof Error)}Z.isError=Yu,Z.types.isNativeError=Yu;function Qu(ol){return typeof ol=="function"}Z.isFunction=Qu;function Lu(ol){return ol===null||typeof ol=="boolean"||typeof ol=="number"||typeof ol=="string"||typeof ol=="symbol"||typeof ol>"u"}Z.isPrimitive=Lu,Z.isBuffer=isBufferBrowser;function cl(ol){return Object.prototype.toString.call(ol)}function el(ol){return ol<10?"0"+ol.toString(10):ol.toString(10)}var Zu=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function dl(){var ol=new Date,gl=[el(ol.getHours()),el(ol.getMinutes()),el(ol.getSeconds())].join(":");return[ol.getDate(),Zu[ol.getMonth()],gl].join(" ")}Z.log=function(){console.log("%s - %s",dl(),Z.format.apply(Z,arguments))},Z.inherits=inherits_browserExports,Z._extend=function(ol,gl){if(!gl||!Uu(gl))return ol;for(var nl=Object.keys(gl),Sl=nl.length;Sl--;)ol[nl[Sl]]=gl[nl[Sl]];return ol};function El(ol,gl){return Object.prototype.hasOwnProperty.call(ol,gl)}var hl=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;Z.promisify=function(gl){if(typeof gl!="function")throw new TypeError('The "original" argument must be of type Function');if(hl&&gl[hl]){var nl=gl[hl];if(typeof nl!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(nl,hl,{value:nl,enumerable:!1,writable:!1,configurable:!0}),nl}function nl(){for(var Sl,ll,ul=new Promise(function(qu,Ou){Sl=qu,ll=Ou}),Al=[],Tl=0;Tl<arguments.length;Tl++)Al.push(arguments[Tl]);Al.push(function(qu,Ou){qu?ll(qu):Sl(Ou)});try{gl.apply(this,Al)}catch(qu){ll(qu)}return ul}return Object.setPrototypeOf(nl,Object.getPrototypeOf(gl)),hl&&Object.defineProperty(nl,hl,{value:nl,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(nl,t(gl))},Z.promisify.custom=hl;function _l(ol,gl){if(!ol){var nl=new Error("Promise was rejected with a falsy value");nl.reason=ol,ol=nl}return gl(ol)}function Rl(ol){if(typeof ol!="function")throw new TypeError('The "original" argument must be of type Function');function gl(){for(var nl=[],Sl=0;Sl<arguments.length;Sl++)nl.push(arguments[Sl]);var ll=nl.pop();if(typeof ll!="function")throw new TypeError("The last argument must be of type Function");var ul=this,Al=function(){return ll.apply(ul,arguments)};ol.apply(this,nl).then(function(Tl){process$1.nextTick(Al.bind(null,null,Tl))},function(Tl){process$1.nextTick(_l.bind(null,Tl,Al))})}return Object.setPrototypeOf(gl,Object.getPrototypeOf(ol)),Object.defineProperties(gl,t(ol)),gl}Z.callbackify=Rl})(util$3);var buffer_list,hasRequiredBuffer_list;function requireBuffer_list(){if(hasRequiredBuffer_list)return buffer_list;hasRequiredBuffer_list=1;function Z(Pu,Cu){var Bu=Object.keys(Pu);if(Object.getOwnPropertySymbols){var Fu=Object.getOwnPropertySymbols(Pu);Cu&&(Fu=Fu.filter(function(zu){return Object.getOwnPropertyDescriptor(Pu,zu).enumerable})),Bu.push.apply(Bu,Fu)}return Bu}function t(Pu){for(var Cu=1;Cu<arguments.length;Cu++){var Bu=arguments[Cu]!=null?arguments[Cu]:{};Cu%2?Z(Object(Bu),!0).forEach(function(Fu){Hs(Pu,Fu,Bu[Fu])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Pu,Object.getOwnPropertyDescriptors(Bu)):Z(Object(Bu)).forEach(function(Fu){Object.defineProperty(Pu,Fu,Object.getOwnPropertyDescriptor(Bu,Fu))})}return Pu}function Hs(Pu,Cu,Bu){return Cu=_u(Cu),Cu in Pu?Object.defineProperty(Pu,Cu,{value:Bu,enumerable:!0,configurable:!0,writable:!0}):Pu[Cu]=Bu,Pu}function zs(Pu,Cu){if(!(Pu instanceof Cu))throw new TypeError("Cannot call a class as a function")}function Ys(Pu,Cu){for(var Bu=0;Bu<Cu.length;Bu++){var Fu=Cu[Bu];Fu.enumerable=Fu.enumerable||!1,Fu.configurable=!0,"value"in Fu&&(Fu.writable=!0),Object.defineProperty(Pu,_u(Fu.key),Fu)}}function Zs(Pu,Cu,Bu){return Cu&&Ys(Pu.prototype,Cu),Bu&&Ys(Pu,Bu),Object.defineProperty(Pu,"prototype",{writable:!1}),Pu}function _u(Pu){var Cu=Eu(Pu,"string");return typeof Cu=="symbol"?Cu:String(Cu)}function Eu(Pu,Cu){if(typeof Pu!="object"||Pu===null)return Pu;var Bu=Pu[Symbol.toPrimitive];if(Bu!==void 0){var Fu=Bu.call(Pu,Cu||"default");if(typeof Fu!="object")return Fu;throw new TypeError("@@toPrimitive must return a primitive value.")}return(Cu==="string"?String:Number)(Pu)}var Iu=require$$0$1,Au=Iu.Buffer,$u=util$3,vu=$u.inspect,Su=vu&&vu.custom||"inspect";function Ru(Pu,Cu,Bu){Au.prototype.copy.call(Pu,Cu,Bu)}return buffer_list=function(){function Pu(){zs(this,Pu),this.head=null,this.tail=null,this.length=0}return Zs(Pu,[{key:"push",value:function(Bu){var Fu={data:Bu,next:null};this.length>0?this.tail.next=Fu:this.head=Fu,this.tail=Fu,++this.length}},{key:"unshift",value:function(Bu){var Fu={data:Bu,next:this.head};this.length===0&&(this.tail=Fu),this.head=Fu,++this.length}},{key:"shift",value:function(){if(this.length!==0){var Bu=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,Bu}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(Bu){if(this.length===0)return"";for(var Fu=this.head,zu=""+Fu.data;Fu=Fu.next;)zu+=Bu+Fu.data;return zu}},{key:"concat",value:function(Bu){if(this.length===0)return Au.alloc(0);for(var Fu=Au.allocUnsafe(Bu>>>0),zu=this.head,Hu=0;zu;)Ru(zu.data,Fu,Hu),Hu+=zu.data.length,zu=zu.next;return Fu}},{key:"consume",value:function(Bu,Fu){var zu;return Bu<this.head.data.length?(zu=this.head.data.slice(0,Bu),this.head.data=this.head.data.slice(Bu)):Bu===this.head.data.length?zu=this.shift():zu=Fu?this._getString(Bu):this._getBuffer(Bu),zu}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(Bu){var Fu=this.head,zu=1,Hu=Fu.data;for(Bu-=Hu.length;Fu=Fu.next;){var Wu=Fu.data,tl=Bu>Wu.length?Wu.length:Bu;if(tl===Wu.length?Hu+=Wu:Hu+=Wu.slice(0,Bu),Bu-=tl,Bu===0){tl===Wu.length?(++zu,Fu.next?this.head=Fu.next:this.head=this.tail=null):(this.head=Fu,Fu.data=Wu.slice(tl));break}++zu}return this.length-=zu,Hu}},{key:"_getBuffer",value:function(Bu){var Fu=Au.allocUnsafe(Bu),zu=this.head,Hu=1;for(zu.data.copy(Fu),Bu-=zu.data.length;zu=zu.next;){var Wu=zu.data,tl=Bu>Wu.length?Wu.length:Bu;if(Wu.copy(Fu,Fu.length-Bu,0,tl),Bu-=tl,Bu===0){tl===Wu.length?(++Hu,zu.next?this.head=zu.next:this.head=this.tail=null):(this.head=zu,zu.data=Wu.slice(tl));break}++Hu}return this.length-=Hu,Fu}},{key:Su,value:function(Bu,Fu){return vu(this,t(t({},Fu),{},{depth:0,customInspect:!1}))}}]),Pu}(),buffer_list}function destroy(Z,t){var Hs=this,zs=this._readableState&&this._readableState.destroyed,Ys=this._writableState&&this._writableState.destroyed;return zs||Ys?(t?t(Z):Z&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process$1.nextTick(emitErrorNT,this,Z)):process$1.nextTick(emitErrorNT,this,Z)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(Z||null,function(Zs){!t&&Zs?Hs._writableState?Hs._writableState.errorEmitted?process$1.nextTick(emitCloseNT,Hs):(Hs._writableState.errorEmitted=!0,process$1.nextTick(emitErrorAndCloseNT,Hs,Zs)):process$1.nextTick(emitErrorAndCloseNT,Hs,Zs):t?(process$1.nextTick(emitCloseNT,Hs),t(Zs)):process$1.nextTick(emitCloseNT,Hs)}),this)}function emitErrorAndCloseNT(Z,t){emitErrorNT(Z,t),emitCloseNT(Z)}function emitCloseNT(Z){Z._writableState&&!Z._writableState.emitClose||Z._readableState&&!Z._readableState.emitClose||Z.emit("close")}function undestroy(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function emitErrorNT(Z,t){Z.emit("error",t)}function errorOrDestroy(Z,t){var Hs=Z._readableState,zs=Z._writableState;Hs&&Hs.autoDestroy||zs&&zs.autoDestroy?Z.destroy(t):Z.emit("error",t)}var destroy_1={destroy,undestroy,errorOrDestroy},errorsBrowser={};function _inheritsLoose(Z,t){Z.prototype=Object.create(t.prototype),Z.prototype.constructor=Z,Z.__proto__=t}var codes={};function createErrorType(Z,t,Hs){Hs||(Hs=Error);function zs(Zs,_u,Eu){return typeof t=="string"?t:t(Zs,_u,Eu)}var Ys=function(Zs){_inheritsLoose(_u,Zs);function _u(Eu,Iu,Au){return Zs.call(this,zs(Eu,Iu,Au))||this}return _u}(Hs);Ys.prototype.name=Hs.name,Ys.prototype.code=Z,codes[Z]=Ys}function oneOf(Z,t){if(Array.isArray(Z)){var Hs=Z.length;return Z=Z.map(function(zs){return String(zs)}),Hs>2?"one of ".concat(t," ").concat(Z.slice(0,Hs-1).join(", "),", or ")+Z[Hs-1]:Hs===2?"one of ".concat(t," ").concat(Z[0]," or ").concat(Z[1]):"of ".concat(t," ").concat(Z[0])}else return"of ".concat(t," ").concat(String(Z))}function startsWith(Z,t,Hs){return Z.substr(!Hs||Hs<0?0:+Hs,t.length)===t}function endsWith(Z,t,Hs){return(Hs===void 0||Hs>Z.length)&&(Hs=Z.length),Z.substring(Hs-t.length,Hs)===t}function includes(Z,t,Hs){return typeof Hs!="number"&&(Hs=0),Hs+t.length>Z.length?!1:Z.indexOf(t,Hs)!==-1}createErrorType("ERR_INVALID_OPT_VALUE",function(Z,t){return'The value "'+t+'" is invalid for option "'+Z+'"'},TypeError);createErrorType("ERR_INVALID_ARG_TYPE",function(Z,t,Hs){var zs;typeof t=="string"&&startsWith(t,"not ")?(zs="must not be",t=t.replace(/^not /,"")):zs="must be";var Ys;if(endsWith(Z," argument"))Ys="The ".concat(Z," ").concat(zs," ").concat(oneOf(t,"type"));else{var Zs=includes(Z,".")?"property":"argument";Ys='The "'.concat(Z,'" ').concat(Zs," ").concat(zs," ").concat(oneOf(t,"type"))}return Ys+=". Received type ".concat(typeof Hs),Ys},TypeError);createErrorType("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");createErrorType("ERR_METHOD_NOT_IMPLEMENTED",function(Z){return"The "+Z+" method is not implemented"});createErrorType("ERR_STREAM_PREMATURE_CLOSE","Premature close");createErrorType("ERR_STREAM_DESTROYED",function(Z){return"Cannot call "+Z+" after a stream was destroyed"});createErrorType("ERR_MULTIPLE_CALLBACK","Callback called multiple times");createErrorType("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");createErrorType("ERR_STREAM_WRITE_AFTER_END","write after end");createErrorType("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);createErrorType("ERR_UNKNOWN_ENCODING",function(Z){return"Unknown encoding: "+Z},TypeError);createErrorType("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");errorsBrowser.codes=codes;var ERR_INVALID_OPT_VALUE=errorsBrowser.codes.ERR_INVALID_OPT_VALUE;function highWaterMarkFrom(Z,t,Hs){return Z.highWaterMark!=null?Z.highWaterMark:t?Z[Hs]:null}function getHighWaterMark(Z,t,Hs,zs){var Ys=highWaterMarkFrom(t,zs,Hs);if(Ys!=null){if(!(isFinite(Ys)&&Math.floor(Ys)===Ys)||Ys<0){var Zs=zs?Hs:"highWaterMark";throw new ERR_INVALID_OPT_VALUE(Zs,Ys)}return Math.floor(Ys)}return Z.objectMode?16:16*1024}var state={getHighWaterMark},browser$1=deprecate;function deprecate(Z,t){if(config("noDeprecation"))return Z;var Hs=!1;function zs(){if(!Hs){if(config("throwDeprecation"))throw new Error(t);config("traceDeprecation")?console.trace(t):console.warn(t),Hs=!0}return Z.apply(this,arguments)}return zs}function config(Z){try{if(!globalThis.localStorage)return!1}catch{return!1}var t=globalThis.localStorage[Z];return t==null?!1:String(t).toLowerCase()==="true"}var _stream_writable,hasRequired_stream_writable;function require_stream_writable(){if(hasRequired_stream_writable)return _stream_writable;hasRequired_stream_writable=1,_stream_writable=ku;function Z(ll){var ul=this;this.next=null,this.entry=null,this.finish=function(){Sl(ul,ll)}}var t;ku.WritableState=Xu;var Hs={deprecate:browser$1},zs=streamBrowser,Ys=require$$0$1.Buffer,Zs=(typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function _u(ll){return Ys.from(ll)}function Eu(ll){return Ys.isBuffer(ll)||ll instanceof Zs}var Iu=destroy_1,Au=state,$u=Au.getHighWaterMark,vu=errorsBrowser.codes,Su=vu.ERR_INVALID_ARG_TYPE,Ru=vu.ERR_METHOD_NOT_IMPLEMENTED,Pu=vu.ERR_MULTIPLE_CALLBACK,Cu=vu.ERR_STREAM_CANNOT_PIPE,Bu=vu.ERR_STREAM_DESTROYED,Fu=vu.ERR_STREAM_NULL_VALUES,zu=vu.ERR_STREAM_WRITE_AFTER_END,Hu=vu.ERR_UNKNOWN_ENCODING,Wu=Iu.errorOrDestroy;inherits_browserExports(ku,zs);function tl(){}function Xu(ll,ul,Al){t=t||require_stream_duplex(),ll=ll||{},typeof Al!="boolean"&&(Al=ul instanceof t),this.objectMode=!!ll.objectMode,Al&&(this.objectMode=this.objectMode||!!ll.writableObjectMode),this.highWaterMark=$u(this,ll,"writableHighWaterMark",Al),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var Tl=ll.decodeStrings===!1;this.decodeStrings=!Tl,this.defaultEncoding=ll.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(qu){Zu(ul,qu)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=ll.emitClose!==!1,this.autoDestroy=!!ll.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new Z(this)}Xu.prototype.getBuffer=function(){for(var ul=this.bufferedRequest,Al=[];ul;)Al.push(ul),ul=ul.next;return Al},function(){try{Object.defineProperty(Xu.prototype,"buffer",{get:Hs.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var ju;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(ju=Function.prototype[Symbol.hasInstance],Object.defineProperty(ku,Symbol.hasInstance,{value:function(ul){return ju.call(this,ul)?!0:this!==ku?!1:ul&&ul._writableState instanceof Xu}})):ju=function(ul){return ul instanceof this};function ku(ll){t=t||require_stream_duplex();var ul=this instanceof t;if(!ul&&!ju.call(ku,this))return new ku(ll);this._writableState=new Xu(ll,this,ul),this.writable=!0,ll&&(typeof ll.write=="function"&&(this._write=ll.write),typeof ll.writev=="function"&&(this._writev=ll.writev),typeof ll.destroy=="function"&&(this._destroy=ll.destroy),typeof ll.final=="function"&&(this._final=ll.final)),zs.call(this)}ku.prototype.pipe=function(){Wu(this,new Cu)};function Uu(ll,ul){var Al=new zu;Wu(ll,Al),process$1.nextTick(ul,Al)}function Gu(ll,ul,Al,Tl){var qu;return Al===null?qu=new Fu:typeof Al!="string"&&!ul.objectMode&&(qu=new Su("chunk",["string","Buffer"],Al)),qu?(Wu(ll,qu),process$1.nextTick(Tl,qu),!1):!0}ku.prototype.write=function(ll,ul,Al){var Tl=this._writableState,qu=!1,Ou=!Tl.objectMode&&Eu(ll);return Ou&&!Ys.isBuffer(ll)&&(ll=_u(ll)),typeof ul=="function"&&(Al=ul,ul=null),Ou?ul="buffer":ul||(ul=Tl.defaultEncoding),typeof Al!="function"&&(Al=tl),Tl.ending?Uu(this,Al):(Ou||Gu(this,Tl,ll,Al))&&(Tl.pendingcb++,qu=Qu(this,Tl,Ou,ll,ul,Al)),qu},ku.prototype.cork=function(){this._writableState.corked++},ku.prototype.uncork=function(){var ll=this._writableState;ll.corked&&(ll.corked--,!ll.writing&&!ll.corked&&!ll.bufferProcessing&&ll.bufferedRequest&&hl(this,ll))},ku.prototype.setDefaultEncoding=function(ul){if(typeof ul=="string"&&(ul=ul.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((ul+"").toLowerCase())>-1))throw new Hu(ul);return this._writableState.defaultEncoding=ul,this},Object.defineProperty(ku.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function Yu(ll,ul,Al){return!ll.objectMode&&ll.decodeStrings!==!1&&typeof ul=="string"&&(ul=Ys.from(ul,Al)),ul}Object.defineProperty(ku.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function Qu(ll,ul,Al,Tl,qu,Ou){if(!Al){var Vu=Yu(ul,Tl,qu);Tl!==Vu&&(Al=!0,qu="buffer",Tl=Vu)}var il=ul.objectMode?1:Tl.length;ul.length+=il;var sl=ul.length<ul.highWaterMark;if(sl||(ul.needDrain=!0),ul.writing||ul.corked){var pl=ul.lastBufferedRequest;ul.lastBufferedRequest={chunk:Tl,encoding:qu,isBuf:Al,callback:Ou,next:null},pl?pl.next=ul.lastBufferedRequest:ul.bufferedRequest=ul.lastBufferedRequest,ul.bufferedRequestCount+=1}else Lu(ll,ul,!1,il,Tl,qu,Ou);return sl}function Lu(ll,ul,Al,Tl,qu,Ou,Vu){ul.writelen=Tl,ul.writecb=Vu,ul.writing=!0,ul.sync=!0,ul.destroyed?ul.onwrite(new Bu("write")):Al?ll._writev(qu,ul.onwrite):ll._write(qu,Ou,ul.onwrite),ul.sync=!1}function cl(ll,ul,Al,Tl,qu){--ul.pendingcb,Al?(process$1.nextTick(qu,Tl),process$1.nextTick(gl,ll,ul),ll._writableState.errorEmitted=!0,Wu(ll,Tl)):(qu(Tl),ll._writableState.errorEmitted=!0,Wu(ll,Tl),gl(ll,ul))}function el(ll){ll.writing=!1,ll.writecb=null,ll.length-=ll.writelen,ll.writelen=0}function Zu(ll,ul){var Al=ll._writableState,Tl=Al.sync,qu=Al.writecb;if(typeof qu!="function")throw new Pu;if(el(Al),ul)cl(ll,Al,Tl,ul,qu);else{var Ou=_l(Al)||ll.destroyed;!Ou&&!Al.corked&&!Al.bufferProcessing&&Al.bufferedRequest&&hl(ll,Al),Tl?process$1.nextTick(dl,ll,Al,Ou,qu):dl(ll,Al,Ou,qu)}}function dl(ll,ul,Al,Tl){Al||El(ll,ul),ul.pendingcb--,Tl(),gl(ll,ul)}function El(ll,ul){ul.length===0&&ul.needDrain&&(ul.needDrain=!1,ll.emit("drain"))}function hl(ll,ul){ul.bufferProcessing=!0;var Al=ul.bufferedRequest;if(ll._writev&&Al&&Al.next){var Tl=ul.bufferedRequestCount,qu=new Array(Tl),Ou=ul.corkedRequestsFree;Ou.entry=Al;for(var Vu=0,il=!0;Al;)qu[Vu]=Al,Al.isBuf||(il=!1),Al=Al.next,Vu+=1;qu.allBuffers=il,Lu(ll,ul,!0,ul.length,qu,"",Ou.finish),ul.pendingcb++,ul.lastBufferedRequest=null,Ou.next?(ul.corkedRequestsFree=Ou.next,Ou.next=null):ul.corkedRequestsFree=new Z(ul),ul.bufferedRequestCount=0}else{for(;Al;){var sl=Al.chunk,pl=Al.encoding,yl=Al.callback,fl=ul.objectMode?1:sl.length;if(Lu(ll,ul,!1,fl,sl,pl,yl),Al=Al.next,ul.bufferedRequestCount--,ul.writing)break}Al===null&&(ul.lastBufferedRequest=null)}ul.bufferedRequest=Al,ul.bufferProcessing=!1}ku.prototype._write=function(ll,ul,Al){Al(new Ru("_write()"))},ku.prototype._writev=null,ku.prototype.end=function(ll,ul,Al){var Tl=this._writableState;return typeof ll=="function"?(Al=ll,ll=null,ul=null):typeof ul=="function"&&(Al=ul,ul=null),ll!=null&&this.write(ll,ul),Tl.corked&&(Tl.corked=1,this.uncork()),Tl.ending||nl(this,Tl,Al),this},Object.defineProperty(ku.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function _l(ll){return ll.ending&&ll.length===0&&ll.bufferedRequest===null&&!ll.finished&&!ll.writing}function Rl(ll,ul){ll._final(function(Al){ul.pendingcb--,Al&&Wu(ll,Al),ul.prefinished=!0,ll.emit("prefinish"),gl(ll,ul)})}function ol(ll,ul){!ul.prefinished&&!ul.finalCalled&&(typeof ll._final=="function"&&!ul.destroyed?(ul.pendingcb++,ul.finalCalled=!0,process$1.nextTick(Rl,ll,ul)):(ul.prefinished=!0,ll.emit("prefinish")))}function gl(ll,ul){var Al=_l(ul);if(Al&&(ol(ll,ul),ul.pendingcb===0&&(ul.finished=!0,ll.emit("finish"),ul.autoDestroy))){var Tl=ll._readableState;(!Tl||Tl.autoDestroy&&Tl.endEmitted)&&ll.destroy()}return Al}function nl(ll,ul,Al){ul.ending=!0,gl(ll,ul),Al&&(ul.finished?process$1.nextTick(Al):ll.once("finish",Al)),ul.ended=!0,ll.writable=!1}function Sl(ll,ul,Al){var Tl=ll.entry;for(ll.entry=null;Tl;){var qu=Tl.callback;ul.pendingcb--,qu(Al),Tl=Tl.next}ul.corkedRequestsFree.next=ll}return Object.defineProperty(ku.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(ul){this._writableState&&(this._writableState.destroyed=ul)}}),ku.prototype.destroy=Iu.destroy,ku.prototype._undestroy=Iu.undestroy,ku.prototype._destroy=function(ll,ul){ul(ll)},_stream_writable}var _stream_duplex,hasRequired_stream_duplex;function require_stream_duplex(){if(hasRequired_stream_duplex)return _stream_duplex;hasRequired_stream_duplex=1;var Z=Object.keys||function(Au){var $u=[];for(var vu in Au)$u.push(vu);return $u};_stream_duplex=_u;var t=require_stream_readable(),Hs=require_stream_writable();inherits_browserExports(_u,t);for(var zs=Z(Hs.prototype),Ys=0;Ys<zs.length;Ys++){var Zs=zs[Ys];_u.prototype[Zs]||(_u.prototype[Zs]=Hs.prototype[Zs])}function _u(Au){if(!(this instanceof _u))return new _u(Au);t.call(this,Au),Hs.call(this,Au),this.allowHalfOpen=!0,Au&&(Au.readable===!1&&(this.readable=!1),Au.writable===!1&&(this.writable=!1),Au.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",Eu)))}Object.defineProperty(_u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(_u.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(_u.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function Eu(){this._writableState.ended||process$1.nextTick(Iu,this)}function Iu(Au){Au.end()}return Object.defineProperty(_u.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function($u){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=$u,this._writableState.destroyed=$u)}}),_stream_duplex}var string_decoder={},safeBuffer={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */(function(Z,t){var Hs=require$$0$1,zs=Hs.Buffer;function Ys(_u,Eu){for(var Iu in _u)Eu[Iu]=_u[Iu]}zs.from&&zs.alloc&&zs.allocUnsafe&&zs.allocUnsafeSlow?Z.exports=Hs:(Ys(Hs,t),t.Buffer=Zs);function Zs(_u,Eu,Iu){return zs(_u,Eu,Iu)}Zs.prototype=Object.create(zs.prototype),Ys(zs,Zs),Zs.from=function(_u,Eu,Iu){if(typeof _u=="number")throw new TypeError("Argument must not be a number");return zs(_u,Eu,Iu)},Zs.alloc=function(_u,Eu,Iu){if(typeof _u!="number")throw new TypeError("Argument must be a number");var Au=zs(_u);return Eu!==void 0?typeof Iu=="string"?Au.fill(Eu,Iu):Au.fill(Eu):Au.fill(0),Au},Zs.allocUnsafe=function(_u){if(typeof _u!="number")throw new TypeError("Argument must be a number");return zs(_u)},Zs.allocUnsafeSlow=function(_u){if(typeof _u!="number")throw new TypeError("Argument must be a number");return Hs.SlowBuffer(_u)}})(safeBuffer,safeBuffer.exports);var safeBufferExports=safeBuffer.exports,Buffer=safeBufferExports.Buffer,isEncoding=Buffer.isEncoding||function(Z){switch(Z=""+Z,Z&&Z.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function _normalizeEncoding(Z){if(!Z)return"utf8";for(var t;;)switch(Z){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return Z;default:if(t)return;Z=(""+Z).toLowerCase(),t=!0}}function normalizeEncoding(Z){var t=_normalizeEncoding(Z);if(typeof t!="string"&&(Buffer.isEncoding===isEncoding||!isEncoding(Z)))throw new Error("Unknown encoding: "+Z);return t||Z}string_decoder.StringDecoder=StringDecoder;function StringDecoder(Z){this.encoding=normalizeEncoding(Z);var t;switch(this.encoding){case"utf16le":this.text=utf16Text,this.end=utf16End,t=4;break;case"utf8":this.fillLast=utf8FillLast,t=4;break;case"base64":this.text=base64Text,this.end=base64End,t=3;break;default:this.write=simpleWrite,this.end=simpleEnd;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=Buffer.allocUnsafe(t)}StringDecoder.prototype.write=function(Z){if(Z.length===0)return"";var t,Hs;if(this.lastNeed){if(t=this.fillLast(Z),t===void 0)return"";Hs=this.lastNeed,this.lastNeed=0}else Hs=0;return Hs<Z.length?t?t+this.text(Z,Hs):this.text(Z,Hs):t||""};StringDecoder.prototype.end=utf8End;StringDecoder.prototype.text=utf8Text;StringDecoder.prototype.fillLast=function(Z){if(this.lastNeed<=Z.length)return Z.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);Z.copy(this.lastChar,this.lastTotal-this.lastNeed,0,Z.length),this.lastNeed-=Z.length};function utf8CheckByte(Z){return Z<=127?0:Z>>5===6?2:Z>>4===14?3:Z>>3===30?4:Z>>6===2?-1:-2}function utf8CheckIncomplete(Z,t,Hs){var zs=t.length-1;if(zs<Hs)return 0;var Ys=utf8CheckByte(t[zs]);return Ys>=0?(Ys>0&&(Z.lastNeed=Ys-1),Ys):--zs<Hs||Ys===-2?0:(Ys=utf8CheckByte(t[zs]),Ys>=0?(Ys>0&&(Z.lastNeed=Ys-2),Ys):--zs<Hs||Ys===-2?0:(Ys=utf8CheckByte(t[zs]),Ys>=0?(Ys>0&&(Ys===2?Ys=0:Z.lastNeed=Ys-3),Ys):0))}function utf8CheckExtraBytes(Z,t,Hs){if((t[0]&192)!==128)return Z.lastNeed=0,"";if(Z.lastNeed>1&&t.length>1){if((t[1]&192)!==128)return Z.lastNeed=1,"";if(Z.lastNeed>2&&t.length>2&&(t[2]&192)!==128)return Z.lastNeed=2,""}}function utf8FillLast(Z){var t=this.lastTotal-this.lastNeed,Hs=utf8CheckExtraBytes(this,Z);if(Hs!==void 0)return Hs;if(this.lastNeed<=Z.length)return Z.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);Z.copy(this.lastChar,t,0,Z.length),this.lastNeed-=Z.length}function utf8Text(Z,t){var Hs=utf8CheckIncomplete(this,Z,t);if(!this.lastNeed)return Z.toString("utf8",t);this.lastTotal=Hs;var zs=Z.length-(Hs-this.lastNeed);return Z.copy(this.lastChar,0,zs),Z.toString("utf8",t,zs)}function utf8End(Z){var t=Z&&Z.length?this.write(Z):"";return this.lastNeed?t+"":t}function utf16Text(Z,t){if((Z.length-t)%2===0){var Hs=Z.toString("utf16le",t);if(Hs){var zs=Hs.charCodeAt(Hs.length-1);if(zs>=55296&&zs<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=Z[Z.length-2],this.lastChar[1]=Z[Z.length-1],Hs.slice(0,-1)}return Hs}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=Z[Z.length-1],Z.toString("utf16le",t,Z.length-1)}function utf16End(Z){var t=Z&&Z.length?this.write(Z):"";if(this.lastNeed){var Hs=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,Hs)}return t}function base64Text(Z,t){var Hs=(Z.length-t)%3;return Hs===0?Z.toString("base64",t):(this.lastNeed=3-Hs,this.lastTotal=3,Hs===1?this.lastChar[0]=Z[Z.length-1]:(this.lastChar[0]=Z[Z.length-2],this.lastChar[1]=Z[Z.length-1]),Z.toString("base64",t,Z.length-Hs))}function base64End(Z){var t=Z&&Z.length?this.write(Z):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function simpleWrite(Z){return Z.toString(this.encoding)}function simpleEnd(Z){return Z&&Z.length?this.write(Z):""}var ERR_STREAM_PREMATURE_CLOSE=errorsBrowser.codes.ERR_STREAM_PREMATURE_CLOSE;function once$1(Z){var t=!1;return function(){if(!t){t=!0;for(var Hs=arguments.length,zs=new Array(Hs),Ys=0;Ys<Hs;Ys++)zs[Ys]=arguments[Ys];Z.apply(this,zs)}}}function noop$3(){}function isRequest$1(Z){return Z.setHeader&&typeof Z.abort=="function"}function eos$1(Z,t,Hs){if(typeof t=="function")return eos$1(Z,null,t);t||(t={}),Hs=once$1(Hs||noop$3);var zs=t.readable||t.readable!==!1&&Z.readable,Ys=t.writable||t.writable!==!1&&Z.writable,Zs=function(){Z.writable||Eu()},_u=Z._writableState&&Z._writableState.finished,Eu=function(){Ys=!1,_u=!0,zs||Hs.call(Z)},Iu=Z._readableState&&Z._readableState.endEmitted,Au=function(){zs=!1,Iu=!0,Ys||Hs.call(Z)},$u=function(Pu){Hs.call(Z,Pu)},vu=function(){var Pu;if(zs&&!Iu)return(!Z._readableState||!Z._readableState.ended)&&(Pu=new ERR_STREAM_PREMATURE_CLOSE),Hs.call(Z,Pu);if(Ys&&!_u)return(!Z._writableState||!Z._writableState.ended)&&(Pu=new ERR_STREAM_PREMATURE_CLOSE),Hs.call(Z,Pu)},Su=function(){Z.req.on("finish",Eu)};return isRequest$1(Z)?(Z.on("complete",Eu),Z.on("abort",vu),Z.req?Su():Z.on("request",Su)):Ys&&!Z._writableState&&(Z.on("end",Zs),Z.on("close",Zs)),Z.on("end",Au),Z.on("finish",Eu),t.error!==!1&&Z.on("error",$u),Z.on("close",vu),function(){Z.removeListener("complete",Eu),Z.removeListener("abort",vu),Z.removeListener("request",Su),Z.req&&Z.req.removeListener("finish",Eu),Z.removeListener("end",Zs),Z.removeListener("close",Zs),Z.removeListener("finish",Eu),Z.removeListener("end",Au),Z.removeListener("error",$u),Z.removeListener("close",vu)}}var endOfStream=eos$1,async_iterator,hasRequiredAsync_iterator;function requireAsync_iterator(){if(hasRequiredAsync_iterator)return async_iterator;hasRequiredAsync_iterator=1;var Z;function t(Hu,Wu,tl){return Wu=Hs(Wu),Wu in Hu?Object.defineProperty(Hu,Wu,{value:tl,enumerable:!0,configurable:!0,writable:!0}):Hu[Wu]=tl,Hu}function Hs(Hu){var Wu=zs(Hu,"string");return typeof Wu=="symbol"?Wu:String(Wu)}function zs(Hu,Wu){if(typeof Hu!="object"||Hu===null)return Hu;var tl=Hu[Symbol.toPrimitive];if(tl!==void 0){var Xu=tl.call(Hu,Wu||"default");if(typeof Xu!="object")return Xu;throw new TypeError("@@toPrimitive must return a primitive value.")}return(Wu==="string"?String:Number)(Hu)}var Ys=endOfStream,Zs=Symbol("lastResolve"),_u=Symbol("lastReject"),Eu=Symbol("error"),Iu=Symbol("ended"),Au=Symbol("lastPromise"),$u=Symbol("handlePromise"),vu=Symbol("stream");function Su(Hu,Wu){return{value:Hu,done:Wu}}function Ru(Hu){var Wu=Hu[Zs];if(Wu!==null){var tl=Hu[vu].read();tl!==null&&(Hu[Au]=null,Hu[Zs]=null,Hu[_u]=null,Wu(Su(tl,!1)))}}function Pu(Hu){process$1.nextTick(Ru,Hu)}function Cu(Hu,Wu){return function(tl,Xu){Hu.then(function(){if(Wu[Iu]){tl(Su(void 0,!0));return}Wu[$u](tl,Xu)},Xu)}}var Bu=Object.getPrototypeOf(function(){}),Fu=Object.setPrototypeOf((Z={get stream(){return this[vu]},next:function(){var Wu=this,tl=this[Eu];if(tl!==null)return Promise.reject(tl);if(this[Iu])return Promise.resolve(Su(void 0,!0));if(this[vu].destroyed)return new Promise(function(Uu,Gu){process$1.nextTick(function(){Wu[Eu]?Gu(Wu[Eu]):Uu(Su(void 0,!0))})});var Xu=this[Au],ju;if(Xu)ju=new Promise(Cu(Xu,this));else{var ku=this[vu].read();if(ku!==null)return Promise.resolve(Su(ku,!1));ju=new Promise(this[$u])}return this[Au]=ju,ju}},t(Z,Symbol.asyncIterator,function(){return this}),t(Z,"return",function(){var Wu=this;return new Promise(function(tl,Xu){Wu[vu].destroy(null,function(ju){if(ju){Xu(ju);return}tl(Su(void 0,!0))})})}),Z),Bu),zu=function(Wu){var tl,Xu=Object.create(Fu,(tl={},t(tl,vu,{value:Wu,writable:!0}),t(tl,Zs,{value:null,writable:!0}),t(tl,_u,{value:null,writable:!0}),t(tl,Eu,{value:null,writable:!0}),t(tl,Iu,{value:Wu._readableState.endEmitted,writable:!0}),t(tl,$u,{value:function(ku,Uu){var Gu=Xu[vu].read();Gu?(Xu[Au]=null,Xu[Zs]=null,Xu[_u]=null,ku(Su(Gu,!1))):(Xu[Zs]=ku,Xu[_u]=Uu)},writable:!0}),tl));return Xu[Au]=null,Ys(Wu,function(ju){if(ju&&ju.code!=="ERR_STREAM_PREMATURE_CLOSE"){var ku=Xu[_u];ku!==null&&(Xu[Au]=null,Xu[Zs]=null,Xu[_u]=null,ku(ju)),Xu[Eu]=ju;return}var Uu=Xu[Zs];Uu!==null&&(Xu[Au]=null,Xu[Zs]=null,Xu[_u]=null,Uu(Su(void 0,!0))),Xu[Iu]=!0}),Wu.on("readable",Pu.bind(null,Xu)),Xu};return async_iterator=zu,async_iterator}var fromBrowser,hasRequiredFromBrowser;function requireFromBrowser(){return hasRequiredFromBrowser||(hasRequiredFromBrowser=1,fromBrowser=function(){throw new Error("Readable.from is not available in the browser")}),fromBrowser}var _stream_readable,hasRequired_stream_readable;function require_stream_readable(){if(hasRequired_stream_readable)return _stream_readable;hasRequired_stream_readable=1,_stream_readable=Uu;var Z;Uu.ReadableState=ku,eventsExports.EventEmitter;var t=function(Vu,il){return Vu.listeners(il).length},Hs=streamBrowser,zs=require$$0$1.Buffer,Ys=(typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function Zs(Ou){return zs.from(Ou)}function _u(Ou){return zs.isBuffer(Ou)||Ou instanceof Ys}var Eu=util$3,Iu;Eu&&Eu.debuglog?Iu=Eu.debuglog("stream"):Iu=function(){};var Au=requireBuffer_list(),$u=destroy_1,vu=state,Su=vu.getHighWaterMark,Ru=errorsBrowser.codes,Pu=Ru.ERR_INVALID_ARG_TYPE,Cu=Ru.ERR_STREAM_PUSH_AFTER_EOF,Bu=Ru.ERR_METHOD_NOT_IMPLEMENTED,Fu=Ru.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,zu,Hu,Wu;inherits_browserExports(Uu,Hs);var tl=$u.errorOrDestroy,Xu=["error","close","destroy","pause","resume"];function ju(Ou,Vu,il){if(typeof Ou.prependListener=="function")return Ou.prependListener(Vu,il);!Ou._events||!Ou._events[Vu]?Ou.on(Vu,il):Array.isArray(Ou._events[Vu])?Ou._events[Vu].unshift(il):Ou._events[Vu]=[il,Ou._events[Vu]]}function ku(Ou,Vu,il){Z=Z||require_stream_duplex(),Ou=Ou||{},typeof il!="boolean"&&(il=Vu instanceof Z),this.objectMode=!!Ou.objectMode,il&&(this.objectMode=this.objectMode||!!Ou.readableObjectMode),this.highWaterMark=Su(this,Ou,"readableHighWaterMark",il),this.buffer=new Au,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=Ou.emitClose!==!1,this.autoDestroy=!!Ou.autoDestroy,this.destroyed=!1,this.defaultEncoding=Ou.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,Ou.encoding&&(zu||(zu=string_decoder.StringDecoder),this.decoder=new zu(Ou.encoding),this.encoding=Ou.encoding)}function Uu(Ou){if(Z=Z||require_stream_duplex(),!(this instanceof Uu))return new Uu(Ou);var Vu=this instanceof Z;this._readableState=new ku(Ou,this,Vu),this.readable=!0,Ou&&(typeof Ou.read=="function"&&(this._read=Ou.read),typeof Ou.destroy=="function"&&(this._destroy=Ou.destroy)),Hs.call(this)}Object.defineProperty(Uu.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(Vu){this._readableState&&(this._readableState.destroyed=Vu)}}),Uu.prototype.destroy=$u.destroy,Uu.prototype._undestroy=$u.undestroy,Uu.prototype._destroy=function(Ou,Vu){Vu(Ou)},Uu.prototype.push=function(Ou,Vu){var il=this._readableState,sl;return il.objectMode?sl=!0:typeof Ou=="string"&&(Vu=Vu||il.defaultEncoding,Vu!==il.encoding&&(Ou=zs.from(Ou,Vu),Vu=""),sl=!0),Gu(this,Ou,Vu,!1,sl)},Uu.prototype.unshift=function(Ou){return Gu(this,Ou,null,!0,!1)};function Gu(Ou,Vu,il,sl,pl){Iu("readableAddChunk",Vu);var yl=Ou._readableState;if(Vu===null)yl.reading=!1,Zu(Ou,yl);else{var fl;if(pl||(fl=Qu(yl,Vu)),fl)tl(Ou,fl);else if(yl.objectMode||Vu&&Vu.length>0)if(typeof Vu!="string"&&!yl.objectMode&&Object.getPrototypeOf(Vu)!==zs.prototype&&(Vu=Zs(Vu)),sl)yl.endEmitted?tl(Ou,new Fu):Yu(Ou,yl,Vu,!0);else if(yl.ended)tl(Ou,new Cu);else{if(yl.destroyed)return!1;yl.reading=!1,yl.decoder&&!il?(Vu=yl.decoder.write(Vu),yl.objectMode||Vu.length!==0?Yu(Ou,yl,Vu,!1):hl(Ou,yl)):Yu(Ou,yl,Vu,!1)}else sl||(yl.reading=!1,hl(Ou,yl))}return!yl.ended&&(yl.length<yl.highWaterMark||yl.length===0)}function Yu(Ou,Vu,il,sl){Vu.flowing&&Vu.length===0&&!Vu.sync?(Vu.awaitDrain=0,Ou.emit("data",il)):(Vu.length+=Vu.objectMode?1:il.length,sl?Vu.buffer.unshift(il):Vu.buffer.push(il),Vu.needReadable&&dl(Ou)),hl(Ou,Vu)}function Qu(Ou,Vu){var il;return!_u(Vu)&&typeof Vu!="string"&&Vu!==void 0&&!Ou.objectMode&&(il=new Pu("chunk",["string","Buffer","Uint8Array"],Vu)),il}Uu.prototype.isPaused=function(){return this._readableState.flowing===!1},Uu.prototype.setEncoding=function(Ou){zu||(zu=string_decoder.StringDecoder);var Vu=new zu(Ou);this._readableState.decoder=Vu,this._readableState.encoding=this._readableState.decoder.encoding;for(var il=this._readableState.buffer.head,sl="";il!==null;)sl+=Vu.write(il.data),il=il.next;return this._readableState.buffer.clear(),sl!==""&&this._readableState.buffer.push(sl),this._readableState.length=sl.length,this};var Lu=1073741824;function cl(Ou){return Ou>=Lu?Ou=Lu:(Ou--,Ou|=Ou>>>1,Ou|=Ou>>>2,Ou|=Ou>>>4,Ou|=Ou>>>8,Ou|=Ou>>>16,Ou++),Ou}function el(Ou,Vu){return Ou<=0||Vu.length===0&&Vu.ended?0:Vu.objectMode?1:Ou!==Ou?Vu.flowing&&Vu.length?Vu.buffer.head.data.length:Vu.length:(Ou>Vu.highWaterMark&&(Vu.highWaterMark=cl(Ou)),Ou<=Vu.length?Ou:Vu.ended?Vu.length:(Vu.needReadable=!0,0))}Uu.prototype.read=function(Ou){Iu("read",Ou),Ou=parseInt(Ou,10);var Vu=this._readableState,il=Ou;if(Ou!==0&&(Vu.emittedReadable=!1),Ou===0&&Vu.needReadable&&((Vu.highWaterMark!==0?Vu.length>=Vu.highWaterMark:Vu.length>0)||Vu.ended))return Iu("read: emitReadable",Vu.length,Vu.ended),Vu.length===0&&Vu.ended?Al(this):dl(this),null;if(Ou=el(Ou,Vu),Ou===0&&Vu.ended)return Vu.length===0&&Al(this),null;var sl=Vu.needReadable;Iu("need readable",sl),(Vu.length===0||Vu.length-Ou<Vu.highWaterMark)&&(sl=!0,Iu("length less than watermark",sl)),Vu.ended||Vu.reading?(sl=!1,Iu("reading or ended",sl)):sl&&(Iu("do read"),Vu.reading=!0,Vu.sync=!0,Vu.length===0&&(Vu.needReadable=!0),this._read(Vu.highWaterMark),Vu.sync=!1,Vu.reading||(Ou=el(il,Vu)));var pl;return Ou>0?pl=ul(Ou,Vu):pl=null,pl===null?(Vu.needReadable=Vu.length<=Vu.highWaterMark,Ou=0):(Vu.length-=Ou,Vu.awaitDrain=0),Vu.length===0&&(Vu.ended||(Vu.needReadable=!0),il!==Ou&&Vu.ended&&Al(this)),pl!==null&&this.emit("data",pl),pl};function Zu(Ou,Vu){if(Iu("onEofChunk"),!Vu.ended){if(Vu.decoder){var il=Vu.decoder.end();il&&il.length&&(Vu.buffer.push(il),Vu.length+=Vu.objectMode?1:il.length)}Vu.ended=!0,Vu.sync?dl(Ou):(Vu.needReadable=!1,Vu.emittedReadable||(Vu.emittedReadable=!0,El(Ou)))}}function dl(Ou){var Vu=Ou._readableState;Iu("emitReadable",Vu.needReadable,Vu.emittedReadable),Vu.needReadable=!1,Vu.emittedReadable||(Iu("emitReadable",Vu.flowing),Vu.emittedReadable=!0,process$1.nextTick(El,Ou))}function El(Ou){var Vu=Ou._readableState;Iu("emitReadable_",Vu.destroyed,Vu.length,Vu.ended),!Vu.destroyed&&(Vu.length||Vu.ended)&&(Ou.emit("readable"),Vu.emittedReadable=!1),Vu.needReadable=!Vu.flowing&&!Vu.ended&&Vu.length<=Vu.highWaterMark,ll(Ou)}function hl(Ou,Vu){Vu.readingMore||(Vu.readingMore=!0,process$1.nextTick(_l,Ou,Vu))}function _l(Ou,Vu){for(;!Vu.reading&&!Vu.ended&&(Vu.length<Vu.highWaterMark||Vu.flowing&&Vu.length===0);){var il=Vu.length;if(Iu("maybeReadMore read 0"),Ou.read(0),il===Vu.length)break}Vu.readingMore=!1}Uu.prototype._read=function(Ou){tl(this,new Bu("_read()"))},Uu.prototype.pipe=function(Ou,Vu){var il=this,sl=this._readableState;switch(sl.pipesCount){case 0:sl.pipes=Ou;break;case 1:sl.pipes=[sl.pipes,Ou];break;default:sl.pipes.push(Ou);break}sl.pipesCount+=1,Iu("pipe count=%d opts=%j",sl.pipesCount,Vu);var pl=(!Vu||Vu.end!==!1)&&Ou!==process$1.stdout&&Ou!==process$1.stderr,yl=pl?bl:Ql;sl.endEmitted?process$1.nextTick(yl):il.once("end",yl),Ou.on("unpipe",fl);function fl(Hl,jl){Iu("onunpipe"),Hl===il&&jl&&jl.hasUnpiped===!1&&(jl.hasUnpiped=!0,Dl())}function bl(){Iu("onend"),Ou.end()}var al=Rl(il);Ou.on("drain",al);var wl=!1;function Dl(){Iu("cleanup"),Ou.removeListener("close",ql),Ou.removeListener("finish",Gl),Ou.removeListener("drain",al),Ou.removeListener("error",Fl),Ou.removeListener("unpipe",fl),il.removeListener("end",bl),il.removeListener("end",Ql),il.removeListener("data",Ll),wl=!0,sl.awaitDrain&&(!Ou._writableState||Ou._writableState.needDrain)&&al()}il.on("data",Ll);function Ll(Hl){Iu("ondata");var jl=Ou.write(Hl);Iu("dest.write",jl),jl===!1&&((sl.pipesCount===1&&sl.pipes===Ou||sl.pipesCount>1&&qu(sl.pipes,Ou)!==-1)&&!wl&&(Iu("false write response, pause",sl.awaitDrain),sl.awaitDrain++),il.pause())}function Fl(Hl){Iu("onerror",Hl),Ql(),Ou.removeListener("error",Fl),t(Ou,"error")===0&&tl(Ou,Hl)}ju(Ou,"error",Fl);function ql(){Ou.removeListener("finish",Gl),Ql()}Ou.once("close",ql);function Gl(){Iu("onfinish"),Ou.removeListener("close",ql),Ql()}Ou.once("finish",Gl);function Ql(){Iu("unpipe"),il.unpipe(Ou)}return Ou.emit("pipe",il),sl.flowing||(Iu("pipe resume"),il.resume()),Ou};function Rl(Ou){return function(){var il=Ou._readableState;Iu("pipeOnDrain",il.awaitDrain),il.awaitDrain&&il.awaitDrain--,il.awaitDrain===0&&t(Ou,"data")&&(il.flowing=!0,ll(Ou))}}Uu.prototype.unpipe=function(Ou){var Vu=this._readableState,il={hasUnpiped:!1};if(Vu.pipesCount===0)return this;if(Vu.pipesCount===1)return Ou&&Ou!==Vu.pipes?this:(Ou||(Ou=Vu.pipes),Vu.pipes=null,Vu.pipesCount=0,Vu.flowing=!1,Ou&&Ou.emit("unpipe",this,il),this);if(!Ou){var sl=Vu.pipes,pl=Vu.pipesCount;Vu.pipes=null,Vu.pipesCount=0,Vu.flowing=!1;for(var yl=0;yl<pl;yl++)sl[yl].emit("unpipe",this,{hasUnpiped:!1});return this}var fl=qu(Vu.pipes,Ou);return fl===-1?this:(Vu.pipes.splice(fl,1),Vu.pipesCount-=1,Vu.pipesCount===1&&(Vu.pipes=Vu.pipes[0]),Ou.emit("unpipe",this,il),this)},Uu.prototype.on=function(Ou,Vu){var il=Hs.prototype.on.call(this,Ou,Vu),sl=this._readableState;return Ou==="data"?(sl.readableListening=this.listenerCount("readable")>0,sl.flowing!==!1&&this.resume()):Ou==="readable"&&!sl.endEmitted&&!sl.readableListening&&(sl.readableListening=sl.needReadable=!0,sl.flowing=!1,sl.emittedReadable=!1,Iu("on readable",sl.length,sl.reading),sl.length?dl(this):sl.reading||process$1.nextTick(gl,this)),il},Uu.prototype.addListener=Uu.prototype.on,Uu.prototype.removeListener=function(Ou,Vu){var il=Hs.prototype.removeListener.call(this,Ou,Vu);return Ou==="readable"&&process$1.nextTick(ol,this),il},Uu.prototype.removeAllListeners=function(Ou){var Vu=Hs.prototype.removeAllListeners.apply(this,arguments);return(Ou==="readable"||Ou===void 0)&&process$1.nextTick(ol,this),Vu};function ol(Ou){var Vu=Ou._readableState;Vu.readableListening=Ou.listenerCount("readable")>0,Vu.resumeScheduled&&!Vu.paused?Vu.flowing=!0:Ou.listenerCount("data")>0&&Ou.resume()}function gl(Ou){Iu("readable nexttick read 0"),Ou.read(0)}Uu.prototype.resume=function(){var Ou=this._readableState;return Ou.flowing||(Iu("resume"),Ou.flowing=!Ou.readableListening,nl(this,Ou)),Ou.paused=!1,this};function nl(Ou,Vu){Vu.resumeScheduled||(Vu.resumeScheduled=!0,process$1.nextTick(Sl,Ou,Vu))}function Sl(Ou,Vu){Iu("resume",Vu.reading),Vu.reading||Ou.read(0),Vu.resumeScheduled=!1,Ou.emit("resume"),ll(Ou),Vu.flowing&&!Vu.reading&&Ou.read(0)}Uu.prototype.pause=function(){return Iu("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(Iu("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function ll(Ou){var Vu=Ou._readableState;for(Iu("flow",Vu.flowing);Vu.flowing&&Ou.read()!==null;);}Uu.prototype.wrap=function(Ou){var Vu=this,il=this._readableState,sl=!1;Ou.on("end",function(){if(Iu("wrapped end"),il.decoder&&!il.ended){var fl=il.decoder.end();fl&&fl.length&&Vu.push(fl)}Vu.push(null)}),Ou.on("data",function(fl){if(Iu("wrapped data"),il.decoder&&(fl=il.decoder.write(fl)),!(il.objectMode&&fl==null)&&!(!il.objectMode&&(!fl||!fl.length))){var bl=Vu.push(fl);bl||(sl=!0,Ou.pause())}});for(var pl in Ou)this[pl]===void 0&&typeof Ou[pl]=="function"&&(this[pl]=function(bl){return function(){return Ou[bl].apply(Ou,arguments)}}(pl));for(var yl=0;yl<Xu.length;yl++)Ou.on(Xu[yl],this.emit.bind(this,Xu[yl]));return this._read=function(fl){Iu("wrapped _read",fl),sl&&(sl=!1,Ou.resume())},this},typeof Symbol=="function"&&(Uu.prototype[Symbol.asyncIterator]=function(){return Hu===void 0&&(Hu=requireAsync_iterator()),Hu(this)}),Object.defineProperty(Uu.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(Uu.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(Uu.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(Vu){this._readableState&&(this._readableState.flowing=Vu)}}),Uu._fromList=ul,Object.defineProperty(Uu.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function ul(Ou,Vu){if(Vu.length===0)return null;var il;return Vu.objectMode?il=Vu.buffer.shift():!Ou||Ou>=Vu.length?(Vu.decoder?il=Vu.buffer.join(""):Vu.buffer.length===1?il=Vu.buffer.first():il=Vu.buffer.concat(Vu.length),Vu.buffer.clear()):il=Vu.buffer.consume(Ou,Vu.decoder),il}function Al(Ou){var Vu=Ou._readableState;Iu("endReadable",Vu.endEmitted),Vu.endEmitted||(Vu.ended=!0,process$1.nextTick(Tl,Vu,Ou))}function Tl(Ou,Vu){if(Iu("endReadableNT",Ou.endEmitted,Ou.length),!Ou.endEmitted&&Ou.length===0&&(Ou.endEmitted=!0,Vu.readable=!1,Vu.emit("end"),Ou.autoDestroy)){var il=Vu._writableState;(!il||il.autoDestroy&&il.finished)&&Vu.destroy()}}typeof Symbol=="function"&&(Uu.from=function(Ou,Vu){return Wu===void 0&&(Wu=requireFromBrowser()),Wu(Uu,Ou,Vu)});function qu(Ou,Vu){for(var il=0,sl=Ou.length;il<sl;il++)if(Ou[il]===Vu)return il;return-1}return _stream_readable}var _stream_transform=Transform$3,_require$codes$1=errorsBrowser.codes,ERR_METHOD_NOT_IMPLEMENTED=_require$codes$1.ERR_METHOD_NOT_IMPLEMENTED,ERR_MULTIPLE_CALLBACK=_require$codes$1.ERR_MULTIPLE_CALLBACK,ERR_TRANSFORM_ALREADY_TRANSFORMING=_require$codes$1.ERR_TRANSFORM_ALREADY_TRANSFORMING,ERR_TRANSFORM_WITH_LENGTH_0=_require$codes$1.ERR_TRANSFORM_WITH_LENGTH_0,Duplex=require_stream_duplex();inherits_browserExports(Transform$3,Duplex);function afterTransform(Z,t){var Hs=this._transformState;Hs.transforming=!1;var zs=Hs.writecb;if(zs===null)return this.emit("error",new ERR_MULTIPLE_CALLBACK);Hs.writechunk=null,Hs.writecb=null,t!=null&&this.push(t),zs(Z);var Ys=this._readableState;Ys.reading=!1,(Ys.needReadable||Ys.length<Ys.highWaterMark)&&this._read(Ys.highWaterMark)}function Transform$3(Z){if(!(this instanceof Transform$3))return new Transform$3(Z);Duplex.call(this,Z),this._transformState={afterTransform:afterTransform.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,Z&&(typeof Z.transform=="function"&&(this._transform=Z.transform),typeof Z.flush=="function"&&(this._flush=Z.flush)),this.on("prefinish",prefinish)}function prefinish(){var Z=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(t,Hs){done(Z,t,Hs)}):done(this,null,null)}Transform$3.prototype.push=function(Z,t){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,Z,t)};Transform$3.prototype._transform=function(Z,t,Hs){Hs(new ERR_METHOD_NOT_IMPLEMENTED("_transform()"))};Transform$3.prototype._write=function(Z,t,Hs){var zs=this._transformState;if(zs.writecb=Hs,zs.writechunk=Z,zs.writeencoding=t,!zs.transforming){var Ys=this._readableState;(zs.needTransform||Ys.needReadable||Ys.length<Ys.highWaterMark)&&this._read(Ys.highWaterMark)}};Transform$3.prototype._read=function(Z){var t=this._transformState;t.writechunk!==null&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0};Transform$3.prototype._destroy=function(Z,t){Duplex.prototype._destroy.call(this,Z,function(Hs){t(Hs)})};function done(Z,t,Hs){if(t)return Z.emit("error",t);if(Hs!=null&&Z.push(Hs),Z._writableState.length)throw new ERR_TRANSFORM_WITH_LENGTH_0;if(Z._transformState.transforming)throw new ERR_TRANSFORM_ALREADY_TRANSFORMING;return Z.push(null)}var _stream_passthrough=PassThrough,Transform$2=_stream_transform;inherits_browserExports(PassThrough,Transform$2);function PassThrough(Z){if(!(this instanceof PassThrough))return new PassThrough(Z);Transform$2.call(this,Z)}PassThrough.prototype._transform=function(Z,t,Hs){Hs(null,Z)};var eos;function once(Z){var t=!1;return function(){t||(t=!0,Z.apply(void 0,arguments))}}var _require$codes=errorsBrowser.codes,ERR_MISSING_ARGS=_require$codes.ERR_MISSING_ARGS,ERR_STREAM_DESTROYED=_require$codes.ERR_STREAM_DESTROYED;function noop$2(Z){if(Z)throw Z}function isRequest(Z){return Z.setHeader&&typeof Z.abort=="function"}function destroyer(Z,t,Hs,zs){zs=once(zs);var Ys=!1;Z.on("close",function(){Ys=!0}),eos===void 0&&(eos=endOfStream),eos(Z,{readable:t,writable:Hs},function(_u){if(_u)return zs(_u);Ys=!0,zs()});var Zs=!1;return function(_u){if(!Ys&&!Zs){if(Zs=!0,isRequest(Z))return Z.abort();if(typeof Z.destroy=="function")return Z.destroy();zs(_u||new ERR_STREAM_DESTROYED("pipe"))}}}function call(Z){Z()}function pipe(Z,t){return Z.pipe(t)}function popCallback(Z){return!Z.length||typeof Z[Z.length-1]!="function"?noop$2:Z.pop()}function pipeline(){for(var Z=arguments.length,t=new Array(Z),Hs=0;Hs<Z;Hs++)t[Hs]=arguments[Hs];var zs=popCallback(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new ERR_MISSING_ARGS("streams");var Ys,Zs=t.map(function(_u,Eu){var Iu=Eu<t.length-1,Au=Eu>0;return destroyer(_u,Iu,Au,function($u){Ys||(Ys=$u),$u&&Zs.forEach(call),!Iu&&(Zs.forEach(call),zs(Ys))})});return t.reduce(pipe)}var pipeline_1=pipeline;(function(Z,t){t=Z.exports=require_stream_readable(),t.Stream=t,t.Readable=t,t.Writable=require_stream_writable(),t.Duplex=require_stream_duplex(),t.Transform=_stream_transform,t.PassThrough=_stream_passthrough,t.finished=endOfStream,t.pipeline=pipeline_1})(readableBrowser,readableBrowser.exports);var readableBrowserExports=readableBrowser.exports;const{Transform:Transform$1}=readableBrowserExports;var keccak$1=Z=>class Gd extends Transform$1{constructor(Hs,zs,Ys,Zs,_u){super(_u),this._rate=Hs,this._capacity=zs,this._delimitedSuffix=Ys,this._hashBitLength=Zs,this._options=_u,this._state=new Z,this._state.initialize(Hs,zs),this._finalized=!1}_transform(Hs,zs,Ys){let Zs=null;try{this.update(Hs,zs)}catch(_u){Zs=_u}Ys(Zs)}_flush(Hs){let zs=null;try{this.push(this.digest())}catch(Ys){zs=Ys}Hs(zs)}update(Hs,zs){if(!Buffer$1.isBuffer(Hs)&&typeof Hs!="string")throw new TypeError("Data must be a string or a buffer");if(this._finalized)throw new Error("Digest already called");return Buffer$1.isBuffer(Hs)||(Hs=Buffer$1.from(Hs,zs)),this._state.absorb(Hs),this}digest(Hs){if(this._finalized)throw new Error("Digest already called");this._finalized=!0,this._delimitedSuffix&&this._state.absorbLastFewBits(this._delimitedSuffix);let zs=this._state.squeeze(this._hashBitLength/8);return Hs!==void 0&&(zs=zs.toString(Hs)),this._resetState(),zs}_resetState(){return this._state.initialize(this._rate,this._capacity),this}_clone(){const Hs=new Gd(this._rate,this._capacity,this._delimitedSuffix,this._hashBitLength,this._options);return this._state.copy(Hs._state),Hs._finalized=this._finalized,Hs}};const{Transform}=readableBrowserExports;var shake=Z=>class Kd extends Transform{constructor(Hs,zs,Ys,Zs){super(Zs),this._rate=Hs,this._capacity=zs,this._delimitedSuffix=Ys,this._options=Zs,this._state=new Z,this._state.initialize(Hs,zs),this._finalized=!1}_transform(Hs,zs,Ys){let Zs=null;try{this.update(Hs,zs)}catch(_u){Zs=_u}Ys(Zs)}_flush(){}_read(Hs){this.push(this.squeeze(Hs))}update(Hs,zs){if(!Buffer$1.isBuffer(Hs)&&typeof Hs!="string")throw new TypeError("Data must be a string or a buffer");if(this._finalized)throw new Error("Squeeze already called");return Buffer$1.isBuffer(Hs)||(Hs=Buffer$1.from(Hs,zs)),this._state.absorb(Hs),this}squeeze(Hs,zs){this._finalized||(this._finalized=!0,this._state.absorbLastFewBits(this._delimitedSuffix));let Ys=this._state.squeeze(Hs);return zs!==void 0&&(Ys=Ys.toString(zs)),Ys}_resetState(){return this._state.initialize(this._rate,this._capacity),this}_clone(){const Hs=new Kd(this._rate,this._capacity,this._delimitedSuffix,this._options);return this._state.copy(Hs._state),Hs._finalized=this._finalized,Hs}};const createKeccak=keccak$1,createShake=shake;var api=function(Z){const t=createKeccak(Z),Hs=createShake(Z);return function(zs,Ys){switch(typeof zs=="string"?zs.toLowerCase():zs){case"keccak224":return new t(1152,448,null,224,Ys);case"keccak256":return new t(1088,512,null,256,Ys);case"keccak384":return new t(832,768,null,384,Ys);case"keccak512":return new t(576,1024,null,512,Ys);case"sha3-224":return new t(1152,448,6,224,Ys);case"sha3-256":return new t(1088,512,6,256,Ys);case"sha3-384":return new t(832,768,6,384,Ys);case"sha3-512":return new t(576,1024,6,512,Ys);case"shake128":return new Hs(1344,256,31,Ys);case"shake256":return new Hs(1088,512,31,Ys);default:throw new Error("Invald algorithm: "+zs)}}},keccakStateUnroll={};const P1600_ROUND_CONSTANTS=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648];keccakStateUnroll.p1600=function(Z){for(let t=0;t<24;++t){const Hs=Z[0]^Z[10]^Z[20]^Z[30]^Z[40],zs=Z[1]^Z[11]^Z[21]^Z[31]^Z[41],Ys=Z[2]^Z[12]^Z[22]^Z[32]^Z[42],Zs=Z[3]^Z[13]^Z[23]^Z[33]^Z[43],_u=Z[4]^Z[14]^Z[24]^Z[34]^Z[44],Eu=Z[5]^Z[15]^Z[25]^Z[35]^Z[45],Iu=Z[6]^Z[16]^Z[26]^Z[36]^Z[46],Au=Z[7]^Z[17]^Z[27]^Z[37]^Z[47],$u=Z[8]^Z[18]^Z[28]^Z[38]^Z[48],vu=Z[9]^Z[19]^Z[29]^Z[39]^Z[49];let Su=$u^(Ys<<1|Zs>>>31),Ru=vu^(Zs<<1|Ys>>>31);const Pu=Z[0]^Su,Cu=Z[1]^Ru,Bu=Z[10]^Su,Fu=Z[11]^Ru,zu=Z[20]^Su,Hu=Z[21]^Ru,Wu=Z[30]^Su,tl=Z[31]^Ru,Xu=Z[40]^Su,ju=Z[41]^Ru;Su=Hs^(_u<<1|Eu>>>31),Ru=zs^(Eu<<1|_u>>>31);const ku=Z[2]^Su,Uu=Z[3]^Ru,Gu=Z[12]^Su,Yu=Z[13]^Ru,Qu=Z[22]^Su,Lu=Z[23]^Ru,cl=Z[32]^Su,el=Z[33]^Ru,Zu=Z[42]^Su,dl=Z[43]^Ru;Su=Ys^(Iu<<1|Au>>>31),Ru=Zs^(Au<<1|Iu>>>31);const El=Z[4]^Su,hl=Z[5]^Ru,_l=Z[14]^Su,Rl=Z[15]^Ru,ol=Z[24]^Su,gl=Z[25]^Ru,nl=Z[34]^Su,Sl=Z[35]^Ru,ll=Z[44]^Su,ul=Z[45]^Ru;Su=_u^($u<<1|vu>>>31),Ru=Eu^(vu<<1|$u>>>31);const Al=Z[6]^Su,Tl=Z[7]^Ru,qu=Z[16]^Su,Ou=Z[17]^Ru,Vu=Z[26]^Su,il=Z[27]^Ru,sl=Z[36]^Su,pl=Z[37]^Ru,yl=Z[46]^Su,fl=Z[47]^Ru;Su=Iu^(Hs<<1|zs>>>31),Ru=Au^(zs<<1|Hs>>>31);const bl=Z[8]^Su,al=Z[9]^Ru,wl=Z[18]^Su,Dl=Z[19]^Ru,Ll=Z[28]^Su,Fl=Z[29]^Ru,ql=Z[38]^Su,Gl=Z[39]^Ru,Ql=Z[48]^Su,Hl=Z[49]^Ru,jl=Pu,rh=Cu,Ku=Fu<<4|Bu>>>28,xu=Bu<<4|Fu>>>28,Nu=zu<<3|Hu>>>29,rl=Hu<<3|zu>>>29,ml=tl<<9|Wu>>>23,Il=Wu<<9|tl>>>23,Cl=Xu<<18|ju>>>14,Ml=ju<<18|Xu>>>14,eh=ku<<1|Uu>>>31,Xl=Uu<<1|ku>>>31,th=Yu<<12|Gu>>>20,Yl=Gu<<12|Yu>>>20,Rh=Qu<<10|Lu>>>22,hh=Lu<<10|Qu>>>22,vh=el<<13|cl>>>19,_h=cl<<13|el>>>19,$l=Zu<<2|dl>>>30,Bl=dl<<2|Zu>>>30,xl=hl<<30|El>>>2,Ol=El<<30|hl>>>2,Nl=_l<<6|Rl>>>26,kl=Rl<<6|_l>>>26,Ul=gl<<11|ol>>>21,zl=ol<<11|gl>>>21,ih=nl<<15|Sl>>>17,Kl=Sl<<15|nl>>>17,nh=ul<<29|ll>>>3,ch=ll<<29|ul>>>3,uh=Al<<28|Tl>>>4,dh=Tl<<28|Al>>>4,ah=Ou<<23|qu>>>9,Wl=qu<<23|Ou>>>9,gh=Vu<<25|il>>>7,mh=il<<25|Vu>>>7,Zl=sl<<21|pl>>>11,yh=pl<<21|sl>>>11,Ah=fl<<24|yl>>>8,Eh=yl<<24|fl>>>8,Th=bl<<27|al>>>5,Oh=al<<27|bl>>>5,Sh=wl<<20|Dl>>>12,bh=Dl<<20|wl>>>12,Nh=Fl<<7|Ll>>>25,zh=Ll<<7|Fl>>>25,Uh=ql<<8|Gl>>>24,kh=Gl<<8|ql>>>24,jh=Ql<<14|Hl>>>18,Vh=Hl<<14|Ql>>>18;Z[0]=jl^~th&Ul,Z[1]=rh^~Yl&zl,Z[10]=uh^~Sh&Nu,Z[11]=dh^~bh&rl,Z[20]=eh^~Nl&gh,Z[21]=Xl^~kl&mh,Z[30]=Th^~Ku&Rh,Z[31]=Oh^~xu&hh,Z[40]=xl^~ah&Nh,Z[41]=Ol^~Wl&zh,Z[2]=th^~Ul&Zl,Z[3]=Yl^~zl&yh,Z[12]=Sh^~Nu&vh,Z[13]=bh^~rl&_h,Z[22]=Nl^~gh&Uh,Z[23]=kl^~mh&kh,Z[32]=Ku^~Rh&ih,Z[33]=xu^~hh&Kl,Z[42]=ah^~Nh&ml,Z[43]=Wl^~zh&Il,Z[4]=Ul^~Zl&jh,Z[5]=zl^~yh&Vh,Z[14]=Nu^~vh&nh,Z[15]=rl^~_h&ch,Z[24]=gh^~Uh&Cl,Z[25]=mh^~kh&Ml,Z[34]=Rh^~ih&Ah,Z[35]=hh^~Kl&Eh,Z[44]=Nh^~ml&$l,Z[45]=zh^~Il&Bl,Z[6]=Zl^~jh&jl,Z[7]=yh^~Vh&rh,Z[16]=vh^~nh&uh,Z[17]=_h^~ch&dh,Z[26]=Uh^~Cl&eh,Z[27]=kh^~Ml&Xl,Z[36]=ih^~Ah&Th,Z[37]=Kl^~Eh&Oh,Z[46]=ml^~$l&xl,Z[47]=Il^~Bl&Ol,Z[8]=jh^~jl&th,Z[9]=Vh^~rh&Yl,Z[18]=nh^~uh&Sh,Z[19]=ch^~dh&bh,Z[28]=Cl^~eh&Nl,Z[29]=Ml^~Xl&kl,Z[38]=Ah^~Th&Ku,Z[39]=Eh^~Oh&xu,Z[48]=$l^~xl&ah,Z[49]=Bl^~Ol&Wl,Z[0]^=P1600_ROUND_CONSTANTS[t*2],Z[1]^=P1600_ROUND_CONSTANTS[t*2+1]}};const keccakState=keccakStateUnroll;function Keccak$1(){this.state=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.blockSize=null,this.count=0,this.squeezing=!1}Keccak$1.prototype.initialize=function(Z,t){for(let Hs=0;Hs<50;++Hs)this.state[Hs]=0;this.blockSize=Z/8,this.count=0,this.squeezing=!1};Keccak$1.prototype.absorb=function(Z){for(let t=0;t<Z.length;++t)this.state[~~(this.count/4)]^=Z[t]<<8*(this.count%4),this.count+=1,this.count===this.blockSize&&(keccakState.p1600(this.state),this.count=0)};Keccak$1.prototype.absorbLastFewBits=function(Z){this.state[~~(this.count/4)]^=Z<<8*(this.count%4),Z&128&&this.count===this.blockSize-1&&keccakState.p1600(this.state),this.state[~~((this.blockSize-1)/4)]^=128<<8*((this.blockSize-1)%4),keccakState.p1600(this.state),this.count=0,this.squeezing=!0};Keccak$1.prototype.squeeze=function(Z){this.squeezing||this.absorbLastFewBits(1);const t=Buffer$1.alloc(Z);for(let Hs=0;Hs<Z;++Hs)t[Hs]=this.state[~~(this.count/4)]>>>8*(this.count%4)&255,this.count+=1,this.count===this.blockSize&&(keccakState.p1600(this.state),this.count=0);return t};Keccak$1.prototype.copy=function(Z){for(let t=0;t<50;++t)Z.state[t]=this.state[t];Z.blockSize=this.blockSize,Z.count=this.count,Z.squeezing=this.squeezing};var keccak=Keccak$1,js$2=api(keccak),__createBinding$3=commonjsGlobal$2&&commonjsGlobal$2.__createBinding||(Object.create?function(Z,t,Hs,zs){zs===void 0&&(zs=Hs),Object.defineProperty(Z,zs,{enumerable:!0,get:function(){return t[Hs]}})}:function(Z,t,Hs,zs){zs===void 0&&(zs=Hs),Z[zs]=t[Hs]}),__setModuleDefault$2=commonjsGlobal$2&&commonjsGlobal$2.__setModuleDefault||(Object.create?function(Z,t){Object.defineProperty(Z,"default",{enumerable:!0,value:t})}:function(Z,t){Z.default=t}),__importStar$3=commonjsGlobal$2&&commonjsGlobal$2.__importStar||function(Z){if(Z&&Z.__esModule)return Z;var t={};if(Z!=null)for(var Hs in Z)Hs!=="default"&&Object.prototype.hasOwnProperty.call(Z,Hs)&&__createBinding$3(t,Z,Hs);return __setModuleDefault$2(t,Z),t},__importDefault$3=commonjsGlobal$2&&commonjsGlobal$2.__importDefault||function(Z){return Z&&Z.__esModule?Z:{default:Z}};Object.defineProperty(address,"__esModule",{value:!0});address.AddressComputer=address.Address=void 0;const bech32=__importStar$3(bech32$1),bignumber_js_1$2=__importDefault$3(bignumberExports),codec_1=codec,config_1=config$1,constants_1$5=constants$2,errors$4=__importStar$3(errors$5),createKeccakHash$2=js$2,PUBKEY_LENGTH=32,SMART_CONTRACT_HEX_PUBKEY_PREFIX="0".repeat(16);class Address{constructor(t,Hs){if(!t){this.publicKey=Buffer$1.from([]),this.hrp=Hs||config_1.LibraryConfig.DefaultAddressHrp;return}if(ArrayBuffer.isView(t)){if(t.length!=PUBKEY_LENGTH)throw new errors$4.ErrAddressCannotCreate(t);this.publicKey=Buffer$1.from(t),this.hrp=Hs||config_1.LibraryConfig.DefaultAddressHrp;return}if(t instanceof Address){if(Hs)throw new errors$4.ErrInvalidArgument("this variant of the Address constructor does not accept the 'hrp' argument");this.publicKey=t.publicKey,this.hrp=t.hrp;return}if(typeof t=="string"){if(Address.isValidHex(t)){this.publicKey=Buffer$1.from(t,"hex"),this.hrp=Hs||config_1.LibraryConfig.DefaultAddressHrp;return}if(Hs)throw new errors$4.ErrInvalidArgument("this variant of the Address constructor does not accept the 'hrp' argument");const{hrp:zs,pubkey:Ys}=decodeFromBech32({value:t,allowCustomHrp:!1});this.publicKey=Ys,this.hrp=zs;return}throw new errors$4.ErrAddressCannotCreate(t)}static newFromBech32(t){const{hrp:Hs,pubkey:zs}=decodeFromBech32({value:t,allowCustomHrp:!0});return new Address(zs,Hs)}static newFromHex(t,Hs){if(!Address.isValidHex(t))throw new errors$4.ErrAddressCannotCreate(t);return new Address(Buffer$1.from(t,"hex"),Hs)}toHex(){return this.isEmpty()?"":this.publicKey.toString("hex")}toBech32(){if(this.isEmpty())return"";let t=bech32.toWords(this.getPublicKey());return bech32.encode(this.hrp,t)}getPublicKey(){return this.publicKey}getHrp(){return this.hrp}static empty(){return new Address("")}static isValid(t){const Hs=bech32.decodeUnsafe(t),zs=Hs==null?void 0:Hs.prefix,Ys=Hs?Buffer$1.from(bech32.fromWords(Hs.words)):void 0;return!(zs!==config_1.LibraryConfig.DefaultAddressHrp||(Ys==null?void 0:Ys.length)!==PUBKEY_LENGTH)}static isValidHex(t){return Buffer$1.from(t,"hex").length==PUBKEY_LENGTH}isEmpty(){return this.publicKey.length==0}equals(t){return t?this.publicKey.toString()==t.publicKey.toString():!1}toString(){return this.toBech32()}toJSON(){return{bech32:this.toBech32(),pubkey:this.toHex()}}static Zero(){return new Address("0".repeat(64))}isSmartContract(){return this.toHex().startsWith(SMART_CONTRACT_HEX_PUBKEY_PREFIX)}}address.Address=Address;class AddressComputer{constructor(t){this.numberOfShardsWithoutMeta=t||constants_1$5.CURRENT_NUMBER_OF_SHARDS_WITHOUT_META}computeContractAddress(t,Hs){const zs=Buffer$1.alloc(8,0),Ys=t.getPublicKey(),Zs=Ys.slice(30),_u=Buffer$1.alloc(8),Eu=new bignumber_js_1$2.default(Hs.toString()),Iu=codec_1.bigIntToBuffer(Eu);_u.write(Iu.reverse().toString("hex"),"hex");const Au=Buffer$1.concat([Ys,_u]),$u=createKeccakHash$2("keccak256").update(Au).digest(),vu=Buffer$1.from(constants_1$5.WasmVirtualMachine,"hex"),Su=Buffer$1.concat([zs,vu,$u.slice(10,30),Zs]);return new Address(Su)}getShardOfAddress(t){return this.getShardOfPubkey(t.getPublicKey(),this.numberOfShardsWithoutMeta)}getShardOfPubkey(t,Hs){const zs=parseInt("11",2),Ys=parseInt("01",2),Zs=t[31];if(this.isPubkeyOfMetachain(t))return constants_1$5.METACHAIN_ID;let _u=Zs&zs;return _u>Hs-1&&(_u=Zs&Ys),_u}isPubkeyOfMetachain(t){const Hs=Buffer$1.from([0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),zs=Buffer$1.from(t).slice(0,Hs.length);return!!(Hs.equals(zs)||Buffer$1.alloc(32).equals(Buffer$1.from(t)))}}address.AddressComputer=AddressComputer;function decodeFromBech32(Z){const t=Z.value,Hs=Z.allowCustomHrp;let zs,Ys;try{const Zs=bech32.decode(t);zs=Zs.prefix,Ys=Buffer$1.from(bech32.fromWords(Zs.words))}catch(Zs){throw new errors$4.ErrAddressCannotCreate(t,Zs)}if(!Hs&&zs!=config_1.LibraryConfig.DefaultAddressHrp)throw new errors$4.ErrAddressBadHrp(config_1.LibraryConfig.DefaultAddressHrp,zs);return{hrp:zs,pubkey:Ys}}Object.defineProperty(message,"__esModule",{value:!0});message.MessageComputer=message.Message=void 0;const address_1$4=address,constants_1$4=constants$2,createKeccakHash$1=js$2;class Message{constructor(t){this.data=t.data,this.signature=t.signature,this.address=t.address,this.version=t.version||constants_1$4.DEFAULT_MESSAGE_VERSION,this.signer=t.signer||constants_1$4.SDK_JS_SIGNER}}message.Message=Message;class MessageComputer{constructor(){}computeBytesForSigning(t){const Hs=Buffer$1.from(t.data.length.toString()),zs=Buffer$1.concat([Hs,t.data]);let Ys=Buffer$1.concat([Buffer$1.from(constants_1$4.MESSAGE_PREFIX),zs]);return createKeccakHash$1("keccak256").update(Ys).digest()}computeBytesForVerifying(t){return this.computeBytesForSigning(t)}packMessage(t){return{message:Buffer$1.from(t.data).toString("hex"),signature:t.signature?Buffer$1.from(t.signature).toString("hex"):"",address:t.address?t.address.toBech32():"",version:t.version,signer:t.signer}}unpackMessage(t){const Hs=this.trimHexPrefix(t.message),zs=Buffer$1.from(Hs,"hex"),Ys=this.trimHexPrefix(t.signature||""),Zs=Buffer$1.from(Ys,"hex");let _u;t.address&&(_u=address_1$4.Address.newFromBech32(t.address));const Eu=t.version||constants_1$4.DEFAULT_MESSAGE_VERSION,Iu=t.signer||constants_1$4.UNKNOWN_SIGNER;return new Message({data:zs,signature:Zs,address:_u,version:Eu,signer:Iu})}trimHexPrefix(t){return t.startsWith("0x")||t.startsWith("0X")?t.slice(2):t}}message.MessageComputer=MessageComputer;var cjs$3={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics=function(Z,t){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Hs,zs){Hs.__proto__=zs}||function(Hs,zs){for(var Ys in zs)zs.hasOwnProperty(Ys)&&(Hs[Ys]=zs[Ys])},extendStatics(Z,t)};function __extends(Z,t){extendStatics(Z,t);function Hs(){this.constructor=Z}Z.prototype=t===null?Object.create(t):(Hs.prototype=t.prototype,new Hs)}var __assign=function(){return __assign=Object.assign||function(t){for(var Hs,zs=1,Ys=arguments.length;zs<Ys;zs++){Hs=arguments[zs];for(var Zs in Hs)Object.prototype.hasOwnProperty.call(Hs,Zs)&&(t[Zs]=Hs[Zs])}return t},__assign.apply(this,arguments)};function __rest(Z,t){var Hs={};for(var zs in Z)Object.prototype.hasOwnProperty.call(Z,zs)&&t.indexOf(zs)<0&&(Hs[zs]=Z[zs]);if(Z!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Ys=0,zs=Object.getOwnPropertySymbols(Z);Ys<zs.length;Ys++)t.indexOf(zs[Ys])<0&&Object.prototype.propertyIsEnumerable.call(Z,zs[Ys])&&(Hs[zs[Ys]]=Z[zs[Ys]]);return Hs}function __decorate(Z,t,Hs,zs){var Ys=arguments.length,Zs=Ys<3?t:zs===null?zs=Object.getOwnPropertyDescriptor(t,Hs):zs,_u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Zs=Reflect.decorate(Z,t,Hs,zs);else for(var Eu=Z.length-1;Eu>=0;Eu--)(_u=Z[Eu])&&(Zs=(Ys<3?_u(Zs):Ys>3?_u(t,Hs,Zs):_u(t,Hs))||Zs);return Ys>3&&Zs&&Object.defineProperty(t,Hs,Zs),Zs}function __param(Z,t){return function(Hs,zs){t(Hs,zs,Z)}}function __metadata(Z,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(Z,t)}function __awaiter$2(Z,t,Hs,zs){function Ys(Zs){return Zs instanceof Hs?Zs:new Hs(function(_u){_u(Zs)})}return new(Hs||(Hs=Promise))(function(Zs,_u){function Eu($u){try{Au(zs.next($u))}catch(vu){_u(vu)}}function Iu($u){try{Au(zs.throw($u))}catch(vu){_u(vu)}}function Au($u){$u.done?Zs($u.value):Ys($u.value).then(Eu,Iu)}Au((zs=zs.apply(Z,t||[])).next())})}function __generator(Z,t){var Hs={label:0,sent:function(){if(Zs[0]&1)throw Zs[1];return Zs[1]},trys:[],ops:[]},zs,Ys,Zs,_u;return _u={next:Eu(0),throw:Eu(1),return:Eu(2)},typeof Symbol=="function"&&(_u[Symbol.iterator]=function(){return this}),_u;function Eu(Au){return function($u){return Iu([Au,$u])}}function Iu(Au){if(zs)throw new TypeError("Generator is already executing.");for(;Hs;)try{if(zs=1,Ys&&(Zs=Au[0]&2?Ys.return:Au[0]?Ys.throw||((Zs=Ys.return)&&Zs.call(Ys),0):Ys.next)&&!(Zs=Zs.call(Ys,Au[1])).done)return Zs;switch(Ys=0,Zs&&(Au=[Au[0]&2,Zs.value]),Au[0]){case 0:case 1:Zs=Au;break;case 4:return Hs.label++,{value:Au[1],done:!1};case 5:Hs.label++,Ys=Au[1],Au=[0];continue;case 7:Au=Hs.ops.pop(),Hs.trys.pop();continue;default:if(Zs=Hs.trys,!(Zs=Zs.length>0&&Zs[Zs.length-1])&&(Au[0]===6||Au[0]===2)){Hs=0;continue}if(Au[0]===3&&(!Zs||Au[1]>Zs[0]&&Au[1]<Zs[3])){Hs.label=Au[1];break}if(Au[0]===6&&Hs.label<Zs[1]){Hs.label=Zs[1],Zs=Au;break}if(Zs&&Hs.label<Zs[2]){Hs.label=Zs[2],Hs.ops.push(Au);break}Zs[2]&&Hs.ops.pop(),Hs.trys.pop();continue}Au=t.call(Z,Hs)}catch($u){Au=[6,$u],Ys=0}finally{zs=Zs=0}if(Au[0]&5)throw Au[1];return{value:Au[0]?Au[1]:void 0,done:!0}}}function __createBinding$2(Z,t,Hs,zs){zs===void 0&&(zs=Hs),Z[zs]=t[Hs]}function __exportStar(Z,t){for(var Hs in Z)Hs!=="default"&&!t.hasOwnProperty(Hs)&&(t[Hs]=Z[Hs])}function __values(Z){var t=typeof Symbol=="function"&&Symbol.iterator,Hs=t&&Z[t],zs=0;if(Hs)return Hs.call(Z);if(Z&&typeof Z.length=="number")return{next:function(){return Z&&zs>=Z.length&&(Z=void 0),{value:Z&&Z[zs++],done:!Z}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(Z,t){var Hs=typeof Symbol=="function"&&Z[Symbol.iterator];if(!Hs)return Z;var zs=Hs.call(Z),Ys,Zs=[],_u;try{for(;(t===void 0||t-- >0)&&!(Ys=zs.next()).done;)Zs.push(Ys.value)}catch(Eu){_u={error:Eu}}finally{try{Ys&&!Ys.done&&(Hs=zs.return)&&Hs.call(zs)}finally{if(_u)throw _u.error}}return Zs}function __spread(){for(var Z=[],t=0;t<arguments.length;t++)Z=Z.concat(__read(arguments[t]));return Z}function __spreadArrays(){for(var Z=0,t=0,Hs=arguments.length;t<Hs;t++)Z+=arguments[t].length;for(var zs=Array(Z),Ys=0,t=0;t<Hs;t++)for(var Zs=arguments[t],_u=0,Eu=Zs.length;_u<Eu;_u++,Ys++)zs[Ys]=Zs[_u];return zs}function __await(Z){return this instanceof __await?(this.v=Z,this):new __await(Z)}function __asyncGenerator(Z,t,Hs){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var zs=Hs.apply(Z,t||[]),Ys,Zs=[];return Ys={},_u("next"),_u("throw"),_u("return"),Ys[Symbol.asyncIterator]=function(){return this},Ys;function _u(Su){zs[Su]&&(Ys[Su]=function(Ru){return new Promise(function(Pu,Cu){Zs.push([Su,Ru,Pu,Cu])>1||Eu(Su,Ru)})})}function Eu(Su,Ru){try{Iu(zs[Su](Ru))}catch(Pu){vu(Zs[0][3],Pu)}}function Iu(Su){Su.value instanceof __await?Promise.resolve(Su.value.v).then(Au,$u):vu(Zs[0][2],Su)}function Au(Su){Eu("next",Su)}function $u(Su){Eu("throw",Su)}function vu(Su,Ru){Su(Ru),Zs.shift(),Zs.length&&Eu(Zs[0][0],Zs[0][1])}}function __asyncDelegator(Z){var t,Hs;return t={},zs("next"),zs("throw",function(Ys){throw Ys}),zs("return"),t[Symbol.iterator]=function(){return this},t;function zs(Ys,Zs){t[Ys]=Z[Ys]?function(_u){return(Hs=!Hs)?{value:__await(Z[Ys](_u)),done:Ys==="return"}:Zs?Zs(_u):_u}:Zs}}function __asyncValues(Z){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=Z[Symbol.asyncIterator],Hs;return t?t.call(Z):(Z=typeof __values=="function"?__values(Z):Z[Symbol.iterator](),Hs={},zs("next"),zs("throw"),zs("return"),Hs[Symbol.asyncIterator]=function(){return this},Hs);function zs(Zs){Hs[Zs]=Z[Zs]&&function(_u){return new Promise(function(Eu,Iu){_u=Z[Zs](_u),Ys(Eu,Iu,_u.done,_u.value)})}}function Ys(Zs,_u,Eu,Iu){Promise.resolve(Iu).then(function(Au){Zs({value:Au,done:Eu})},_u)}}function __makeTemplateObject(Z,t){return Object.defineProperty?Object.defineProperty(Z,"raw",{value:t}):Z.raw=t,Z}function __importStar$2(Z){if(Z&&Z.__esModule)return Z;var t={};if(Z!=null)for(var Hs in Z)Object.hasOwnProperty.call(Z,Hs)&&(t[Hs]=Z[Hs]);return t.default=Z,t}function __importDefault$2(Z){return Z&&Z.__esModule?Z:{default:Z}}function __classPrivateFieldGet(Z,t){if(!t.has(Z))throw new TypeError("attempted to get private field on non-instance");return t.get(Z)}function __classPrivateFieldSet(Z,t,Hs){if(!t.has(Z))throw new TypeError("attempted to set private field on non-instance");return t.set(Z,Hs),Hs}const tslib_es6=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return __assign},__asyncDelegator,__asyncGenerator,__asyncValues,__await,__awaiter:__awaiter$2,__classPrivateFieldGet,__classPrivateFieldSet,__createBinding:__createBinding$2,__decorate,__exportStar,__extends,__generator,__importDefault:__importDefault$2,__importStar:__importStar$2,__makeTemplateObject,__metadata,__param,__read,__rest,__spread,__spreadArrays,__values},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(tslib_es6);var utils$1={},delay={},hasRequiredDelay;function requireDelay(){if(hasRequiredDelay)return delay;hasRequiredDelay=1,Object.defineProperty(delay,"__esModule",{value:!0}),delay.delay=void 0;function Z(t){return new Promise(Hs=>{setTimeout(()=>{Hs(!0)},t)})}return delay.delay=Z,delay}var convert={},constants$1={},misc={},hasRequiredMisc;function requireMisc(){return hasRequiredMisc||(hasRequiredMisc=1,Object.defineProperty(misc,"__esModule",{value:!0}),misc.ONE_THOUSAND=misc.ONE_HUNDRED=void 0,misc.ONE_HUNDRED=100,misc.ONE_THOUSAND=1e3),misc}var time={},hasRequiredTime;function requireTime(){return hasRequiredTime||(hasRequiredTime=1,function(Z){Object.defineProperty(Z,"__esModule",{value:!0}),Z.ONE_YEAR=Z.FOUR_WEEKS=Z.THREE_WEEKS=Z.TWO_WEEKS=Z.ONE_WEEK=Z.THIRTY_DAYS=Z.SEVEN_DAYS=Z.FIVE_DAYS=Z.THREE_DAYS=Z.ONE_DAY=Z.TWENTY_FOUR_HOURS=Z.TWELVE_HOURS=Z.SIX_HOURS=Z.THREE_HOURS=Z.ONE_HOUR=Z.SIXTY_MINUTES=Z.THIRTY_MINUTES=Z.TEN_MINUTES=Z.FIVE_MINUTES=Z.ONE_MINUTE=Z.SIXTY_SECONDS=Z.THIRTY_SECONDS=Z.TEN_SECONDS=Z.FIVE_SECONDS=Z.ONE_SECOND=void 0,Z.ONE_SECOND=1,Z.FIVE_SECONDS=5,Z.TEN_SECONDS=10,Z.THIRTY_SECONDS=30,Z.SIXTY_SECONDS=60,Z.ONE_MINUTE=Z.SIXTY_SECONDS,Z.FIVE_MINUTES=Z.ONE_MINUTE*5,Z.TEN_MINUTES=Z.ONE_MINUTE*10,Z.THIRTY_MINUTES=Z.ONE_MINUTE*30,Z.SIXTY_MINUTES=Z.ONE_MINUTE*60,Z.ONE_HOUR=Z.SIXTY_MINUTES,Z.THREE_HOURS=Z.ONE_HOUR*3,Z.SIX_HOURS=Z.ONE_HOUR*6,Z.TWELVE_HOURS=Z.ONE_HOUR*12,Z.TWENTY_FOUR_HOURS=Z.ONE_HOUR*24,Z.ONE_DAY=Z.TWENTY_FOUR_HOURS,Z.THREE_DAYS=Z.ONE_DAY*3,Z.FIVE_DAYS=Z.ONE_DAY*5,Z.SEVEN_DAYS=Z.ONE_DAY*7,Z.THIRTY_DAYS=Z.ONE_DAY*30,Z.ONE_WEEK=Z.SEVEN_DAYS,Z.TWO_WEEKS=Z.ONE_WEEK*2,Z.THREE_WEEKS=Z.ONE_WEEK*3,Z.FOUR_WEEKS=Z.ONE_WEEK*4,Z.ONE_YEAR=Z.ONE_DAY*365}(time)),time}var hasRequiredConstants;function requireConstants(){return hasRequiredConstants||(hasRequiredConstants=1,function(Z){Object.defineProperty(Z,"__esModule",{value:!0});const t=require$$0;t.__exportStar(requireMisc(),Z),t.__exportStar(requireTime(),Z)}(constants$1)),constants$1}var hasRequiredConvert;function requireConvert(){if(hasRequiredConvert)return convert;hasRequiredConvert=1,Object.defineProperty(convert,"__esModule",{value:!0}),convert.fromMiliseconds=convert.toMiliseconds=void 0;const Z=requireConstants();function t(zs){return zs*Z.ONE_THOUSAND}convert.toMiliseconds=t;function Hs(zs){return Math.floor(zs/Z.ONE_THOUSAND)}return convert.fromMiliseconds=Hs,convert}var hasRequiredUtils;function requireUtils(){return hasRequiredUtils||(hasRequiredUtils=1,function(Z){Object.defineProperty(Z,"__esModule",{value:!0});const t=require$$0;t.__exportStar(requireDelay(),Z),t.__exportStar(requireConvert(),Z)}(utils$1)),utils$1}var watch$2={},hasRequiredWatch$1;function requireWatch$1(){if(hasRequiredWatch$1)return watch$2;hasRequiredWatch$1=1,Object.defineProperty(watch$2,"__esModule",{value:!0}),watch$2.Watch=void 0;class Z{constructor(){this.timestamps=new Map}start(Hs){if(this.timestamps.has(Hs))throw new Error(`Watch already started for label: ${Hs}`);this.timestamps.set(Hs,{started:Date.now()})}stop(Hs){const zs=this.get(Hs);if(typeof zs.elapsed<"u")throw new Error(`Watch already stopped for label: ${Hs}`);const Ys=Date.now()-zs.started;this.timestamps.set(Hs,{started:zs.started,elapsed:Ys})}get(Hs){const zs=this.timestamps.get(Hs);if(typeof zs>"u")throw new Error(`No timestamp found for label: ${Hs}`);return zs}elapsed(Hs){const zs=this.get(Hs);return zs.elapsed||Date.now()-zs.started}}return watch$2.Watch=Z,watch$2.default=Z,watch$2}var types={},watch$1={},hasRequiredWatch;function requireWatch(){if(hasRequiredWatch)return watch$1;hasRequiredWatch=1,Object.defineProperty(watch$1,"__esModule",{value:!0}),watch$1.IWatch=void 0;class Z{}return watch$1.IWatch=Z,watch$1}var hasRequiredTypes;function requireTypes(){return hasRequiredTypes||(hasRequiredTypes=1,function(Z){Object.defineProperty(Z,"__esModule",{value:!0}),require$$0.__exportStar(requireWatch(),Z)}(types)),types}(function(Z){Object.defineProperty(Z,"__esModule",{value:!0});const t=require$$0;t.__exportStar(requireUtils(),Z),t.__exportStar(requireWatch$1(),Z),t.__exportStar(requireTypes(),Z),t.__exportStar(requireConstants(),Z)})(cjs$3);class IEvents{}let n$1=class extends IEvents{constructor(t){super()}};const s$1=cjs$3.FIVE_SECONDS,r$1={pulse:"heartbeat_pulse"};let i$2=class Wd extends n$1{constructor(t){super(t),this.events=new eventsExports.EventEmitter,this.interval=s$1,this.interval=(t==null?void 0:t.interval)||s$1}static async init(t){const Hs=new Wd(t);return await Hs.init(),Hs}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(t,Hs){this.events.on(t,Hs)}once(t,Hs){this.events.once(t,Hs)}off(t,Hs){this.events.off(t,Hs)}removeListener(t,Hs){this.events.removeListener(t,Hs)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),cjs$3.toMiliseconds(this.interval))}pulse(){this.events.emit(r$1.pulse)}};const suspectProtoRx=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,suspectConstructorRx=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,JsonSigRx=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function jsonParseTransform(Z,t){if(Z==="__proto__"||Z==="constructor"&&t&&typeof t=="object"&&"prototype"in t){warnKeyDropped(Z);return}return t}function warnKeyDropped(Z){console.warn(`[destr] Dropping "${Z}" key to prevent prototype pollution.`)}function destr(Z,t={}){if(typeof Z!="string")return Z;if(Z[0]==='"'&&Z[Z.length-1]==='"'&&Z.indexOf("\\")===-1)return Z.slice(1,-1);const Hs=Z.trim();if(Hs.length<=9)switch(Hs.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!JsonSigRx.test(Z)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return Z}try{if(suspectProtoRx.test(Z)||suspectConstructorRx.test(Z)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(Z,jsonParseTransform)}return JSON.parse(Z)}catch(zs){if(t.strict)throw zs;return Z}}function wrapToPromise(Z){return!Z||typeof Z.then!="function"?Promise.resolve(Z):Z}function asyncCall(Z,...t){try{return wrapToPromise(Z(...t))}catch(Hs){return Promise.reject(Hs)}}function isPrimitive(Z){const t=typeof Z;return Z===null||t!=="object"&&t!=="function"}function isPureObject(Z){const t=Object.getPrototypeOf(Z);return!t||t.isPrototypeOf(Object)}function stringify$1(Z){if(isPrimitive(Z))return String(Z);if(isPureObject(Z)||Array.isArray(Z))return JSON.stringify(Z);if(typeof Z.toJSON=="function")return stringify$1(Z.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const BASE64_PREFIX="base64:";function serializeRaw(Z){return typeof Z=="string"?Z:BASE64_PREFIX+base64Encode$1(Z)}function deserializeRaw(Z){return typeof Z!="string"||!Z.startsWith(BASE64_PREFIX)?Z:base64Decode$1(Z.slice(BASE64_PREFIX.length))}function base64Decode$1(Z){return globalThis.Buffer?Buffer$1.from(Z,"base64"):Uint8Array.from(globalThis.atob(Z),t=>t.codePointAt(0))}function base64Encode$1(Z){return globalThis.Buffer?Buffer$1.from(Z).toString("base64"):globalThis.btoa(String.fromCodePoint(...Z))}function normalizeKey(Z){var t;return Z&&((t=Z.split("?")[0])==null?void 0:t.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function joinKeys(...Z){return normalizeKey(Z.join(":"))}function normalizeBaseKey(Z){return Z=normalizeKey(Z),Z?Z+":":""}function filterKeyByDepth(Z,t){if(t===void 0)return!0;let Hs=0,zs=Z.indexOf(":");for(;zs>-1;)Hs++,zs=Z.indexOf(":",zs+1);return Hs<=t}function filterKeyByBase(Z,t){return t?Z.startsWith(t)&&Z[Z.length-1]!=="$":Z[Z.length-1]!=="$"}function defineDriver(Z){return Z}const DRIVER_NAME="memory",memory=()=>{const Z=new Map;return{name:DRIVER_NAME,getInstance:()=>Z,hasItem(t){return Z.has(t)},getItem(t){return Z.get(t)??null},getItemRaw(t){return Z.get(t)??null},setItem(t,Hs){Z.set(t,Hs)},setItemRaw(t,Hs){Z.set(t,Hs)},removeItem(t){Z.delete(t)},getKeys(){return[...Z.keys()]},clear(){Z.clear()},dispose(){Z.clear()}}};function createStorage(Z={}){const t={mounts:{"":Z.driver||memory()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},Hs=Au=>{for(const $u of t.mountpoints)if(Au.startsWith($u))return{base:$u,relativeKey:Au.slice($u.length),driver:t.mounts[$u]};return{base:"",relativeKey:Au,driver:t.mounts[""]}},zs=(Au,$u)=>t.mountpoints.filter(vu=>vu.startsWith(Au)||$u&&Au.startsWith(vu)).map(vu=>({relativeBase:Au.length>vu.length?Au.slice(vu.length):void 0,mountpoint:vu,driver:t.mounts[vu]})),Ys=(Au,$u)=>{if(t.watching){$u=normalizeKey($u);for(const vu of t.watchListeners)vu(Au,$u)}},Zs=async()=>{if(!t.watching){t.watching=!0;for(const Au in t.mounts)t.unwatch[Au]=await watch(t.mounts[Au],Ys,Au)}},_u=async()=>{if(t.watching){for(const Au in t.unwatch)await t.unwatch[Au]();t.unwatch={},t.watching=!1}},Eu=(Au,$u,vu)=>{const Su=new Map,Ru=Pu=>{let Cu=Su.get(Pu.base);return Cu||(Cu={driver:Pu.driver,base:Pu.base,items:[]},Su.set(Pu.base,Cu)),Cu};for(const Pu of Au){const Cu=typeof Pu=="string",Bu=normalizeKey(Cu?Pu:Pu.key),Fu=Cu?void 0:Pu.value,zu=Cu||!Pu.options?$u:{...$u,...Pu.options},Hu=Hs(Bu);Ru(Hu).items.push({key:Bu,value:Fu,relativeKey:Hu.relativeKey,options:zu})}return Promise.all([...Su.values()].map(Pu=>vu(Pu))).then(Pu=>Pu.flat())},Iu={hasItem(Au,$u={}){Au=normalizeKey(Au);const{relativeKey:vu,driver:Su}=Hs(Au);return asyncCall(Su.hasItem,vu,$u)},getItem(Au,$u={}){Au=normalizeKey(Au);const{relativeKey:vu,driver:Su}=Hs(Au);return asyncCall(Su.getItem,vu,$u).then(Ru=>destr(Ru))},getItems(Au,$u={}){return Eu(Au,$u,vu=>vu.driver.getItems?asyncCall(vu.driver.getItems,vu.items.map(Su=>({key:Su.relativeKey,options:Su.options})),$u).then(Su=>Su.map(Ru=>({key:joinKeys(vu.base,Ru.key),value:destr(Ru.value)}))):Promise.all(vu.items.map(Su=>asyncCall(vu.driver.getItem,Su.relativeKey,Su.options).then(Ru=>({key:Su.key,value:destr(Ru)})))))},getItemRaw(Au,$u={}){Au=normalizeKey(Au);const{relativeKey:vu,driver:Su}=Hs(Au);return Su.getItemRaw?asyncCall(Su.getItemRaw,vu,$u):asyncCall(Su.getItem,vu,$u).then(Ru=>deserializeRaw(Ru))},async setItem(Au,$u,vu={}){if($u===void 0)return Iu.removeItem(Au);Au=normalizeKey(Au);const{relativeKey:Su,driver:Ru}=Hs(Au);Ru.setItem&&(await asyncCall(Ru.setItem,Su,stringify$1($u),vu),Ru.watch||Ys("update",Au))},async setItems(Au,$u){await Eu(Au,$u,async vu=>{if(vu.driver.setItems)return asyncCall(vu.driver.setItems,vu.items.map(Su=>({key:Su.relativeKey,value:stringify$1(Su.value),options:Su.options})),$u);vu.driver.setItem&&await Promise.all(vu.items.map(Su=>asyncCall(vu.driver.setItem,Su.relativeKey,stringify$1(Su.value),Su.options)))})},async setItemRaw(Au,$u,vu={}){if($u===void 0)return Iu.removeItem(Au,vu);Au=normalizeKey(Au);const{relativeKey:Su,driver:Ru}=Hs(Au);if(Ru.setItemRaw)await asyncCall(Ru.setItemRaw,Su,$u,vu);else if(Ru.setItem)await asyncCall(Ru.setItem,Su,serializeRaw($u),vu);else return;Ru.watch||Ys("update",Au)},async removeItem(Au,$u={}){typeof $u=="boolean"&&($u={removeMeta:$u}),Au=normalizeKey(Au);const{relativeKey:vu,driver:Su}=Hs(Au);Su.removeItem&&(await asyncCall(Su.removeItem,vu,$u),($u.removeMeta||$u.removeMata)&&await asyncCall(Su.removeItem,vu+"$",$u),Su.watch||Ys("remove",Au))},async getMeta(Au,$u={}){typeof $u=="boolean"&&($u={nativeOnly:$u}),Au=normalizeKey(Au);const{relativeKey:vu,driver:Su}=Hs(Au),Ru=Object.create(null);if(Su.getMeta&&Object.assign(Ru,await asyncCall(Su.getMeta,vu,$u)),!$u.nativeOnly){const Pu=await asyncCall(Su.getItem,vu+"$",$u).then(Cu=>destr(Cu));Pu&&typeof Pu=="object"&&(typeof Pu.atime=="string"&&(Pu.atime=new Date(Pu.atime)),typeof Pu.mtime=="string"&&(Pu.mtime=new Date(Pu.mtime)),Object.assign(Ru,Pu))}return Ru},setMeta(Au,$u,vu={}){return this.setItem(Au+"$",$u,vu)},removeMeta(Au,$u={}){return this.removeItem(Au+"$",$u)},async getKeys(Au,$u={}){var Bu;Au=normalizeBaseKey(Au);const vu=zs(Au,!0);let Su=[];const Ru=[];let Pu=!0;for(const Fu of vu){(Bu=Fu.driver.flags)!=null&&Bu.maxDepth||(Pu=!1);const zu=await asyncCall(Fu.driver.getKeys,Fu.relativeBase,$u);for(const Hu of zu){const Wu=Fu.mountpoint+normalizeKey(Hu);Su.some(tl=>Wu.startsWith(tl))||Ru.push(Wu)}Su=[Fu.mountpoint,...Su.filter(Hu=>!Hu.startsWith(Fu.mountpoint))]}const Cu=$u.maxDepth!==void 0&&!Pu;return Ru.filter(Fu=>(!Cu||filterKeyByDepth(Fu,$u.maxDepth))&&filterKeyByBase(Fu,Au))},async clear(Au,$u={}){Au=normalizeBaseKey(Au),await Promise.all(zs(Au,!1).map(async vu=>{if(vu.driver.clear)return asyncCall(vu.driver.clear,vu.relativeBase,$u);if(vu.driver.removeItem){const Su=await vu.driver.getKeys(vu.relativeBase||"",$u);return Promise.all(Su.map(Ru=>vu.driver.removeItem(Ru,$u)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(Au=>dispose(Au)))},async watch(Au){return await Zs(),t.watchListeners.push(Au),async()=>{t.watchListeners=t.watchListeners.filter($u=>$u!==Au),t.watchListeners.length===0&&await _u()}},async unwatch(){t.watchListeners=[],await _u()},mount(Au,$u){if(Au=normalizeBaseKey(Au),Au&&t.mounts[Au])throw new Error(`already mounted at ${Au}`);return Au&&(t.mountpoints.push(Au),t.mountpoints.sort((vu,Su)=>Su.length-vu.length)),t.mounts[Au]=$u,t.watching&&Promise.resolve(watch($u,Ys,Au)).then(vu=>{t.unwatch[Au]=vu}).catch(console.error),Iu},async unmount(Au,$u=!0){var vu,Su;Au=normalizeBaseKey(Au),!(!Au||!t.mounts[Au])&&(t.watching&&Au in t.unwatch&&((Su=(vu=t.unwatch)[Au])==null||Su.call(vu),delete t.unwatch[Au]),$u&&await dispose(t.mounts[Au]),t.mountpoints=t.mountpoints.filter(Ru=>Ru!==Au),delete t.mounts[Au])},getMount(Au=""){Au=normalizeKey(Au)+":";const $u=Hs(Au);return{driver:$u.driver,base:$u.base}},getMounts(Au="",$u={}){return Au=normalizeKey(Au),zs(Au,$u.parents).map(Su=>({driver:Su.driver,base:Su.mountpoint}))},keys:(Au,$u={})=>Iu.getKeys(Au,$u),get:(Au,$u={})=>Iu.getItem(Au,$u),set:(Au,$u,vu={})=>Iu.setItem(Au,$u,vu),has:(Au,$u={})=>Iu.hasItem(Au,$u),del:(Au,$u={})=>Iu.removeItem(Au,$u),remove:(Au,$u={})=>Iu.removeItem(Au,$u)};return Iu}function watch(Z,t,Hs){return Z.watch?Z.watch((zs,Ys)=>t(zs,Hs+Ys)):()=>{}}async function dispose(Z){typeof Z.dispose=="function"&&await asyncCall(Z.dispose)}function promisifyRequest$1(Z){return new Promise((t,Hs)=>{Z.oncomplete=Z.onsuccess=()=>t(Z.result),Z.onabort=Z.onerror=()=>Hs(Z.error)})}function createStore(Z,t){let Hs;const zs=()=>{if(Hs)return Hs;const Ys=indexedDB.open(Z);return Ys.onupgradeneeded=()=>Ys.result.createObjectStore(t),Hs=promisifyRequest$1(Ys),Hs.then(Zs=>{Zs.onclose=()=>Hs=void 0},()=>{}),Hs};return(Ys,Zs)=>zs().then(_u=>Zs(_u.transaction(t,Ys).objectStore(t)))}let defaultGetStoreFunc;function defaultGetStore(){return defaultGetStoreFunc||(defaultGetStoreFunc=createStore("keyval-store","keyval")),defaultGetStoreFunc}function get(Z,t=defaultGetStore()){return t("readonly",Hs=>promisifyRequest$1(Hs.get(Z)))}function set$1(Z,t,Hs=defaultGetStore()){return Hs("readwrite",zs=>(zs.put(t,Z),promisifyRequest$1(zs.transaction)))}function del(Z,t=defaultGetStore()){return t("readwrite",Hs=>(Hs.delete(Z),promisifyRequest$1(Hs.transaction)))}function clear(Z=defaultGetStore()){return Z("readwrite",t=>(t.clear(),promisifyRequest$1(t.transaction)))}function eachCursor(Z,t){return Z.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},promisifyRequest$1(Z.transaction)}function keys(Z=defaultGetStore()){return Z("readonly",t=>{if(t.getAllKeys)return promisifyRequest$1(t.getAllKeys());const Hs=[];return eachCursor(t,zs=>Hs.push(zs.key)).then(()=>Hs)})}const JSONStringify=Z=>JSON.stringify(Z,(t,Hs)=>typeof Hs=="bigint"?Hs.toString()+"n":Hs),JSONParse=Z=>{const t=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,Hs=Z.replace(t,'$1"$2n"$3');return JSON.parse(Hs,(zs,Ys)=>typeof Ys=="string"&&Ys.match(/^\d+n$/)?BigInt(Ys.substring(0,Ys.length-1)):Ys)};function safeJsonParse(Z){if(typeof Z!="string")throw new Error(`Cannot safe json parse value of type ${typeof Z}`);try{return JSONParse(Z)}catch{return Z}}function safeJsonStringify(Z){return typeof Z=="string"?Z:JSONStringify(Z)||""}const x$4="idb-keyval";var z$3=(Z={})=>{const t=Z.base&&Z.base.length>0?`${Z.base}:`:"",Hs=Ys=>t+Ys;let zs;return Z.dbName&&Z.storeName&&(zs=createStore(Z.dbName,Z.storeName)),{name:x$4,options:Z,async hasItem(Ys){return!(typeof await get(Hs(Ys),zs)>"u")},async getItem(Ys){return await get(Hs(Ys),zs)??null},setItem(Ys,Zs){return set$1(Hs(Ys),Zs,zs)},removeItem(Ys){return del(Hs(Ys),zs)},getKeys(){return keys(zs)},clear(){return clear(zs)}}};const D$2="WALLET_CONNECT_V2_INDEXED_DB",E$1="keyvaluestorage";let _$1=class{constructor(){this.indexedDb=createStorage({driver:z$3({dbName:D$2,storeName:E$1})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const Hs=await this.indexedDb.getItem(t);if(Hs!==null)return Hs}async setItem(t,Hs){await this.indexedDb.setItem(t,safeJsonStringify(Hs))}async removeItem(t){await this.indexedDb.removeItem(t)}};var l$1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},c$3={exports:{}};(function(){let Z;function t(){}Z=t,Z.prototype.getItem=function(Hs){return this.hasOwnProperty(Hs)?String(this[Hs]):null},Z.prototype.setItem=function(Hs,zs){this[Hs]=String(zs)},Z.prototype.removeItem=function(Hs){delete this[Hs]},Z.prototype.clear=function(){const Hs=this;Object.keys(Hs).forEach(function(zs){Hs[zs]=void 0,delete Hs[zs]})},Z.prototype.key=function(Hs){return Hs=Hs||0,Object.keys(this)[Hs]},Z.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof l$1<"u"&&l$1.localStorage?c$3.exports=l$1.localStorage:typeof window<"u"&&window.localStorage?c$3.exports=window.localStorage:c$3.exports=new t})();function k$3(Z){var t;return[Z[0],safeJsonParse((t=Z[1])!=null?t:"")]}let K$3=class{constructor(){this.localStorage=c$3.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(k$3)}async getItem(t){const Hs=this.localStorage.getItem(t);if(Hs!==null)return safeJsonParse(Hs)}async setItem(t,Hs){this.localStorage.setItem(t,safeJsonStringify(Hs))}async removeItem(t){this.localStorage.removeItem(t)}};const N$4="wc_storage_version",y$2=1,O$4=async(Z,t,Hs)=>{const zs=N$4,Ys=await t.getItem(zs);if(Ys&&Ys>=y$2){Hs(t);return}const Zs=await Z.getKeys();if(!Zs.length){Hs(t);return}const _u=[];for(;Zs.length;){const Eu=Zs.shift();if(!Eu)continue;const Iu=Eu.toLowerCase();if(Iu.includes("wc@")||Iu.includes("walletconnect")||Iu.includes("wc_")||Iu.includes("wallet_connect")){const Au=await Z.getItem(Eu);await t.setItem(Eu,Au),_u.push(Eu)}}await t.setItem(zs,y$2),Hs(t),j$3(Z,_u)},j$3=async(Z,t)=>{t.length&&t.forEach(async Hs=>{await Z.removeItem(Hs)})};let h$3=class{constructor(){this.initialized=!1,this.setInitialized=Hs=>{this.storage=Hs,this.initialized=!0};const t=new K$3;this.storage=t;try{const Hs=new _$1;O$4(t,Hs,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,Hs){return await this.initialize(),this.storage.setItem(t,Hs)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const Hs=setInterval(()=>{this.initialized&&(clearInterval(Hs),t())},20)})}};var browser={exports:{}};function tryStringify(Z){try{return JSON.stringify(Z)}catch{return'"[Circular]"'}}var quickFormatUnescaped=format$1;function format$1(Z,t,Hs){var zs=Hs&&Hs.stringify||tryStringify,Ys=1;if(typeof Z=="object"&&Z!==null){var Zs=t.length+Ys;if(Zs===1)return Z;var _u=new Array(Zs);_u[0]=zs(Z);for(var Eu=1;Eu<Zs;Eu++)_u[Eu]=zs(t[Eu]);return _u.join(" ")}if(typeof Z!="string")return Z;var Iu=t.length;if(Iu===0)return Z;for(var Au="",$u=1-Ys,vu=-1,Su=Z&&Z.length||0,Ru=0;Ru<Su;){if(Z.charCodeAt(Ru)===37&&Ru+1<Su){switch(vu=vu>-1?vu:0,Z.charCodeAt(Ru+1)){case 100:case 102:if($u>=Iu||t[$u]==null)break;vu<Ru&&(Au+=Z.slice(vu,Ru)),Au+=Number(t[$u]),vu=Ru+2,Ru++;break;case 105:if($u>=Iu||t[$u]==null)break;vu<Ru&&(Au+=Z.slice(vu,Ru)),Au+=Math.floor(Number(t[$u])),vu=Ru+2,Ru++;break;case 79:case 111:case 106:if($u>=Iu||t[$u]===void 0)break;vu<Ru&&(Au+=Z.slice(vu,Ru));var Pu=typeof t[$u];if(Pu==="string"){Au+="'"+t[$u]+"'",vu=Ru+2,Ru++;break}if(Pu==="function"){Au+=t[$u].name||"<anonymous>",vu=Ru+2,Ru++;break}Au+=zs(t[$u]),vu=Ru+2,Ru++;break;case 115:if($u>=Iu)break;vu<Ru&&(Au+=Z.slice(vu,Ru)),Au+=String(t[$u]),vu=Ru+2,Ru++;break;case 37:vu<Ru&&(Au+=Z.slice(vu,Ru)),Au+="%",vu=Ru+2,Ru++,$u--;break}++$u}++Ru}return vu===-1?Z:(vu<Su&&(Au+=Z.slice(vu)),Au)}const format=quickFormatUnescaped;browser.exports=pino;const _console=pfGlobalThisOrFallback().console||{},stdSerializers={mapHttpRequest:mock,mapHttpResponse:mock,wrapRequestSerializer:passthrough,wrapResponseSerializer:passthrough,wrapErrorSerializer:passthrough,req:mock,res:mock,err:asErrValue,errWithCause:asErrValue};function levelToValue(Z,t){return Z==="silent"?1/0:t.levels.values[Z]}const baseLogFunctionSymbol=Symbol("pino.logFuncs"),hierarchySymbol=Symbol("pino.hierarchy"),logFallbackMap={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function appendChildLogger(Z,t){const Hs={logger:t,parent:Z[hierarchySymbol]};t[hierarchySymbol]=Hs}function setupBaseLogFunctions(Z,t,Hs){const zs={};t.forEach(Ys=>{zs[Ys]=Hs[Ys]?Hs[Ys]:_console[Ys]||_console[logFallbackMap[Ys]||"log"]||noop$1}),Z[baseLogFunctionSymbol]=zs}function shouldSerialize(Z,t){return Array.isArray(Z)?Z.filter(function(zs){return zs!=="!stdSerializers.err"}):Z===!0?Object.keys(t):!1}function pino(Z){Z=Z||{},Z.browser=Z.browser||{};const t=Z.browser.transmit;if(t&&typeof t.send!="function")throw Error("pino: transmit option must have a send function");const Hs=Z.browser.write||_console;Z.browser.write&&(Z.browser.asObject=!0);const zs=Z.serializers||{},Ys=shouldSerialize(Z.browser.serialize,zs);let Zs=Z.browser.serialize;Array.isArray(Z.browser.serialize)&&Z.browser.serialize.indexOf("!stdSerializers.err")>-1&&(Zs=!1);const _u=Object.keys(Z.customLevels||{}),Eu=["error","fatal","warn","info","debug","trace"].concat(_u);typeof Hs=="function"&&Eu.forEach(function(Cu){Hs[Cu]=Hs}),(Z.enabled===!1||Z.browser.disabled)&&(Z.level="silent");const Iu=Z.level||"info",Au=Object.create(Hs);Au.log||(Au.log=noop$1),setupBaseLogFunctions(Au,Eu,Hs),appendChildLogger({},Au),Object.defineProperty(Au,"levelVal",{get:vu}),Object.defineProperty(Au,"level",{get:Su,set:Ru});const $u={transmit:t,serialize:Ys,asObject:Z.browser.asObject,asObjectBindingsOnly:Z.browser.asObjectBindingsOnly,formatters:Z.browser.formatters,levels:Eu,timestamp:getTimeFunction(Z),messageKey:Z.messageKey||"msg",onChild:Z.onChild||noop$1};Au.levels=getLevels(Z),Au.level=Iu,Au.isLevelEnabled=function(Cu){return this.levels.values[Cu]?this.levels.values[Cu]>=this.levels.values[this.level]:!1},Au.setMaxListeners=Au.getMaxListeners=Au.emit=Au.addListener=Au.on=Au.prependListener=Au.once=Au.prependOnceListener=Au.removeListener=Au.removeAllListeners=Au.listeners=Au.listenerCount=Au.eventNames=Au.write=Au.flush=noop$1,Au.serializers=zs,Au._serialize=Ys,Au._stdErrSerialize=Zs,Au.child=function(...Cu){return Pu.call(this,$u,...Cu)},t&&(Au._logEvent=createLogEventShape());function vu(){return levelToValue(this.level,this)}function Su(){return this._level}function Ru(Cu){if(Cu!=="silent"&&!this.levels.values[Cu])throw Error("unknown level "+Cu);this._level=Cu,set(this,$u,Au,"error"),set(this,$u,Au,"fatal"),set(this,$u,Au,"warn"),set(this,$u,Au,"info"),set(this,$u,Au,"debug"),set(this,$u,Au,"trace"),_u.forEach(Bu=>{set(this,$u,Au,Bu)})}function Pu(Cu,Bu,Fu){if(!Bu)throw new Error("missing bindings for child Pino");Fu=Fu||{},Ys&&Bu.serializers&&(Fu.serializers=Bu.serializers);const zu=Fu.serializers;if(Ys&&zu){var Hu=Object.assign({},zs,zu),Wu=Z.browser.serialize===!0?Object.keys(Hu):Ys;delete Bu.serializers,applySerializers([Bu],Wu,Hu,this._stdErrSerialize)}function tl(ju){this._childLevel=(ju._childLevel|0)+1,this.bindings=Bu,Hu&&(this.serializers=Hu,this._serialize=Wu),t&&(this._logEvent=createLogEventShape([].concat(ju._logEvent.bindings,Bu)))}tl.prototype=this;const Xu=new tl(this);return appendChildLogger(this,Xu),Xu.child=function(...ju){return Pu.call(this,Cu,...ju)},Xu.level=Fu.level||this.level,Cu.onChild(Xu),Xu}return Au}function getLevels(Z){const t=Z.customLevels||{},Hs=Object.assign({},pino.levels.values,t),zs=Object.assign({},pino.levels.labels,invertObject(t));return{values:Hs,labels:zs}}function invertObject(Z){const t={};return Object.keys(Z).forEach(function(Hs){t[Z[Hs]]=Hs}),t}pino.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};pino.stdSerializers=stdSerializers;pino.stdTimeFunctions=Object.assign({},{nullTime,epochTime,unixTime,isoTime});function getBindingChain(Z){const t=[];Z.bindings&&t.push(Z.bindings);let Hs=Z[hierarchySymbol];for(;Hs.parent;)Hs=Hs.parent,Hs.logger.bindings&&t.push(Hs.logger.bindings);return t.reverse()}function set(Z,t,Hs,zs){if(Object.defineProperty(Z,zs,{value:levelToValue(Z.level,Hs)>levelToValue(zs,Hs)?noop$1:Hs[baseLogFunctionSymbol][zs],writable:!0,enumerable:!0,configurable:!0}),Z[zs]===noop$1){if(!t.transmit)return;const Zs=t.transmit.level||Z.level,_u=levelToValue(Zs,Hs);if(levelToValue(zs,Hs)<_u)return}Z[zs]=createWrap(Z,t,Hs,zs);const Ys=getBindingChain(Z);Ys.length!==0&&(Z[zs]=prependBindingsInArguments(Ys,Z[zs]))}function prependBindingsInArguments(Z,t){return function(){return t.apply(this,[...Z,...arguments])}}function createWrap(Z,t,Hs,zs){return function(Ys){return function(){const _u=t.timestamp(),Eu=new Array(arguments.length),Iu=Object.getPrototypeOf&&Object.getPrototypeOf(this)===_console?_console:this;for(var Au=0;Au<Eu.length;Au++)Eu[Au]=arguments[Au];var $u=!1;if(t.serialize&&(applySerializers(Eu,this._serialize,this.serializers,this._stdErrSerialize),$u=!0),t.asObject||t.formatters?Ys.call(Iu,...asObject(this,zs,Eu,_u,t)):Ys.apply(Iu,Eu),t.transmit){const vu=t.transmit.level||Z._level,Su=levelToValue(vu,Hs),Ru=levelToValue(zs,Hs);if(Ru<Su)return;transmit(this,{ts:_u,methodLevel:zs,methodValue:Ru,transmitLevel:vu,transmitValue:Hs.levels.values[t.transmit.level||Z._level],send:t.transmit.send,val:levelToValue(Z._level,Hs)},Eu,$u)}}}(Z[baseLogFunctionSymbol][zs])}function asObject(Z,t,Hs,zs,Ys){const{level:Zs,log:_u=vu=>vu}=Ys.formatters||{},Eu=Hs.slice();let Iu=Eu[0];const Au={};let $u=(Z._childLevel|0)+1;if($u<1&&($u=1),zs&&(Au.time=zs),Zs){const vu=Zs(t,Z.levels.values[t]);Object.assign(Au,vu)}else Au.level=Z.levels.values[t];if(Ys.asObjectBindingsOnly){if(Iu!==null&&typeof Iu=="object")for(;$u--&&typeof Eu[0]=="object";)Object.assign(Au,Eu.shift());return[_u(Au),...Eu]}else{if(Iu!==null&&typeof Iu=="object"){for(;$u--&&typeof Eu[0]=="object";)Object.assign(Au,Eu.shift());Iu=Eu.length?format(Eu.shift(),Eu):void 0}else typeof Iu=="string"&&(Iu=format(Eu.shift(),Eu));return Iu!==void 0&&(Au[Ys.messageKey]=Iu),[_u(Au)]}}function applySerializers(Z,t,Hs,zs){for(const Ys in Z)if(zs&&Z[Ys]instanceof Error)Z[Ys]=pino.stdSerializers.err(Z[Ys]);else if(typeof Z[Ys]=="object"&&!Array.isArray(Z[Ys])&&t)for(const Zs in Z[Ys])t.indexOf(Zs)>-1&&Zs in Hs&&(Z[Ys][Zs]=Hs[Zs](Z[Ys][Zs]))}function transmit(Z,t,Hs,zs=!1){const Ys=t.send,Zs=t.ts,_u=t.methodLevel,Eu=t.methodValue,Iu=t.val,Au=Z._logEvent.bindings;zs||applySerializers(Hs,Z._serialize||Object.keys(Z.serializers),Z.serializers,Z._stdErrSerialize===void 0?!0:Z._stdErrSerialize),Z._logEvent.ts=Zs,Z._logEvent.messages=Hs.filter(function($u){return Au.indexOf($u)===-1}),Z._logEvent.level.label=_u,Z._logEvent.level.value=Eu,Ys(_u,Z._logEvent,Iu),Z._logEvent=createLogEventShape(Au)}function createLogEventShape(Z){return{ts:0,messages:[],bindings:Z||[],level:{label:"",value:0}}}function asErrValue(Z){const t={type:Z.constructor.name,msg:Z.message,stack:Z.stack};for(const Hs in Z)t[Hs]===void 0&&(t[Hs]=Z[Hs]);return t}function getTimeFunction(Z){return typeof Z.timestamp=="function"?Z.timestamp:Z.timestamp===!1?nullTime:epochTime}function mock(){return{}}function passthrough(Z){return Z}function noop$1(){}function nullTime(){return!1}function epochTime(){return Date.now()}function unixTime(){return Math.round(Date.now()/1e3)}function isoTime(){return new Date(Date.now()).toISOString()}function pfGlobalThisOrFallback(){function Z(t){return typeof t<"u"&&t}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return Z(self)||Z(window)||Z(this)||{}}}browser.exports.default=pino;browser.exports.pino=pino;var browserExports=browser.exports;const c$2=getDefaultExportFromCjs(browserExports),b$2={level:"info"},l="custom_context",i$1=1e3*1024;var C$3=Object.defineProperty,B$1=(Z,t,Hs)=>t in Z?C$3(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,s=(Z,t,Hs)=>B$1(Z,typeof t!="symbol"?t+"":t,Hs);let S$3=class{constructor(t){s(this,"nodeValue"),s(this,"sizeInBytes"),s(this,"next"),this.nodeValue=t,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},v$7=class{constructor(t){s(this,"lengthInNodes"),s(this,"sizeInBytes"),s(this,"head"),s(this,"tail"),s(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=t,this.sizeInBytes=0}append(t){const Hs=new S$3(t);if(Hs.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${t} with size ${Hs.size}`);for(;this.size+Hs.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=Hs),this.tail=Hs):(this.head=Hs,this.tail=Hs),this.lengthInNodes++,this.sizeInBytes+=Hs.size}shift(){if(!this.head)return;const t=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=t.size}toArray(){const t=[];let Hs=this.head;for(;Hs!==null;)t.push(Hs.value),Hs=Hs.next;return t}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let t=this.head;return{next:()=>{if(!t)return{done:!0,value:null};const Hs=t.value;return t=t.next,{done:!1,value:Hs}}}}};var _=Object.defineProperty,x$3=(Z,t,Hs)=>t in Z?_(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,a$1=(Z,t,Hs)=>x$3(Z,typeof t!="symbol"?t+"":t,Hs);let L$1=class{constructor(t,Hs=i$1){a$1(this,"logs"),a$1(this,"level"),a$1(this,"levelValue"),a$1(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=t??"error",this.levelValue=browserExports.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=Hs,this.logs=new v$7(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(t,Hs){Hs===browserExports.levels.values.error?console.error(t):Hs===browserExports.levels.values.warn?console.warn(t):Hs===browserExports.levels.values.debug?console.debug(t):Hs===browserExports.levels.values.trace?console.trace(t):console.log(t)}appendToLogs(t){this.logs.append(safeJsonStringify({timestamp:new Date().toISOString(),log:t}));const Hs=typeof t=="string"?JSON.parse(t).level:t.level;Hs>=this.levelValue&&this.forwardToConsole(t,Hs)}getLogs(){return this.logs}clearLogs(){this.logs=new v$7(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(t){const Hs=this.getLogArray();return Hs.push(safeJsonStringify({extraMetadata:t})),new Blob(Hs,{type:"application/json"})}};var z$2=Object.defineProperty,T$1=(Z,t,Hs)=>t in Z?z$2(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,k$2=(Z,t,Hs)=>T$1(Z,typeof t!="symbol"?t+"":t,Hs);class E{constructor(t,Hs=i$1){k$2(this,"baseChunkLogger"),this.baseChunkLogger=new L$1(t,Hs)}write(t){this.baseChunkLogger.appendToLogs(t)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(t){return this.baseChunkLogger.logsToBlob(t)}downloadLogsBlobInBrowser(t){const Hs=URL.createObjectURL(this.logsToBlob(t)),zs=document.createElement("a");zs.href=Hs,zs.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(zs),zs.click(),document.body.removeChild(zs),URL.revokeObjectURL(Hs)}}var A$1=Object.defineProperty,$$2=(Z,t,Hs)=>t in Z?A$1(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,N$3=(Z,t,Hs)=>$$2(Z,typeof t!="symbol"?t+"":t,Hs);let j$2=class{constructor(t,Hs=i$1){N$3(this,"baseChunkLogger"),this.baseChunkLogger=new L$1(t,Hs)}write(t){this.baseChunkLogger.appendToLogs(t)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(t){return this.baseChunkLogger.logsToBlob(t)}};var P$4=Object.defineProperty,V$2=Object.defineProperties,G$2=Object.getOwnPropertyDescriptors,p$2=Object.getOwnPropertySymbols,M$4=Object.prototype.hasOwnProperty,U$2=Object.prototype.propertyIsEnumerable,f$4=(Z,t,Hs)=>t in Z?P$4(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,g=(Z,t)=>{for(var Hs in t||(t={}))M$4.call(t,Hs)&&f$4(Z,Hs,t[Hs]);if(p$2)for(var Hs of p$2(t))U$2.call(t,Hs)&&f$4(Z,Hs,t[Hs]);return Z},h$2=(Z,t)=>V$2(Z,G$2(t));function D$1(Z){return h$2(g({},Z),{level:(Z==null?void 0:Z.level)||b$2.level})}function y$1(Z,t,Hs=l){return Z[Hs]=t,Z}function w$1(Z,t=l){return Z[t]||""}function m$4(Z,t,Hs=l){const zs=w$1(Z,Hs);return zs.trim()?`${zs}/${t}`:t}function X$2(Z,t,Hs=l){const zs=m$4(Z,t,Hs),Ys=Z.child({context:zs});return y$1(Ys,zs,Hs)}function I$1(Z){var t,Hs;const zs=new E((t=Z.opts)==null?void 0:t.level,Z.maxSizeInBytes);return{logger:c$2(h$2(g({},Z.opts),{level:"trace",browser:h$2(g({},(Hs=Z.opts)==null?void 0:Hs.browser),{write:Ys=>zs.write(Ys)})})),chunkLoggerController:zs}}function O$3(Z){var t;const Hs=new j$2((t=Z.opts)==null?void 0:t.level,Z.maxSizeInBytes);return{logger:c$2(h$2(g({},Z.opts),{level:"trace"}),Hs),chunkLoggerController:Hs}}function Y$1(Z){return typeof Z.loggerOverride<"u"&&typeof Z.loggerOverride!="string"?{logger:Z.loggerOverride,chunkLoggerController:null}:typeof window<"u"?I$1(Z):O$3(Z)}var a=Object.defineProperty,u=(Z,t,Hs)=>t in Z?a(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,c$1=(Z,t,Hs)=>u(Z,typeof t!="symbol"?t+"":t,Hs);let h$1=class extends IEvents{constructor(t){super(),this.opts=t,c$1(this,"protocol","wc"),c$1(this,"version",2)}};var p$1=Object.defineProperty,b$1=(Z,t,Hs)=>t in Z?p$1(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,v$6=(Z,t,Hs)=>b$1(Z,typeof t!="symbol"?t+"":t,Hs);class I extends IEvents{constructor(t,Hs){super(),this.core=t,this.logger=Hs,v$6(this,"records",new Map)}}class y{constructor(t,Hs){this.logger=t,this.core=Hs}}let m$3=class extends IEvents{constructor(t,Hs){super(),this.relayer=t,this.logger=Hs}},d$2=class extends IEvents{constructor(t){super()}},f$3=class{constructor(t,Hs,zs,Ys){this.core=t,this.logger=Hs,this.name=zs}},P$3=class extends IEvents{constructor(t,Hs){super(),this.relayer=t,this.logger=Hs}},S$2=class extends IEvents{constructor(t,Hs){super(),this.core=t,this.logger=Hs}},M$3=class{constructor(t,Hs,zs){this.core=t,this.logger=Hs,this.store=zs}},O$2=class{constructor(t,Hs){this.projectId=t,this.logger=Hs}},R$2=class{constructor(t,Hs,zs){this.core=t,this.logger=Hs,this.telemetryEnabled=zs}};var T=Object.defineProperty,k$1=(Z,t,Hs)=>t in Z?T(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,i=(Z,t,Hs)=>k$1(Z,typeof t!="symbol"?t+"":t,Hs);let J$3=class{constructor(t){this.opts=t,i(this,"protocol","wc"),i(this,"version",2)}},V$1=class{constructor(t){this.client=t}};function En$2(Z){return Z instanceof Uint8Array||ArrayBuffer.isView(Z)&&Z.constructor.name==="Uint8Array"}function fe$2(Z,...t){if(!En$2(Z))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(Z.length))throw new Error("Uint8Array expected of length "+t+", got length="+Z.length)}function De$3(Z,t=!0){if(Z.destroyed)throw new Error("Hash instance has been destroyed");if(t&&Z.finished)throw new Error("Hash#digest() has already been called")}function gn$2(Z,t){fe$2(Z);const Hs=t.outputLen;if(Z.length<Hs)throw new Error("digestInto() expects output buffer of length at least "+Hs)}const it$1=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _t$3=Z=>new DataView(Z.buffer,Z.byteOffset,Z.byteLength);function yn$2(Z){if(typeof Z!="string")throw new Error("utf8ToBytes expected string, got "+typeof Z);return new Uint8Array(new TextEncoder().encode(Z))}function de$1(Z){return typeof Z=="string"&&(Z=yn$2(Z)),fe$2(Z),Z}let xn$2=class{clone(){return this._cloneInto()}};function Bn$2(Z){const t=zs=>Z().update(de$1(zs)).digest(),Hs=Z();return t.outputLen=Hs.outputLen,t.blockLen=Hs.blockLen,t.create=()=>Z(),t}function he$2(Z=32){if(it$1&&typeof it$1.getRandomValues=="function")return it$1.getRandomValues(new Uint8Array(Z));if(it$1&&typeof it$1.randomBytes=="function")return it$1.randomBytes(Z);throw new Error("crypto.getRandomValues must be defined")}function Cn$2(Z,t,Hs,zs){if(typeof Z.setBigUint64=="function")return Z.setBigUint64(t,Hs,zs);const Ys=BigInt(32),Zs=BigInt(4294967295),_u=Number(Hs>>Ys&Zs),Eu=Number(Hs&Zs),Iu=zs?4:0,Au=zs?0:4;Z.setUint32(t+Iu,_u,zs),Z.setUint32(t+Au,Eu,zs)}let An$2=class extends xn$2{constructor(t,Hs,zs,Ys){super(),this.blockLen=t,this.outputLen=Hs,this.padOffset=zs,this.isLE=Ys,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=_t$3(this.buffer)}update(t){De$3(this);const{view:Hs,buffer:zs,blockLen:Ys}=this;t=de$1(t);const Zs=t.length;for(let _u=0;_u<Zs;){const Eu=Math.min(Ys-this.pos,Zs-_u);if(Eu===Ys){const Iu=_t$3(t);for(;Ys<=Zs-_u;_u+=Ys)this.process(Iu,_u);continue}zs.set(t.subarray(_u,_u+Eu),this.pos),this.pos+=Eu,_u+=Eu,this.pos===Ys&&(this.process(Hs,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){De$3(this),gn$2(t,this),this.finished=!0;const{buffer:Hs,view:zs,blockLen:Ys,isLE:Zs}=this;let{pos:_u}=this;Hs[_u++]=128,this.buffer.subarray(_u).fill(0),this.padOffset>Ys-_u&&(this.process(zs,0),_u=0);for(let vu=_u;vu<Ys;vu++)Hs[vu]=0;Cn$2(zs,Ys-8,BigInt(this.length*8),Zs),this.process(zs,0);const Eu=_t$3(t),Iu=this.outputLen;if(Iu%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const Au=Iu/4,$u=this.get();if(Au>$u.length)throw new Error("_sha2: outputLen bigger than state");for(let vu=0;vu<Au;vu++)Eu.setUint32(4*vu,$u[vu],Zs)}digest(){const{buffer:t,outputLen:Hs}=this;this.digestInto(t);const zs=t.slice(0,Hs);return this.destroy(),zs}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:Hs,buffer:zs,length:Ys,finished:Zs,destroyed:_u,pos:Eu}=this;return t.length=Ys,t.pos=Eu,t.finished=Zs,t.destroyed=_u,Ys%Hs&&t.buffer.set(zs),t}};const wt$2=BigInt(2**32-1),St$4=BigInt(32);function le$1(Z,t=!1){return t?{h:Number(Z&wt$2),l:Number(Z>>St$4&wt$2)}:{h:Number(Z>>St$4&wt$2)|0,l:Number(Z&wt$2)|0}}function mn$2(Z,t=!1){let Hs=new Uint32Array(Z.length),zs=new Uint32Array(Z.length);for(let Ys=0;Ys<Z.length;Ys++){const{h:Zs,l:_u}=le$1(Z[Ys],t);[Hs[Ys],zs[Ys]]=[Zs,_u]}return[Hs,zs]}const _n$3=(Z,t)=>BigInt(Z>>>0)<<St$4|BigInt(t>>>0),Sn$2=(Z,t,Hs)=>Z>>>Hs,vn$2=(Z,t,Hs)=>Z<<32-Hs|t>>>Hs,In$2=(Z,t,Hs)=>Z>>>Hs|t<<32-Hs,Un$2=(Z,t,Hs)=>Z<<32-Hs|t>>>Hs,Tn$2=(Z,t,Hs)=>Z<<64-Hs|t>>>Hs-32,Fn$2=(Z,t,Hs)=>Z>>>Hs-32|t<<64-Hs,Nn$2=(Z,t)=>t,Ln$2=(Z,t)=>Z,On$2=(Z,t,Hs)=>Z<<Hs|t>>>32-Hs,Hn$2=(Z,t,Hs)=>t<<Hs|Z>>>32-Hs,zn$2=(Z,t,Hs)=>t<<Hs-32|Z>>>64-Hs,Mn$2=(Z,t,Hs)=>Z<<Hs-32|t>>>64-Hs;function qn$2(Z,t,Hs,zs){const Ys=(t>>>0)+(zs>>>0);return{h:Z+Hs+(Ys/2**32|0)|0,l:Ys|0}}const $n$2=(Z,t,Hs)=>(Z>>>0)+(t>>>0)+(Hs>>>0),kn$2=(Z,t,Hs,zs)=>t+Hs+zs+(Z/2**32|0)|0,Rn$2=(Z,t,Hs,zs)=>(Z>>>0)+(t>>>0)+(Hs>>>0)+(zs>>>0),jn$2=(Z,t,Hs,zs,Ys)=>t+Hs+zs+Ys+(Z/2**32|0)|0,Zn$2=(Z,t,Hs,zs,Ys)=>(Z>>>0)+(t>>>0)+(Hs>>>0)+(zs>>>0)+(Ys>>>0),Gn$2=(Z,t,Hs,zs,Ys,Zs)=>t+Hs+zs+Ys+Zs+(Z/2**32|0)|0,x$2={fromBig:le$1,split:mn$2,toBig:_n$3,shrSH:Sn$2,shrSL:vn$2,rotrSH:In$2,rotrSL:Un$2,rotrBH:Tn$2,rotrBL:Fn$2,rotr32H:Nn$2,rotr32L:Ln$2,rotlSH:On$2,rotlSL:Hn$2,rotlBH:zn$2,rotlBL:Mn$2,add:qn$2,add3L:$n$2,add3H:kn$2,add4L:Rn$2,add4H:jn$2,add5H:Gn$2,add5L:Zn$2},[Vn$2,Yn$2]=(()=>x$2.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(Z=>BigInt(Z))))(),P$2=new Uint32Array(80),Q$1=new Uint32Array(80);let Jn$2=class extends An$2{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:t,Al:Hs,Bh:zs,Bl:Ys,Ch:Zs,Cl:_u,Dh:Eu,Dl:Iu,Eh:Au,El:$u,Fh:vu,Fl:Su,Gh:Ru,Gl:Pu,Hh:Cu,Hl:Bu}=this;return[t,Hs,zs,Ys,Zs,_u,Eu,Iu,Au,$u,vu,Su,Ru,Pu,Cu,Bu]}set(t,Hs,zs,Ys,Zs,_u,Eu,Iu,Au,$u,vu,Su,Ru,Pu,Cu,Bu){this.Ah=t|0,this.Al=Hs|0,this.Bh=zs|0,this.Bl=Ys|0,this.Ch=Zs|0,this.Cl=_u|0,this.Dh=Eu|0,this.Dl=Iu|0,this.Eh=Au|0,this.El=$u|0,this.Fh=vu|0,this.Fl=Su|0,this.Gh=Ru|0,this.Gl=Pu|0,this.Hh=Cu|0,this.Hl=Bu|0}process(t,Hs){for(let Hu=0;Hu<16;Hu++,Hs+=4)P$2[Hu]=t.getUint32(Hs),Q$1[Hu]=t.getUint32(Hs+=4);for(let Hu=16;Hu<80;Hu++){const Wu=P$2[Hu-15]|0,tl=Q$1[Hu-15]|0,Xu=x$2.rotrSH(Wu,tl,1)^x$2.rotrSH(Wu,tl,8)^x$2.shrSH(Wu,tl,7),ju=x$2.rotrSL(Wu,tl,1)^x$2.rotrSL(Wu,tl,8)^x$2.shrSL(Wu,tl,7),ku=P$2[Hu-2]|0,Uu=Q$1[Hu-2]|0,Gu=x$2.rotrSH(ku,Uu,19)^x$2.rotrBH(ku,Uu,61)^x$2.shrSH(ku,Uu,6),Yu=x$2.rotrSL(ku,Uu,19)^x$2.rotrBL(ku,Uu,61)^x$2.shrSL(ku,Uu,6),Qu=x$2.add4L(ju,Yu,Q$1[Hu-7],Q$1[Hu-16]),Lu=x$2.add4H(Qu,Xu,Gu,P$2[Hu-7],P$2[Hu-16]);P$2[Hu]=Lu|0,Q$1[Hu]=Qu|0}let{Ah:zs,Al:Ys,Bh:Zs,Bl:_u,Ch:Eu,Cl:Iu,Dh:Au,Dl:$u,Eh:vu,El:Su,Fh:Ru,Fl:Pu,Gh:Cu,Gl:Bu,Hh:Fu,Hl:zu}=this;for(let Hu=0;Hu<80;Hu++){const Wu=x$2.rotrSH(vu,Su,14)^x$2.rotrSH(vu,Su,18)^x$2.rotrBH(vu,Su,41),tl=x$2.rotrSL(vu,Su,14)^x$2.rotrSL(vu,Su,18)^x$2.rotrBL(vu,Su,41),Xu=vu&Ru^~vu&Cu,ju=Su&Pu^~Su&Bu,ku=x$2.add5L(zu,tl,ju,Yn$2[Hu],Q$1[Hu]),Uu=x$2.add5H(ku,Fu,Wu,Xu,Vn$2[Hu],P$2[Hu]),Gu=ku|0,Yu=x$2.rotrSH(zs,Ys,28)^x$2.rotrBH(zs,Ys,34)^x$2.rotrBH(zs,Ys,39),Qu=x$2.rotrSL(zs,Ys,28)^x$2.rotrBL(zs,Ys,34)^x$2.rotrBL(zs,Ys,39),Lu=zs&Zs^zs&Eu^Zs&Eu,cl=Ys&_u^Ys&Iu^_u&Iu;Fu=Cu|0,zu=Bu|0,Cu=Ru|0,Bu=Pu|0,Ru=vu|0,Pu=Su|0,{h:vu,l:Su}=x$2.add(Au|0,$u|0,Uu|0,Gu|0),Au=Eu|0,$u=Iu|0,Eu=Zs|0,Iu=_u|0,Zs=zs|0,_u=Ys|0;const el=x$2.add3L(Gu,Qu,cl);zs=x$2.add3H(el,Uu,Yu,Lu),Ys=el|0}({h:zs,l:Ys}=x$2.add(this.Ah|0,this.Al|0,zs|0,Ys|0)),{h:Zs,l:_u}=x$2.add(this.Bh|0,this.Bl|0,Zs|0,_u|0),{h:Eu,l:Iu}=x$2.add(this.Ch|0,this.Cl|0,Eu|0,Iu|0),{h:Au,l:$u}=x$2.add(this.Dh|0,this.Dl|0,Au|0,$u|0),{h:vu,l:Su}=x$2.add(this.Eh|0,this.El|0,vu|0,Su|0),{h:Ru,l:Pu}=x$2.add(this.Fh|0,this.Fl|0,Ru|0,Pu|0),{h:Cu,l:Bu}=x$2.add(this.Gh|0,this.Gl|0,Cu|0,Bu|0),{h:Fu,l:zu}=x$2.add(this.Hh|0,this.Hl|0,Fu|0,zu|0),this.set(zs,Ys,Zs,_u,Eu,Iu,Au,$u,vu,Su,Ru,Pu,Cu,Bu,Fu,zu)}roundClean(){P$2.fill(0),Q$1.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const Kn$2=Bn$2(()=>new Jn$2);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const vt$3=BigInt(0),be$2=BigInt(1),Wn$2=BigInt(2);function It$4(Z){return Z instanceof Uint8Array||ArrayBuffer.isView(Z)&&Z.constructor.name==="Uint8Array"}function Ut$3(Z){if(!It$4(Z))throw new Error("Uint8Array expected")}function Tt$3(Z,t){if(typeof t!="boolean")throw new Error(Z+" boolean expected, got "+t)}const Xn$2=Array.from({length:256},(Z,t)=>t.toString(16).padStart(2,"0"));function Ft$2(Z){Ut$3(Z);let t="";for(let Hs=0;Hs<Z.length;Hs++)t+=Xn$2[Z[Hs]];return t}function pe$2(Z){if(typeof Z!="string")throw new Error("hex string expected, got "+typeof Z);return Z===""?vt$3:BigInt("0x"+Z)}const K$2={_0:48,_9:57,A:65,F:70,a:97,f:102};function we$2(Z){if(Z>=K$2._0&&Z<=K$2._9)return Z-K$2._0;if(Z>=K$2.A&&Z<=K$2.F)return Z-(K$2.A-10);if(Z>=K$2.a&&Z<=K$2.f)return Z-(K$2.a-10)}function Ee$1(Z){if(typeof Z!="string")throw new Error("hex string expected, got "+typeof Z);const t=Z.length,Hs=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const zs=new Uint8Array(Hs);for(let Ys=0,Zs=0;Ys<Hs;Ys++,Zs+=2){const _u=we$2(Z.charCodeAt(Zs)),Eu=we$2(Z.charCodeAt(Zs+1));if(_u===void 0||Eu===void 0){const Iu=Z[Zs]+Z[Zs+1];throw new Error('hex string expected, got non-hex character "'+Iu+'" at index '+Zs)}zs[Ys]=_u*16+Eu}return zs}function Pn$2(Z){return pe$2(Ft$2(Z))}function Et$4(Z){return Ut$3(Z),pe$2(Ft$2(Uint8Array.from(Z).reverse()))}function ge$2(Z,t){return Ee$1(Z.toString(16).padStart(t*2,"0"))}function Nt$2(Z,t){return ge$2(Z,t).reverse()}function W$3(Z,t,Hs){let zs;if(typeof t=="string")try{zs=Ee$1(t)}catch(Zs){throw new Error(Z+" must be hex string or Uint8Array, cause: "+Zs)}else if(It$4(t))zs=Uint8Array.from(t);else throw new Error(Z+" must be hex string or Uint8Array");const Ys=zs.length;if(typeof Hs=="number"&&Ys!==Hs)throw new Error(Z+" of length "+Hs+" expected, got "+Ys);return zs}function ye$2(...Z){let t=0;for(let zs=0;zs<Z.length;zs++){const Ys=Z[zs];Ut$3(Ys),t+=Ys.length}const Hs=new Uint8Array(t);for(let zs=0,Ys=0;zs<Z.length;zs++){const Zs=Z[zs];Hs.set(Zs,Ys),Ys+=Zs.length}return Hs}const Lt$3=Z=>typeof Z=="bigint"&&vt$3<=Z;function Qn$1(Z,t,Hs){return Lt$3(Z)&&Lt$3(t)&&Lt$3(Hs)&&t<=Z&&Z<Hs}function ft$3(Z,t,Hs,zs){if(!Qn$1(t,Hs,zs))throw new Error("expected valid "+Z+": "+Hs+" <= n < "+zs+", got "+t)}function tr(Z){let t;for(t=0;Z>vt$3;Z>>=be$2,t+=1);return t}const er=Z=>(Wn$2<<BigInt(Z-1))-be$2,nr$1={bigint:Z=>typeof Z=="bigint",function:Z=>typeof Z=="function",boolean:Z=>typeof Z=="boolean",string:Z=>typeof Z=="string",stringOrUint8Array:Z=>typeof Z=="string"||It$4(Z),isSafeInteger:Z=>Number.isSafeInteger(Z),array:Z=>Array.isArray(Z),field:(Z,t)=>t.Fp.isValid(Z),hash:Z=>typeof Z=="function"&&Number.isSafeInteger(Z.outputLen)};function Ot$2(Z,t,Hs={}){const zs=(Ys,Zs,_u)=>{const Eu=nr$1[Zs];if(typeof Eu!="function")throw new Error("invalid validator function");const Iu=Z[Ys];if(!(_u&&Iu===void 0)&&!Eu(Iu,Z))throw new Error("param "+String(Ys)+" is invalid. Expected "+Zs+", got "+Iu)};for(const[Ys,Zs]of Object.entries(t))zs(Ys,Zs,!1);for(const[Ys,Zs]of Object.entries(Hs))zs(Ys,Zs,!0);return Z}function xe$1(Z){const t=new WeakMap;return(Hs,...zs)=>{const Ys=t.get(Hs);if(Ys!==void 0)return Ys;const Zs=Z(Hs,...zs);return t.set(Hs,Zs),Zs}}const M$2=BigInt(0),N$2=BigInt(1),nt$2=BigInt(2),rr$1=BigInt(3),Ht$4=BigInt(4),Be$2=BigInt(5),Ce$1=BigInt(8);function H(Z,t){const Hs=Z%t;return Hs>=M$2?Hs:t+Hs}function or$3(Z,t,Hs){if(t<M$2)throw new Error("invalid exponent, negatives unsupported");if(Hs<=M$2)throw new Error("invalid modulus");if(Hs===N$2)return M$2;let zs=N$2;for(;t>M$2;)t&N$2&&(zs=zs*Z%Hs),Z=Z*Z%Hs,t>>=N$2;return zs}function J$2(Z,t,Hs){let zs=Z;for(;t-- >M$2;)zs*=zs,zs%=Hs;return zs}function Ae$1(Z,t){if(Z===M$2)throw new Error("invert: expected non-zero number");if(t<=M$2)throw new Error("invert: expected positive modulus, got "+t);let Hs=H(Z,t),zs=t,Ys=M$2,Zs=N$2;for(;Hs!==M$2;){const _u=zs/Hs,Eu=zs%Hs,Iu=Ys-Zs*_u;zs=Hs,Hs=Eu,Ys=Zs,Zs=Iu}if(zs!==N$2)throw new Error("invert: does not exist");return H(Ys,t)}function sr$1(Z){const t=(Z-N$2)/nt$2;let Hs,zs,Ys;for(Hs=Z-N$2,zs=0;Hs%nt$2===M$2;Hs/=nt$2,zs++);for(Ys=nt$2;Ys<Z&&or$3(Ys,t,Z)!==Z-N$2;Ys++)if(Ys>1e3)throw new Error("Cannot find square root: likely non-prime P");if(zs===1){const _u=(Z+N$2)/Ht$4;return function(Eu,Iu){const Au=Eu.pow(Iu,_u);if(!Eu.eql(Eu.sqr(Au),Iu))throw new Error("Cannot find square root");return Au}}const Zs=(Hs+N$2)/nt$2;return function(_u,Eu){if(_u.pow(Eu,t)===_u.neg(_u.ONE))throw new Error("Cannot find square root");let Iu=zs,Au=_u.pow(_u.mul(_u.ONE,Ys),Hs),$u=_u.pow(Eu,Zs),vu=_u.pow(Eu,Hs);for(;!_u.eql(vu,_u.ONE);){if(_u.eql(vu,_u.ZERO))return _u.ZERO;let Su=1;for(let Pu=_u.sqr(vu);Su<Iu&&!_u.eql(Pu,_u.ONE);Su++)Pu=_u.sqr(Pu);const Ru=_u.pow(Au,N$2<<BigInt(Iu-Su-1));Au=_u.sqr(Ru),$u=_u.mul($u,Ru),vu=_u.mul(vu,Au),Iu=Su}return $u}}function ir$2(Z){if(Z%Ht$4===rr$1){const t=(Z+N$2)/Ht$4;return function(Hs,zs){const Ys=Hs.pow(zs,t);if(!Hs.eql(Hs.sqr(Ys),zs))throw new Error("Cannot find square root");return Ys}}if(Z%Ce$1===Be$2){const t=(Z-Be$2)/Ce$1;return function(Hs,zs){const Ys=Hs.mul(zs,nt$2),Zs=Hs.pow(Ys,t),_u=Hs.mul(zs,Zs),Eu=Hs.mul(Hs.mul(_u,nt$2),Zs),Iu=Hs.mul(_u,Hs.sub(Eu,Hs.ONE));if(!Hs.eql(Hs.sqr(Iu),zs))throw new Error("Cannot find square root");return Iu}}return sr$1(Z)}const ur$2=(Z,t)=>(H(Z,t)&N$2)===N$2,cr$2=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function ar$2(Z){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},Hs=cr$2.reduce((zs,Ys)=>(zs[Ys]="function",zs),t);return Ot$2(Z,Hs)}function fr$2(Z,t,Hs){if(Hs<M$2)throw new Error("invalid exponent, negatives unsupported");if(Hs===M$2)return Z.ONE;if(Hs===N$2)return t;let zs=Z.ONE,Ys=t;for(;Hs>M$2;)Hs&N$2&&(zs=Z.mul(zs,Ys)),Ys=Z.sqr(Ys),Hs>>=N$2;return zs}function Dr$2(Z,t){const Hs=new Array(t.length),zs=t.reduce((Zs,_u,Eu)=>Z.is0(_u)?Zs:(Hs[Eu]=Zs,Z.mul(Zs,_u)),Z.ONE),Ys=Z.inv(zs);return t.reduceRight((Zs,_u,Eu)=>Z.is0(_u)?Zs:(Hs[Eu]=Z.mul(Zs,Hs[Eu]),Z.mul(Zs,_u)),Ys),Hs}function me$3(Z,t){const Hs=t!==void 0?t:Z.toString(2).length,zs=Math.ceil(Hs/8);return{nBitLength:Hs,nByteLength:zs}}function _e$3(Z,t,Hs=!1,zs={}){if(Z<=M$2)throw new Error("invalid field: expected ORDER > 0, got "+Z);const{nBitLength:Ys,nByteLength:Zs}=me$3(Z,t);if(Zs>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let _u;const Eu=Object.freeze({ORDER:Z,isLE:Hs,BITS:Ys,BYTES:Zs,MASK:er(Ys),ZERO:M$2,ONE:N$2,create:Iu=>H(Iu,Z),isValid:Iu=>{if(typeof Iu!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof Iu);return M$2<=Iu&&Iu<Z},is0:Iu=>Iu===M$2,isOdd:Iu=>(Iu&N$2)===N$2,neg:Iu=>H(-Iu,Z),eql:(Iu,Au)=>Iu===Au,sqr:Iu=>H(Iu*Iu,Z),add:(Iu,Au)=>H(Iu+Au,Z),sub:(Iu,Au)=>H(Iu-Au,Z),mul:(Iu,Au)=>H(Iu*Au,Z),pow:(Iu,Au)=>fr$2(Eu,Iu,Au),div:(Iu,Au)=>H(Iu*Ae$1(Au,Z),Z),sqrN:Iu=>Iu*Iu,addN:(Iu,Au)=>Iu+Au,subN:(Iu,Au)=>Iu-Au,mulN:(Iu,Au)=>Iu*Au,inv:Iu=>Ae$1(Iu,Z),sqrt:zs.sqrt||(Iu=>(_u||(_u=ir$2(Z)),_u(Eu,Iu))),invertBatch:Iu=>Dr$2(Eu,Iu),cmov:(Iu,Au,$u)=>$u?Au:Iu,toBytes:Iu=>Hs?Nt$2(Iu,Zs):ge$2(Iu,Zs),fromBytes:Iu=>{if(Iu.length!==Zs)throw new Error("Field.fromBytes: expected "+Zs+" bytes, got "+Iu.length);return Hs?Et$4(Iu):Pn$2(Iu)}});return Object.freeze(Eu)}const Se$2=BigInt(0),gt$3=BigInt(1);function zt$3(Z,t){const Hs=t.negate();return Z?Hs:t}function ve$2(Z,t){if(!Number.isSafeInteger(Z)||Z<=0||Z>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+Z)}function Mt$2(Z,t){ve$2(Z,t);const Hs=Math.ceil(t/Z)+1,zs=2**(Z-1);return{windows:Hs,windowSize:zs}}function dr$2(Z,t){if(!Array.isArray(Z))throw new Error("array expected");Z.forEach((Hs,zs)=>{if(!(Hs instanceof t))throw new Error("invalid point at index "+zs)})}function hr$2(Z,t){if(!Array.isArray(Z))throw new Error("array of scalars expected");Z.forEach((Hs,zs)=>{if(!t.isValid(Hs))throw new Error("invalid scalar at index "+zs)})}const qt$2=new WeakMap,Ie$1=new WeakMap;function $t$3(Z){return Ie$1.get(Z)||1}function lr$2(Z,t){return{constTimeNegate:zt$3,hasPrecomputes(Hs){return $t$3(Hs)!==1},unsafeLadder(Hs,zs,Ys=Z.ZERO){let Zs=Hs;for(;zs>Se$2;)zs&gt$3&&(Ys=Ys.add(Zs)),Zs=Zs.double(),zs>>=gt$3;return Ys},precomputeWindow(Hs,zs){const{windows:Ys,windowSize:Zs}=Mt$2(zs,t),_u=[];let Eu=Hs,Iu=Eu;for(let Au=0;Au<Ys;Au++){Iu=Eu,_u.push(Iu);for(let $u=1;$u<Zs;$u++)Iu=Iu.add(Eu),_u.push(Iu);Eu=Iu.double()}return _u},wNAF(Hs,zs,Ys){const{windows:Zs,windowSize:_u}=Mt$2(Hs,t);let Eu=Z.ZERO,Iu=Z.BASE;const Au=BigInt(2**Hs-1),$u=2**Hs,vu=BigInt(Hs);for(let Su=0;Su<Zs;Su++){const Ru=Su*_u;let Pu=Number(Ys&Au);Ys>>=vu,Pu>_u&&(Pu-=$u,Ys+=gt$3);const Cu=Ru,Bu=Ru+Math.abs(Pu)-1,Fu=Su%2!==0,zu=Pu<0;Pu===0?Iu=Iu.add(zt$3(Fu,zs[Cu])):Eu=Eu.add(zt$3(zu,zs[Bu]))}return{p:Eu,f:Iu}},wNAFUnsafe(Hs,zs,Ys,Zs=Z.ZERO){const{windows:_u,windowSize:Eu}=Mt$2(Hs,t),Iu=BigInt(2**Hs-1),Au=2**Hs,$u=BigInt(Hs);for(let vu=0;vu<_u;vu++){const Su=vu*Eu;if(Ys===Se$2)break;let Ru=Number(Ys&Iu);if(Ys>>=$u,Ru>Eu&&(Ru-=Au,Ys+=gt$3),Ru===0)continue;let Pu=zs[Su+Math.abs(Ru)-1];Ru<0&&(Pu=Pu.negate()),Zs=Zs.add(Pu)}return Zs},getPrecomputes(Hs,zs,Ys){let Zs=qt$2.get(zs);return Zs||(Zs=this.precomputeWindow(zs,Hs),Hs!==1&&qt$2.set(zs,Ys(Zs))),Zs},wNAFCached(Hs,zs,Ys){const Zs=$t$3(Hs);return this.wNAF(Zs,this.getPrecomputes(Zs,Hs,Ys),zs)},wNAFCachedUnsafe(Hs,zs,Ys,Zs){const _u=$t$3(Hs);return _u===1?this.unsafeLadder(Hs,zs,Zs):this.wNAFUnsafe(_u,this.getPrecomputes(_u,Hs,Ys),zs,Zs)},setWindowSize(Hs,zs){ve$2(zs,t),Ie$1.set(Hs,zs),qt$2.delete(Hs)}}}function br$2(Z,t,Hs,zs){if(dr$2(Hs,Z),hr$2(zs,t),Hs.length!==zs.length)throw new Error("arrays of points and scalars must have equal length");const Ys=Z.ZERO,Zs=tr(BigInt(Hs.length)),_u=Zs>12?Zs-3:Zs>4?Zs-2:Zs?2:1,Eu=(1<<_u)-1,Iu=new Array(Eu+1).fill(Ys),Au=Math.floor((t.BITS-1)/_u)*_u;let $u=Ys;for(let vu=Au;vu>=0;vu-=_u){Iu.fill(Ys);for(let Ru=0;Ru<zs.length;Ru++){const Pu=zs[Ru],Cu=Number(Pu>>BigInt(vu)&BigInt(Eu));Iu[Cu]=Iu[Cu].add(Hs[Ru])}let Su=Ys;for(let Ru=Iu.length-1,Pu=Ys;Ru>0;Ru--)Pu=Pu.add(Iu[Ru]),Su=Su.add(Pu);if($u=$u.add(Su),vu!==0)for(let Ru=0;Ru<_u;Ru++)$u=$u.double()}return $u}function pr$2(Z){return ar$2(Z.Fp),Ot$2(Z,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...me$3(Z.n,Z.nBitLength),...Z,p:Z.Fp.ORDER})}const G$1=BigInt(0),j$1=BigInt(1),yt$2=BigInt(2),wr$2=BigInt(8),Er$2={zip215:!0};function gr$2(Z){const t=pr$2(Z);return Ot$2(Z,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}function yr$2(Z){const t=gr$2(Z),{Fp:Hs,n:zs,prehash:Ys,hash:Zs,randomBytes:_u,nByteLength:Eu,h:Iu}=t,Au=yt$2<<BigInt(Eu*8)-j$1,$u=Hs.create,vu=_e$3(t.n,t.nBitLength),Su=t.uvRatio||((el,Zu)=>{try{return{isValid:!0,value:Hs.sqrt(el*Hs.inv(Zu))}}catch{return{isValid:!1,value:G$1}}}),Ru=t.adjustScalarBytes||(el=>el),Pu=t.domain||((el,Zu,dl)=>{if(Tt$3("phflag",dl),Zu.length||dl)throw new Error("Contexts/pre-hash are not supported");return el});function Cu(el,Zu){ft$3("coordinate "+el,Zu,G$1,Au)}function Bu(el){if(!(el instanceof Hu))throw new Error("ExtendedPoint expected")}const Fu=xe$1((el,Zu)=>{const{ex:dl,ey:El,ez:hl}=el,_l=el.is0();Zu==null&&(Zu=_l?wr$2:Hs.inv(hl));const Rl=$u(dl*Zu),ol=$u(El*Zu),gl=$u(hl*Zu);if(_l)return{x:G$1,y:j$1};if(gl!==j$1)throw new Error("invZ was invalid");return{x:Rl,y:ol}}),zu=xe$1(el=>{const{a:Zu,d:dl}=t;if(el.is0())throw new Error("bad point: ZERO");const{ex:El,ey:hl,ez:_l,et:Rl}=el,ol=$u(El*El),gl=$u(hl*hl),nl=$u(_l*_l),Sl=$u(nl*nl),ll=$u(ol*Zu),ul=$u(nl*$u(ll+gl)),Al=$u(Sl+$u(dl*$u(ol*gl)));if(ul!==Al)throw new Error("bad point: equation left != right (1)");const Tl=$u(El*hl),qu=$u(_l*Rl);if(Tl!==qu)throw new Error("bad point: equation left != right (2)");return!0});class Hu{constructor(Zu,dl,El,hl){this.ex=Zu,this.ey=dl,this.ez=El,this.et=hl,Cu("x",Zu),Cu("y",dl),Cu("z",El),Cu("t",hl),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(Zu){if(Zu instanceof Hu)throw new Error("extended point not allowed");const{x:dl,y:El}=Zu||{};return Cu("x",dl),Cu("y",El),new Hu(dl,El,j$1,$u(dl*El))}static normalizeZ(Zu){const dl=Hs.invertBatch(Zu.map(El=>El.ez));return Zu.map((El,hl)=>El.toAffine(dl[hl])).map(Hu.fromAffine)}static msm(Zu,dl){return br$2(Hu,vu,Zu,dl)}_setWindowSize(Zu){Xu.setWindowSize(this,Zu)}assertValidity(){zu(this)}equals(Zu){Bu(Zu);const{ex:dl,ey:El,ez:hl}=this,{ex:_l,ey:Rl,ez:ol}=Zu,gl=$u(dl*ol),nl=$u(_l*hl),Sl=$u(El*ol),ll=$u(Rl*hl);return gl===nl&&Sl===ll}is0(){return this.equals(Hu.ZERO)}negate(){return new Hu($u(-this.ex),this.ey,this.ez,$u(-this.et))}double(){const{a:Zu}=t,{ex:dl,ey:El,ez:hl}=this,_l=$u(dl*dl),Rl=$u(El*El),ol=$u(yt$2*$u(hl*hl)),gl=$u(Zu*_l),nl=dl+El,Sl=$u($u(nl*nl)-_l-Rl),ll=gl+Rl,ul=ll-ol,Al=gl-Rl,Tl=$u(Sl*ul),qu=$u(ll*Al),Ou=$u(Sl*Al),Vu=$u(ul*ll);return new Hu(Tl,qu,Vu,Ou)}add(Zu){Bu(Zu);const{a:dl,d:El}=t,{ex:hl,ey:_l,ez:Rl,et:ol}=this,{ex:gl,ey:nl,ez:Sl,et:ll}=Zu;if(dl===BigInt(-1)){const al=$u((_l-hl)*(nl+gl)),wl=$u((_l+hl)*(nl-gl)),Dl=$u(wl-al);if(Dl===G$1)return this.double();const Ll=$u(Rl*yt$2*ll),Fl=$u(ol*yt$2*Sl),ql=Fl+Ll,Gl=wl+al,Ql=Fl-Ll,Hl=$u(ql*Dl),jl=$u(Gl*Ql),rh=$u(ql*Ql),Ku=$u(Dl*Gl);return new Hu(Hl,jl,Ku,rh)}const ul=$u(hl*gl),Al=$u(_l*nl),Tl=$u(ol*El*ll),qu=$u(Rl*Sl),Ou=$u((hl+_l)*(gl+nl)-ul-Al),Vu=qu-Tl,il=qu+Tl,sl=$u(Al-dl*ul),pl=$u(Ou*Vu),yl=$u(il*sl),fl=$u(Ou*sl),bl=$u(Vu*il);return new Hu(pl,yl,bl,fl)}subtract(Zu){return this.add(Zu.negate())}wNAF(Zu){return Xu.wNAFCached(this,Zu,Hu.normalizeZ)}multiply(Zu){const dl=Zu;ft$3("scalar",dl,j$1,zs);const{p:El,f:hl}=this.wNAF(dl);return Hu.normalizeZ([El,hl])[0]}multiplyUnsafe(Zu,dl=Hu.ZERO){const El=Zu;return ft$3("scalar",El,G$1,zs),El===G$1?tl:this.is0()||El===j$1?this:Xu.wNAFCachedUnsafe(this,El,Hu.normalizeZ,dl)}isSmallOrder(){return this.multiplyUnsafe(Iu).is0()}isTorsionFree(){return Xu.unsafeLadder(this,zs).is0()}toAffine(Zu){return Fu(this,Zu)}clearCofactor(){const{h:Zu}=t;return Zu===j$1?this:this.multiplyUnsafe(Zu)}static fromHex(Zu,dl=!1){const{d:El,a:hl}=t,_l=Hs.BYTES;Zu=W$3("pointHex",Zu,_l),Tt$3("zip215",dl);const Rl=Zu.slice(),ol=Zu[_l-1];Rl[_l-1]=ol&-129;const gl=Et$4(Rl),nl=dl?Au:Hs.ORDER;ft$3("pointHex.y",gl,G$1,nl);const Sl=$u(gl*gl),ll=$u(Sl-j$1),ul=$u(El*Sl-hl);let{isValid:Al,value:Tl}=Su(ll,ul);if(!Al)throw new Error("Point.fromHex: invalid y coordinate");const qu=(Tl&j$1)===j$1,Ou=(ol&128)!==0;if(!dl&&Tl===G$1&&Ou)throw new Error("Point.fromHex: x=0 and x_0=1");return Ou!==qu&&(Tl=$u(-Tl)),Hu.fromAffine({x:Tl,y:gl})}static fromPrivateKey(Zu){return Uu(Zu).point}toRawBytes(){const{x:Zu,y:dl}=this.toAffine(),El=Nt$2(dl,Hs.BYTES);return El[El.length-1]|=Zu&j$1?128:0,El}toHex(){return Ft$2(this.toRawBytes())}}Hu.BASE=new Hu(t.Gx,t.Gy,j$1,$u(t.Gx*t.Gy)),Hu.ZERO=new Hu(G$1,j$1,j$1,G$1);const{BASE:Wu,ZERO:tl}=Hu,Xu=lr$2(Hu,Eu*8);function ju(el){return H(el,zs)}function ku(el){return ju(Et$4(el))}function Uu(el){const Zu=Hs.BYTES;el=W$3("private key",el,Zu);const dl=W$3("hashed private key",Zs(el),2*Zu),El=Ru(dl.slice(0,Zu)),hl=dl.slice(Zu,2*Zu),_l=ku(El),Rl=Wu.multiply(_l),ol=Rl.toRawBytes();return{head:El,prefix:hl,scalar:_l,point:Rl,pointBytes:ol}}function Gu(el){return Uu(el).pointBytes}function Yu(el=new Uint8Array,...Zu){const dl=ye$2(...Zu);return ku(Zs(Pu(dl,W$3("context",el),!!Ys)))}function Qu(el,Zu,dl={}){el=W$3("message",el),Ys&&(el=Ys(el));const{prefix:El,scalar:hl,pointBytes:_l}=Uu(Zu),Rl=Yu(dl.context,El,el),ol=Wu.multiply(Rl).toRawBytes(),gl=Yu(dl.context,ol,_l,el),nl=ju(Rl+gl*hl);ft$3("signature.s",nl,G$1,zs);const Sl=ye$2(ol,Nt$2(nl,Hs.BYTES));return W$3("result",Sl,Hs.BYTES*2)}const Lu=Er$2;function cl(el,Zu,dl,El=Lu){const{context:hl,zip215:_l}=El,Rl=Hs.BYTES;el=W$3("signature",el,2*Rl),Zu=W$3("message",Zu),dl=W$3("publicKey",dl,Rl),_l!==void 0&&Tt$3("zip215",_l),Ys&&(Zu=Ys(Zu));const ol=Et$4(el.slice(Rl,2*Rl));let gl,nl,Sl;try{gl=Hu.fromHex(dl,_l),nl=Hu.fromHex(el.slice(0,Rl),_l),Sl=Wu.multiplyUnsafe(ol)}catch{return!1}if(!_l&&gl.isSmallOrder())return!1;const ll=Yu(hl,nl.toRawBytes(),gl.toRawBytes(),Zu);return nl.add(gl.multiplyUnsafe(ll)).subtract(Sl).clearCofactor().equals(Hu.ZERO)}return Wu._setWindowSize(8),{CURVE:t,getPublicKey:Gu,sign:Qu,verify:cl,ExtendedPoint:Hu,utils:{getExtendedPublicKey:Uu,randomPrivateKey:()=>_u(Hs.BYTES),precompute(el=8,Zu=Hu.BASE){return Zu._setWindowSize(el),Zu.multiply(BigInt(3)),Zu}}}}BigInt(0),BigInt(1);const kt$2=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Ue$2=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const xr$2=BigInt(1),Te$1=BigInt(2);BigInt(3);const Br$2=BigInt(5),Cr$2=BigInt(8);function Ar$2(Z){const t=BigInt(10),Hs=BigInt(20),zs=BigInt(40),Ys=BigInt(80),Zs=kt$2,_u=Z*Z%Zs*Z%Zs,Eu=J$2(_u,Te$1,Zs)*_u%Zs,Iu=J$2(Eu,xr$2,Zs)*Z%Zs,Au=J$2(Iu,Br$2,Zs)*Iu%Zs,$u=J$2(Au,t,Zs)*Au%Zs,vu=J$2($u,Hs,Zs)*$u%Zs,Su=J$2(vu,zs,Zs)*vu%Zs,Ru=J$2(Su,Ys,Zs)*Su%Zs,Pu=J$2(Ru,Ys,Zs)*Su%Zs,Cu=J$2(Pu,t,Zs)*Au%Zs;return{pow_p_5_8:J$2(Cu,Te$1,Zs)*Z%Zs,b2:_u}}function mr$2(Z){return Z[0]&=248,Z[31]&=127,Z[31]|=64,Z}function _r$2(Z,t){const Hs=kt$2,zs=H(t*t*t,Hs),Ys=H(zs*zs*t,Hs),Zs=Ar$2(Z*Ys).pow_p_5_8;let _u=H(Z*zs*Zs,Hs);const Eu=H(t*_u*_u,Hs),Iu=_u,Au=H(_u*Ue$2,Hs),$u=Eu===Z,vu=Eu===H(-Z,Hs),Su=Eu===H(-Z*Ue$2,Hs);return $u&&(_u=Iu),(vu||Su)&&(_u=Au),ur$2(_u,Hs)&&(_u=H(-_u,Hs)),{isValid:$u||vu,value:_u}}const Sr$2=(()=>_e$3(kt$2,void 0,!0))(),vr$2=(()=>({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Sr$2,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:Cr$2,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Kn$2,randomBytes:he$2,adjustScalarBytes:mr$2,uvRatio:_r$2}))(),Rt$4=(()=>yr$2(vr$2))(),jt$3="EdDSA",Zt$3="JWT",ut$3=".",Dt$2="base64url",Gt$3="utf8",xt$2="utf8",Vt$3=":",Yt$2="did",Jt$3="key",dt$2="base58btc",Kt$2="z",Wt$3="K36",Ne$1=32;function Xt$3(Z){return globalThis.Buffer!=null?new Uint8Array(Z.buffer,Z.byteOffset,Z.byteLength):Z}function Le$2(Z=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Xt$3(globalThis.Buffer.allocUnsafe(Z)):new Uint8Array(Z)}function Oe$2(Z,t){t||(t=Z.reduce((Ys,Zs)=>Ys+Zs.length,0));const Hs=Le$2(t);let zs=0;for(const Ys of Z)Hs.set(Ys,zs),zs+=Ys.length;return Xt$3(Hs)}function Ir$2(Z,t){if(Z.length>=255)throw new TypeError("Alphabet too long");for(var Hs=new Uint8Array(256),zs=0;zs<Hs.length;zs++)Hs[zs]=255;for(var Ys=0;Ys<Z.length;Ys++){var Zs=Z.charAt(Ys),_u=Zs.charCodeAt(0);if(Hs[_u]!==255)throw new TypeError(Zs+" is ambiguous");Hs[_u]=Ys}var Eu=Z.length,Iu=Z.charAt(0),Au=Math.log(Eu)/Math.log(256),$u=Math.log(256)/Math.log(Eu);function vu(Pu){if(Pu instanceof Uint8Array||(ArrayBuffer.isView(Pu)?Pu=new Uint8Array(Pu.buffer,Pu.byteOffset,Pu.byteLength):Array.isArray(Pu)&&(Pu=Uint8Array.from(Pu))),!(Pu instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(Pu.length===0)return"";for(var Cu=0,Bu=0,Fu=0,zu=Pu.length;Fu!==zu&&Pu[Fu]===0;)Fu++,Cu++;for(var Hu=(zu-Fu)*$u+1>>>0,Wu=new Uint8Array(Hu);Fu!==zu;){for(var tl=Pu[Fu],Xu=0,ju=Hu-1;(tl!==0||Xu<Bu)&&ju!==-1;ju--,Xu++)tl+=256*Wu[ju]>>>0,Wu[ju]=tl%Eu>>>0,tl=tl/Eu>>>0;if(tl!==0)throw new Error("Non-zero carry");Bu=Xu,Fu++}for(var ku=Hu-Bu;ku!==Hu&&Wu[ku]===0;)ku++;for(var Uu=Iu.repeat(Cu);ku<Hu;++ku)Uu+=Z.charAt(Wu[ku]);return Uu}function Su(Pu){if(typeof Pu!="string")throw new TypeError("Expected String");if(Pu.length===0)return new Uint8Array;var Cu=0;if(Pu[Cu]!==" "){for(var Bu=0,Fu=0;Pu[Cu]===Iu;)Bu++,Cu++;for(var zu=(Pu.length-Cu)*Au+1>>>0,Hu=new Uint8Array(zu);Pu[Cu];){var Wu=Hs[Pu.charCodeAt(Cu)];if(Wu===255)return;for(var tl=0,Xu=zu-1;(Wu!==0||tl<Fu)&&Xu!==-1;Xu--,tl++)Wu+=Eu*Hu[Xu]>>>0,Hu[Xu]=Wu%256>>>0,Wu=Wu/256>>>0;if(Wu!==0)throw new Error("Non-zero carry");Fu=tl,Cu++}if(Pu[Cu]!==" "){for(var ju=zu-Fu;ju!==zu&&Hu[ju]===0;)ju++;for(var ku=new Uint8Array(Bu+(zu-ju)),Uu=Bu;ju!==zu;)ku[Uu++]=Hu[ju++];return ku}}}function Ru(Pu){var Cu=Su(Pu);if(Cu)return Cu;throw new Error(`Non-${t} character`)}return{encode:vu,decodeUnsafe:Su,decode:Ru}}var Ur$2=Ir$2,Tr$2=Ur$2;const He$2=Z=>{if(Z instanceof Uint8Array&&Z.constructor.name==="Uint8Array")return Z;if(Z instanceof ArrayBuffer)return new Uint8Array(Z);if(ArrayBuffer.isView(Z))return new Uint8Array(Z.buffer,Z.byteOffset,Z.byteLength);throw new Error("Unknown type, must be binary type")},Fr$2=Z=>new TextEncoder().encode(Z),Nr$2=Z=>new TextDecoder().decode(Z);let Lr$2=class{constructor(t,Hs,zs){this.name=t,this.prefix=Hs,this.baseEncode=zs}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},Or$2=class{constructor(t,Hs,zs){if(this.name=t,this.prefix=Hs,Hs.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=Hs.codePointAt(0),this.baseDecode=zs}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return ze$1(this,t)}},Hr$2=class{constructor(t){this.decoders=t}or(t){return ze$1(this,t)}decode(t){const Hs=t[0],zs=this.decoders[Hs];if(zs)return zs.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const ze$1=(Z,t)=>new Hr$2({...Z.decoders||{[Z.prefix]:Z},...t.decoders||{[t.prefix]:t}});let zr$2=class{constructor(t,Hs,zs,Ys){this.name=t,this.prefix=Hs,this.baseEncode=zs,this.baseDecode=Ys,this.encoder=new Lr$2(t,Hs,zs),this.decoder=new Or$2(t,Hs,Ys)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};const Bt$3=({name:Z,prefix:t,encode:Hs,decode:zs})=>new zr$2(Z,t,Hs,zs),ht$1=({prefix:Z,name:t,alphabet:Hs})=>{const{encode:zs,decode:Ys}=Tr$2(Hs,t);return Bt$3({prefix:Z,name:t,encode:zs,decode:Zs=>He$2(Ys(Zs))})},Mr$2=(Z,t,Hs,zs)=>{const Ys={};for(let $u=0;$u<t.length;++$u)Ys[t[$u]]=$u;let Zs=Z.length;for(;Z[Zs-1]==="=";)--Zs;const _u=new Uint8Array(Zs*Hs/8|0);let Eu=0,Iu=0,Au=0;for(let $u=0;$u<Zs;++$u){const vu=Ys[Z[$u]];if(vu===void 0)throw new SyntaxError(`Non-${zs} character`);Iu=Iu<<Hs|vu,Eu+=Hs,Eu>=8&&(Eu-=8,_u[Au++]=255&Iu>>Eu)}if(Eu>=Hs||255&Iu<<8-Eu)throw new SyntaxError("Unexpected end of data");return _u},qr$2=(Z,t,Hs)=>{const zs=t[t.length-1]==="=",Ys=(1<<Hs)-1;let Zs="",_u=0,Eu=0;for(let Iu=0;Iu<Z.length;++Iu)for(Eu=Eu<<8|Z[Iu],_u+=8;_u>Hs;)_u-=Hs,Zs+=t[Ys&Eu>>_u];if(_u&&(Zs+=t[Ys&Eu<<Hs-_u]),zs)for(;Zs.length*Hs&7;)Zs+="=";return Zs},k=({name:Z,prefix:t,bitsPerChar:Hs,alphabet:zs})=>Bt$3({prefix:t,name:Z,encode(Ys){return qr$2(Ys,zs,Hs)},decode(Ys){return Mr$2(Ys,zs,Hs,Z)}}),$r$2=Bt$3({prefix:"\0",name:"identity",encode:Z=>Nr$2(Z),decode:Z=>Fr$2(Z)});var kr$2=Object.freeze({__proto__:null,identity:$r$2});const Rr$2=k({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var jr$2=Object.freeze({__proto__:null,base2:Rr$2});const Zr$2=k({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Gr$2=Object.freeze({__proto__:null,base8:Zr$2});const Vr$2=ht$1({prefix:"9",name:"base10",alphabet:"0123456789"});var Yr$2=Object.freeze({__proto__:null,base10:Vr$2});const Jr$2=k({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Kr$2=k({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Wr$2=Object.freeze({__proto__:null,base16:Jr$2,base16upper:Kr$2});const Xr$2=k({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Pr$2=k({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Qr$2=k({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),to$2=k({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),eo$2=k({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),no$2=k({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ro$2=k({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),oo$2=k({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),so$2=k({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var io$2=Object.freeze({__proto__:null,base32:Xr$2,base32upper:Pr$2,base32pad:Qr$2,base32padupper:to$2,base32hex:eo$2,base32hexupper:no$2,base32hexpad:ro$2,base32hexpadupper:oo$2,base32z:so$2});const uo$2=ht$1({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),co$2=ht$1({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var ao$2=Object.freeze({__proto__:null,base36:uo$2,base36upper:co$2});const fo$2=ht$1({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Do$2=ht$1({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var ho$2=Object.freeze({__proto__:null,base58btc:fo$2,base58flickr:Do$2});const lo$2=k({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),bo$2=k({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),po$2=k({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),wo$2=k({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Eo$2=Object.freeze({__proto__:null,base64:lo$2,base64pad:bo$2,base64url:po$2,base64urlpad:wo$2});const Me$3=Array.from(""),go$2=Me$3.reduce((Z,t,Hs)=>(Z[Hs]=t,Z),[]),yo$2=Me$3.reduce((Z,t,Hs)=>(Z[t.codePointAt(0)]=Hs,Z),[]);function xo$2(Z){return Z.reduce((t,Hs)=>(t+=go$2[Hs],t),"")}function Bo$2(Z){const t=[];for(const Hs of Z){const zs=yo$2[Hs.codePointAt(0)];if(zs===void 0)throw new Error(`Non-base256emoji character: ${Hs}`);t.push(zs)}return new Uint8Array(t)}const Co$2=Bt$3({prefix:"",name:"base256emoji",encode:xo$2,decode:Bo$2});var Ao$2=Object.freeze({__proto__:null,base256emoji:Co$2}),mo$2=$e$2,qe$2=128,_o$2=127,So$2=~_o$2,vo$2=Math.pow(2,31);function $e$2(Z,t,Hs){t=t||[],Hs=Hs||0;for(var zs=Hs;Z>=vo$2;)t[Hs++]=Z&255|qe$2,Z/=128;for(;Z&So$2;)t[Hs++]=Z&255|qe$2,Z>>>=7;return t[Hs]=Z|0,$e$2.bytes=Hs-zs+1,t}var Io$2=Pt$3,Uo$2=128,ke$2=127;function Pt$3(Z,zs){var Hs=0,zs=zs||0,Ys=0,Zs=zs,_u,Eu=Z.length;do{if(Zs>=Eu)throw Pt$3.bytes=0,new RangeError("Could not decode varint");_u=Z[Zs++],Hs+=Ys<28?(_u&ke$2)<<Ys:(_u&ke$2)*Math.pow(2,Ys),Ys+=7}while(_u>=Uo$2);return Pt$3.bytes=Zs-zs,Hs}var To$2=Math.pow(2,7),Fo$2=Math.pow(2,14),No$2=Math.pow(2,21),Lo$2=Math.pow(2,28),Oo$2=Math.pow(2,35),Ho$2=Math.pow(2,42),zo$2=Math.pow(2,49),Mo$2=Math.pow(2,56),qo$2=Math.pow(2,63),$o$2=function(Z){return Z<To$2?1:Z<Fo$2?2:Z<No$2?3:Z<Lo$2?4:Z<Oo$2?5:Z<Ho$2?6:Z<zo$2?7:Z<Mo$2?8:Z<qo$2?9:10},ko$2={encode:mo$2,decode:Io$2,encodingLength:$o$2},Re$1=ko$2;const je$1=(Z,t,Hs=0)=>(Re$1.encode(Z,t,Hs),t),Ze$2=Z=>Re$1.encodingLength(Z),Qt$3=(Z,t)=>{const Hs=t.byteLength,zs=Ze$2(Z),Ys=zs+Ze$2(Hs),Zs=new Uint8Array(Ys+Hs);return je$1(Z,Zs,0),je$1(Hs,Zs,zs),Zs.set(t,Ys),new Ro$2(Z,Hs,t,Zs)};let Ro$2=class{constructor(t,Hs,zs,Ys){this.code=t,this.size=Hs,this.digest=zs,this.bytes=Ys}};const Ge$2=({name:Z,code:t,encode:Hs})=>new jo$2(Z,t,Hs);let jo$2=class{constructor(t,Hs,zs){this.name=t,this.code=Hs,this.encode=zs}digest(t){if(t instanceof Uint8Array){const Hs=this.encode(t);return Hs instanceof Uint8Array?Qt$3(this.code,Hs):Hs.then(zs=>Qt$3(this.code,zs))}else throw Error("Unknown type, must be binary type")}};const Ve$3=Z=>async t=>new Uint8Array(await crypto.subtle.digest(Z,t)),Zo$2=Ge$2({name:"sha2-256",code:18,encode:Ve$3("SHA-256")}),Go$2=Ge$2({name:"sha2-512",code:19,encode:Ve$3("SHA-512")});var Vo$2=Object.freeze({__proto__:null,sha256:Zo$2,sha512:Go$2});const Ye$2=0,Yo$2="identity",Je$2=He$2,Jo$2=Z=>Qt$3(Ye$2,Je$2(Z)),Ko$2={code:Ye$2,name:Yo$2,encode:Je$2,digest:Jo$2};var Wo$2=Object.freeze({__proto__:null,identity:Ko$2});new TextEncoder,new TextDecoder;const Ke$3={...kr$2,...jr$2,...Gr$2,...Yr$2,...Wr$2,...io$2,...ao$2,...ho$2,...Eo$2,...Ao$2};({...Vo$2,...Wo$2});function We$2(Z,t,Hs,zs){return{name:Z,prefix:t,encoder:{name:Z,prefix:t,encode:Hs},decoder:{decode:zs}}}const Xe$1=We$2("utf8","u",Z=>"u"+new TextDecoder("utf8").decode(Z),Z=>new TextEncoder().encode(Z.substring(1))),te$1=We$2("ascii","a",Z=>{let t="a";for(let Hs=0;Hs<Z.length;Hs++)t+=String.fromCharCode(Z[Hs]);return t},Z=>{Z=Z.substring(1);const t=Le$2(Z.length);for(let Hs=0;Hs<Z.length;Hs++)t[Hs]=Z.charCodeAt(Hs);return t}),Pe$2={utf8:Xe$1,"utf-8":Xe$1,hex:Ke$3.base16,latin1:te$1,ascii:te$1,binary:te$1,...Ke$3};function ct$2(Z,t="utf8"){const Hs=Pe$2[t];if(!Hs)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(Z.buffer,Z.byteOffset,Z.byteLength).toString("utf8"):Hs.encoder.encode(Z).substring(1)}function rt$2(Z,t="utf8"){const Hs=Pe$2[t];if(!Hs)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Xt$3(globalThis.Buffer.from(Z,"utf-8")):Hs.decoder.decode(`${Hs.prefix}${Z}`)}function lt$1(Z){return safeJsonParse(ct$2(rt$2(Z,Dt$2),Gt$3))}function bt$1(Z){return ct$2(rt$2(safeJsonStringify(Z),Gt$3),Dt$2)}function Qe$2(Z){const t=rt$2(Wt$3,dt$2),Hs=Kt$2+ct$2(Oe$2([t,Z]),dt$2);return[Yt$2,Jt$3,Hs].join(Vt$3)}function en$3(Z){return ct$2(Z,Dt$2)}function nn$3(Z){return rt$2(Z,Dt$2)}function rn$3(Z){return rt$2([bt$1(Z.header),bt$1(Z.payload)].join(ut$3),xt$2)}function on$2(Z){return[bt$1(Z.header),bt$1(Z.payload),en$3(Z.signature)].join(ut$3)}function sn$3(Z){const t=Z.split(ut$3),Hs=lt$1(t[0]),zs=lt$1(t[1]),Ys=nn$3(t[2]),Zs=rt$2(t.slice(0,2).join(ut$3),xt$2);return{header:Hs,payload:zs,signature:Ys,data:Zs}}function Po$2(Z=he$2(Ne$1)){const t=Rt$4.getPublicKey(Z);return{secretKey:Oe$2([Z,t]),publicKey:t}}async function Qo$2(Z,t,Hs,zs,Ys=cjs$3.fromMiliseconds(Date.now())){const Zs={alg:jt$3,typ:Zt$3},_u=Qe$2(zs.publicKey),Eu=Ys+Hs,Iu={iss:_u,sub:Z,aud:t,iat:Ys,exp:Eu},Au=rn$3({header:Zs,payload:Iu}),$u=Rt$4.sign(Au,zs.secretKey.slice(0,32));return on$2({header:Zs,payload:Iu,signature:$u})}var __spreadArray=globalThis&&globalThis.__spreadArray||function(Z,t,Hs){if(Hs||arguments.length===2)for(var zs=0,Ys=t.length,Zs;zs<Ys;zs++)(Zs||!(zs in t))&&(Zs||(Zs=Array.prototype.slice.call(t,0,zs)),Zs[zs]=t[zs]);return Z.concat(Zs||Array.prototype.slice.call(t))},BrowserInfo=function(){function Z(t,Hs,zs){this.name=t,this.version=Hs,this.os=zs,this.type="browser"}return Z}(),NodeInfo=function(){function Z(t){this.version=t,this.type="node",this.name="node",this.os=process$1.platform}return Z}(),SearchBotDeviceInfo=function(){function Z(t,Hs,zs,Ys){this.name=t,this.version=Hs,this.os=zs,this.bot=Ys,this.type="bot-device"}return Z}(),BotInfo=function(){function Z(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return Z}(),ReactNativeInfo=function(){function Z(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return Z}(),SEARCHBOX_UA_REGEX=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,SEARCHBOT_OS_REGEX=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,REQUIRED_VERSION_PARTS=3,userAgentRules=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",SEARCHBOX_UA_REGEX]],operatingSystemRules=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function detect(Z){return Z?parseUserAgent(Z):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new ReactNativeInfo:typeof navigator<"u"?parseUserAgent(navigator.userAgent):getNodeVersion()}function matchUserAgent(Z){return Z!==""&&userAgentRules.reduce(function(t,Hs){var zs=Hs[0],Ys=Hs[1];if(t)return t;var Zs=Ys.exec(Z);return!!Zs&&[zs,Zs]},!1)}function parseUserAgent(Z){var t=matchUserAgent(Z);if(!t)return null;var Hs=t[0],zs=t[1];if(Hs==="searchbot")return new BotInfo;var Ys=zs[1]&&zs[1].split(".").join("_").split("_").slice(0,3);Ys?Ys.length<REQUIRED_VERSION_PARTS&&(Ys=__spreadArray(__spreadArray([],Ys,!0),createVersionParts(REQUIRED_VERSION_PARTS-Ys.length),!0)):Ys=[];var Zs=Ys.join("."),_u=detectOS(Z),Eu=SEARCHBOT_OS_REGEX.exec(Z);return Eu&&Eu[1]?new SearchBotDeviceInfo(Hs,Zs,_u,Eu[1]):new BrowserInfo(Hs,Zs,_u)}function detectOS(Z){for(var t=0,Hs=operatingSystemRules.length;t<Hs;t++){var zs=operatingSystemRules[t],Ys=zs[0],Zs=zs[1],_u=Zs.exec(Z);if(_u)return Ys}return null}function getNodeVersion(){var Z=typeof process$1<"u"&&process$1.version;return Z?new NodeInfo(process$1.version.slice(1)):null}function createVersionParts(Z){for(var t=[],Hs=0;Hs<Z;Hs++)t.push("0");return t}var cjs$2={};Object.defineProperty(cjs$2,"__esModule",{value:!0});cjs$2.getLocalStorage=cjs$2.getLocalStorageOrThrow=cjs$2.getCrypto=cjs$2.getCryptoOrThrow=getLocation_1=cjs$2.getLocation=cjs$2.getLocationOrThrow=getNavigator_1=cjs$2.getNavigator=cjs$2.getNavigatorOrThrow=getDocument_1=cjs$2.getDocument=cjs$2.getDocumentOrThrow=cjs$2.getFromWindowOrThrow=cjs$2.getFromWindow=void 0;function getFromWindow(Z){let t;return typeof window<"u"&&typeof window[Z]<"u"&&(t=window[Z]),t}cjs$2.getFromWindow=getFromWindow;function getFromWindowOrThrow(Z){const t=getFromWindow(Z);if(!t)throw new Error(`${Z} is not defined in Window`);return t}cjs$2.getFromWindowOrThrow=getFromWindowOrThrow;function getDocumentOrThrow(){return getFromWindowOrThrow("document")}cjs$2.getDocumentOrThrow=getDocumentOrThrow;function getDocument$1(){return getFromWindow("document")}var getDocument_1=cjs$2.getDocument=getDocument$1;function getNavigatorOrThrow(){return getFromWindowOrThrow("navigator")}cjs$2.getNavigatorOrThrow=getNavigatorOrThrow;function getNavigator(){return getFromWindow("navigator")}var getNavigator_1=cjs$2.getNavigator=getNavigator;function getLocationOrThrow(){return getFromWindowOrThrow("location")}cjs$2.getLocationOrThrow=getLocationOrThrow;function getLocation(){return getFromWindow("location")}var getLocation_1=cjs$2.getLocation=getLocation;function getCryptoOrThrow(){return getFromWindowOrThrow("crypto")}cjs$2.getCryptoOrThrow=getCryptoOrThrow;function getCrypto(){return getFromWindow("crypto")}cjs$2.getCrypto=getCrypto;function getLocalStorageOrThrow(){return getFromWindowOrThrow("localStorage")}cjs$2.getLocalStorageOrThrow=getLocalStorageOrThrow;function getLocalStorage(){return getFromWindow("localStorage")}cjs$2.getLocalStorage=getLocalStorage;var cjs$1={};Object.defineProperty(cjs$1,"__esModule",{value:!0});var getWindowMetadata_1=cjs$1.getWindowMetadata=void 0;const window_getters_1=cjs$2;function getWindowMetadata(){let Z,t;try{Z=window_getters_1.getDocumentOrThrow(),t=window_getters_1.getLocationOrThrow()}catch{return null}function Hs(){const vu=Z.getElementsByTagName("link"),Su=[];for(let Ru=0;Ru<vu.length;Ru++){const Pu=vu[Ru],Cu=Pu.getAttribute("rel");if(Cu&&Cu.toLowerCase().indexOf("icon")>-1){const Bu=Pu.getAttribute("href");if(Bu)if(Bu.toLowerCase().indexOf("https:")===-1&&Bu.toLowerCase().indexOf("http:")===-1&&Bu.indexOf("//")!==0){let Fu=t.protocol+"//"+t.host;if(Bu.indexOf("/")===0)Fu+=Bu;else{const zu=t.pathname.split("/");zu.pop();const Hu=zu.join("/");Fu+=Hu+"/"+Bu}Su.push(Fu)}else if(Bu.indexOf("//")===0){const Fu=t.protocol+Bu;Su.push(Fu)}else Su.push(Bu)}}return Su}function zs(...vu){const Su=Z.getElementsByTagName("meta");for(let Ru=0;Ru<Su.length;Ru++){const Pu=Su[Ru],Cu=["itemprop","property","name"].map(Bu=>Pu.getAttribute(Bu)).filter(Bu=>Bu?vu.includes(Bu):!1);if(Cu.length&&Cu){const Bu=Pu.getAttribute("content");if(Bu)return Bu}}return""}function Ys(){let vu=zs("name","og:site_name","og:title","twitter:title");return vu||(vu=Z.title),vu}function Zs(){return zs("description","og:description","twitter:description","keywords")}const _u=Ys(),Eu=Zs(),Iu=t.origin,Au=Hs();return{description:Eu,url:Iu,icons:Au,name:_u}}getWindowMetadata_1=cjs$1.getWindowMetadata=getWindowMetadata;const version$3="0.1.1";function getVersion(){return version$3}class BaseError extends Error{constructor(t,Hs={}){const zs=(()=>{var Iu;if(Hs.cause instanceof BaseError){if(Hs.cause.details)return Hs.cause.details;if(Hs.cause.shortMessage)return Hs.cause.shortMessage}return Hs.cause&&"details"in Hs.cause&&typeof Hs.cause.details=="string"?Hs.cause.details:(Iu=Hs.cause)!=null&&Iu.message?Hs.cause.message:Hs.details})(),Ys=(()=>Hs.cause instanceof BaseError&&Hs.cause.docsPath||Hs.docsPath)(),_u=`https://oxlib.sh${Ys??""}`,Eu=[t||"An error occurred.",...Hs.metaMessages?["",...Hs.metaMessages]:[],...zs||Ys?["",zs?`Details: ${zs}`:void 0,Ys?`See: ${_u}`:void 0]:[]].filter(Iu=>typeof Iu=="string").join(`
`);super(Eu,Hs.cause?{cause:Hs.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${getVersion()}`}),this.cause=Hs.cause,this.details=zs,this.docs=_u,this.docsPath=Ys,this.shortMessage=t}walk(t){return walk(this,t)}}function walk(Z,t){return t!=null&&t(Z)?Z:Z&&typeof Z=="object"&&"cause"in Z&&Z.cause?walk(Z.cause,t):t?null:Z}const crypto$2=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function isBytes$2(Z){return Z instanceof Uint8Array||ArrayBuffer.isView(Z)&&Z.constructor.name==="Uint8Array"}function anumber$1(Z){if(!Number.isSafeInteger(Z)||Z<0)throw new Error("positive integer expected, got "+Z)}function abytes$1(Z,...t){if(!isBytes$2(Z))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(Z.length))throw new Error("Uint8Array expected of length "+t+", got length="+Z.length)}function ahash(Z){if(typeof Z!="function"||typeof Z.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");anumber$1(Z.outputLen),anumber$1(Z.blockLen)}function aexists(Z,t=!0){if(Z.destroyed)throw new Error("Hash instance has been destroyed");if(t&&Z.finished)throw new Error("Hash#digest() has already been called")}function aoutput(Z,t){abytes$1(Z);const Hs=t.outputLen;if(Z.length<Hs)throw new Error("digestInto() expects output buffer of length at least "+Hs)}function u32(Z){return new Uint32Array(Z.buffer,Z.byteOffset,Math.floor(Z.byteLength/4))}function clean(...Z){for(let t=0;t<Z.length;t++)Z[t].fill(0)}function createView(Z){return new DataView(Z.buffer,Z.byteOffset,Z.byteLength)}function rotr(Z,t){return Z<<32-t|Z>>>t}const isLE=(()=>new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68)();function byteSwap(Z){return Z<<24&4278190080|Z<<8&16711680|Z>>>8&65280|Z>>>24&255}function byteSwap32(Z){for(let t=0;t<Z.length;t++)Z[t]=byteSwap(Z[t]);return Z}const swap32IfBE=isLE?Z=>Z:byteSwap32;function utf8ToBytes(Z){if(typeof Z!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(Z))}function toBytes(Z){return typeof Z=="string"&&(Z=utf8ToBytes(Z)),abytes$1(Z),Z}function concatBytes$1(...Z){let t=0;for(let zs=0;zs<Z.length;zs++){const Ys=Z[zs];abytes$1(Ys),t+=Ys.length}const Hs=new Uint8Array(t);for(let zs=0,Ys=0;zs<Z.length;zs++){const Zs=Z[zs];Hs.set(Zs,Ys),Ys+=Zs.length}return Hs}class Hash{}function createHasher(Z){const t=zs=>Z().update(toBytes(zs)).digest(),Hs=Z();return t.outputLen=Hs.outputLen,t.blockLen=Hs.blockLen,t.create=()=>Z(),t}function randomBytes(Z=32){if(crypto$2&&typeof crypto$2.getRandomValues=="function")return crypto$2.getRandomValues(new Uint8Array(Z));if(crypto$2&&typeof crypto$2.randomBytes=="function")return Uint8Array.from(crypto$2.randomBytes(Z));throw new Error("crypto.getRandomValues must be defined")}function setBigUint64(Z,t,Hs,zs){if(typeof Z.setBigUint64=="function")return Z.setBigUint64(t,Hs,zs);const Ys=BigInt(32),Zs=BigInt(4294967295),_u=Number(Hs>>Ys&Zs),Eu=Number(Hs&Zs),Iu=zs?4:0,Au=zs?0:4;Z.setUint32(t+Iu,_u,zs),Z.setUint32(t+Au,Eu,zs)}function Chi(Z,t,Hs){return Z&t^~Z&Hs}function Maj(Z,t,Hs){return Z&t^Z&Hs^t&Hs}class HashMD extends Hash{constructor(t,Hs,zs,Ys){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=Hs,this.padOffset=zs,this.isLE=Ys,this.buffer=new Uint8Array(t),this.view=createView(this.buffer)}update(t){aexists(this),t=toBytes(t),abytes$1(t);const{view:Hs,buffer:zs,blockLen:Ys}=this,Zs=t.length;for(let _u=0;_u<Zs;){const Eu=Math.min(Ys-this.pos,Zs-_u);if(Eu===Ys){const Iu=createView(t);for(;Ys<=Zs-_u;_u+=Ys)this.process(Iu,_u);continue}zs.set(t.subarray(_u,_u+Eu),this.pos),this.pos+=Eu,_u+=Eu,this.pos===Ys&&(this.process(Hs,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){aexists(this),aoutput(t,this),this.finished=!0;const{buffer:Hs,view:zs,blockLen:Ys,isLE:Zs}=this;let{pos:_u}=this;Hs[_u++]=128,clean(this.buffer.subarray(_u)),this.padOffset>Ys-_u&&(this.process(zs,0),_u=0);for(let vu=_u;vu<Ys;vu++)Hs[vu]=0;setBigUint64(zs,Ys-8,BigInt(this.length*8),Zs),this.process(zs,0);const Eu=createView(t),Iu=this.outputLen;if(Iu%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const Au=Iu/4,$u=this.get();if(Au>$u.length)throw new Error("_sha2: outputLen bigger than state");for(let vu=0;vu<Au;vu++)Eu.setUint32(4*vu,$u[vu],Zs)}digest(){const{buffer:t,outputLen:Hs}=this;this.digestInto(t);const zs=t.slice(0,Hs);return this.destroy(),zs}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:Hs,buffer:zs,length:Ys,finished:Zs,destroyed:_u,pos:Eu}=this;return t.destroyed=_u,t.finished=Zs,t.length=Ys,t.pos=Eu,Ys%Hs&&t.buffer.set(zs),t}clone(){return this._cloneInto()}}const SHA256_IV=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),U32_MASK64=BigInt(2**32-1),_32n=BigInt(32);function fromBig(Z,t=!1){return t?{h:Number(Z&U32_MASK64),l:Number(Z>>_32n&U32_MASK64)}:{h:Number(Z>>_32n&U32_MASK64)|0,l:Number(Z&U32_MASK64)|0}}function split(Z,t=!1){const Hs=Z.length;let zs=new Uint32Array(Hs),Ys=new Uint32Array(Hs);for(let Zs=0;Zs<Hs;Zs++){const{h:_u,l:Eu}=fromBig(Z[Zs],t);[zs[Zs],Ys[Zs]]=[_u,Eu]}return[zs,Ys]}const rotlSH=(Z,t,Hs)=>Z<<Hs|t>>>32-Hs,rotlSL=(Z,t,Hs)=>t<<Hs|Z>>>32-Hs,rotlBH=(Z,t,Hs)=>t<<Hs-32|Z>>>64-Hs,rotlBL=(Z,t,Hs)=>Z<<Hs-32|t>>>64-Hs,_0n$5=BigInt(0),_1n$5=BigInt(1),_2n$2=BigInt(2),_7n=BigInt(7),_256n=BigInt(256),_0x71n=BigInt(113),SHA3_PI=[],SHA3_ROTL=[],_SHA3_IOTA=[];for(let Z=0,t=_1n$5,Hs=1,zs=0;Z<24;Z++){[Hs,zs]=[zs,(2*Hs+3*zs)%5],SHA3_PI.push(2*(5*zs+Hs)),SHA3_ROTL.push((Z+1)*(Z+2)/2%64);let Ys=_0n$5;for(let Zs=0;Zs<7;Zs++)t=(t<<_1n$5^(t>>_7n)*_0x71n)%_256n,t&_2n$2&&(Ys^=_1n$5<<(_1n$5<<BigInt(Zs))-_1n$5);_SHA3_IOTA.push(Ys)}const IOTAS=split(_SHA3_IOTA,!0),SHA3_IOTA_H=IOTAS[0],SHA3_IOTA_L=IOTAS[1],rotlH=(Z,t,Hs)=>Hs>32?rotlBH(Z,t,Hs):rotlSH(Z,t,Hs),rotlL=(Z,t,Hs)=>Hs>32?rotlBL(Z,t,Hs):rotlSL(Z,t,Hs);function keccakP(Z,t=24){const Hs=new Uint32Array(10);for(let zs=24-t;zs<24;zs++){for(let _u=0;_u<10;_u++)Hs[_u]=Z[_u]^Z[_u+10]^Z[_u+20]^Z[_u+30]^Z[_u+40];for(let _u=0;_u<10;_u+=2){const Eu=(_u+8)%10,Iu=(_u+2)%10,Au=Hs[Iu],$u=Hs[Iu+1],vu=rotlH(Au,$u,1)^Hs[Eu],Su=rotlL(Au,$u,1)^Hs[Eu+1];for(let Ru=0;Ru<50;Ru+=10)Z[_u+Ru]^=vu,Z[_u+Ru+1]^=Su}let Ys=Z[2],Zs=Z[3];for(let _u=0;_u<24;_u++){const Eu=SHA3_ROTL[_u],Iu=rotlH(Ys,Zs,Eu),Au=rotlL(Ys,Zs,Eu),$u=SHA3_PI[_u];Ys=Z[$u],Zs=Z[$u+1],Z[$u]=Iu,Z[$u+1]=Au}for(let _u=0;_u<50;_u+=10){for(let Eu=0;Eu<10;Eu++)Hs[Eu]=Z[_u+Eu];for(let Eu=0;Eu<10;Eu++)Z[_u+Eu]^=~Hs[(Eu+2)%10]&Hs[(Eu+4)%10]}Z[0]^=SHA3_IOTA_H[zs],Z[1]^=SHA3_IOTA_L[zs]}clean(Hs)}class Keccak extends Hash{constructor(t,Hs,zs,Ys=!1,Zs=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=t,this.suffix=Hs,this.outputLen=zs,this.enableXOF=Ys,this.rounds=Zs,anumber$1(zs),!(0<t&&t<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=u32(this.state)}clone(){return this._cloneInto()}keccak(){swap32IfBE(this.state32),keccakP(this.state32,this.rounds),swap32IfBE(this.state32),this.posOut=0,this.pos=0}update(t){aexists(this),t=toBytes(t),abytes$1(t);const{blockLen:Hs,state:zs}=this,Ys=t.length;for(let Zs=0;Zs<Ys;){const _u=Math.min(Hs-this.pos,Ys-Zs);for(let Eu=0;Eu<_u;Eu++)zs[this.pos++]^=t[Zs++];this.pos===Hs&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:t,suffix:Hs,pos:zs,blockLen:Ys}=this;t[zs]^=Hs,Hs&128&&zs===Ys-1&&this.keccak(),t[Ys-1]^=128,this.keccak()}writeInto(t){aexists(this,!1),abytes$1(t),this.finish();const Hs=this.state,{blockLen:zs}=this;for(let Ys=0,Zs=t.length;Ys<Zs;){this.posOut>=zs&&this.keccak();const _u=Math.min(zs-this.posOut,Zs-Ys);t.set(Hs.subarray(this.posOut,this.posOut+_u),Ys),this.posOut+=_u,Ys+=_u}return t}xofInto(t){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(t)}xof(t){return anumber$1(t),this.xofInto(new Uint8Array(t))}digestInto(t){if(aoutput(t,this),this.finished)throw new Error("digest() was already called");return this.writeInto(t),this.destroy(),t}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,clean(this.state)}_cloneInto(t){const{blockLen:Hs,suffix:zs,outputLen:Ys,rounds:Zs,enableXOF:_u}=this;return t||(t=new Keccak(Hs,zs,Ys,_u,Zs)),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=Zs,t.suffix=zs,t.outputLen=Ys,t.enableXOF=_u,t.destroyed=this.destroyed,t}}const gen=(Z,t,Hs)=>createHasher(()=>new Keccak(t,Z,Hs)),keccak_256=(()=>gen(1,136,256/8))(),SHA256_K=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_W=new Uint32Array(64);class SHA256 extends HashMD{constructor(t=32){super(64,t,8,!1),this.A=SHA256_IV[0]|0,this.B=SHA256_IV[1]|0,this.C=SHA256_IV[2]|0,this.D=SHA256_IV[3]|0,this.E=SHA256_IV[4]|0,this.F=SHA256_IV[5]|0,this.G=SHA256_IV[6]|0,this.H=SHA256_IV[7]|0}get(){const{A:t,B:Hs,C:zs,D:Ys,E:Zs,F:_u,G:Eu,H:Iu}=this;return[t,Hs,zs,Ys,Zs,_u,Eu,Iu]}set(t,Hs,zs,Ys,Zs,_u,Eu,Iu){this.A=t|0,this.B=Hs|0,this.C=zs|0,this.D=Ys|0,this.E=Zs|0,this.F=_u|0,this.G=Eu|0,this.H=Iu|0}process(t,Hs){for(let vu=0;vu<16;vu++,Hs+=4)SHA256_W[vu]=t.getUint32(Hs,!1);for(let vu=16;vu<64;vu++){const Su=SHA256_W[vu-15],Ru=SHA256_W[vu-2],Pu=rotr(Su,7)^rotr(Su,18)^Su>>>3,Cu=rotr(Ru,17)^rotr(Ru,19)^Ru>>>10;SHA256_W[vu]=Cu+SHA256_W[vu-7]+Pu+SHA256_W[vu-16]|0}let{A:zs,B:Ys,C:Zs,D:_u,E:Eu,F:Iu,G:Au,H:$u}=this;for(let vu=0;vu<64;vu++){const Su=rotr(Eu,6)^rotr(Eu,11)^rotr(Eu,25),Ru=$u+Su+Chi(Eu,Iu,Au)+SHA256_K[vu]+SHA256_W[vu]|0,Cu=(rotr(zs,2)^rotr(zs,13)^rotr(zs,22))+Maj(zs,Ys,Zs)|0;$u=Au,Au=Iu,Iu=Eu,Eu=_u+Ru|0,_u=Zs,Zs=Ys,Ys=zs,zs=Ru+Cu|0}zs=zs+this.A|0,Ys=Ys+this.B|0,Zs=Zs+this.C|0,_u=_u+this.D|0,Eu=Eu+this.E|0,Iu=Iu+this.F|0,Au=Au+this.G|0,$u=$u+this.H|0,this.set(zs,Ys,Zs,_u,Eu,Iu,Au,$u)}roundClean(){clean(SHA256_W)}destroy(){this.set(0,0,0,0,0,0,0,0),clean(this.buffer)}}const sha256=createHasher(()=>new SHA256);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$4=BigInt(0),_1n$4=BigInt(1);function isBytes$1(Z){return Z instanceof Uint8Array||ArrayBuffer.isView(Z)&&Z.constructor.name==="Uint8Array"}function abytes(Z){if(!isBytes$1(Z))throw new Error("Uint8Array expected")}function abool(Z,t){if(typeof t!="boolean")throw new Error(Z+" boolean expected, got "+t)}function numberToHexUnpadded(Z){const t=Z.toString(16);return t.length&1?"0"+t:t}function hexToNumber(Z){if(typeof Z!="string")throw new Error("hex string expected, got "+typeof Z);return Z===""?_0n$4:BigInt("0x"+Z)}const hasHexBuiltin=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",hexes$1=Array.from({length:256},(Z,t)=>t.toString(16).padStart(2,"0"));function bytesToHex(Z){if(abytes(Z),hasHexBuiltin)return Z.toHex();let t="";for(let Hs=0;Hs<Z.length;Hs++)t+=hexes$1[Z[Hs]];return t}const asciis={_0:48,_9:57,A:65,F:70,a:97,f:102};function asciiToBase16(Z){if(Z>=asciis._0&&Z<=asciis._9)return Z-asciis._0;if(Z>=asciis.A&&Z<=asciis.F)return Z-(asciis.A-10);if(Z>=asciis.a&&Z<=asciis.f)return Z-(asciis.a-10)}function hexToBytes(Z){if(typeof Z!="string")throw new Error("hex string expected, got "+typeof Z);if(hasHexBuiltin)return Uint8Array.fromHex(Z);const t=Z.length,Hs=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const zs=new Uint8Array(Hs);for(let Ys=0,Zs=0;Ys<Hs;Ys++,Zs+=2){const _u=asciiToBase16(Z.charCodeAt(Zs)),Eu=asciiToBase16(Z.charCodeAt(Zs+1));if(_u===void 0||Eu===void 0){const Iu=Z[Zs]+Z[Zs+1];throw new Error('hex string expected, got non-hex character "'+Iu+'" at index '+Zs)}zs[Ys]=_u*16+Eu}return zs}function bytesToNumberBE(Z){return hexToNumber(bytesToHex(Z))}function bytesToNumberLE(Z){return abytes(Z),hexToNumber(bytesToHex(Uint8Array.from(Z).reverse()))}function numberToBytesBE(Z,t){return hexToBytes(Z.toString(16).padStart(t*2,"0"))}function numberToBytesLE(Z,t){return numberToBytesBE(Z,t).reverse()}function ensureBytes(Z,t,Hs){let zs;if(typeof t=="string")try{zs=hexToBytes(t)}catch(Zs){throw new Error(Z+" must be hex string or Uint8Array, cause: "+Zs)}else if(isBytes$1(t))zs=Uint8Array.from(t);else throw new Error(Z+" must be hex string or Uint8Array");const Ys=zs.length;if(typeof Hs=="number"&&Ys!==Hs)throw new Error(Z+" of length "+Hs+" expected, got "+Ys);return zs}function concatBytes(...Z){let t=0;for(let zs=0;zs<Z.length;zs++){const Ys=Z[zs];abytes(Ys),t+=Ys.length}const Hs=new Uint8Array(t);for(let zs=0,Ys=0;zs<Z.length;zs++){const Zs=Z[zs];Hs.set(Zs,Ys),Ys+=Zs.length}return Hs}const isPosBig=Z=>typeof Z=="bigint"&&_0n$4<=Z;function inRange(Z,t,Hs){return isPosBig(Z)&&isPosBig(t)&&isPosBig(Hs)&&t<=Z&&Z<Hs}function aInRange(Z,t,Hs,zs){if(!inRange(t,Hs,zs))throw new Error("expected valid "+Z+": "+Hs+" <= n < "+zs+", got "+t)}function bitLen(Z){let t;for(t=0;Z>_0n$4;Z>>=_1n$4,t+=1);return t}const bitMask=Z=>(_1n$4<<BigInt(Z))-_1n$4,u8n=Z=>new Uint8Array(Z),u8fr=Z=>Uint8Array.from(Z);function createHmacDrbg(Z,t,Hs){if(typeof Z!="number"||Z<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof Hs!="function")throw new Error("hmacFn must be a function");let zs=u8n(Z),Ys=u8n(Z),Zs=0;const _u=()=>{zs.fill(1),Ys.fill(0),Zs=0},Eu=(...vu)=>Hs(Ys,zs,...vu),Iu=(vu=u8n(0))=>{Ys=Eu(u8fr([0]),vu),zs=Eu(),vu.length!==0&&(Ys=Eu(u8fr([1]),vu),zs=Eu())},Au=()=>{if(Zs++>=1e3)throw new Error("drbg: tried 1000 values");let vu=0;const Su=[];for(;vu<t;){zs=Eu();const Ru=zs.slice();Su.push(Ru),vu+=zs.length}return concatBytes(...Su)};return(vu,Su)=>{_u(),Iu(vu);let Ru;for(;!(Ru=Su(Au()));)Iu();return _u(),Ru}}const validatorFns={bigint:Z=>typeof Z=="bigint",function:Z=>typeof Z=="function",boolean:Z=>typeof Z=="boolean",string:Z=>typeof Z=="string",stringOrUint8Array:Z=>typeof Z=="string"||isBytes$1(Z),isSafeInteger:Z=>Number.isSafeInteger(Z),array:Z=>Array.isArray(Z),field:(Z,t)=>t.Fp.isValid(Z),hash:Z=>typeof Z=="function"&&Number.isSafeInteger(Z.outputLen)};function validateObject(Z,t,Hs={}){const zs=(Ys,Zs,_u)=>{const Eu=validatorFns[Zs];if(typeof Eu!="function")throw new Error("invalid validator function");const Iu=Z[Ys];if(!(_u&&Iu===void 0)&&!Eu(Iu,Z))throw new Error("param "+String(Ys)+" is invalid. Expected "+Zs+", got "+Iu)};for(const[Ys,Zs]of Object.entries(t))zs(Ys,Zs,!1);for(const[Ys,Zs]of Object.entries(Hs))zs(Ys,Zs,!0);return Z}function memoized(Z){const t=new WeakMap;return(Hs,...zs)=>{const Ys=t.get(Hs);if(Ys!==void 0)return Ys;const Zs=Z(Hs,...zs);return t.set(Hs,Zs),Zs}}function assertSize$1(Z,t){if(size(Z)>t)throw new SizeOverflowError({givenSize:size(Z),maxSize:t})}const charCodeMap={zero:48,nine:57,A:65,F:70,a:97,f:102};function charCodeToBase16(Z){if(Z>=charCodeMap.zero&&Z<=charCodeMap.nine)return Z-charCodeMap.zero;if(Z>=charCodeMap.A&&Z<=charCodeMap.F)return Z-(charCodeMap.A-10);if(Z>=charCodeMap.a&&Z<=charCodeMap.f)return Z-(charCodeMap.a-10)}function pad$1(Z,t={}){const{dir:Hs,size:zs=32}=t;if(zs===0)return Z;if(Z.length>zs)throw new SizeExceedsPaddingSizeError({size:Z.length,targetSize:zs,type:"Bytes"});const Ys=new Uint8Array(zs);for(let Zs=0;Zs<zs;Zs++){const _u=Hs==="right";Ys[_u?Zs:zs-Zs-1]=Z[_u?Zs:Z.length-Zs-1]}return Ys}function assertSize(Z,t){if(size$1(Z)>t)throw new SizeOverflowError$1({givenSize:size$1(Z),maxSize:t})}function assertStartOffset(Z,t){if(typeof t=="number"&&t>0&&t>size$1(Z)-1)throw new SliceOffsetOutOfBoundsError({offset:t,position:"start",size:size$1(Z)})}function assertEndOffset(Z,t,Hs){if(typeof t=="number"&&typeof Hs=="number"&&size$1(Z)!==Hs-t)throw new SliceOffsetOutOfBoundsError({offset:Hs,position:"end",size:size$1(Z)})}function pad(Z,t={}){const{dir:Hs,size:zs=32}=t;if(zs===0)return Z;const Ys=Z.replace("0x","");if(Ys.length>zs*2)throw new SizeExceedsPaddingSizeError$1({size:Math.ceil(Ys.length/2),targetSize:zs,type:"Hex"});return`0x${Ys[Hs==="right"?"padEnd":"padStart"](zs*2,"0")}`}const bigIntSuffix="#__bigint";function stringify(Z,t,Hs){return JSON.stringify(Z,(zs,Ys)=>typeof t=="function"?t(zs,Ys):typeof Ys=="bigint"?Ys.toString()+bigIntSuffix:Ys,Hs)}const hexes=Array.from({length:256},(Z,t)=>t.toString(16).padStart(2,"0"));function assert$6(Z,t={}){const{strict:Hs=!1}=t;if(!Z)throw new InvalidHexTypeError(Z);if(typeof Z!="string")throw new InvalidHexTypeError(Z);if(Hs&&!/^0x[0-9a-fA-F]*$/.test(Z))throw new InvalidHexValueError(Z);if(!Z.startsWith("0x"))throw new InvalidHexValueError(Z)}function concat$1(...Z){return`0x${Z.reduce((t,Hs)=>t+Hs.replace("0x",""),"")}`}function from$4(Z){return Z instanceof Uint8Array?fromBytes$1(Z):Array.isArray(Z)?fromBytes$1(new Uint8Array(Z)):Z}function fromBytes$1(Z,t={}){let Hs="";for(let Ys=0;Ys<Z.length;Ys++)Hs+=hexes[Z[Ys]];const zs=`0x${Hs}`;return typeof t.size=="number"?(assertSize(zs,t.size),padRight$1(zs,t.size)):zs}function fromNumber(Z,t={}){const{signed:Hs,size:zs}=t,Ys=BigInt(Z);let Zs;zs?Hs?Zs=(1n<<BigInt(zs)*8n-1n)-1n:Zs=2n**(BigInt(zs)*8n)-1n:typeof Z=="number"&&(Zs=BigInt(Number.MAX_SAFE_INTEGER));const _u=typeof Zs=="bigint"&&Hs?-Zs-1n:0;if(Zs&&Ys>Zs||Ys<_u){const Au=typeof Z=="bigint"?"n":"";throw new IntegerOutOfRangeError({max:Zs?`${Zs}${Au}`:void 0,min:`${_u}${Au}`,signed:Hs,size:zs,value:`${Z}${Au}`})}const Iu=`0x${(Hs&&Ys<0?(1n<<BigInt(zs*8))+BigInt(Ys):Ys).toString(16)}`;return zs?padLeft(Iu,zs):Iu}function padLeft(Z,t){return pad(Z,{dir:"left",size:t})}function padRight$1(Z,t){return pad(Z,{dir:"right",size:t})}function slice(Z,t,Hs,zs={}){const{strict:Ys}=zs;assertStartOffset(Z,t);const Zs=`0x${Z.replace("0x","").slice((t??0)*2,(Hs??Z.length)*2)}`;return Ys&&assertEndOffset(Zs,t,Hs),Zs}function size$1(Z){return Math.ceil((Z.length-2)/2)}function validate$1(Z,t={}){const{strict:Hs=!1}=t;try{return assert$6(Z,{strict:Hs}),!0}catch{return!1}}class IntegerOutOfRangeError extends BaseError{constructor({max:t,min:Hs,signed:zs,size:Ys,value:Zs}){super(`Number \`${Zs}\` is not in safe${Ys?` ${Ys*8}-bit`:""}${zs?" signed":" unsigned"} integer range ${t?`(\`${Hs}\` to \`${t}\`)`:`(above \`${Hs}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class InvalidHexTypeError extends BaseError{constructor(t){super(`Value \`${typeof t=="object"?stringify(t):t}\` of type \`${typeof t}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class InvalidHexValueError extends BaseError{constructor(t){super(`Value \`${t}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}let SizeOverflowError$1=class extends BaseError{constructor({givenSize:t,maxSize:Hs}){super(`Size cannot exceed \`${Hs}\` bytes. Given size: \`${t}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}};class SliceOffsetOutOfBoundsError extends BaseError{constructor({offset:t,position:Hs,size:zs}){super(`Slice ${Hs==="start"?"starting":"ending"} at offset \`${t}\` is out-of-bounds (size: \`${zs}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}let SizeExceedsPaddingSizeError$1=class extends BaseError{constructor({size:t,targetSize:Hs,type:zs}){super(`${zs.charAt(0).toUpperCase()}${zs.slice(1).toLowerCase()} size (\`${t}\`) exceeds padding size (\`${Hs}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}};const encoder=new TextEncoder;function assert$5(Z){if(!(Z instanceof Uint8Array)){if(!Z)throw new InvalidBytesTypeError(Z);if(typeof Z!="object")throw new InvalidBytesTypeError(Z);if(!("BYTES_PER_ELEMENT"in Z))throw new InvalidBytesTypeError(Z);if(Z.BYTES_PER_ELEMENT!==1||Z.constructor.name!=="Uint8Array")throw new InvalidBytesTypeError(Z)}}function from$3(Z){return Z instanceof Uint8Array?Z:typeof Z=="string"?fromHex$2(Z):fromArray(Z)}function fromArray(Z){return Z instanceof Uint8Array?Z:new Uint8Array(Z)}function fromHex$2(Z,t={}){const{size:Hs}=t;let zs=Z;Hs&&(assertSize(Z,Hs),zs=padRight$1(Z,Hs));let Ys=zs.slice(2);Ys.length%2&&(Ys=`0${Ys}`);const Zs=Ys.length/2,_u=new Uint8Array(Zs);for(let Eu=0,Iu=0;Eu<Zs;Eu++){const Au=charCodeToBase16(Ys.charCodeAt(Iu++)),$u=charCodeToBase16(Ys.charCodeAt(Iu++));if(Au===void 0||$u===void 0)throw new BaseError(`Invalid byte sequence ("${Ys[Iu-2]}${Ys[Iu-1]}" in "${Ys}").`);_u[Eu]=Au*16+$u}return _u}function fromString$2(Z,t={}){const{size:Hs}=t,zs=encoder.encode(Z);return typeof Hs=="number"?(assertSize$1(zs,Hs),padRight(zs,Hs)):zs}function padRight(Z,t){return pad$1(Z,{dir:"right",size:t})}function size(Z){return Z.length}function validate(Z){try{return assert$5(Z),!0}catch{return!1}}class InvalidBytesTypeError extends BaseError{constructor(t){super(`Value \`${typeof t=="object"?stringify(t):t}\` of type \`${typeof t}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class SizeOverflowError extends BaseError{constructor({givenSize:t,maxSize:Hs}){super(`Size cannot exceed \`${Hs}\` bytes. Given size: \`${t}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class SizeExceedsPaddingSizeError extends BaseError{constructor({size:t,targetSize:Hs,type:zs}){super(`${zs.charAt(0).toUpperCase()}${zs.slice(1).toLowerCase()} size (\`${t}\`) exceeds padding size (\`${Hs}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}function keccak256(Z,t={}){const{as:Hs=typeof Z=="string"?"Hex":"Bytes"}=t,zs=keccak_256(from$3(Z));return Hs==="Bytes"?zs:fromBytes$1(zs)}class LruMap extends Map{constructor(t){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=t}get(t){const Hs=super.get(t);return super.has(t)&&Hs!==void 0&&(this.delete(t),super.set(t,Hs)),Hs}set(t,Hs){if(super.set(t,Hs),this.maxSize&&this.size>this.maxSize){const zs=this.keys().next().value;zs&&this.delete(zs)}return this}}const caches={checksum:new LruMap(8192)},checksum$1=caches.checksum;function assert$4(Z,t={}){const{compressed:Hs}=t,{prefix:zs,x:Ys,y:Zs}=Z;if(Hs===!1||typeof Ys=="bigint"&&typeof Zs=="bigint"){if(zs!==4)throw new InvalidPrefixError({prefix:zs,cause:new InvalidUncompressedPrefixError});return}if(Hs===!0||typeof Ys=="bigint"&&typeof Zs>"u"){if(zs!==3&&zs!==2)throw new InvalidPrefixError({prefix:zs,cause:new InvalidCompressedPrefixError});return}throw new InvalidError({publicKey:Z})}function from$2(Z){const t=(()=>{if(validate$1(Z))return fromHex$1(Z);if(validate(Z))return fromBytes(Z);const{prefix:Hs,x:zs,y:Ys}=Z;return typeof zs=="bigint"&&typeof Ys=="bigint"?{prefix:Hs??4,x:zs,y:Ys}:{prefix:Hs,x:zs}})();return assert$4(t),t}function fromBytes(Z){return fromHex$1(fromBytes$1(Z))}function fromHex$1(Z){if(Z.length!==132&&Z.length!==130&&Z.length!==68)throw new InvalidSerializedSizeError$1({publicKey:Z});if(Z.length===130){const zs=BigInt(slice(Z,0,32)),Ys=BigInt(slice(Z,32,64));return{prefix:4,x:zs,y:Ys}}if(Z.length===132){const zs=Number(slice(Z,0,1)),Ys=BigInt(slice(Z,1,33)),Zs=BigInt(slice(Z,33,65));return{prefix:zs,x:Ys,y:Zs}}const t=Number(slice(Z,0,1)),Hs=BigInt(slice(Z,1,33));return{prefix:t,x:Hs}}function toHex$3(Z,t={}){assert$4(Z);const{prefix:Hs,x:zs,y:Ys}=Z,{includePrefix:Zs=!0}=t;return concat$1(Zs?fromNumber(Hs,{size:1}):"0x",fromNumber(zs,{size:32}),typeof Ys=="bigint"?fromNumber(Ys,{size:32}):"0x")}class InvalidError extends BaseError{constructor({publicKey:t}){super(`Value \`${stringify(t)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class InvalidPrefixError extends BaseError{constructor({prefix:t,cause:Hs}){super(`Prefix "${t}" is invalid.`,{cause:Hs}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class InvalidCompressedPrefixError extends BaseError{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class InvalidUncompressedPrefixError extends BaseError{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}let InvalidSerializedSizeError$1=class extends BaseError{constructor({publicKey:t}){super(`Value \`${t}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${size$1(from$4(t))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}};const addressRegex=/^0x[a-fA-F0-9]{40}$/;function assert$3(Z,t={}){const{strict:Hs=!0}=t;if(!addressRegex.test(Z))throw new InvalidAddressError({address:Z,cause:new InvalidInputError});if(Hs){if(Z.toLowerCase()===Z)return;if(checksum(Z)!==Z)throw new InvalidAddressError({address:Z,cause:new InvalidChecksumError})}}function checksum(Z){if(checksum$1.has(Z))return checksum$1.get(Z);assert$3(Z,{strict:!1});const t=Z.substring(2).toLowerCase(),Hs=keccak256(fromString$2(t),{as:"Bytes"}),zs=t.split("");for(let Zs=0;Zs<40;Zs+=2)Hs[Zs>>1]>>4>=8&&zs[Zs]&&(zs[Zs]=zs[Zs].toUpperCase()),(Hs[Zs>>1]&15)>=8&&zs[Zs+1]&&(zs[Zs+1]=zs[Zs+1].toUpperCase());const Ys=`0x${zs.join("")}`;return checksum$1.set(Z,Ys),Ys}function from$1(Z,t={}){const{checksum:Hs=!1}=t;return assert$3(Z),Hs?checksum(Z):Z}function fromPublicKey(Z,t={}){const Hs=keccak256(`0x${toHex$3(Z).slice(4)}`).substring(26);return from$1(`0x${Hs}`,t)}class InvalidAddressError extends BaseError{constructor({address:t,cause:Hs}){super(`Address "${t}" is invalid.`,{cause:Hs}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class InvalidInputError extends BaseError{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class InvalidChecksumError extends BaseError{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}class HMAC extends Hash{constructor(t,Hs){super(),this.finished=!1,this.destroyed=!1,ahash(t);const zs=toBytes(Hs);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const Ys=this.blockLen,Zs=new Uint8Array(Ys);Zs.set(zs.length>Ys?t.create().update(zs).digest():zs);for(let _u=0;_u<Zs.length;_u++)Zs[_u]^=54;this.iHash.update(Zs),this.oHash=t.create();for(let _u=0;_u<Zs.length;_u++)Zs[_u]^=106;this.oHash.update(Zs),clean(Zs)}update(t){return aexists(this),this.iHash.update(t),this}digestInto(t){aexists(this),abytes$1(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:Hs,iHash:zs,finished:Ys,destroyed:Zs,blockLen:_u,outputLen:Eu}=this;return t=t,t.finished=Ys,t.destroyed=Zs,t.blockLen=_u,t.outputLen=Eu,t.oHash=Hs._cloneInto(t.oHash),t.iHash=zs._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const hmac=(Z,t,Hs)=>new HMAC(Z,t).update(Hs).digest();hmac.create=(Z,t)=>new HMAC(Z,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$3=BigInt(0),_1n$3=BigInt(1),_2n$1=BigInt(2),_3n$1=BigInt(3),_4n$1=BigInt(4),_5n=BigInt(5),_8n=BigInt(8);function mod(Z,t){const Hs=Z%t;return Hs>=_0n$3?Hs:t+Hs}function pow2(Z,t,Hs){let zs=Z;for(;t-- >_0n$3;)zs*=zs,zs%=Hs;return zs}function invert(Z,t){if(Z===_0n$3)throw new Error("invert: expected non-zero number");if(t<=_0n$3)throw new Error("invert: expected positive modulus, got "+t);let Hs=mod(Z,t),zs=t,Ys=_0n$3,Zs=_1n$3;for(;Hs!==_0n$3;){const Eu=zs/Hs,Iu=zs%Hs,Au=Ys-Zs*Eu;zs=Hs,Hs=Iu,Ys=Zs,Zs=Au}if(zs!==_1n$3)throw new Error("invert: does not exist");return mod(Ys,t)}function sqrt3mod4(Z,t){const Hs=(Z.ORDER+_1n$3)/_4n$1,zs=Z.pow(t,Hs);if(!Z.eql(Z.sqr(zs),t))throw new Error("Cannot find square root");return zs}function sqrt5mod8(Z,t){const Hs=(Z.ORDER-_5n)/_8n,zs=Z.mul(t,_2n$1),Ys=Z.pow(zs,Hs),Zs=Z.mul(t,Ys),_u=Z.mul(Z.mul(Zs,_2n$1),Ys),Eu=Z.mul(Zs,Z.sub(_u,Z.ONE));if(!Z.eql(Z.sqr(Eu),t))throw new Error("Cannot find square root");return Eu}function tonelliShanks(Z){if(Z<BigInt(3))throw new Error("sqrt is not defined for small field");let t=Z-_1n$3,Hs=0;for(;t%_2n$1===_0n$3;)t/=_2n$1,Hs++;let zs=_2n$1;const Ys=Field(Z);for(;FpLegendre(Ys,zs)===1;)if(zs++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(Hs===1)return sqrt3mod4;let Zs=Ys.pow(zs,t);const _u=(t+_1n$3)/_2n$1;return function(Iu,Au){if(Iu.is0(Au))return Au;if(FpLegendre(Iu,Au)!==1)throw new Error("Cannot find square root");let $u=Hs,vu=Iu.mul(Iu.ONE,Zs),Su=Iu.pow(Au,t),Ru=Iu.pow(Au,_u);for(;!Iu.eql(Su,Iu.ONE);){if(Iu.is0(Su))return Iu.ZERO;let Pu=1,Cu=Iu.sqr(Su);for(;!Iu.eql(Cu,Iu.ONE);)if(Pu++,Cu=Iu.sqr(Cu),Pu===$u)throw new Error("Cannot find square root");const Bu=_1n$3<<BigInt($u-Pu-1),Fu=Iu.pow(vu,Bu);$u=Pu,vu=Iu.sqr(Fu),Su=Iu.mul(Su,vu),Ru=Iu.mul(Ru,Fu)}return Ru}}function FpSqrt(Z){return Z%_4n$1===_3n$1?sqrt3mod4:Z%_8n===_5n?sqrt5mod8:tonelliShanks(Z)}const FIELD_FIELDS=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField(Z){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},Hs=FIELD_FIELDS.reduce((zs,Ys)=>(zs[Ys]="function",zs),t);return validateObject(Z,Hs)}function FpPow(Z,t,Hs){if(Hs<_0n$3)throw new Error("invalid exponent, negatives unsupported");if(Hs===_0n$3)return Z.ONE;if(Hs===_1n$3)return t;let zs=Z.ONE,Ys=t;for(;Hs>_0n$3;)Hs&_1n$3&&(zs=Z.mul(zs,Ys)),Ys=Z.sqr(Ys),Hs>>=_1n$3;return zs}function FpInvertBatch(Z,t,Hs=!1){const zs=new Array(t.length).fill(Hs?Z.ZERO:void 0),Ys=t.reduce((_u,Eu,Iu)=>Z.is0(Eu)?_u:(zs[Iu]=_u,Z.mul(_u,Eu)),Z.ONE),Zs=Z.inv(Ys);return t.reduceRight((_u,Eu,Iu)=>Z.is0(Eu)?_u:(zs[Iu]=Z.mul(_u,zs[Iu]),Z.mul(_u,Eu)),Zs),zs}function FpLegendre(Z,t){const Hs=(Z.ORDER-_1n$3)/_2n$1,zs=Z.pow(t,Hs),Ys=Z.eql(zs,Z.ONE),Zs=Z.eql(zs,Z.ZERO),_u=Z.eql(zs,Z.neg(Z.ONE));if(!Ys&&!Zs&&!_u)throw new Error("invalid Legendre symbol result");return Ys?1:Zs?0:-1}function nLength(Z,t){t!==void 0&&anumber$1(t);const Hs=t!==void 0?t:Z.toString(2).length,zs=Math.ceil(Hs/8);return{nBitLength:Hs,nByteLength:zs}}function Field(Z,t,Hs=!1,zs={}){if(Z<=_0n$3)throw new Error("invalid field: expected ORDER > 0, got "+Z);const{nBitLength:Ys,nByteLength:Zs}=nLength(Z,t);if(Zs>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let _u;const Eu=Object.freeze({ORDER:Z,isLE:Hs,BITS:Ys,BYTES:Zs,MASK:bitMask(Ys),ZERO:_0n$3,ONE:_1n$3,create:Iu=>mod(Iu,Z),isValid:Iu=>{if(typeof Iu!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof Iu);return _0n$3<=Iu&&Iu<Z},is0:Iu=>Iu===_0n$3,isOdd:Iu=>(Iu&_1n$3)===_1n$3,neg:Iu=>mod(-Iu,Z),eql:(Iu,Au)=>Iu===Au,sqr:Iu=>mod(Iu*Iu,Z),add:(Iu,Au)=>mod(Iu+Au,Z),sub:(Iu,Au)=>mod(Iu-Au,Z),mul:(Iu,Au)=>mod(Iu*Au,Z),pow:(Iu,Au)=>FpPow(Eu,Iu,Au),div:(Iu,Au)=>mod(Iu*invert(Au,Z),Z),sqrN:Iu=>Iu*Iu,addN:(Iu,Au)=>Iu+Au,subN:(Iu,Au)=>Iu-Au,mulN:(Iu,Au)=>Iu*Au,inv:Iu=>invert(Iu,Z),sqrt:zs.sqrt||(Iu=>(_u||(_u=FpSqrt(Z)),_u(Eu,Iu))),toBytes:Iu=>Hs?numberToBytesLE(Iu,Zs):numberToBytesBE(Iu,Zs),fromBytes:Iu=>{if(Iu.length!==Zs)throw new Error("Field.fromBytes: expected "+Zs+" bytes, got "+Iu.length);return Hs?bytesToNumberLE(Iu):bytesToNumberBE(Iu)},invertBatch:Iu=>FpInvertBatch(Eu,Iu),cmov:(Iu,Au,$u)=>$u?Au:Iu});return Object.freeze(Eu)}function getFieldBytesLength(Z){if(typeof Z!="bigint")throw new Error("field order must be bigint");const t=Z.toString(2).length;return Math.ceil(t/8)}function getMinHashLength(Z){const t=getFieldBytesLength(Z);return t+Math.ceil(t/2)}function mapHashToField(Z,t,Hs=!1){const zs=Z.length,Ys=getFieldBytesLength(t),Zs=getMinHashLength(t);if(zs<16||zs<Zs||zs>1024)throw new Error("expected "+Zs+"-1024 bytes of input, got "+zs);const _u=Hs?bytesToNumberLE(Z):bytesToNumberBE(Z),Eu=mod(_u,t-_1n$3)+_1n$3;return Hs?numberToBytesLE(Eu,Ys):numberToBytesBE(Eu,Ys)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$2=BigInt(0),_1n$2=BigInt(1);function constTimeNegate(Z,t){const Hs=t.negate();return Z?Hs:t}function validateW(Z,t){if(!Number.isSafeInteger(Z)||Z<=0||Z>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+Z)}function calcWOpts(Z,t){validateW(Z,t);const Hs=Math.ceil(t/Z)+1,zs=2**(Z-1),Ys=2**Z,Zs=bitMask(Z),_u=BigInt(Z);return{windows:Hs,windowSize:zs,mask:Zs,maxNumber:Ys,shiftBy:_u}}function calcOffsets(Z,t,Hs){const{windowSize:zs,mask:Ys,maxNumber:Zs,shiftBy:_u}=Hs;let Eu=Number(Z&Ys),Iu=Z>>_u;Eu>zs&&(Eu-=Zs,Iu+=_1n$2);const Au=t*zs,$u=Au+Math.abs(Eu)-1,vu=Eu===0,Su=Eu<0,Ru=t%2!==0;return{nextN:Iu,offset:$u,isZero:vu,isNeg:Su,isNegF:Ru,offsetF:Au}}function validateMSMPoints(Z,t){if(!Array.isArray(Z))throw new Error("array expected");Z.forEach((Hs,zs)=>{if(!(Hs instanceof t))throw new Error("invalid point at index "+zs)})}function validateMSMScalars(Z,t){if(!Array.isArray(Z))throw new Error("array of scalars expected");Z.forEach((Hs,zs)=>{if(!t.isValid(Hs))throw new Error("invalid scalar at index "+zs)})}const pointPrecomputes=new WeakMap,pointWindowSizes=new WeakMap;function getW(Z){return pointWindowSizes.get(Z)||1}function wNAF(Z,t){return{constTimeNegate,hasPrecomputes(Hs){return getW(Hs)!==1},unsafeLadder(Hs,zs,Ys=Z.ZERO){let Zs=Hs;for(;zs>_0n$2;)zs&_1n$2&&(Ys=Ys.add(Zs)),Zs=Zs.double(),zs>>=_1n$2;return Ys},precomputeWindow(Hs,zs){const{windows:Ys,windowSize:Zs}=calcWOpts(zs,t),_u=[];let Eu=Hs,Iu=Eu;for(let Au=0;Au<Ys;Au++){Iu=Eu,_u.push(Iu);for(let $u=1;$u<Zs;$u++)Iu=Iu.add(Eu),_u.push(Iu);Eu=Iu.double()}return _u},wNAF(Hs,zs,Ys){let Zs=Z.ZERO,_u=Z.BASE;const Eu=calcWOpts(Hs,t);for(let Iu=0;Iu<Eu.windows;Iu++){const{nextN:Au,offset:$u,isZero:vu,isNeg:Su,isNegF:Ru,offsetF:Pu}=calcOffsets(Ys,Iu,Eu);Ys=Au,vu?_u=_u.add(constTimeNegate(Ru,zs[Pu])):Zs=Zs.add(constTimeNegate(Su,zs[$u]))}return{p:Zs,f:_u}},wNAFUnsafe(Hs,zs,Ys,Zs=Z.ZERO){const _u=calcWOpts(Hs,t);for(let Eu=0;Eu<_u.windows&&Ys!==_0n$2;Eu++){const{nextN:Iu,offset:Au,isZero:$u,isNeg:vu}=calcOffsets(Ys,Eu,_u);if(Ys=Iu,!$u){const Su=zs[Au];Zs=Zs.add(vu?Su.negate():Su)}}return Zs},getPrecomputes(Hs,zs,Ys){let Zs=pointPrecomputes.get(zs);return Zs||(Zs=this.precomputeWindow(zs,Hs),Hs!==1&&pointPrecomputes.set(zs,Ys(Zs))),Zs},wNAFCached(Hs,zs,Ys){const Zs=getW(Hs);return this.wNAF(Zs,this.getPrecomputes(Zs,Hs,Ys),zs)},wNAFCachedUnsafe(Hs,zs,Ys,Zs){const _u=getW(Hs);return _u===1?this.unsafeLadder(Hs,zs,Zs):this.wNAFUnsafe(_u,this.getPrecomputes(_u,Hs,Ys),zs,Zs)},setWindowSize(Hs,zs){validateW(zs,t),pointWindowSizes.set(Hs,zs),pointPrecomputes.delete(Hs)}}}function pippenger(Z,t,Hs,zs){validateMSMPoints(Hs,Z),validateMSMScalars(zs,t);const Ys=Hs.length,Zs=zs.length;if(Ys!==Zs)throw new Error("arrays of points and scalars must have equal length");const _u=Z.ZERO,Eu=bitLen(BigInt(Ys));let Iu=1;Eu>12?Iu=Eu-3:Eu>4?Iu=Eu-2:Eu>0&&(Iu=2);const Au=bitMask(Iu),$u=new Array(Number(Au)+1).fill(_u),vu=Math.floor((t.BITS-1)/Iu)*Iu;let Su=_u;for(let Ru=vu;Ru>=0;Ru-=Iu){$u.fill(_u);for(let Cu=0;Cu<Zs;Cu++){const Bu=zs[Cu],Fu=Number(Bu>>BigInt(Ru)&Au);$u[Fu]=$u[Fu].add(Hs[Cu])}let Pu=_u;for(let Cu=$u.length-1,Bu=_u;Cu>0;Cu--)Bu=Bu.add($u[Cu]),Pu=Pu.add(Bu);if(Su=Su.add(Pu),Ru!==0)for(let Cu=0;Cu<Iu;Cu++)Su=Su.double()}return Su}function validateBasic(Z){return validateField(Z.Fp),validateObject(Z,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...nLength(Z.n,Z.nBitLength),...Z,p:Z.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function validateSigVerOpts(Z){Z.lowS!==void 0&&abool("lowS",Z.lowS),Z.prehash!==void 0&&abool("prehash",Z.prehash)}function validatePointOpts(Z){const t=validateBasic(Z);validateObject(t,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:Hs,Fp:zs,a:Ys}=t;if(Hs){if(!zs.eql(Ys,zs.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof Hs!="object"||typeof Hs.beta!="bigint"||typeof Hs.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...t})}class DERErr extends Error{constructor(t=""){super(t)}}const DER={Err:DERErr,_tlv:{encode:(Z,t)=>{const{Err:Hs}=DER;if(Z<0||Z>256)throw new Hs("tlv.encode: wrong tag");if(t.length&1)throw new Hs("tlv.encode: unpadded data");const zs=t.length/2,Ys=numberToHexUnpadded(zs);if(Ys.length/2&128)throw new Hs("tlv.encode: long form length too big");const Zs=zs>127?numberToHexUnpadded(Ys.length/2|128):"";return numberToHexUnpadded(Z)+Zs+Ys+t},decode(Z,t){const{Err:Hs}=DER;let zs=0;if(Z<0||Z>256)throw new Hs("tlv.encode: wrong tag");if(t.length<2||t[zs++]!==Z)throw new Hs("tlv.decode: wrong tlv");const Ys=t[zs++],Zs=!!(Ys&128);let _u=0;if(!Zs)_u=Ys;else{const Iu=Ys&127;if(!Iu)throw new Hs("tlv.decode(long): indefinite length not supported");if(Iu>4)throw new Hs("tlv.decode(long): byte length is too big");const Au=t.subarray(zs,zs+Iu);if(Au.length!==Iu)throw new Hs("tlv.decode: length bytes not complete");if(Au[0]===0)throw new Hs("tlv.decode(long): zero leftmost byte");for(const $u of Au)_u=_u<<8|$u;if(zs+=Iu,_u<128)throw new Hs("tlv.decode(long): not minimal encoding")}const Eu=t.subarray(zs,zs+_u);if(Eu.length!==_u)throw new Hs("tlv.decode: wrong value length");return{v:Eu,l:t.subarray(zs+_u)}}},_int:{encode(Z){const{Err:t}=DER;if(Z<_0n$1)throw new t("integer: negative integers are not allowed");let Hs=numberToHexUnpadded(Z);if(Number.parseInt(Hs[0],16)&8&&(Hs="00"+Hs),Hs.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return Hs},decode(Z){const{Err:t}=DER;if(Z[0]&128)throw new t("invalid signature integer: negative");if(Z[0]===0&&!(Z[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return bytesToNumberBE(Z)}},toSig(Z){const{Err:t,_int:Hs,_tlv:zs}=DER,Ys=ensureBytes("signature",Z),{v:Zs,l:_u}=zs.decode(48,Ys);if(_u.length)throw new t("invalid signature: left bytes after parsing");const{v:Eu,l:Iu}=zs.decode(2,Zs),{v:Au,l:$u}=zs.decode(2,Iu);if($u.length)throw new t("invalid signature: left bytes after parsing");return{r:Hs.decode(Eu),s:Hs.decode(Au)}},hexFromSig(Z){const{_tlv:t,_int:Hs}=DER,zs=t.encode(2,Hs.encode(Z.r)),Ys=t.encode(2,Hs.encode(Z.s)),Zs=zs+Ys;return t.encode(48,Zs)}};function numToSizedHex(Z,t){return bytesToHex(numberToBytesBE(Z,t))}const _0n$1=BigInt(0),_1n$1=BigInt(1);BigInt(2);const _3n=BigInt(3),_4n=BigInt(4);function weierstrassPoints(Z){const t=validatePointOpts(Z),{Fp:Hs}=t,zs=Field(t.n,t.nBitLength),Ys=t.toBytes||((Hu,Wu,tl)=>{const Xu=Wu.toAffine();return concatBytes(Uint8Array.from([4]),Hs.toBytes(Xu.x),Hs.toBytes(Xu.y))}),Zs=t.fromBytes||(Hu=>{const Wu=Hu.subarray(1),tl=Hs.fromBytes(Wu.subarray(0,Hs.BYTES)),Xu=Hs.fromBytes(Wu.subarray(Hs.BYTES,2*Hs.BYTES));return{x:tl,y:Xu}});function _u(Hu){const{a:Wu,b:tl}=t,Xu=Hs.sqr(Hu),ju=Hs.mul(Xu,Hu);return Hs.add(Hs.add(ju,Hs.mul(Hu,Wu)),tl)}function Eu(Hu,Wu){const tl=Hs.sqr(Wu),Xu=_u(Hu);return Hs.eql(tl,Xu)}if(!Eu(t.Gx,t.Gy))throw new Error("bad curve params: generator point");const Iu=Hs.mul(Hs.pow(t.a,_3n),_4n),Au=Hs.mul(Hs.sqr(t.b),BigInt(27));if(Hs.is0(Hs.add(Iu,Au)))throw new Error("bad curve params: a or b");function $u(Hu){return inRange(Hu,_1n$1,t.n)}function vu(Hu){const{allowedPrivateKeyLengths:Wu,nByteLength:tl,wrapPrivateKey:Xu,n:ju}=t;if(Wu&&typeof Hu!="bigint"){if(isBytes$1(Hu)&&(Hu=bytesToHex(Hu)),typeof Hu!="string"||!Wu.includes(Hu.length))throw new Error("invalid private key");Hu=Hu.padStart(tl*2,"0")}let ku;try{ku=typeof Hu=="bigint"?Hu:bytesToNumberBE(ensureBytes("private key",Hu,tl))}catch{throw new Error("invalid private key, expected hex or "+tl+" bytes, got "+typeof Hu)}return Xu&&(ku=mod(ku,ju)),aInRange("private key",ku,_1n$1,ju),ku}function Su(Hu){if(!(Hu instanceof Cu))throw new Error("ProjectivePoint expected")}const Ru=memoized((Hu,Wu)=>{const{px:tl,py:Xu,pz:ju}=Hu;if(Hs.eql(ju,Hs.ONE))return{x:tl,y:Xu};const ku=Hu.is0();Wu==null&&(Wu=ku?Hs.ONE:Hs.inv(ju));const Uu=Hs.mul(tl,Wu),Gu=Hs.mul(Xu,Wu),Yu=Hs.mul(ju,Wu);if(ku)return{x:Hs.ZERO,y:Hs.ZERO};if(!Hs.eql(Yu,Hs.ONE))throw new Error("invZ was invalid");return{x:Uu,y:Gu}}),Pu=memoized(Hu=>{if(Hu.is0()){if(t.allowInfinityPoint&&!Hs.is0(Hu.py))return;throw new Error("bad point: ZERO")}const{x:Wu,y:tl}=Hu.toAffine();if(!Hs.isValid(Wu)||!Hs.isValid(tl))throw new Error("bad point: x or y not FE");if(!Eu(Wu,tl))throw new Error("bad point: equation left != right");if(!Hu.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class Cu{constructor(Wu,tl,Xu){if(Wu==null||!Hs.isValid(Wu))throw new Error("x required");if(tl==null||!Hs.isValid(tl)||Hs.is0(tl))throw new Error("y required");if(Xu==null||!Hs.isValid(Xu))throw new Error("z required");this.px=Wu,this.py=tl,this.pz=Xu,Object.freeze(this)}static fromAffine(Wu){const{x:tl,y:Xu}=Wu||{};if(!Wu||!Hs.isValid(tl)||!Hs.isValid(Xu))throw new Error("invalid affine point");if(Wu instanceof Cu)throw new Error("projective point not allowed");const ju=ku=>Hs.eql(ku,Hs.ZERO);return ju(tl)&&ju(Xu)?Cu.ZERO:new Cu(tl,Xu,Hs.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(Wu){const tl=FpInvertBatch(Hs,Wu.map(Xu=>Xu.pz));return Wu.map((Xu,ju)=>Xu.toAffine(tl[ju])).map(Cu.fromAffine)}static fromHex(Wu){const tl=Cu.fromAffine(Zs(ensureBytes("pointHex",Wu)));return tl.assertValidity(),tl}static fromPrivateKey(Wu){return Cu.BASE.multiply(vu(Wu))}static msm(Wu,tl){return pippenger(Cu,zs,Wu,tl)}_setWindowSize(Wu){zu.setWindowSize(this,Wu)}assertValidity(){Pu(this)}hasEvenY(){const{y:Wu}=this.toAffine();if(Hs.isOdd)return!Hs.isOdd(Wu);throw new Error("Field doesn't support isOdd")}equals(Wu){Su(Wu);const{px:tl,py:Xu,pz:ju}=this,{px:ku,py:Uu,pz:Gu}=Wu,Yu=Hs.eql(Hs.mul(tl,Gu),Hs.mul(ku,ju)),Qu=Hs.eql(Hs.mul(Xu,Gu),Hs.mul(Uu,ju));return Yu&&Qu}negate(){return new Cu(this.px,Hs.neg(this.py),this.pz)}double(){const{a:Wu,b:tl}=t,Xu=Hs.mul(tl,_3n),{px:ju,py:ku,pz:Uu}=this;let Gu=Hs.ZERO,Yu=Hs.ZERO,Qu=Hs.ZERO,Lu=Hs.mul(ju,ju),cl=Hs.mul(ku,ku),el=Hs.mul(Uu,Uu),Zu=Hs.mul(ju,ku);return Zu=Hs.add(Zu,Zu),Qu=Hs.mul(ju,Uu),Qu=Hs.add(Qu,Qu),Gu=Hs.mul(Wu,Qu),Yu=Hs.mul(Xu,el),Yu=Hs.add(Gu,Yu),Gu=Hs.sub(cl,Yu),Yu=Hs.add(cl,Yu),Yu=Hs.mul(Gu,Yu),Gu=Hs.mul(Zu,Gu),Qu=Hs.mul(Xu,Qu),el=Hs.mul(Wu,el),Zu=Hs.sub(Lu,el),Zu=Hs.mul(Wu,Zu),Zu=Hs.add(Zu,Qu),Qu=Hs.add(Lu,Lu),Lu=Hs.add(Qu,Lu),Lu=Hs.add(Lu,el),Lu=Hs.mul(Lu,Zu),Yu=Hs.add(Yu,Lu),el=Hs.mul(ku,Uu),el=Hs.add(el,el),Lu=Hs.mul(el,Zu),Gu=Hs.sub(Gu,Lu),Qu=Hs.mul(el,cl),Qu=Hs.add(Qu,Qu),Qu=Hs.add(Qu,Qu),new Cu(Gu,Yu,Qu)}add(Wu){Su(Wu);const{px:tl,py:Xu,pz:ju}=this,{px:ku,py:Uu,pz:Gu}=Wu;let Yu=Hs.ZERO,Qu=Hs.ZERO,Lu=Hs.ZERO;const cl=t.a,el=Hs.mul(t.b,_3n);let Zu=Hs.mul(tl,ku),dl=Hs.mul(Xu,Uu),El=Hs.mul(ju,Gu),hl=Hs.add(tl,Xu),_l=Hs.add(ku,Uu);hl=Hs.mul(hl,_l),_l=Hs.add(Zu,dl),hl=Hs.sub(hl,_l),_l=Hs.add(tl,ju);let Rl=Hs.add(ku,Gu);return _l=Hs.mul(_l,Rl),Rl=Hs.add(Zu,El),_l=Hs.sub(_l,Rl),Rl=Hs.add(Xu,ju),Yu=Hs.add(Uu,Gu),Rl=Hs.mul(Rl,Yu),Yu=Hs.add(dl,El),Rl=Hs.sub(Rl,Yu),Lu=Hs.mul(cl,_l),Yu=Hs.mul(el,El),Lu=Hs.add(Yu,Lu),Yu=Hs.sub(dl,Lu),Lu=Hs.add(dl,Lu),Qu=Hs.mul(Yu,Lu),dl=Hs.add(Zu,Zu),dl=Hs.add(dl,Zu),El=Hs.mul(cl,El),_l=Hs.mul(el,_l),dl=Hs.add(dl,El),El=Hs.sub(Zu,El),El=Hs.mul(cl,El),_l=Hs.add(_l,El),Zu=Hs.mul(dl,_l),Qu=Hs.add(Qu,Zu),Zu=Hs.mul(Rl,_l),Yu=Hs.mul(hl,Yu),Yu=Hs.sub(Yu,Zu),Zu=Hs.mul(hl,dl),Lu=Hs.mul(Rl,Lu),Lu=Hs.add(Lu,Zu),new Cu(Yu,Qu,Lu)}subtract(Wu){return this.add(Wu.negate())}is0(){return this.equals(Cu.ZERO)}wNAF(Wu){return zu.wNAFCached(this,Wu,Cu.normalizeZ)}multiplyUnsafe(Wu){const{endo:tl,n:Xu}=t;aInRange("scalar",Wu,_0n$1,Xu);const ju=Cu.ZERO;if(Wu===_0n$1)return ju;if(this.is0()||Wu===_1n$1)return this;if(!tl||zu.hasPrecomputes(this))return zu.wNAFCachedUnsafe(this,Wu,Cu.normalizeZ);let{k1neg:ku,k1:Uu,k2neg:Gu,k2:Yu}=tl.splitScalar(Wu),Qu=ju,Lu=ju,cl=this;for(;Uu>_0n$1||Yu>_0n$1;)Uu&_1n$1&&(Qu=Qu.add(cl)),Yu&_1n$1&&(Lu=Lu.add(cl)),cl=cl.double(),Uu>>=_1n$1,Yu>>=_1n$1;return ku&&(Qu=Qu.negate()),Gu&&(Lu=Lu.negate()),Lu=new Cu(Hs.mul(Lu.px,tl.beta),Lu.py,Lu.pz),Qu.add(Lu)}multiply(Wu){const{endo:tl,n:Xu}=t;aInRange("scalar",Wu,_1n$1,Xu);let ju,ku;if(tl){const{k1neg:Uu,k1:Gu,k2neg:Yu,k2:Qu}=tl.splitScalar(Wu);let{p:Lu,f:cl}=this.wNAF(Gu),{p:el,f:Zu}=this.wNAF(Qu);Lu=zu.constTimeNegate(Uu,Lu),el=zu.constTimeNegate(Yu,el),el=new Cu(Hs.mul(el.px,tl.beta),el.py,el.pz),ju=Lu.add(el),ku=cl.add(Zu)}else{const{p:Uu,f:Gu}=this.wNAF(Wu);ju=Uu,ku=Gu}return Cu.normalizeZ([ju,ku])[0]}multiplyAndAddUnsafe(Wu,tl,Xu){const ju=Cu.BASE,ku=(Gu,Yu)=>Yu===_0n$1||Yu===_1n$1||!Gu.equals(ju)?Gu.multiplyUnsafe(Yu):Gu.multiply(Yu),Uu=ku(this,tl).add(ku(Wu,Xu));return Uu.is0()?void 0:Uu}toAffine(Wu){return Ru(this,Wu)}isTorsionFree(){const{h:Wu,isTorsionFree:tl}=t;if(Wu===_1n$1)return!0;if(tl)return tl(Cu,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:Wu,clearCofactor:tl}=t;return Wu===_1n$1?this:tl?tl(Cu,this):this.multiplyUnsafe(t.h)}toRawBytes(Wu=!0){return abool("isCompressed",Wu),this.assertValidity(),Ys(Cu,this,Wu)}toHex(Wu=!0){return abool("isCompressed",Wu),bytesToHex(this.toRawBytes(Wu))}}Cu.BASE=new Cu(t.Gx,t.Gy,Hs.ONE),Cu.ZERO=new Cu(Hs.ZERO,Hs.ONE,Hs.ZERO);const{endo:Bu,nBitLength:Fu}=t,zu=wNAF(Cu,Bu?Math.ceil(Fu/2):Fu);return{CURVE:t,ProjectivePoint:Cu,normPrivateKeyToScalar:vu,weierstrassEquation:_u,isWithinCurveOrder:$u}}function validateOpts(Z){const t=validateBasic(Z);return validateObject(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function weierstrass(Z){const t=validateOpts(Z),{Fp:Hs,n:zs,nByteLength:Ys,nBitLength:Zs}=t,_u=Hs.BYTES+1,Eu=2*Hs.BYTES+1;function Iu(el){return mod(el,zs)}function Au(el){return invert(el,zs)}const{ProjectivePoint:$u,normPrivateKeyToScalar:vu,weierstrassEquation:Su,isWithinCurveOrder:Ru}=weierstrassPoints({...t,toBytes(el,Zu,dl){const El=Zu.toAffine(),hl=Hs.toBytes(El.x),_l=concatBytes;return abool("isCompressed",dl),dl?_l(Uint8Array.from([Zu.hasEvenY()?2:3]),hl):_l(Uint8Array.from([4]),hl,Hs.toBytes(El.y))},fromBytes(el){const Zu=el.length,dl=el[0],El=el.subarray(1);if(Zu===_u&&(dl===2||dl===3)){const hl=bytesToNumberBE(El);if(!inRange(hl,_1n$1,Hs.ORDER))throw new Error("Point is not on curve");const _l=Su(hl);let Rl;try{Rl=Hs.sqrt(_l)}catch(nl){const Sl=nl instanceof Error?": "+nl.message:"";throw new Error("Point is not on curve"+Sl)}const ol=(Rl&_1n$1)===_1n$1;return(dl&1)===1!==ol&&(Rl=Hs.neg(Rl)),{x:hl,y:Rl}}else if(Zu===Eu&&dl===4){const hl=Hs.fromBytes(El.subarray(0,Hs.BYTES)),_l=Hs.fromBytes(El.subarray(Hs.BYTES,2*Hs.BYTES));return{x:hl,y:_l}}else{const hl=_u,_l=Eu;throw new Error("invalid Point, expected length of "+hl+", or uncompressed "+_l+", got "+Zu)}}});function Pu(el){const Zu=zs>>_1n$1;return el>Zu}function Cu(el){return Pu(el)?Iu(-el):el}const Bu=(el,Zu,dl)=>bytesToNumberBE(el.slice(Zu,dl));class Fu{constructor(Zu,dl,El){aInRange("r",Zu,_1n$1,zs),aInRange("s",dl,_1n$1,zs),this.r=Zu,this.s=dl,El!=null&&(this.recovery=El),Object.freeze(this)}static fromCompact(Zu){const dl=Ys;return Zu=ensureBytes("compactSignature",Zu,dl*2),new Fu(Bu(Zu,0,dl),Bu(Zu,dl,2*dl))}static fromDER(Zu){const{r:dl,s:El}=DER.toSig(ensureBytes("DER",Zu));return new Fu(dl,El)}assertValidity(){}addRecoveryBit(Zu){return new Fu(this.r,this.s,Zu)}recoverPublicKey(Zu){const{r:dl,s:El,recovery:hl}=this,_l=ju(ensureBytes("msgHash",Zu));if(hl==null||![0,1,2,3].includes(hl))throw new Error("recovery id invalid");const Rl=hl===2||hl===3?dl+t.n:dl;if(Rl>=Hs.ORDER)throw new Error("recovery id 2 or 3 invalid");const ol=hl&1?"03":"02",gl=$u.fromHex(ol+numToSizedHex(Rl,Hs.BYTES)),nl=Au(Rl),Sl=Iu(-_l*nl),ll=Iu(El*nl),ul=$u.BASE.multiplyAndAddUnsafe(gl,Sl,ll);if(!ul)throw new Error("point at infinify");return ul.assertValidity(),ul}hasHighS(){return Pu(this.s)}normalizeS(){return this.hasHighS()?new Fu(this.r,Iu(-this.s),this.recovery):this}toDERRawBytes(){return hexToBytes(this.toDERHex())}toDERHex(){return DER.hexFromSig(this)}toCompactRawBytes(){return hexToBytes(this.toCompactHex())}toCompactHex(){const Zu=Ys;return numToSizedHex(this.r,Zu)+numToSizedHex(this.s,Zu)}}const zu={isValidPrivateKey(el){try{return vu(el),!0}catch{return!1}},normPrivateKeyToScalar:vu,randomPrivateKey:()=>{const el=getMinHashLength(t.n);return mapHashToField(t.randomBytes(el),t.n)},precompute(el=8,Zu=$u.BASE){return Zu._setWindowSize(el),Zu.multiply(BigInt(3)),Zu}};function Hu(el,Zu=!0){return $u.fromPrivateKey(el).toRawBytes(Zu)}function Wu(el){if(typeof el=="bigint")return!1;if(el instanceof $u)return!0;const dl=ensureBytes("key",el).length,El=Hs.BYTES,hl=El+1,_l=2*El+1;if(!(t.allowedPrivateKeyLengths||Ys===hl))return dl===hl||dl===_l}function tl(el,Zu,dl=!0){if(Wu(el)===!0)throw new Error("first arg must be private key");if(Wu(Zu)===!1)throw new Error("second arg must be public key");return $u.fromHex(Zu).multiply(vu(el)).toRawBytes(dl)}const Xu=t.bits2int||function(el){if(el.length>8192)throw new Error("input is too large");const Zu=bytesToNumberBE(el),dl=el.length*8-Zs;return dl>0?Zu>>BigInt(dl):Zu},ju=t.bits2int_modN||function(el){return Iu(Xu(el))},ku=bitMask(Zs);function Uu(el){return aInRange("num < 2^"+Zs,el,_0n$1,ku),numberToBytesBE(el,Ys)}function Gu(el,Zu,dl=Yu){if(["recovered","canonical"].some(Tl=>Tl in dl))throw new Error("sign() legacy options not supported");const{hash:El,randomBytes:hl}=t;let{lowS:_l,prehash:Rl,extraEntropy:ol}=dl;_l==null&&(_l=!0),el=ensureBytes("msgHash",el),validateSigVerOpts(dl),Rl&&(el=ensureBytes("prehashed msgHash",El(el)));const gl=ju(el),nl=vu(Zu),Sl=[Uu(nl),Uu(gl)];if(ol!=null&&ol!==!1){const Tl=ol===!0?hl(Hs.BYTES):ol;Sl.push(ensureBytes("extraEntropy",Tl))}const ll=concatBytes(...Sl),ul=gl;function Al(Tl){const qu=Xu(Tl);if(!Ru(qu))return;const Ou=Au(qu),Vu=$u.BASE.multiply(qu).toAffine(),il=Iu(Vu.x);if(il===_0n$1)return;const sl=Iu(Ou*Iu(ul+il*nl));if(sl===_0n$1)return;let pl=(Vu.x===il?0:2)|Number(Vu.y&_1n$1),yl=sl;return _l&&Pu(sl)&&(yl=Cu(sl),pl^=1),new Fu(il,yl,pl)}return{seed:ll,k2sig:Al}}const Yu={lowS:t.lowS,prehash:!1},Qu={lowS:t.lowS,prehash:!1};function Lu(el,Zu,dl=Yu){const{seed:El,k2sig:hl}=Gu(el,Zu,dl),_l=t;return createHmacDrbg(_l.hash.outputLen,_l.nByteLength,_l.hmac)(El,hl)}$u.BASE._setWindowSize(8);function cl(el,Zu,dl,El=Qu){var pl;const hl=el;Zu=ensureBytes("msgHash",Zu),dl=ensureBytes("publicKey",dl);const{lowS:_l,prehash:Rl,format:ol}=El;if(validateSigVerOpts(El),"strict"in El)throw new Error("options.strict was renamed to lowS");if(ol!==void 0&&ol!=="compact"&&ol!=="der")throw new Error("format must be compact or der");const gl=typeof hl=="string"||isBytes$1(hl),nl=!gl&&!ol&&typeof hl=="object"&&hl!==null&&typeof hl.r=="bigint"&&typeof hl.s=="bigint";if(!gl&&!nl)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let Sl,ll;try{if(nl&&(Sl=new Fu(hl.r,hl.s)),gl){try{ol!=="compact"&&(Sl=Fu.fromDER(hl))}catch(yl){if(!(yl instanceof DER.Err))throw yl}!Sl&&ol!=="der"&&(Sl=Fu.fromCompact(hl))}ll=$u.fromHex(dl)}catch{return!1}if(!Sl||_l&&Sl.hasHighS())return!1;Rl&&(Zu=t.hash(Zu));const{r:ul,s:Al}=Sl,Tl=ju(Zu),qu=Au(Al),Ou=Iu(Tl*qu),Vu=Iu(ul*qu),il=(pl=$u.BASE.multiplyAndAddUnsafe(ll,Ou,Vu))==null?void 0:pl.toAffine();return il?Iu(il.x)===ul:!1}return{CURVE:t,getPublicKey:Hu,getSharedSecret:tl,sign:Lu,verify:cl,ProjectivePoint:$u,Signature:Fu,utils:zu}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function getHash(Z){return{hash:Z,hmac:(t,...Hs)=>hmac(Z,t,concatBytes$1(...Hs)),randomBytes}}function createCurve(Z,t){const Hs=zs=>weierstrass({...Z,...getHash(zs)});return{...Hs(t),create:Hs}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const secp256k1P=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),secp256k1N=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),_0n=BigInt(0),_1n=BigInt(1),_2n=BigInt(2),divNearest=(Z,t)=>(Z+t/_2n)/t;function sqrtMod(Z){const t=secp256k1P,Hs=BigInt(3),zs=BigInt(6),Ys=BigInt(11),Zs=BigInt(22),_u=BigInt(23),Eu=BigInt(44),Iu=BigInt(88),Au=Z*Z*Z%t,$u=Au*Au*Z%t,vu=pow2($u,Hs,t)*$u%t,Su=pow2(vu,Hs,t)*$u%t,Ru=pow2(Su,_2n,t)*Au%t,Pu=pow2(Ru,Ys,t)*Ru%t,Cu=pow2(Pu,Zs,t)*Pu%t,Bu=pow2(Cu,Eu,t)*Cu%t,Fu=pow2(Bu,Iu,t)*Bu%t,zu=pow2(Fu,Eu,t)*Cu%t,Hu=pow2(zu,Hs,t)*$u%t,Wu=pow2(Hu,_u,t)*Pu%t,tl=pow2(Wu,zs,t)*Au%t,Xu=pow2(tl,_2n,t);if(!Fpk1.eql(Fpk1.sqr(Xu),Z))throw new Error("Cannot find square root");return Xu}const Fpk1=Field(secp256k1P,void 0,void 0,{sqrt:sqrtMod}),secp256k1=createCurve({a:_0n,b:BigInt(7),Fp:Fpk1,n:secp256k1N,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:Z=>{const t=secp256k1N,Hs=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),zs=-_1n*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),Ys=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),Zs=Hs,_u=BigInt("0x100000000000000000000000000000000"),Eu=divNearest(Zs*Z,t),Iu=divNearest(-zs*Z,t);let Au=mod(Z-Eu*Hs-Iu*Ys,t),$u=mod(-Eu*zs-Iu*Zs,t);const vu=Au>_u,Su=$u>_u;if(vu&&(Au=t-Au),Su&&($u=t-$u),Au>_u||$u>_u)throw new Error("splitScalar: Endomorphism failed, k="+Z);return{k1neg:vu,k1:Au,k2neg:Su,k2:$u}}}},sha256);function fromHex(Z){if(Z.length!==130&&Z.length!==132)throw new InvalidSerializedSizeError({signature:Z});const t=BigInt(slice(Z,0,32)),Hs=BigInt(slice(Z,32,64)),zs=(()=>{const Ys=+`0x${Z.slice(130)}`;if(!Number.isNaN(Ys))try{return vToYParity(Ys)}catch{throw new InvalidYParityError({value:Ys})}})();return typeof zs>"u"?{r:t,s:Hs}:{r:t,s:Hs,yParity:zs}}function vToYParity(Z){if(Z===0||Z===27)return 0;if(Z===1||Z===28)return 1;if(Z>=35)return Z%2===0?1:0;throw new InvalidVError({value:Z})}class InvalidSerializedSizeError extends BaseError{constructor({signature:t}){super(`Value \`${t}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${size$1(from$4(t))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class InvalidYParityError extends BaseError{constructor({value:t}){super(`Value \`${t}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class InvalidVError extends BaseError{constructor({value:t}){super(`Value \`${t}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function isBytes(Z){return Z instanceof Uint8Array||ArrayBuffer.isView(Z)&&Z.constructor.name==="Uint8Array"}function isArrayOf(Z,t){return Array.isArray(t)?t.length===0?!0:Z?t.every(Hs=>typeof Hs=="string"):t.every(Hs=>Number.isSafeInteger(Hs)):!1}function astr(Z,t){if(typeof t!="string")throw new Error(`${Z}: string expected`);return!0}function anumber(Z){if(!Number.isSafeInteger(Z))throw new Error(`invalid integer: ${Z}`)}function aArr(Z){if(!Array.isArray(Z))throw new Error("array expected")}function astrArr(Z,t){if(!isArrayOf(!0,t))throw new Error(`${Z}: array of strings expected`)}function anumArr(Z,t){if(!isArrayOf(!1,t))throw new Error(`${Z}: array of numbers expected`)}function chain(...Z){const t=Zs=>Zs,Hs=(Zs,_u)=>Eu=>Zs(_u(Eu)),zs=Z.map(Zs=>Zs.encode).reduceRight(Hs,t),Ys=Z.map(Zs=>Zs.decode).reduce(Hs,t);return{encode:zs,decode:Ys}}function alphabet$1(Z){const t=typeof Z=="string"?Z.split(""):Z,Hs=t.length;astrArr("alphabet",t);const zs=new Map(t.map((Ys,Zs)=>[Ys,Zs]));return{encode:Ys=>(aArr(Ys),Ys.map(Zs=>{if(!Number.isSafeInteger(Zs)||Zs<0||Zs>=Hs)throw new Error(`alphabet.encode: digit index outside alphabet "${Zs}". Allowed: ${Z}`);return t[Zs]})),decode:Ys=>(aArr(Ys),Ys.map(Zs=>{astr("alphabet.decode",Zs);const _u=zs.get(Zs);if(_u===void 0)throw new Error(`Unknown letter: "${Zs}". Allowed: ${Z}`);return _u}))}}function join(Z=""){return astr("join",Z),{encode:t=>(astrArr("join.decode",t),t.join(Z)),decode:t=>(astr("join.decode",t),t.split(Z))}}function padding(Z,t="="){return anumber(Z),astr("padding",t),{encode(Hs){for(astrArr("padding.encode",Hs);Hs.length*Z%8;)Hs.push(t);return Hs},decode(Hs){astrArr("padding.decode",Hs);let zs=Hs.length;if(zs*Z%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;zs>0&&Hs[zs-1]===t;zs--)if((zs-1)*Z%8===0)throw new Error("padding: invalid, string has too much padding");return Hs.slice(0,zs)}}}const gcd=(Z,t)=>t===0?Z:gcd(t,Z%t),radix2carry=(Z,t)=>Z+(t-gcd(Z,t)),powers=(()=>{let Z=[];for(let t=0;t<40;t++)Z.push(2**t);return Z})();function convertRadix2(Z,t,Hs,zs){if(aArr(Z),t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(Hs<=0||Hs>32)throw new Error(`convertRadix2: wrong to=${Hs}`);if(radix2carry(t,Hs)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${Hs} carryBits=${radix2carry(t,Hs)}`);let Ys=0,Zs=0;const _u=powers[t],Eu=powers[Hs]-1,Iu=[];for(const Au of Z){if(anumber(Au),Au>=_u)throw new Error(`convertRadix2: invalid data word=${Au} from=${t}`);if(Ys=Ys<<t|Au,Zs+t>32)throw new Error(`convertRadix2: carry overflow pos=${Zs} from=${t}`);for(Zs+=t;Zs>=Hs;Zs-=Hs)Iu.push((Ys>>Zs-Hs&Eu)>>>0);const $u=powers[Zs];if($u===void 0)throw new Error("invalid carry");Ys&=$u-1}if(Ys=Ys<<Hs-Zs&Eu,!zs&&Zs>=t)throw new Error("Excess padding");if(!zs&&Ys>0)throw new Error(`Non-zero padding: ${Ys}`);return zs&&Zs>0&&Iu.push(Ys>>>0),Iu}function radix2(Z,t=!1){if(anumber(Z),Z<=0||Z>32)throw new Error("radix2: bits should be in (0..32]");if(radix2carry(8,Z)>32||radix2carry(Z,8)>32)throw new Error("radix2: carry overflow");return{encode:Hs=>{if(!isBytes(Hs))throw new Error("radix2.encode input should be Uint8Array");return convertRadix2(Array.from(Hs),8,Z,!t)},decode:Hs=>(anumArr("radix2.decode",Hs),Uint8Array.from(convertRadix2(Hs,Z,8,t)))}}const base32$2=chain(radix2(5),alphabet$1("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),padding(5),join(""));function recoverAddress(Z){return fromPublicKey(recoverPublicKey(Z))}function recoverPublicKey(Z){const{payload:t,signature:Hs}=Z,{r:zs,s:Ys,yParity:Zs}=Hs,Eu=new secp256k1.Signature(BigInt(zs),BigInt(Ys)).addRecoveryBit(Zs).recoverPublicKey(from$4(t).substring(2));return from$2(Eu)}function base$1(Z){if(Z.length>=255)throw new TypeError("Alphabet too long");const t=new Uint8Array(256);for(let Au=0;Au<t.length;Au++)t[Au]=255;for(let Au=0;Au<Z.length;Au++){const $u=Z.charAt(Au),vu=$u.charCodeAt(0);if(t[vu]!==255)throw new TypeError($u+" is ambiguous");t[vu]=Au}const Hs=Z.length,zs=Z.charAt(0),Ys=Math.log(Hs)/Math.log(256),Zs=Math.log(256)/Math.log(Hs);function _u(Au){if(Au instanceof Uint8Array||(ArrayBuffer.isView(Au)?Au=new Uint8Array(Au.buffer,Au.byteOffset,Au.byteLength):Array.isArray(Au)&&(Au=Uint8Array.from(Au))),!(Au instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(Au.length===0)return"";let $u=0,vu=0,Su=0;const Ru=Au.length;for(;Su!==Ru&&Au[Su]===0;)Su++,$u++;const Pu=(Ru-Su)*Zs+1>>>0,Cu=new Uint8Array(Pu);for(;Su!==Ru;){let zu=Au[Su],Hu=0;for(let Wu=Pu-1;(zu!==0||Hu<vu)&&Wu!==-1;Wu--,Hu++)zu+=256*Cu[Wu]>>>0,Cu[Wu]=zu%Hs>>>0,zu=zu/Hs>>>0;if(zu!==0)throw new Error("Non-zero carry");vu=Hu,Su++}let Bu=Pu-vu;for(;Bu!==Pu&&Cu[Bu]===0;)Bu++;let Fu=zs.repeat($u);for(;Bu<Pu;++Bu)Fu+=Z.charAt(Cu[Bu]);return Fu}function Eu(Au){if(typeof Au!="string")throw new TypeError("Expected String");if(Au.length===0)return new Uint8Array;let $u=0,vu=0,Su=0;for(;Au[$u]===zs;)vu++,$u++;const Ru=(Au.length-$u)*Ys+1>>>0,Pu=new Uint8Array(Ru);for(;$u<Au.length;){const zu=Au.charCodeAt($u);if(zu>255)return;let Hu=t[zu];if(Hu===255)return;let Wu=0;for(let tl=Ru-1;(Hu!==0||Wu<Su)&&tl!==-1;tl--,Wu++)Hu+=Hs*Pu[tl]>>>0,Pu[tl]=Hu%256>>>0,Hu=Hu/256>>>0;if(Hu!==0)throw new Error("Non-zero carry");Su=Wu,$u++}let Cu=Ru-Su;for(;Cu!==Ru&&Pu[Cu]===0;)Cu++;const Bu=new Uint8Array(vu+(Ru-Cu));let Fu=vu;for(;Cu!==Ru;)Bu[Fu++]=Pu[Cu++];return Bu}function Iu(Au){const $u=Eu(Au);if($u)return $u;throw new Error("Non-base"+Hs+" character")}return{encode:_u,decodeUnsafe:Eu,decode:Iu}}var ALPHABET="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const ue=base$1(ALPHABET);function utf8Count(Z){const t=Z.length;let Hs=0,zs=0;for(;zs<t;){let Ys=Z.charCodeAt(zs++);if(Ys&4294967168)if(!(Ys&4294965248))Hs+=2;else{if(Ys>=55296&&Ys<=56319&&zs<t){const Zs=Z.charCodeAt(zs);(Zs&64512)===56320&&(++zs,Ys=((Ys&1023)<<10)+(Zs&1023)+65536)}Ys&4294901760?Hs+=4:Hs+=3}else{Hs++;continue}}return Hs}function utf8EncodeJs(Z,t,Hs){const zs=Z.length;let Ys=Hs,Zs=0;for(;Zs<zs;){let _u=Z.charCodeAt(Zs++);if(_u&4294967168)if(!(_u&4294965248))t[Ys++]=_u>>6&31|192;else{if(_u>=55296&&_u<=56319&&Zs<zs){const Eu=Z.charCodeAt(Zs);(Eu&64512)===56320&&(++Zs,_u=((_u&1023)<<10)+(Eu&1023)+65536)}_u&4294901760?(t[Ys++]=_u>>18&7|240,t[Ys++]=_u>>12&63|128,t[Ys++]=_u>>6&63|128):(t[Ys++]=_u>>12&15|224,t[Ys++]=_u>>6&63|128)}else{t[Ys++]=_u;continue}t[Ys++]=_u&63|128}}const sharedTextEncoder=new TextEncoder,TEXT_ENCODER_THRESHOLD=50;function utf8EncodeTE(Z,t,Hs){sharedTextEncoder.encodeInto(Z,t.subarray(Hs))}function utf8Encode(Z,t,Hs){Z.length>TEXT_ENCODER_THRESHOLD?utf8EncodeTE(Z,t,Hs):utf8EncodeJs(Z,t,Hs)}const CHUNK_SIZE=4096;function utf8DecodeJs(Z,t,Hs){let zs=t;const Ys=zs+Hs,Zs=[];let _u="";for(;zs<Ys;){const Eu=Z[zs++];if(!(Eu&128))Zs.push(Eu);else if((Eu&224)===192){const Iu=Z[zs++]&63;Zs.push((Eu&31)<<6|Iu)}else if((Eu&240)===224){const Iu=Z[zs++]&63,Au=Z[zs++]&63;Zs.push((Eu&31)<<12|Iu<<6|Au)}else if((Eu&248)===240){const Iu=Z[zs++]&63,Au=Z[zs++]&63,$u=Z[zs++]&63;let vu=(Eu&7)<<18|Iu<<12|Au<<6|$u;vu>65535&&(vu-=65536,Zs.push(vu>>>10&1023|55296),vu=56320|vu&1023),Zs.push(vu)}else Zs.push(Eu);Zs.length>=CHUNK_SIZE&&(_u+=String.fromCharCode(...Zs),Zs.length=0)}return Zs.length>0&&(_u+=String.fromCharCode(...Zs)),_u}const sharedTextDecoder=new TextDecoder,TEXT_DECODER_THRESHOLD=200;function utf8DecodeTD(Z,t,Hs){const zs=Z.subarray(t,t+Hs);return sharedTextDecoder.decode(zs)}function utf8Decode(Z,t,Hs){return Hs>TEXT_DECODER_THRESHOLD?utf8DecodeTD(Z,t,Hs):utf8DecodeJs(Z,t,Hs)}class ExtData{constructor(t,Hs){this.type=t,this.data=Hs}}class DecodeError extends Error{constructor(t){super(t);const Hs=Object.create(DecodeError.prototype);Object.setPrototypeOf(this,Hs),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:DecodeError.name})}}const UINT32_MAX=4294967295;function setUint64(Z,t,Hs){const zs=Hs/4294967296,Ys=Hs;Z.setUint32(t,zs),Z.setUint32(t+4,Ys)}function setInt64(Z,t,Hs){const zs=Math.floor(Hs/4294967296),Ys=Hs;Z.setUint32(t,zs),Z.setUint32(t+4,Ys)}function getInt64(Z,t){const Hs=Z.getInt32(t),zs=Z.getUint32(t+4);return Hs*4294967296+zs}function getUint64(Z,t){const Hs=Z.getUint32(t),zs=Z.getUint32(t+4);return Hs*4294967296+zs}const EXT_TIMESTAMP=-1,TIMESTAMP32_MAX_SEC=4294967296-1,TIMESTAMP64_MAX_SEC=17179869184-1;function encodeTimeSpecToTimestamp({sec:Z,nsec:t}){if(Z>=0&&t>=0&&Z<=TIMESTAMP64_MAX_SEC)if(t===0&&Z<=TIMESTAMP32_MAX_SEC){const Hs=new Uint8Array(4);return new DataView(Hs.buffer).setUint32(0,Z),Hs}else{const Hs=Z/4294967296,zs=Z&4294967295,Ys=new Uint8Array(8),Zs=new DataView(Ys.buffer);return Zs.setUint32(0,t<<2|Hs&3),Zs.setUint32(4,zs),Ys}else{const Hs=new Uint8Array(12),zs=new DataView(Hs.buffer);return zs.setUint32(0,t),setInt64(zs,4,Z),Hs}}function encodeDateToTimeSpec(Z){const t=Z.getTime(),Hs=Math.floor(t/1e3),zs=(t-Hs*1e3)*1e6,Ys=Math.floor(zs/1e9);return{sec:Hs+Ys,nsec:zs-Ys*1e9}}function encodeTimestampExtension(Z){if(Z instanceof Date){const t=encodeDateToTimeSpec(Z);return encodeTimeSpecToTimestamp(t)}else return null}function decodeTimestampToTimeSpec(Z){const t=new DataView(Z.buffer,Z.byteOffset,Z.byteLength);switch(Z.byteLength){case 4:return{sec:t.getUint32(0),nsec:0};case 8:{const Hs=t.getUint32(0),zs=t.getUint32(4),Ys=(Hs&3)*4294967296+zs,Zs=Hs>>>2;return{sec:Ys,nsec:Zs}}case 12:{const Hs=getInt64(t,4),zs=t.getUint32(0);return{sec:Hs,nsec:zs}}default:throw new DecodeError(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${Z.length}`)}}function decodeTimestampExtension(Z){const t=decodeTimestampToTimeSpec(Z);return new Date(t.sec*1e3+t.nsec/1e6)}const timestampExtension={type:EXT_TIMESTAMP,encode:encodeTimestampExtension,decode:decodeTimestampExtension};class ExtensionCodec{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(timestampExtension)}register({type:t,encode:Hs,decode:zs}){if(t>=0)this.encoders[t]=Hs,this.decoders[t]=zs;else{const Ys=-1-t;this.builtInEncoders[Ys]=Hs,this.builtInDecoders[Ys]=zs}}tryToEncode(t,Hs){for(let zs=0;zs<this.builtInEncoders.length;zs++){const Ys=this.builtInEncoders[zs];if(Ys!=null){const Zs=Ys(t,Hs);if(Zs!=null){const _u=-1-zs;return new ExtData(_u,Zs)}}}for(let zs=0;zs<this.encoders.length;zs++){const Ys=this.encoders[zs];if(Ys!=null){const Zs=Ys(t,Hs);if(Zs!=null){const _u=zs;return new ExtData(_u,Zs)}}}return t instanceof ExtData?t:null}decode(t,Hs,zs){const Ys=Hs<0?this.builtInDecoders[-1-Hs]:this.decoders[Hs];return Ys?Ys(t,Hs,zs):new ExtData(Hs,t)}}ExtensionCodec.defaultCodec=new ExtensionCodec;function isArrayBufferLike(Z){return Z instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&Z instanceof SharedArrayBuffer}function ensureUint8Array(Z){return Z instanceof Uint8Array?Z:ArrayBuffer.isView(Z)?new Uint8Array(Z.buffer,Z.byteOffset,Z.byteLength):isArrayBufferLike(Z)?new Uint8Array(Z):Uint8Array.from(Z)}const DEFAULT_MAX_DEPTH=100,DEFAULT_INITIAL_BUFFER_SIZE=2048;let Encoder$1=class Qd{constructor(t){this.entered=!1,this.extensionCodec=(t==null?void 0:t.extensionCodec)??ExtensionCodec.defaultCodec,this.context=t==null?void 0:t.context,this.useBigInt64=(t==null?void 0:t.useBigInt64)??!1,this.maxDepth=(t==null?void 0:t.maxDepth)??DEFAULT_MAX_DEPTH,this.initialBufferSize=(t==null?void 0:t.initialBufferSize)??DEFAULT_INITIAL_BUFFER_SIZE,this.sortKeys=(t==null?void 0:t.sortKeys)??!1,this.forceFloat32=(t==null?void 0:t.forceFloat32)??!1,this.ignoreUndefined=(t==null?void 0:t.ignoreUndefined)??!1,this.forceIntegerToFloat=(t==null?void 0:t.forceIntegerToFloat)??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new Qd({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(t){if(this.entered)return this.clone().encodeSharedRef(t);try{return this.entered=!0,this.reinitializeState(),this.doEncode(t,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(t){if(this.entered)return this.clone().encode(t);try{return this.entered=!0,this.reinitializeState(),this.doEncode(t,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(t,Hs){if(Hs>this.maxDepth)throw new Error(`Too deep objects in depth ${Hs}`);t==null?this.encodeNil():typeof t=="boolean"?this.encodeBoolean(t):typeof t=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(t):this.encodeNumber(t):typeof t=="string"?this.encodeString(t):this.useBigInt64&&typeof t=="bigint"?this.encodeBigInt64(t):this.encodeObject(t,Hs)}ensureBufferSizeToWrite(t){const Hs=this.pos+t;this.view.byteLength<Hs&&this.resizeBuffer(Hs*2)}resizeBuffer(t){const Hs=new ArrayBuffer(t),zs=new Uint8Array(Hs),Ys=new DataView(Hs);zs.set(this.bytes),this.view=Ys,this.bytes=zs}encodeNil(){this.writeU8(192)}encodeBoolean(t){t===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(t){!this.forceIntegerToFloat&&Number.isSafeInteger(t)?t>=0?t<128?this.writeU8(t):t<256?(this.writeU8(204),this.writeU8(t)):t<65536?(this.writeU8(205),this.writeU16(t)):t<4294967296?(this.writeU8(206),this.writeU32(t)):this.useBigInt64?this.encodeNumberAsFloat(t):(this.writeU8(207),this.writeU64(t)):t>=-32?this.writeU8(224|t+32):t>=-128?(this.writeU8(208),this.writeI8(t)):t>=-32768?(this.writeU8(209),this.writeI16(t)):t>=-2147483648?(this.writeU8(210),this.writeI32(t)):this.useBigInt64?this.encodeNumberAsFloat(t):(this.writeU8(211),this.writeI64(t)):this.encodeNumberAsFloat(t)}encodeNumberAsFloat(t){this.forceFloat32?(this.writeU8(202),this.writeF32(t)):(this.writeU8(203),this.writeF64(t))}encodeBigInt64(t){t>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(t)):(this.writeU8(211),this.writeBigInt64(t))}writeStringHeader(t){if(t<32)this.writeU8(160+t);else if(t<256)this.writeU8(217),this.writeU8(t);else if(t<65536)this.writeU8(218),this.writeU16(t);else if(t<4294967296)this.writeU8(219),this.writeU32(t);else throw new Error(`Too long string: ${t} bytes in UTF-8`)}encodeString(t){const zs=utf8Count(t);this.ensureBufferSizeToWrite(5+zs),this.writeStringHeader(zs),utf8Encode(t,this.bytes,this.pos),this.pos+=zs}encodeObject(t,Hs){const zs=this.extensionCodec.tryToEncode(t,this.context);if(zs!=null)this.encodeExtension(zs);else if(Array.isArray(t))this.encodeArray(t,Hs);else if(ArrayBuffer.isView(t))this.encodeBinary(t);else if(typeof t=="object")this.encodeMap(t,Hs);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(t)}`)}encodeBinary(t){const Hs=t.byteLength;if(Hs<256)this.writeU8(196),this.writeU8(Hs);else if(Hs<65536)this.writeU8(197),this.writeU16(Hs);else if(Hs<4294967296)this.writeU8(198),this.writeU32(Hs);else throw new Error(`Too large binary: ${Hs}`);const zs=ensureUint8Array(t);this.writeU8a(zs)}encodeArray(t,Hs){const zs=t.length;if(zs<16)this.writeU8(144+zs);else if(zs<65536)this.writeU8(220),this.writeU16(zs);else if(zs<4294967296)this.writeU8(221),this.writeU32(zs);else throw new Error(`Too large array: ${zs}`);for(const Ys of t)this.doEncode(Ys,Hs+1)}countWithoutUndefined(t,Hs){let zs=0;for(const Ys of Hs)t[Ys]!==void 0&&zs++;return zs}encodeMap(t,Hs){const zs=Object.keys(t);this.sortKeys&&zs.sort();const Ys=this.ignoreUndefined?this.countWithoutUndefined(t,zs):zs.length;if(Ys<16)this.writeU8(128+Ys);else if(Ys<65536)this.writeU8(222),this.writeU16(Ys);else if(Ys<4294967296)this.writeU8(223),this.writeU32(Ys);else throw new Error(`Too large map object: ${Ys}`);for(const Zs of zs){const _u=t[Zs];this.ignoreUndefined&&_u===void 0||(this.encodeString(Zs),this.doEncode(_u,Hs+1))}}encodeExtension(t){if(typeof t.data=="function"){const zs=t.data(this.pos+6),Ys=zs.length;if(Ys>=4294967296)throw new Error(`Too large extension object: ${Ys}`);this.writeU8(201),this.writeU32(Ys),this.writeI8(t.type),this.writeU8a(zs);return}const Hs=t.data.length;if(Hs===1)this.writeU8(212);else if(Hs===2)this.writeU8(213);else if(Hs===4)this.writeU8(214);else if(Hs===8)this.writeU8(215);else if(Hs===16)this.writeU8(216);else if(Hs<256)this.writeU8(199),this.writeU8(Hs);else if(Hs<65536)this.writeU8(200),this.writeU16(Hs);else if(Hs<4294967296)this.writeU8(201),this.writeU32(Hs);else throw new Error(`Too large extension object: ${Hs}`);this.writeI8(t.type),this.writeU8a(t.data)}writeU8(t){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,t),this.pos++}writeU8a(t){const Hs=t.length;this.ensureBufferSizeToWrite(Hs),this.bytes.set(t,this.pos),this.pos+=Hs}writeI8(t){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,t),this.pos++}writeU16(t){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,t),this.pos+=2}writeI16(t){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,t),this.pos+=2}writeU32(t){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,t),this.pos+=4}writeI32(t){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,t),this.pos+=4}writeF32(t){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,t),this.pos+=4}writeF64(t){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,t),this.pos+=8}writeU64(t){this.ensureBufferSizeToWrite(8),setUint64(this.view,this.pos,t),this.pos+=8}writeI64(t){this.ensureBufferSizeToWrite(8),setInt64(this.view,this.pos,t),this.pos+=8}writeBigUint64(t){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,t),this.pos+=8}writeBigInt64(t){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,t),this.pos+=8}};function encode$2(Z,t){return new Encoder$1(t).encodeSharedRef(Z)}function prettyByte(Z){return`${Z<0?"-":""}0x${Math.abs(Z).toString(16).padStart(2,"0")}`}const DEFAULT_MAX_KEY_LENGTH=16,DEFAULT_MAX_LENGTH_PER_KEY=16;class CachedKeyDecoder{constructor(t=DEFAULT_MAX_KEY_LENGTH,Hs=DEFAULT_MAX_LENGTH_PER_KEY){this.hit=0,this.miss=0,this.maxKeyLength=t,this.maxLengthPerKey=Hs,this.caches=[];for(let zs=0;zs<this.maxKeyLength;zs++)this.caches.push([])}canBeCached(t){return t>0&&t<=this.maxKeyLength}find(t,Hs,zs){const Ys=this.caches[zs-1];e:for(const Zs of Ys){const _u=Zs.bytes;for(let Eu=0;Eu<zs;Eu++)if(_u[Eu]!==t[Hs+Eu])continue e;return Zs.str}return null}store(t,Hs){const zs=this.caches[t.length-1],Ys={bytes:t,str:Hs};zs.length>=this.maxLengthPerKey?zs[Math.random()*zs.length|0]=Ys:zs.push(Ys)}decode(t,Hs,zs){const Ys=this.find(t,Hs,zs);if(Ys!=null)return this.hit++,Ys;this.miss++;const Zs=utf8DecodeJs(t,Hs,zs),_u=Uint8Array.prototype.slice.call(t,Hs,Hs+zs);return this.store(_u,Zs),Zs}}const STATE_ARRAY="array",STATE_MAP_KEY="map_key",STATE_MAP_VALUE="map_value",mapKeyConverter=Z=>{if(typeof Z=="string"||typeof Z=="number")return Z;throw new DecodeError("The type of key must be string or number but "+typeof Z)};class StackPool{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(t){const Hs=this.getUninitializedStateFromPool();Hs.type=STATE_ARRAY,Hs.position=0,Hs.size=t,Hs.array=new Array(t)}pushMapState(t){const Hs=this.getUninitializedStateFromPool();Hs.type=STATE_MAP_KEY,Hs.readCount=0,Hs.size=t,Hs.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const t={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(t)}return this.stack[this.stackHeadPosition]}release(t){if(this.stack[this.stackHeadPosition]!==t)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(t.type===STATE_ARRAY){const zs=t;zs.size=0,zs.array=void 0,zs.position=0,zs.type=void 0}if(t.type===STATE_MAP_KEY||t.type===STATE_MAP_VALUE){const zs=t;zs.size=0,zs.map=void 0,zs.readCount=0,zs.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const HEAD_BYTE_REQUIRED=-1,EMPTY_VIEW=new DataView(new ArrayBuffer(0)),EMPTY_BYTES=new Uint8Array(EMPTY_VIEW.buffer);try{EMPTY_VIEW.getInt8(0)}catch(Z){if(!(Z instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const MORE_DATA=new RangeError("Insufficient data"),sharedCachedKeyDecoder=new CachedKeyDecoder;let Decoder$1=class Yd{constructor(t){this.totalPos=0,this.pos=0,this.view=EMPTY_VIEW,this.bytes=EMPTY_BYTES,this.headByte=HEAD_BYTE_REQUIRED,this.stack=new StackPool,this.entered=!1,this.extensionCodec=(t==null?void 0:t.extensionCodec)??ExtensionCodec.defaultCodec,this.context=t==null?void 0:t.context,this.useBigInt64=(t==null?void 0:t.useBigInt64)??!1,this.rawStrings=(t==null?void 0:t.rawStrings)??!1,this.maxStrLength=(t==null?void 0:t.maxStrLength)??UINT32_MAX,this.maxBinLength=(t==null?void 0:t.maxBinLength)??UINT32_MAX,this.maxArrayLength=(t==null?void 0:t.maxArrayLength)??UINT32_MAX,this.maxMapLength=(t==null?void 0:t.maxMapLength)??UINT32_MAX,this.maxExtLength=(t==null?void 0:t.maxExtLength)??UINT32_MAX,this.keyDecoder=(t==null?void 0:t.keyDecoder)!==void 0?t.keyDecoder:sharedCachedKeyDecoder,this.mapKeyConverter=(t==null?void 0:t.mapKeyConverter)??mapKeyConverter}clone(){return new Yd({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=HEAD_BYTE_REQUIRED,this.stack.reset()}setBuffer(t){const Hs=ensureUint8Array(t);this.bytes=Hs,this.view=new DataView(Hs.buffer,Hs.byteOffset,Hs.byteLength),this.pos=0}appendBuffer(t){if(this.headByte===HEAD_BYTE_REQUIRED&&!this.hasRemaining(1))this.setBuffer(t);else{const Hs=this.bytes.subarray(this.pos),zs=ensureUint8Array(t),Ys=new Uint8Array(Hs.length+zs.length);Ys.set(Hs),Ys.set(zs,Hs.length),this.setBuffer(Ys)}}hasRemaining(t){return this.view.byteLength-this.pos>=t}createExtraByteError(t){const{view:Hs,pos:zs}=this;return new RangeError(`Extra ${Hs.byteLength-zs} of ${Hs.byteLength} byte(s) found at buffer[${t}]`)}decode(t){if(this.entered)return this.clone().decode(t);try{this.entered=!0,this.reinitializeState(),this.setBuffer(t);const Hs=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return Hs}finally{this.entered=!1}}*decodeMulti(t){if(this.entered){yield*this.clone().decodeMulti(t);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(t);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(t){if(this.entered)return this.clone().decodeAsync(t);try{this.entered=!0;let Hs=!1,zs;for await(const Eu of t){if(Hs)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(Eu);try{zs=this.doDecodeSync(),Hs=!0}catch(Iu){if(!(Iu instanceof RangeError))throw Iu}this.totalPos+=this.pos}if(Hs){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return zs}const{headByte:Ys,pos:Zs,totalPos:_u}=this;throw new RangeError(`Insufficient data in parsing ${prettyByte(Ys)} at ${_u} (${Zs} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(t){return this.decodeMultiAsync(t,!0)}decodeStream(t){return this.decodeMultiAsync(t,!1)}async*decodeMultiAsync(t,Hs){if(this.entered){yield*this.clone().decodeMultiAsync(t,Hs);return}try{this.entered=!0;let zs=Hs,Ys=-1;for await(const Zs of t){if(Hs&&Ys===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(Zs),zs&&(Ys=this.readArraySize(),zs=!1,this.complete());try{for(;yield this.doDecodeSync(),--Ys!==0;);}catch(_u){if(!(_u instanceof RangeError))throw _u}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const t=this.readHeadByte();let Hs;if(t>=224)Hs=t-256;else if(t<192)if(t<128)Hs=t;else if(t<144){const Ys=t-128;if(Ys!==0){this.pushMapState(Ys),this.complete();continue e}else Hs={}}else if(t<160){const Ys=t-144;if(Ys!==0){this.pushArrayState(Ys),this.complete();continue e}else Hs=[]}else{const Ys=t-160;Hs=this.decodeString(Ys,0)}else if(t===192)Hs=null;else if(t===194)Hs=!1;else if(t===195)Hs=!0;else if(t===202)Hs=this.readF32();else if(t===203)Hs=this.readF64();else if(t===204)Hs=this.readU8();else if(t===205)Hs=this.readU16();else if(t===206)Hs=this.readU32();else if(t===207)this.useBigInt64?Hs=this.readU64AsBigInt():Hs=this.readU64();else if(t===208)Hs=this.readI8();else if(t===209)Hs=this.readI16();else if(t===210)Hs=this.readI32();else if(t===211)this.useBigInt64?Hs=this.readI64AsBigInt():Hs=this.readI64();else if(t===217){const Ys=this.lookU8();Hs=this.decodeString(Ys,1)}else if(t===218){const Ys=this.lookU16();Hs=this.decodeString(Ys,2)}else if(t===219){const Ys=this.lookU32();Hs=this.decodeString(Ys,4)}else if(t===220){const Ys=this.readU16();if(Ys!==0){this.pushArrayState(Ys),this.complete();continue e}else Hs=[]}else if(t===221){const Ys=this.readU32();if(Ys!==0){this.pushArrayState(Ys),this.complete();continue e}else Hs=[]}else if(t===222){const Ys=this.readU16();if(Ys!==0){this.pushMapState(Ys),this.complete();continue e}else Hs={}}else if(t===223){const Ys=this.readU32();if(Ys!==0){this.pushMapState(Ys),this.complete();continue e}else Hs={}}else if(t===196){const Ys=this.lookU8();Hs=this.decodeBinary(Ys,1)}else if(t===197){const Ys=this.lookU16();Hs=this.decodeBinary(Ys,2)}else if(t===198){const Ys=this.lookU32();Hs=this.decodeBinary(Ys,4)}else if(t===212)Hs=this.decodeExtension(1,0);else if(t===213)Hs=this.decodeExtension(2,0);else if(t===214)Hs=this.decodeExtension(4,0);else if(t===215)Hs=this.decodeExtension(8,0);else if(t===216)Hs=this.decodeExtension(16,0);else if(t===199){const Ys=this.lookU8();Hs=this.decodeExtension(Ys,1)}else if(t===200){const Ys=this.lookU16();Hs=this.decodeExtension(Ys,2)}else if(t===201){const Ys=this.lookU32();Hs=this.decodeExtension(Ys,4)}else throw new DecodeError(`Unrecognized type byte: ${prettyByte(t)}`);this.complete();const zs=this.stack;for(;zs.length>0;){const Ys=zs.top();if(Ys.type===STATE_ARRAY)if(Ys.array[Ys.position]=Hs,Ys.position++,Ys.position===Ys.size)Hs=Ys.array,zs.release(Ys);else continue e;else if(Ys.type===STATE_MAP_KEY){if(Hs==="__proto__")throw new DecodeError("The key __proto__ is not allowed");Ys.key=this.mapKeyConverter(Hs),Ys.type=STATE_MAP_VALUE;continue e}else if(Ys.map[Ys.key]=Hs,Ys.readCount++,Ys.readCount===Ys.size)Hs=Ys.map,zs.release(Ys);else{Ys.key=null,Ys.type=STATE_MAP_KEY;continue e}}return Hs}}readHeadByte(){return this.headByte===HEAD_BYTE_REQUIRED&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=HEAD_BYTE_REQUIRED}readArraySize(){const t=this.readHeadByte();switch(t){case 220:return this.readU16();case 221:return this.readU32();default:{if(t<160)return t-144;throw new DecodeError(`Unrecognized array type byte: ${prettyByte(t)}`)}}}pushMapState(t){if(t>this.maxMapLength)throw new DecodeError(`Max length exceeded: map length (${t}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(t)}pushArrayState(t){if(t>this.maxArrayLength)throw new DecodeError(`Max length exceeded: array length (${t}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(t)}decodeString(t,Hs){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(t,Hs):this.decodeBinary(t,Hs)}decodeUtf8String(t,Hs){var Zs;if(t>this.maxStrLength)throw new DecodeError(`Max length exceeded: UTF-8 byte length (${t}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+Hs+t)throw MORE_DATA;const zs=this.pos+Hs;let Ys;return this.stateIsMapKey()&&((Zs=this.keyDecoder)!=null&&Zs.canBeCached(t))?Ys=this.keyDecoder.decode(this.bytes,zs,t):Ys=utf8Decode(this.bytes,zs,t),this.pos+=Hs+t,Ys}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===STATE_MAP_KEY:!1}decodeBinary(t,Hs){if(t>this.maxBinLength)throw new DecodeError(`Max length exceeded: bin length (${t}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(t+Hs))throw MORE_DATA;const zs=this.pos+Hs,Ys=this.bytes.subarray(zs,zs+t);return this.pos+=Hs+t,Ys}decodeExtension(t,Hs){if(t>this.maxExtLength)throw new DecodeError(`Max length exceeded: ext length (${t}) > maxExtLength (${this.maxExtLength})`);const zs=this.view.getInt8(this.pos+Hs),Ys=this.decodeBinary(t,Hs+1);return this.extensionCodec.decode(Ys,zs,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const t=this.view.getUint8(this.pos);return this.pos++,t}readI8(){const t=this.view.getInt8(this.pos);return this.pos++,t}readU16(){const t=this.view.getUint16(this.pos);return this.pos+=2,t}readI16(){const t=this.view.getInt16(this.pos);return this.pos+=2,t}readU32(){const t=this.view.getUint32(this.pos);return this.pos+=4,t}readI32(){const t=this.view.getInt32(this.pos);return this.pos+=4,t}readU64(){const t=getUint64(this.view,this.pos);return this.pos+=8,t}readI64(){const t=getInt64(this.view,this.pos);return this.pos+=8,t}readU64AsBigInt(){const t=this.view.getBigUint64(this.pos);return this.pos+=8,t}readI64AsBigInt(){const t=this.view.getBigInt64(this.pos);return this.pos+=8,t}readF32(){const t=this.view.getFloat32(this.pos);return this.pos+=4,t}readF64(){const t=this.view.getFloat64(this.pos);return this.pos+=8,t}};function decode$2(Z,t){return new Decoder$1(t).decode(Z)}function asUint8Array(Z){return globalThis.Buffer!=null?new Uint8Array(Z.buffer,Z.byteOffset,Z.byteLength):Z}function allocUnsafe(Z=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?asUint8Array(globalThis.Buffer.allocUnsafe(Z)):new Uint8Array(Z)}function concat(Z,t){t||(t=Z.reduce((Ys,Zs)=>Ys+Zs.length,0));const Hs=allocUnsafe(t);let zs=0;for(const Ys of Z)Hs.set(Ys,zs),zs+=Ys.length;return asUint8Array(Hs)}function base(Z,t){if(Z.length>=255)throw new TypeError("Alphabet too long");for(var Hs=new Uint8Array(256),zs=0;zs<Hs.length;zs++)Hs[zs]=255;for(var Ys=0;Ys<Z.length;Ys++){var Zs=Z.charAt(Ys),_u=Zs.charCodeAt(0);if(Hs[_u]!==255)throw new TypeError(Zs+" is ambiguous");Hs[_u]=Ys}var Eu=Z.length,Iu=Z.charAt(0),Au=Math.log(Eu)/Math.log(256),$u=Math.log(256)/Math.log(Eu);function vu(Pu){if(Pu instanceof Uint8Array||(ArrayBuffer.isView(Pu)?Pu=new Uint8Array(Pu.buffer,Pu.byteOffset,Pu.byteLength):Array.isArray(Pu)&&(Pu=Uint8Array.from(Pu))),!(Pu instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(Pu.length===0)return"";for(var Cu=0,Bu=0,Fu=0,zu=Pu.length;Fu!==zu&&Pu[Fu]===0;)Fu++,Cu++;for(var Hu=(zu-Fu)*$u+1>>>0,Wu=new Uint8Array(Hu);Fu!==zu;){for(var tl=Pu[Fu],Xu=0,ju=Hu-1;(tl!==0||Xu<Bu)&&ju!==-1;ju--,Xu++)tl+=256*Wu[ju]>>>0,Wu[ju]=tl%Eu>>>0,tl=tl/Eu>>>0;if(tl!==0)throw new Error("Non-zero carry");Bu=Xu,Fu++}for(var ku=Hu-Bu;ku!==Hu&&Wu[ku]===0;)ku++;for(var Uu=Iu.repeat(Cu);ku<Hu;++ku)Uu+=Z.charAt(Wu[ku]);return Uu}function Su(Pu){if(typeof Pu!="string")throw new TypeError("Expected String");if(Pu.length===0)return new Uint8Array;var Cu=0;if(Pu[Cu]!==" "){for(var Bu=0,Fu=0;Pu[Cu]===Iu;)Bu++,Cu++;for(var zu=(Pu.length-Cu)*Au+1>>>0,Hu=new Uint8Array(zu);Pu[Cu];){var Wu=Hs[Pu.charCodeAt(Cu)];if(Wu===255)return;for(var tl=0,Xu=zu-1;(Wu!==0||tl<Fu)&&Xu!==-1;Xu--,tl++)Wu+=Eu*Hu[Xu]>>>0,Hu[Xu]=Wu%256>>>0,Wu=Wu/256>>>0;if(Wu!==0)throw new Error("Non-zero carry");Fu=tl,Cu++}if(Pu[Cu]!==" "){for(var ju=zu-Fu;ju!==zu&&Hu[ju]===0;)ju++;for(var ku=new Uint8Array(Bu+(zu-ju)),Uu=Bu;ju!==zu;)ku[Uu++]=Hu[ju++];return ku}}}function Ru(Pu){var Cu=Su(Pu);if(Cu)return Cu;throw new Error(`Non-${t} character`)}return{encode:vu,decodeUnsafe:Su,decode:Ru}}var src=base,_brrp__multiformats_scope_baseX=src;const coerce=Z=>{if(Z instanceof Uint8Array&&Z.constructor.name==="Uint8Array")return Z;if(Z instanceof ArrayBuffer)return new Uint8Array(Z);if(ArrayBuffer.isView(Z))return new Uint8Array(Z.buffer,Z.byteOffset,Z.byteLength);throw new Error("Unknown type, must be binary type")},fromString$1=Z=>new TextEncoder().encode(Z),toString$1=Z=>new TextDecoder().decode(Z);class Encoder{constructor(t,Hs,zs){this.name=t,this.prefix=Hs,this.baseEncode=zs}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class Decoder{constructor(t,Hs,zs){if(this.name=t,this.prefix=Hs,Hs.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=Hs.codePointAt(0),this.baseDecode=zs}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return or$2(this,t)}}class ComposedDecoder{constructor(t){this.decoders=t}or(t){return or$2(this,t)}decode(t){const Hs=t[0],zs=this.decoders[Hs];if(zs)return zs.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const or$2=(Z,t)=>new ComposedDecoder({...Z.decoders||{[Z.prefix]:Z},...t.decoders||{[t.prefix]:t}});class Codec{constructor(t,Hs,zs,Ys){this.name=t,this.prefix=Hs,this.baseEncode=zs,this.baseDecode=Ys,this.encoder=new Encoder(t,Hs,zs),this.decoder=new Decoder(t,Hs,Ys)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const from=({name:Z,prefix:t,encode:Hs,decode:zs})=>new Codec(Z,t,Hs,zs),baseX=({prefix:Z,name:t,alphabet:Hs})=>{const{encode:zs,decode:Ys}=_brrp__multiformats_scope_baseX(Hs,t);return from({prefix:Z,name:t,encode:zs,decode:Zs=>coerce(Ys(Zs))})},decode$1=(Z,t,Hs,zs)=>{const Ys={};for(let $u=0;$u<t.length;++$u)Ys[t[$u]]=$u;let Zs=Z.length;for(;Z[Zs-1]==="=";)--Zs;const _u=new Uint8Array(Zs*Hs/8|0);let Eu=0,Iu=0,Au=0;for(let $u=0;$u<Zs;++$u){const vu=Ys[Z[$u]];if(vu===void 0)throw new SyntaxError(`Non-${zs} character`);Iu=Iu<<Hs|vu,Eu+=Hs,Eu>=8&&(Eu-=8,_u[Au++]=255&Iu>>Eu)}if(Eu>=Hs||255&Iu<<8-Eu)throw new SyntaxError("Unexpected end of data");return _u},encode$1=(Z,t,Hs)=>{const zs=t[t.length-1]==="=",Ys=(1<<Hs)-1;let Zs="",_u=0,Eu=0;for(let Iu=0;Iu<Z.length;++Iu)for(Eu=Eu<<8|Z[Iu],_u+=8;_u>Hs;)_u-=Hs,Zs+=t[Ys&Eu>>_u];if(_u&&(Zs+=t[Ys&Eu<<Hs-_u]),zs)for(;Zs.length*Hs&7;)Zs+="=";return Zs},rfc4648=({name:Z,prefix:t,bitsPerChar:Hs,alphabet:zs})=>from({prefix:t,name:Z,encode(Ys){return encode$1(Ys,zs,Hs)},decode(Ys){return decode$1(Ys,zs,Hs,Z)}}),identity=from({prefix:"\0",name:"identity",encode:Z=>toString$1(Z),decode:Z=>fromString$1(Z)}),identityBase=Object.freeze(Object.defineProperty({__proto__:null,identity},Symbol.toStringTag,{value:"Module"})),base2=rfc4648({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base2$1=Object.freeze(Object.defineProperty({__proto__:null,base2},Symbol.toStringTag,{value:"Module"})),base8=rfc4648({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base8$1=Object.freeze(Object.defineProperty({__proto__:null,base8},Symbol.toStringTag,{value:"Module"})),base10=baseX({prefix:"9",name:"base10",alphabet:"0123456789"}),base10$1=Object.freeze(Object.defineProperty({__proto__:null,base10},Symbol.toStringTag,{value:"Module"})),base16=rfc4648({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper=rfc4648({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base16$1=Object.freeze(Object.defineProperty({__proto__:null,base16,base16upper},Symbol.toStringTag,{value:"Module"})),base32=rfc4648({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper=rfc4648({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad=rfc4648({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper=rfc4648({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex=rfc4648({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper=rfc4648({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad=rfc4648({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper=rfc4648({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z=rfc4648({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base32$1=Object.freeze(Object.defineProperty({__proto__:null,base32,base32hex,base32hexpad,base32hexpadupper,base32hexupper,base32pad,base32padupper,base32upper,base32z},Symbol.toStringTag,{value:"Module"})),base36=baseX({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper=baseX({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base36$1=Object.freeze(Object.defineProperty({__proto__:null,base36,base36upper},Symbol.toStringTag,{value:"Module"})),base58btc=baseX({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr=baseX({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base58=Object.freeze(Object.defineProperty({__proto__:null,base58btc,base58flickr},Symbol.toStringTag,{value:"Module"})),base64$2=rfc4648({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad=rfc4648({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url=rfc4648({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad=rfc4648({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),base64$3=Object.freeze(Object.defineProperty({__proto__:null,base64:base64$2,base64pad,base64url,base64urlpad},Symbol.toStringTag,{value:"Module"})),alphabet=Array.from(""),alphabetBytesToChars=alphabet.reduce((Z,t,Hs)=>(Z[Hs]=t,Z),[]),alphabetCharsToBytes=alphabet.reduce((Z,t,Hs)=>(Z[t.codePointAt(0)]=Hs,Z),[]);function encode(Z){return Z.reduce((t,Hs)=>(t+=alphabetBytesToChars[Hs],t),"")}function decode(Z){const t=[];for(const Hs of Z){const zs=alphabetCharsToBytes[Hs.codePointAt(0)];if(zs===void 0)throw new Error(`Non-base256emoji character: ${Hs}`);t.push(zs)}return new Uint8Array(t)}const base256emoji=from({prefix:"",name:"base256emoji",encode,decode}),base256emoji$1=Object.freeze(Object.defineProperty({__proto__:null,base256emoji},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const bases={...identityBase,...base2$1,...base8$1,...base10$1,...base16$1,...base32$1,...base36$1,...base58,...base64$3,...base256emoji$1};function createCodec(Z,t,Hs,zs){return{name:Z,prefix:t,encoder:{name:Z,prefix:t,encode:Hs},decoder:{decode:zs}}}const string=createCodec("utf8","u",Z=>"u"+new TextDecoder("utf8").decode(Z),Z=>new TextEncoder().encode(Z.substring(1))),ascii=createCodec("ascii","a",Z=>{let t="a";for(let Hs=0;Hs<Z.length;Hs++)t+=String.fromCharCode(Z[Hs]);return t},Z=>{Z=Z.substring(1);const t=allocUnsafe(Z.length);for(let Hs=0;Hs<Z.length;Hs++)t[Hs]=Z.charCodeAt(Hs);return t}),BASES={utf8:string,"utf-8":string,hex:bases.base16,latin1:ascii,ascii,binary:ascii,...bases};function fromString(Z,t="utf8"){const Hs=BASES[t];if(!Hs)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?asUint8Array(globalThis.Buffer.from(Z,"utf-8")):Hs.decoder.decode(`${Hs.prefix}${Z}`)}function toString(Z,t="utf8"){const Hs=BASES[t];if(!Hs)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(Z.buffer,Z.byteOffset,Z.byteLength).toString("utf8"):Hs.encoder.encode(Z).substring(1)}const C$2={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}},ERROR_MSG_INPUT="Input must be an string, Buffer or Uint8Array";function normalizeInput(Z){let t;if(Z instanceof Uint8Array)t=Z;else if(typeof Z=="string")t=new TextEncoder().encode(Z);else throw new Error(ERROR_MSG_INPUT);return t}function toHex$2(Z){return Array.prototype.map.call(Z,function(t){return(t<16?"0":"")+t.toString(16)}).join("")}function uint32ToHex(Z){return(4294967296+Z).toString(16).substring(1)}function debugPrint(Z,t,Hs){let zs=`
`+Z+" = ";for(let Ys=0;Ys<t.length;Ys+=2){if(Hs===32)zs+=uint32ToHex(t[Ys]).toUpperCase(),zs+=" ",zs+=uint32ToHex(t[Ys+1]).toUpperCase();else if(Hs===64)zs+=uint32ToHex(t[Ys+1]).toUpperCase(),zs+=uint32ToHex(t[Ys]).toUpperCase();else throw new Error("Invalid size "+Hs);Ys%6===4?zs+=`
`+new Array(Z.length+4).join(" "):Ys<t.length-2&&(zs+=" ")}console.log(zs)}function testSpeed(Z,t,Hs){let zs=new Date().getTime();const Ys=new Uint8Array(t);for(let _u=0;_u<t;_u++)Ys[_u]=_u%256;const Zs=new Date().getTime();console.log("Generated random input in "+(Zs-zs)+"ms"),zs=Zs;for(let _u=0;_u<Hs;_u++){const Eu=Z(Ys),Iu=new Date().getTime(),Au=Iu-zs;zs=Iu,console.log("Hashed in "+Au+"ms: "+Eu.substring(0,20)+"..."),console.log(Math.round(t/(1<<20)/(Au/1e3)*100)/100+" MB PER SECOND")}}var util$2={normalizeInput,toHex:toHex$2,debugPrint,testSpeed};const util$1=util$2;function ADD64AA$1(Z,t,Hs){const zs=Z[t]+Z[Hs];let Ys=Z[t+1]+Z[Hs+1];zs>=4294967296&&Ys++,Z[t]=zs,Z[t+1]=Ys}function ADD64AC$1(Z,t,Hs,zs){let Ys=Z[t]+Hs;Hs<0&&(Ys+=4294967296);let Zs=Z[t+1]+zs;Ys>=4294967296&&Zs++,Z[t]=Ys,Z[t+1]=Zs}function B2B_GET32$1(Z,t){return Z[t]^Z[t+1]<<8^Z[t+2]<<16^Z[t+3]<<24}function B2B_G$1(Z,t,Hs,zs,Ys,Zs){const _u=m$2[Ys],Eu=m$2[Ys+1],Iu=m$2[Zs],Au=m$2[Zs+1];ADD64AA$1(v$5,Z,t),ADD64AC$1(v$5,Z,_u,Eu);let $u=v$5[zs]^v$5[Z],vu=v$5[zs+1]^v$5[Z+1];v$5[zs]=vu,v$5[zs+1]=$u,ADD64AA$1(v$5,Hs,zs),$u=v$5[t]^v$5[Hs],vu=v$5[t+1]^v$5[Hs+1],v$5[t]=$u>>>24^vu<<8,v$5[t+1]=vu>>>24^$u<<8,ADD64AA$1(v$5,Z,t),ADD64AC$1(v$5,Z,Iu,Au),$u=v$5[zs]^v$5[Z],vu=v$5[zs+1]^v$5[Z+1],v$5[zs]=$u>>>16^vu<<16,v$5[zs+1]=vu>>>16^$u<<16,ADD64AA$1(v$5,Hs,zs),$u=v$5[t]^v$5[Hs],vu=v$5[t+1]^v$5[Hs+1],v$5[t]=vu>>>31^$u<<1,v$5[t+1]=$u>>>31^vu<<1}const BLAKE2B_IV32$1=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),SIGMA8$1=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],SIGMA82$1=new Uint8Array(SIGMA8$1.map(function(Z){return Z*2})),v$5=new Uint32Array(32),m$2=new Uint32Array(32);function blake2bCompress$1(Z,t){let Hs=0;for(Hs=0;Hs<16;Hs++)v$5[Hs]=Z.h[Hs],v$5[Hs+16]=BLAKE2B_IV32$1[Hs];for(v$5[24]=v$5[24]^Z.t,v$5[25]=v$5[25]^Z.t/4294967296,t&&(v$5[28]=~v$5[28],v$5[29]=~v$5[29]),Hs=0;Hs<32;Hs++)m$2[Hs]=B2B_GET32$1(Z.b,4*Hs);for(Hs=0;Hs<12;Hs++)B2B_G$1(0,8,16,24,SIGMA82$1[Hs*16+0],SIGMA82$1[Hs*16+1]),B2B_G$1(2,10,18,26,SIGMA82$1[Hs*16+2],SIGMA82$1[Hs*16+3]),B2B_G$1(4,12,20,28,SIGMA82$1[Hs*16+4],SIGMA82$1[Hs*16+5]),B2B_G$1(6,14,22,30,SIGMA82$1[Hs*16+6],SIGMA82$1[Hs*16+7]),B2B_G$1(0,10,20,30,SIGMA82$1[Hs*16+8],SIGMA82$1[Hs*16+9]),B2B_G$1(2,12,22,24,SIGMA82$1[Hs*16+10],SIGMA82$1[Hs*16+11]),B2B_G$1(4,14,16,26,SIGMA82$1[Hs*16+12],SIGMA82$1[Hs*16+13]),B2B_G$1(6,8,18,28,SIGMA82$1[Hs*16+14],SIGMA82$1[Hs*16+15]);for(Hs=0;Hs<16;Hs++)Z.h[Hs]=Z.h[Hs]^v$5[Hs]^v$5[Hs+16]}const parameterBlock=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function blake2bInit(Z,t,Hs,zs){if(Z===0||Z>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(t&&t.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(Hs&&Hs.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(zs&&zs.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const Ys={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:Z};parameterBlock.fill(0),parameterBlock[0]=Z,t&&(parameterBlock[1]=t.length),parameterBlock[2]=1,parameterBlock[3]=1,Hs&&parameterBlock.set(Hs,32),zs&&parameterBlock.set(zs,48);for(let Zs=0;Zs<16;Zs++)Ys.h[Zs]=BLAKE2B_IV32$1[Zs]^B2B_GET32$1(parameterBlock,Zs*4);return t&&(blake2bUpdate$1(Ys,t),Ys.c=128),Ys}function blake2bUpdate$1(Z,t){for(let Hs=0;Hs<t.length;Hs++)Z.c===128&&(Z.t+=Z.c,blake2bCompress$1(Z,!1),Z.c=0),Z.b[Z.c++]=t[Hs]}function blake2bFinal$1(Z){for(Z.t+=Z.c;Z.c<128;)Z.b[Z.c++]=0;blake2bCompress$1(Z,!0);const t=new Uint8Array(Z.outlen);for(let Hs=0;Hs<Z.outlen;Hs++)t[Hs]=Z.h[Hs>>2]>>8*(Hs&3);return t}function blake2b$2(Z,t,Hs,zs,Ys){Hs=Hs||64,Z=util$1.normalizeInput(Z),zs&&(zs=util$1.normalizeInput(zs)),Ys&&(Ys=util$1.normalizeInput(Ys));const Zs=blake2bInit(Hs,t,zs,Ys);return blake2bUpdate$1(Zs,Z),blake2bFinal$1(Zs)}function blake2bHex(Z,t,Hs,zs,Ys){const Zs=blake2b$2(Z,t,Hs,zs,Ys);return util$1.toHex(Zs)}var blake2b_1={blake2b:blake2b$2,blake2bHex,blake2bInit,blake2bUpdate:blake2bUpdate$1,blake2bFinal:blake2bFinal$1};const util=util$2;function B2S_GET32(Z,t){return Z[t]^Z[t+1]<<8^Z[t+2]<<16^Z[t+3]<<24}function B2S_G(Z,t,Hs,zs,Ys,Zs){v$4[Z]=v$4[Z]+v$4[t]+Ys,v$4[zs]=ROTR32(v$4[zs]^v$4[Z],16),v$4[Hs]=v$4[Hs]+v$4[zs],v$4[t]=ROTR32(v$4[t]^v$4[Hs],12),v$4[Z]=v$4[Z]+v$4[t]+Zs,v$4[zs]=ROTR32(v$4[zs]^v$4[Z],8),v$4[Hs]=v$4[Hs]+v$4[zs],v$4[t]=ROTR32(v$4[t]^v$4[Hs],7)}function ROTR32(Z,t){return Z>>>t^Z<<32-t}const BLAKE2S_IV=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SIGMA=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),v$4=new Uint32Array(16),m$1=new Uint32Array(16);function blake2sCompress(Z,t){let Hs=0;for(Hs=0;Hs<8;Hs++)v$4[Hs]=Z.h[Hs],v$4[Hs+8]=BLAKE2S_IV[Hs];for(v$4[12]^=Z.t,v$4[13]^=Z.t/4294967296,t&&(v$4[14]=~v$4[14]),Hs=0;Hs<16;Hs++)m$1[Hs]=B2S_GET32(Z.b,4*Hs);for(Hs=0;Hs<10;Hs++)B2S_G(0,4,8,12,m$1[SIGMA[Hs*16+0]],m$1[SIGMA[Hs*16+1]]),B2S_G(1,5,9,13,m$1[SIGMA[Hs*16+2]],m$1[SIGMA[Hs*16+3]]),B2S_G(2,6,10,14,m$1[SIGMA[Hs*16+4]],m$1[SIGMA[Hs*16+5]]),B2S_G(3,7,11,15,m$1[SIGMA[Hs*16+6]],m$1[SIGMA[Hs*16+7]]),B2S_G(0,5,10,15,m$1[SIGMA[Hs*16+8]],m$1[SIGMA[Hs*16+9]]),B2S_G(1,6,11,12,m$1[SIGMA[Hs*16+10]],m$1[SIGMA[Hs*16+11]]),B2S_G(2,7,8,13,m$1[SIGMA[Hs*16+12]],m$1[SIGMA[Hs*16+13]]),B2S_G(3,4,9,14,m$1[SIGMA[Hs*16+14]],m$1[SIGMA[Hs*16+15]]);for(Hs=0;Hs<8;Hs++)Z.h[Hs]^=v$4[Hs]^v$4[Hs+8]}function blake2sInit(Z,t){if(!(Z>0&&Z<=32))throw new Error("Incorrect output length, should be in [1, 32]");const Hs=t?t.length:0;if(t&&!(Hs>0&&Hs<=32))throw new Error("Incorrect key length, should be in [1, 32]");const zs={h:new Uint32Array(BLAKE2S_IV),b:new Uint8Array(64),c:0,t:0,outlen:Z};return zs.h[0]^=16842752^Hs<<8^Z,Hs>0&&(blake2sUpdate(zs,t),zs.c=64),zs}function blake2sUpdate(Z,t){for(let Hs=0;Hs<t.length;Hs++)Z.c===64&&(Z.t+=Z.c,blake2sCompress(Z,!1),Z.c=0),Z.b[Z.c++]=t[Hs]}function blake2sFinal(Z){for(Z.t+=Z.c;Z.c<64;)Z.b[Z.c++]=0;blake2sCompress(Z,!0);const t=new Uint8Array(Z.outlen);for(let Hs=0;Hs<Z.outlen;Hs++)t[Hs]=Z.h[Hs>>2]>>8*(Hs&3)&255;return t}function blake2s(Z,t,Hs){Hs=Hs||32,Z=util.normalizeInput(Z);const zs=blake2sInit(Hs,t);return blake2sUpdate(zs,Z),blake2sFinal(zs)}function blake2sHex(Z,t,Hs){const zs=blake2s(Z,t,Hs);return util.toHex(zs)}var blake2s_1={blake2s,blake2sHex,blake2sInit,blake2sUpdate,blake2sFinal};const b2b=blake2b_1,b2s=blake2s_1;var blakejs={blake2b:b2b.blake2b,blake2bHex:b2b.blake2bHex,blake2bInit:b2b.blake2bInit,blake2bUpdate:b2b.blake2bUpdate,blake2bFinal:b2b.blake2bFinal,blake2s:b2s.blake2s,blake2sHex:b2s.blake2sHex,blake2sInit:b2s.blake2sInit,blake2sUpdate:b2s.blake2sUpdate,blake2sFinal:b2s.blake2sFinal};const Ae=":";function Je$1(Z){const[t,Hs]=Z.split(Ae);return{namespace:t,reference:Hs}}function or$1(Z){const{namespace:t,reference:Hs}=Z;return[t,Hs].join(Ae)}function Qe$1(Z){const[t,Hs,zs]=Z.split(Ae);return{namespace:t,reference:Hs,address:zs}}function sr(Z){const{namespace:t,reference:Hs,address:zs}=Z;return[t,Hs,zs].join(Ae)}function tn$2(Z,t){const Hs=[];return Z.forEach(zs=>{const Ys=t(zs);Hs.includes(Ys)||Hs.push(Ys)}),Hs}function ir$1(Z){const{address:t}=Qe$1(Z);return t}function cr$1(Z){const{namespace:t,reference:Hs}=Qe$1(Z);return or$1({namespace:t,reference:Hs})}function Ws(Z,t){const{namespace:Hs,reference:zs}=Je$1(t);return sr({namespace:Hs,reference:zs,address:Z})}function Xs(Z){return tn$2(Z,ir$1)}function fr$1(Z){return tn$2(Z,cr$1)}function Js(Z,t=[]){const Hs=[];return Object.keys(Z).forEach(zs=>{if(t.length&&!t.includes(zs))return;const Ys=Z[zs];Hs.push(...Ys.accounts)}),Hs}function Qs$1(Z,t=[]){const Hs=[];return Object.keys(Z).forEach(zs=>{if(t.length&&!t.includes(zs))return;const Ys=Z[zs];Hs.push(...fr$1(Ys.accounts))}),Hs}function ti$1(Z,t=[]){const Hs=[];return Object.keys(Z).forEach(zs=>{if(t.length&&!t.includes(zs))return;const Ys=Z[zs];Hs.push(...Ie(zs,Ys))}),Hs}function Ie(Z,t){return Z.includes(":")?[Z]:t.chains||[]}var ei$1=Object.defineProperty,ni$1=Object.defineProperties,ri$1=Object.getOwnPropertyDescriptors,ar$1=Object.getOwnPropertySymbols,oi$1=Object.prototype.hasOwnProperty,si$1=Object.prototype.propertyIsEnumerable,en$2=(Z,t,Hs)=>t in Z?ei$1(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,ur$1=(Z,t)=>{for(var Hs in t||(t={}))oi$1.call(t,Hs)&&en$2(Z,Hs,t[Hs]);if(ar$1)for(var Hs of ar$1(t))si$1.call(t,Hs)&&en$2(Z,Hs,t[Hs]);return Z},ii$1=(Z,t)=>ni$1(Z,ri$1(t)),lr$1=(Z,t,Hs)=>en$2(Z,typeof t!="symbol"?t+"":t,Hs);const dr$1="ReactNative",et$2={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Se$1=" ",ci$1=":",hr$1="/",nn$2=2,fi$1=1e3,pr$1="js";function rn$2(){return typeof process$1<"u"&&typeof process$1.versions<"u"&&typeof process$1.versions.node<"u"}function At$2(){return!getDocument_1()&&!!getNavigator_1()&&navigator.product===dr$1}function ai$1(){return At$2()&&typeof globalThis<"u"&&typeof(globalThis==null?void 0:globalThis.Platform)<"u"&&(globalThis==null?void 0:globalThis.Platform.OS)==="android"}function ui$1(){return At$2()&&typeof globalThis<"u"&&typeof(globalThis==null?void 0:globalThis.Platform)<"u"&&(globalThis==null?void 0:globalThis.Platform.OS)==="ios"}function Wt$2(){return!rn$2()&&!!getNavigator_1()&&!!getDocument_1()}function Vt$2(){return At$2()?et$2.reactNative:rn$2()?et$2.node:Wt$2()?et$2.browser:et$2.unknown}function li$1(){var Z;try{return At$2()&&typeof globalThis<"u"&&typeof(globalThis==null?void 0:globalThis.Application)<"u"?(Z=globalThis.Application)==null?void 0:Z.applicationId:void 0}catch{return}}function gr$1(Z,t){const Hs=new URLSearchParams(Z);return Object.entries(t).sort(([zs],[Ys])=>zs.localeCompare(Ys)).forEach(([zs,Ys])=>{Ys!=null&&Hs.set(zs,String(Ys))}),Hs.toString()}function di$1(Z){var t,Hs;const zs=br$1();try{return Z!=null&&Z.url&&zs.url&&new URL(Z.url).host!==new URL(zs.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${Z.url} differs from the actual page url:${zs.url}. This is probably unintended and can lead to issues.`),Z.url=zs.url),(t=Z==null?void 0:Z.icons)!=null&&t.length&&Z.icons.length>0&&(Z.icons=Z.icons.filter(Ys=>Ys!=="")),ii$1(ur$1(ur$1({},zs),Z),{url:(Z==null?void 0:Z.url)||zs.url,name:(Z==null?void 0:Z.name)||zs.name,description:(Z==null?void 0:Z.description)||zs.description,icons:(Hs=Z==null?void 0:Z.icons)!=null&&Hs.length&&Z.icons.length>0?Z.icons:zs.icons})}catch(Ys){return console.warn("Error populating app metadata",Ys),Z||zs}}function br$1(){return getWindowMetadata_1()||{name:"",description:"",url:"",icons:[""]}}function hi$1(Z,t){var Hs;const zs=Vt$2(),Ys={protocol:Z,version:t,env:zs};return zs==="browser"&&(Ys.host=((Hs=getLocation_1())==null?void 0:Hs.host)||"unknown"),Ys}function yr$1(){if(Vt$2()===et$2.reactNative&&typeof globalThis<"u"&&typeof(globalThis==null?void 0:globalThis.Platform)<"u"){const{OS:Hs,Version:zs}=globalThis.Platform;return[Hs,zs].join("-")}const Z=detect();if(Z===null)return"unknown";const t=Z.os?Z.os.replace(" ","").toLowerCase():"unknown";return Z.type==="browser"?[t,Z.name,Z.version].join("-"):[t,Z.version].join("-")}function mr$1(){var Z;const t=Vt$2();return t===et$2.browser?[t,((Z=getLocation_1())==null?void 0:Z.host)||"unknown"].join(":"):t}function wr$1(Z,t,Hs){const zs=yr$1(),Ys=mr$1();return[[Z,t].join("-"),[pr$1,Hs].join("-"),zs,Ys].join("/")}function pi$1({protocol:Z,version:t,relayUrl:Hs,sdkVersion:zs,auth:Ys,projectId:Zs,useOnCloseEvent:_u,bundleId:Eu,packageName:Iu}){const Au=Hs.split("?"),$u=wr$1(Z,t,zs),vu={auth:Ys,ua:$u,projectId:Zs,useOnCloseEvent:_u||void 0,packageName:Iu||void 0,bundleId:Eu||void 0},Su=gr$1(Au[1]||"",vu);return Au[0]+"?"+Su}function gi$1(Z){let t=(Z.match(/^[^:]+(?=:\/\/)/gi)||[])[0];const Hs=typeof t<"u"?Z.split("://")[1]:Z;return t=t==="wss"?"https":"http",[t,Hs].join("://")}function bi$1(Z,t,Hs){if(!Z[t]||typeof Z[t]!==Hs)throw new Error(`Missing or invalid "${t}" param`)}function vr$1(Z,t=nn$2){return xr$1(Z.split(hr$1),t)}function yi$1(Z){return vr$1(Z).join(Se$1)}function It$3(Z,t){return Z.filter(Hs=>t.includes(Hs)).length===Z.length}function xr$1(Z,t=nn$2){return Z.slice(Math.max(Z.length-t,0))}function mi$1(Z){return Object.fromEntries(Z.entries())}function wi$1(Z){return new Map(Object.entries(Z))}function vi$1(Z,t){const Hs={};return Object.keys(Z).forEach(zs=>{Hs[zs]=t(Z[zs])}),Hs}const xi$1=Z=>Z;function Er$1(Z){return Z.trim().replace(/^\w/,t=>t.toUpperCase())}function Ei$1(Z){return Z.split(Se$1).map(t=>Er$1(t)).join(Se$1)}function Bi$1(Z=cjs$3.FIVE_MINUTES,t){const Hs=cjs$3.toMiliseconds(Z||cjs$3.FIVE_MINUTES);let zs,Ys,Zs,_u;return{resolve:Eu=>{Zs&&zs&&(clearTimeout(Zs),zs(Eu),_u=Promise.resolve(Eu))},reject:Eu=>{Zs&&Ys&&(clearTimeout(Zs),Ys(Eu))},done:()=>new Promise((Eu,Iu)=>{if(_u)return Eu(_u);Zs=setTimeout(()=>{const Au=new Error(t);_u=Promise.reject(Au),Iu(Au)},Hs),zs=Eu,Ys=Iu})}}function Ai$1(Z,t,Hs){return new Promise(async(zs,Ys)=>{const Zs=setTimeout(()=>Ys(new Error(Hs)),t);try{const _u=await Z;zs(_u)}catch(_u){Ys(_u)}clearTimeout(Zs)})}function on$1(Z,t){if(typeof t=="string"&&t.startsWith(`${Z}:`))return t;if(Z.toLowerCase()==="topic"){if(typeof t!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}else if(Z.toLowerCase()==="id"){if(typeof t!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw new Error(`Unknown expirer target type: ${Z}`)}function Ii$1(Z){return on$1("topic",Z)}function Si$1(Z){return on$1("id",Z)}function Oi$1(Z){const[t,Hs]=Z.split(":"),zs={id:void 0,topic:void 0};if(t==="topic"&&typeof Hs=="string")zs.topic=Hs;else if(t==="id"&&Number.isInteger(Number(Hs)))zs.id=Number(Hs);else throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${Hs}`);return zs}function Ni$1(Z,t){return cjs$3.fromMiliseconds((t||Date.now())+cjs$3.toMiliseconds(Z))}function Ui$1(Z){return Date.now()>=cjs$3.toMiliseconds(Z)}function _i$1(Z,t){return`${Z}${t?`:${t}`:""}`}function ut$2(Z=[],t=[]){return[...new Set([...Z,...t])]}async function Ri$1({id:Z,topic:t,wcDeepLink:Hs}){var zs;try{if(!Hs)return;const Ys=typeof Hs=="string"?JSON.parse(Hs):Hs,Zs=Ys==null?void 0:Ys.href;if(typeof Zs!="string")return;const _u=Br$1(Zs,Z,t),Eu=Vt$2();if(Eu===et$2.browser){if(!((zs=getDocument_1())!=null&&zs.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}Ar$1(_u)}else Eu===et$2.reactNative&&typeof(globalThis==null?void 0:globalThis.Linking)<"u"&&await globalThis.Linking.openURL(_u)}catch(Ys){console.error(Ys)}}function Br$1(Z,t,Hs){const zs=`requestId=${t}&sessionTopic=${Hs}`;Z.endsWith("/")&&(Z=Z.slice(0,-1));let Ys=`${Z}`;if(Z.startsWith("https://t.me")){const Zs=Z.includes("?")?"&startapp=":"?startapp=";Ys=`${Ys}${Zs}${Or$1(zs,!0)}`}else Ys=`${Ys}/wc?${zs}`;return Ys}function Ar$1(Z){let t="_self";Sr$1()?t="_top":(Ir$1()||Z.startsWith("https://")||Z.startsWith("http://"))&&(t="_blank"),window.open(Z,t,"noreferrer noopener")}async function $i$1(Z,t){let Hs="";try{if(Wt$2()&&(Hs=localStorage.getItem(t),Hs))return Hs;Hs=await Z.getItem(t)}catch(zs){console.error(zs)}return Hs}function sn$2(Z,t){return Z.filter(Hs=>t.includes(Hs))}function Ti$1(Z,t){if(!Z.includes(t))return null;const Hs=Z.split(/([&,?,=])/),zs=Hs.indexOf(t);return Hs[zs+2]}function Ci$1(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,Z=>{const t=Math.random()*16|0;return(Z==="x"?t:t&3|8).toString(16)})}function ji$1(){return typeof process$1<"u"&&{}.IS_VITEST==="true"}function Ir$1(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function Sr$1(){try{return window.self!==window.top}catch{return!1}}function Or$1(Z,t=!1){const Hs=Buffer$1.from(Z).toString("base64");return t?Hs.replace(/[=]/g,""):Hs}function cn$1(Z){return Buffer$1.from(Z,"base64").toString("utf-8")}function Li$1(Z){return new Promise(t=>setTimeout(t,Z))}let ki$1=class{constructor({limit:t}){lr$1(this,"limit"),lr$1(this,"set"),this.limit=t,this.set=new Set}add(t){if(!this.set.has(t)){if(this.set.size>=this.limit){const Hs=this.set.values().next().value;Hs&&this.set.delete(Hs)}this.set.add(t)}}has(t){return this.set.has(t)}};const Oe$1=BigInt(2**32-1),Nr$1=BigInt(32);function Ur$1(Z,t=!1){return t?{h:Number(Z&Oe$1),l:Number(Z>>Nr$1&Oe$1)}:{h:Number(Z>>Nr$1&Oe$1)|0,l:Number(Z&Oe$1)|0}}function _r$1(Z,t=!1){const Hs=Z.length;let zs=new Uint32Array(Hs),Ys=new Uint32Array(Hs);for(let Zs=0;Zs<Hs;Zs++){const{h:_u,l:Eu}=Ur$1(Z[Zs],t);[zs[Zs],Ys[Zs]]=[_u,Eu]}return[zs,Ys]}const Rr$1=(Z,t,Hs)=>Z>>>Hs,$r$1=(Z,t,Hs)=>Z<<32-Hs|t>>>Hs,St$3=(Z,t,Hs)=>Z>>>Hs|t<<32-Hs,Ot$1=(Z,t,Hs)=>Z<<32-Hs|t>>>Hs,de=(Z,t,Hs)=>Z<<64-Hs|t>>>Hs-32,he$1=(Z,t,Hs)=>Z>>>Hs-32|t<<64-Hs,Pi$1=(Z,t)=>t,Hi$1=(Z,t)=>Z,Di$1=(Z,t,Hs)=>Z<<Hs|t>>>32-Hs,Vi$1=(Z,t,Hs)=>t<<Hs|Z>>>32-Hs,Mi$1=(Z,t,Hs)=>t<<Hs-32|Z>>>64-Hs,Ki$1=(Z,t,Hs)=>Z<<Hs-32|t>>>64-Hs;function dt$1(Z,t,Hs,zs){const Ys=(t>>>0)+(zs>>>0);return{h:Z+Hs+(Ys/2**32|0)|0,l:Ys|0}}const fn$1=(Z,t,Hs)=>(Z>>>0)+(t>>>0)+(Hs>>>0),an$2=(Z,t,Hs,zs)=>t+Hs+zs+(Z/2**32|0)|0,qi$1=(Z,t,Hs,zs)=>(Z>>>0)+(t>>>0)+(Hs>>>0)+(zs>>>0),Fi$1=(Z,t,Hs,zs,Ys)=>t+Hs+zs+Ys+(Z/2**32|0)|0,Zi=(Z,t,Hs,zs,Ys)=>(Z>>>0)+(t>>>0)+(Hs>>>0)+(zs>>>0)+(Ys>>>0),Gi$1=(Z,t,Hs,zs,Ys,Zs)=>t+Hs+zs+Ys+Zs+(Z/2**32|0)|0,Xt$2=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Ne(Z){return Z instanceof Uint8Array||ArrayBuffer.isView(Z)&&Z.constructor.name==="Uint8Array"}function mt$2(Z){if(!Number.isSafeInteger(Z)||Z<0)throw new Error("positive integer expected, got "+Z)}function ht(Z,...t){if(!Ne(Z))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(Z.length))throw new Error("Uint8Array expected of length "+t+", got length="+Z.length)}function Ue$1(Z){if(typeof Z!="function"||typeof Z.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");mt$2(Z.outputLen),mt$2(Z.blockLen)}function Nt$1(Z,t=!0){if(Z.destroyed)throw new Error("Hash instance has been destroyed");if(t&&Z.finished)throw new Error("Hash#digest() has already been called")}function un$1(Z,t){ht(Z);const Hs=t.outputLen;if(Z.length<Hs)throw new Error("digestInto() expects output buffer of length at least "+Hs)}function pe$1(Z){return new Uint32Array(Z.buffer,Z.byteOffset,Math.floor(Z.byteLength/4))}function lt(...Z){for(let t=0;t<Z.length;t++)Z[t].fill(0)}function ln$1(Z){return new DataView(Z.buffer,Z.byteOffset,Z.byteLength)}function bt(Z,t){return Z<<32-t|Z>>>t}const Tr$1=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Cr$1(Z){return Z<<24&4278190080|Z<<8&16711680|Z>>>8&65280|Z>>>24&255}const wt$1=Tr$1?Z=>Z:Z=>Cr$1(Z);function zi$1(Z){for(let t=0;t<Z.length;t++)Z[t]=Cr$1(Z[t]);return Z}const Ut$2=Tr$1?Z=>Z:zi$1,jr$1=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Yi=Array.from({length:256},(Z,t)=>t.toString(16).padStart(2,"0"));function Jt$2(Z){if(ht(Z),jr$1)return Z.toHex();let t="";for(let Hs=0;Hs<Z.length;Hs++)t+=Yi[Z[Hs]];return t}const vt$2={_0:48,_9:57,A:65,F:70,a:97,f:102};function Lr$1(Z){if(Z>=vt$2._0&&Z<=vt$2._9)return Z-vt$2._0;if(Z>=vt$2.A&&Z<=vt$2.F)return Z-(vt$2.A-10);if(Z>=vt$2.a&&Z<=vt$2.f)return Z-(vt$2.a-10)}function _e$2(Z){if(typeof Z!="string")throw new Error("hex string expected, got "+typeof Z);if(jr$1)return Uint8Array.fromHex(Z);const t=Z.length,Hs=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const zs=new Uint8Array(Hs);for(let Ys=0,Zs=0;Ys<Hs;Ys++,Zs+=2){const _u=Lr$1(Z.charCodeAt(Zs)),Eu=Lr$1(Z.charCodeAt(Zs+1));if(_u===void 0||Eu===void 0){const Iu=Z[Zs]+Z[Zs+1];throw new Error('hex string expected, got non-hex character "'+Iu+'" at index '+Zs)}zs[Ys]=_u*16+Eu}return zs}function kr$1(Z){if(typeof Z!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(Z))}function pt$1(Z){return typeof Z=="string"&&(Z=kr$1(Z)),ht(Z),Z}function _t$2(...Z){let t=0;for(let zs=0;zs<Z.length;zs++){const Ys=Z[zs];ht(Ys),t+=Ys.length}const Hs=new Uint8Array(t);for(let zs=0,Ys=0;zs<Z.length;zs++){const Zs=Z[zs];Hs.set(Zs,Ys),Ys+=Zs.length}return Hs}class Re{}function ge$1(Z){const t=zs=>Z().update(pt$1(zs)).digest(),Hs=Z();return t.outputLen=Hs.outputLen,t.blockLen=Hs.blockLen,t.create=()=>Z(),t}function Wi$1(Z){const t=(zs,Ys)=>Z(Ys).update(pt$1(zs)).digest(),Hs=Z({});return t.outputLen=Hs.outputLen,t.blockLen=Hs.blockLen,t.create=zs=>Z(zs),t}function Mt$1(Z=32){if(Xt$2&&typeof Xt$2.getRandomValues=="function")return Xt$2.getRandomValues(new Uint8Array(Z));if(Xt$2&&typeof Xt$2.randomBytes=="function")return Uint8Array.from(Xt$2.randomBytes(Z));throw new Error("crypto.getRandomValues must be defined")}const Xi=BigInt(0),be$1=BigInt(1),Ji=BigInt(2),Qi=BigInt(7),tc=BigInt(256),ec=BigInt(113),Pr$1=[],Hr$1=[],Dr$1=[];for(let Z=0,t=be$1,Hs=1,zs=0;Z<24;Z++){[Hs,zs]=[zs,(2*Hs+3*zs)%5],Pr$1.push(2*(5*zs+Hs)),Hr$1.push((Z+1)*(Z+2)/2%64);let Ys=Xi;for(let Zs=0;Zs<7;Zs++)t=(t<<be$1^(t>>Qi)*ec)%tc,t&Ji&&(Ys^=be$1<<(be$1<<BigInt(Zs))-be$1);Dr$1.push(Ys)}const Vr$1=_r$1(Dr$1,!0),nc=Vr$1[0],rc=Vr$1[1],Mr$1=(Z,t,Hs)=>Hs>32?Mi$1(Z,t,Hs):Di$1(Z,t,Hs),Kr$1=(Z,t,Hs)=>Hs>32?Ki$1(Z,t,Hs):Vi$1(Z,t,Hs);function oc(Z,t=24){const Hs=new Uint32Array(10);for(let zs=24-t;zs<24;zs++){for(let _u=0;_u<10;_u++)Hs[_u]=Z[_u]^Z[_u+10]^Z[_u+20]^Z[_u+30]^Z[_u+40];for(let _u=0;_u<10;_u+=2){const Eu=(_u+8)%10,Iu=(_u+2)%10,Au=Hs[Iu],$u=Hs[Iu+1],vu=Mr$1(Au,$u,1)^Hs[Eu],Su=Kr$1(Au,$u,1)^Hs[Eu+1];for(let Ru=0;Ru<50;Ru+=10)Z[_u+Ru]^=vu,Z[_u+Ru+1]^=Su}let Ys=Z[2],Zs=Z[3];for(let _u=0;_u<24;_u++){const Eu=Hr$1[_u],Iu=Mr$1(Ys,Zs,Eu),Au=Kr$1(Ys,Zs,Eu),$u=Pr$1[_u];Ys=Z[$u],Zs=Z[$u+1],Z[$u]=Iu,Z[$u+1]=Au}for(let _u=0;_u<50;_u+=10){for(let Eu=0;Eu<10;Eu++)Hs[Eu]=Z[_u+Eu];for(let Eu=0;Eu<10;Eu++)Z[_u+Eu]^=~Hs[(Eu+2)%10]&Hs[(Eu+4)%10]}Z[0]^=nc[zs],Z[1]^=rc[zs]}lt(Hs)}let Jn$1=class Jd extends Re{constructor(t,Hs,zs,Ys=!1,Zs=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=t,this.suffix=Hs,this.outputLen=zs,this.enableXOF=Ys,this.rounds=Zs,mt$2(zs),!(0<t&&t<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=pe$1(this.state)}clone(){return this._cloneInto()}keccak(){Ut$2(this.state32),oc(this.state32,this.rounds),Ut$2(this.state32),this.posOut=0,this.pos=0}update(t){Nt$1(this),t=pt$1(t),ht(t);const{blockLen:Hs,state:zs}=this,Ys=t.length;for(let Zs=0;Zs<Ys;){const _u=Math.min(Hs-this.pos,Ys-Zs);for(let Eu=0;Eu<_u;Eu++)zs[this.pos++]^=t[Zs++];this.pos===Hs&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:t,suffix:Hs,pos:zs,blockLen:Ys}=this;t[zs]^=Hs,Hs&128&&zs===Ys-1&&this.keccak(),t[Ys-1]^=128,this.keccak()}writeInto(t){Nt$1(this,!1),ht(t),this.finish();const Hs=this.state,{blockLen:zs}=this;for(let Ys=0,Zs=t.length;Ys<Zs;){this.posOut>=zs&&this.keccak();const _u=Math.min(zs-this.posOut,Zs-Ys);t.set(Hs.subarray(this.posOut,this.posOut+_u),Ys),this.posOut+=_u,Ys+=_u}return t}xofInto(t){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(t)}xof(t){return mt$2(t),this.xofInto(new Uint8Array(t))}digestInto(t){if(un$1(t,this),this.finished)throw new Error("digest() was already called");return this.writeInto(t),this.destroy(),t}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,lt(this.state)}_cloneInto(t){const{blockLen:Hs,suffix:zs,outputLen:Ys,rounds:Zs,enableXOF:_u}=this;return t||(t=new Jd(Hs,zs,Ys,_u,Zs)),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=Zs,t.suffix=zs,t.outputLen=Ys,t.enableXOF=_u,t.destroyed=this.destroyed,t}};const sc=(Z,t,Hs)=>ge$1(()=>new Jn$1(t,Z,Hs)),ic=sc(1,136,256/8);function cc(Z,t,Hs,zs){if(typeof Z.setBigUint64=="function")return Z.setBigUint64(t,Hs,zs);const Ys=BigInt(32),Zs=BigInt(4294967295),_u=Number(Hs>>Ys&Zs),Eu=Number(Hs&Zs),Iu=zs?4:0,Au=zs?0:4;Z.setUint32(t+Iu,_u,zs),Z.setUint32(t+Au,Eu,zs)}function fc(Z,t,Hs){return Z&t^~Z&Hs}function ac(Z,t,Hs){return Z&t^Z&Hs^t&Hs}let qr$1=class extends Re{constructor(t,Hs,zs,Ys){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=Hs,this.padOffset=zs,this.isLE=Ys,this.buffer=new Uint8Array(t),this.view=ln$1(this.buffer)}update(t){Nt$1(this),t=pt$1(t),ht(t);const{view:Hs,buffer:zs,blockLen:Ys}=this,Zs=t.length;for(let _u=0;_u<Zs;){const Eu=Math.min(Ys-this.pos,Zs-_u);if(Eu===Ys){const Iu=ln$1(t);for(;Ys<=Zs-_u;_u+=Ys)this.process(Iu,_u);continue}zs.set(t.subarray(_u,_u+Eu),this.pos),this.pos+=Eu,_u+=Eu,this.pos===Ys&&(this.process(Hs,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Nt$1(this),un$1(t,this),this.finished=!0;const{buffer:Hs,view:zs,blockLen:Ys,isLE:Zs}=this;let{pos:_u}=this;Hs[_u++]=128,lt(this.buffer.subarray(_u)),this.padOffset>Ys-_u&&(this.process(zs,0),_u=0);for(let vu=_u;vu<Ys;vu++)Hs[vu]=0;cc(zs,Ys-8,BigInt(this.length*8),Zs),this.process(zs,0);const Eu=ln$1(t),Iu=this.outputLen;if(Iu%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const Au=Iu/4,$u=this.get();if(Au>$u.length)throw new Error("_sha2: outputLen bigger than state");for(let vu=0;vu<Au;vu++)Eu.setUint32(4*vu,$u[vu],Zs)}digest(){const{buffer:t,outputLen:Hs}=this;this.digestInto(t);const zs=t.slice(0,Hs);return this.destroy(),zs}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:Hs,buffer:zs,length:Ys,finished:Zs,destroyed:_u,pos:Eu}=this;return t.destroyed=_u,t.finished=Zs,t.length=Ys,t.pos=Eu,Ys%Hs&&t.buffer.set(zs),t}clone(){return this._cloneInto()}};const Rt$3=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),X$1=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),J$1=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),uc=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),$t$2=new Uint32Array(64);class lc extends qr$1{constructor(t=32){super(64,t,8,!1),this.A=Rt$3[0]|0,this.B=Rt$3[1]|0,this.C=Rt$3[2]|0,this.D=Rt$3[3]|0,this.E=Rt$3[4]|0,this.F=Rt$3[5]|0,this.G=Rt$3[6]|0,this.H=Rt$3[7]|0}get(){const{A:t,B:Hs,C:zs,D:Ys,E:Zs,F:_u,G:Eu,H:Iu}=this;return[t,Hs,zs,Ys,Zs,_u,Eu,Iu]}set(t,Hs,zs,Ys,Zs,_u,Eu,Iu){this.A=t|0,this.B=Hs|0,this.C=zs|0,this.D=Ys|0,this.E=Zs|0,this.F=_u|0,this.G=Eu|0,this.H=Iu|0}process(t,Hs){for(let vu=0;vu<16;vu++,Hs+=4)$t$2[vu]=t.getUint32(Hs,!1);for(let vu=16;vu<64;vu++){const Su=$t$2[vu-15],Ru=$t$2[vu-2],Pu=bt(Su,7)^bt(Su,18)^Su>>>3,Cu=bt(Ru,17)^bt(Ru,19)^Ru>>>10;$t$2[vu]=Cu+$t$2[vu-7]+Pu+$t$2[vu-16]|0}let{A:zs,B:Ys,C:Zs,D:_u,E:Eu,F:Iu,G:Au,H:$u}=this;for(let vu=0;vu<64;vu++){const Su=bt(Eu,6)^bt(Eu,11)^bt(Eu,25),Ru=$u+Su+fc(Eu,Iu,Au)+uc[vu]+$t$2[vu]|0,Pu=(bt(zs,2)^bt(zs,13)^bt(zs,22))+ac(zs,Ys,Zs)|0;$u=Au,Au=Iu,Iu=Eu,Eu=_u+Ru|0,_u=Zs,Zs=Ys,Ys=zs,zs=Ru+Pu|0}zs=zs+this.A|0,Ys=Ys+this.B|0,Zs=Zs+this.C|0,_u=_u+this.D|0,Eu=Eu+this.E|0,Iu=Iu+this.F|0,Au=Au+this.G|0,$u=$u+this.H|0,this.set(zs,Ys,Zs,_u,Eu,Iu,Au,$u)}roundClean(){lt($t$2)}destroy(){this.set(0,0,0,0,0,0,0,0),lt(this.buffer)}}const Fr$1=_r$1(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(Z=>BigInt(Z))),dc=Fr$1[0],hc=Fr$1[1],Tt$2=new Uint32Array(80),Ct$2=new Uint32Array(80);let dn$1=class extends qr$1{constructor(t=64){super(128,t,16,!1),this.Ah=J$1[0]|0,this.Al=J$1[1]|0,this.Bh=J$1[2]|0,this.Bl=J$1[3]|0,this.Ch=J$1[4]|0,this.Cl=J$1[5]|0,this.Dh=J$1[6]|0,this.Dl=J$1[7]|0,this.Eh=J$1[8]|0,this.El=J$1[9]|0,this.Fh=J$1[10]|0,this.Fl=J$1[11]|0,this.Gh=J$1[12]|0,this.Gl=J$1[13]|0,this.Hh=J$1[14]|0,this.Hl=J$1[15]|0}get(){const{Ah:t,Al:Hs,Bh:zs,Bl:Ys,Ch:Zs,Cl:_u,Dh:Eu,Dl:Iu,Eh:Au,El:$u,Fh:vu,Fl:Su,Gh:Ru,Gl:Pu,Hh:Cu,Hl:Bu}=this;return[t,Hs,zs,Ys,Zs,_u,Eu,Iu,Au,$u,vu,Su,Ru,Pu,Cu,Bu]}set(t,Hs,zs,Ys,Zs,_u,Eu,Iu,Au,$u,vu,Su,Ru,Pu,Cu,Bu){this.Ah=t|0,this.Al=Hs|0,this.Bh=zs|0,this.Bl=Ys|0,this.Ch=Zs|0,this.Cl=_u|0,this.Dh=Eu|0,this.Dl=Iu|0,this.Eh=Au|0,this.El=$u|0,this.Fh=vu|0,this.Fl=Su|0,this.Gh=Ru|0,this.Gl=Pu|0,this.Hh=Cu|0,this.Hl=Bu|0}process(t,Hs){for(let Hu=0;Hu<16;Hu++,Hs+=4)Tt$2[Hu]=t.getUint32(Hs),Ct$2[Hu]=t.getUint32(Hs+=4);for(let Hu=16;Hu<80;Hu++){const Wu=Tt$2[Hu-15]|0,tl=Ct$2[Hu-15]|0,Xu=St$3(Wu,tl,1)^St$3(Wu,tl,8)^Rr$1(Wu,tl,7),ju=Ot$1(Wu,tl,1)^Ot$1(Wu,tl,8)^$r$1(Wu,tl,7),ku=Tt$2[Hu-2]|0,Uu=Ct$2[Hu-2]|0,Gu=St$3(ku,Uu,19)^de(ku,Uu,61)^Rr$1(ku,Uu,6),Yu=Ot$1(ku,Uu,19)^he$1(ku,Uu,61)^$r$1(ku,Uu,6),Qu=qi$1(ju,Yu,Ct$2[Hu-7],Ct$2[Hu-16]),Lu=Fi$1(Qu,Xu,Gu,Tt$2[Hu-7],Tt$2[Hu-16]);Tt$2[Hu]=Lu|0,Ct$2[Hu]=Qu|0}let{Ah:zs,Al:Ys,Bh:Zs,Bl:_u,Ch:Eu,Cl:Iu,Dh:Au,Dl:$u,Eh:vu,El:Su,Fh:Ru,Fl:Pu,Gh:Cu,Gl:Bu,Hh:Fu,Hl:zu}=this;for(let Hu=0;Hu<80;Hu++){const Wu=St$3(vu,Su,14)^St$3(vu,Su,18)^de(vu,Su,41),tl=Ot$1(vu,Su,14)^Ot$1(vu,Su,18)^he$1(vu,Su,41),Xu=vu&Ru^~vu&Cu,ju=Su&Pu^~Su&Bu,ku=Zi(zu,tl,ju,hc[Hu],Ct$2[Hu]),Uu=Gi$1(ku,Fu,Wu,Xu,dc[Hu],Tt$2[Hu]),Gu=ku|0,Yu=St$3(zs,Ys,28)^de(zs,Ys,34)^de(zs,Ys,39),Qu=Ot$1(zs,Ys,28)^he$1(zs,Ys,34)^he$1(zs,Ys,39),Lu=zs&Zs^zs&Eu^Zs&Eu,cl=Ys&_u^Ys&Iu^_u&Iu;Fu=Cu|0,zu=Bu|0,Cu=Ru|0,Bu=Pu|0,Ru=vu|0,Pu=Su|0,{h:vu,l:Su}=dt$1(Au|0,$u|0,Uu|0,Gu|0),Au=Eu|0,$u=Iu|0,Eu=Zs|0,Iu=_u|0,Zs=zs|0,_u=Ys|0;const el=fn$1(Gu,Qu,cl);zs=an$2(el,Uu,Yu,Lu),Ys=el|0}({h:zs,l:Ys}=dt$1(this.Ah|0,this.Al|0,zs|0,Ys|0)),{h:Zs,l:_u}=dt$1(this.Bh|0,this.Bl|0,Zs|0,_u|0),{h:Eu,l:Iu}=dt$1(this.Ch|0,this.Cl|0,Eu|0,Iu|0),{h:Au,l:$u}=dt$1(this.Dh|0,this.Dl|0,Au|0,$u|0),{h:vu,l:Su}=dt$1(this.Eh|0,this.El|0,vu|0,Su|0),{h:Ru,l:Pu}=dt$1(this.Fh|0,this.Fl|0,Ru|0,Pu|0),{h:Cu,l:Bu}=dt$1(this.Gh|0,this.Gl|0,Cu|0,Bu|0),{h:Fu,l:zu}=dt$1(this.Hh|0,this.Hl|0,Fu|0,zu|0),this.set(zs,Ys,Zs,_u,Eu,Iu,Au,$u,vu,Su,Ru,Pu,Cu,Bu,Fu,zu)}roundClean(){lt(Tt$2,Ct$2)}destroy(){lt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};class pc extends dn$1{constructor(){super(48),this.Ah=X$1[0]|0,this.Al=X$1[1]|0,this.Bh=X$1[2]|0,this.Bl=X$1[3]|0,this.Ch=X$1[4]|0,this.Cl=X$1[5]|0,this.Dh=X$1[6]|0,this.Dl=X$1[7]|0,this.Eh=X$1[8]|0,this.El=X$1[9]|0,this.Fh=X$1[10]|0,this.Fl=X$1[11]|0,this.Gh=X$1[12]|0,this.Gl=X$1[13]|0,this.Hh=X$1[14]|0,this.Hl=X$1[15]|0}}const Q=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class gc extends dn$1{constructor(){super(32),this.Ah=Q[0]|0,this.Al=Q[1]|0,this.Bh=Q[2]|0,this.Bl=Q[3]|0,this.Ch=Q[4]|0,this.Cl=Q[5]|0,this.Dh=Q[6]|0,this.Dl=Q[7]|0,this.Eh=Q[8]|0,this.El=Q[9]|0,this.Fh=Q[10]|0,this.Fl=Q[11]|0,this.Gh=Q[12]|0,this.Gl=Q[13]|0,this.Hh=Q[14]|0,this.Hl=Q[15]|0}}const $e$1=ge$1(()=>new lc),bc=ge$1(()=>new dn$1),yc=ge$1(()=>new pc),mc=ge$1(()=>new gc),wc=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),z$1=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),S$1=new Uint32Array(32);function jt$2(Z,t,Hs,zs,Ys,Zs){const _u=Ys[Zs],Eu=Ys[Zs+1];let Iu=S$1[2*Z],Au=S$1[2*Z+1],$u=S$1[2*t],vu=S$1[2*t+1],Su=S$1[2*Hs],Ru=S$1[2*Hs+1],Pu=S$1[2*zs],Cu=S$1[2*zs+1],Bu=fn$1(Iu,$u,_u);Au=an$2(Bu,Au,vu,Eu),Iu=Bu|0,{Dh:Cu,Dl:Pu}={Dh:Cu^Au,Dl:Pu^Iu},{Dh:Cu,Dl:Pu}={Dh:Pi$1(Cu,Pu),Dl:Hi$1(Cu)},{h:Ru,l:Su}=dt$1(Ru,Su,Cu,Pu),{Bh:vu,Bl:$u}={Bh:vu^Ru,Bl:$u^Su},{Bh:vu,Bl:$u}={Bh:St$3(vu,$u,24),Bl:Ot$1(vu,$u,24)},S$1[2*Z]=Iu,S$1[2*Z+1]=Au,S$1[2*t]=$u,S$1[2*t+1]=vu,S$1[2*Hs]=Su,S$1[2*Hs+1]=Ru,S$1[2*zs]=Pu,S$1[2*zs+1]=Cu}function Lt$2(Z,t,Hs,zs,Ys,Zs){const _u=Ys[Zs],Eu=Ys[Zs+1];let Iu=S$1[2*Z],Au=S$1[2*Z+1],$u=S$1[2*t],vu=S$1[2*t+1],Su=S$1[2*Hs],Ru=S$1[2*Hs+1],Pu=S$1[2*zs],Cu=S$1[2*zs+1],Bu=fn$1(Iu,$u,_u);Au=an$2(Bu,Au,vu,Eu),Iu=Bu|0,{Dh:Cu,Dl:Pu}={Dh:Cu^Au,Dl:Pu^Iu},{Dh:Cu,Dl:Pu}={Dh:St$3(Cu,Pu,16),Dl:Ot$1(Cu,Pu,16)},{h:Ru,l:Su}=dt$1(Ru,Su,Cu,Pu),{Bh:vu,Bl:$u}={Bh:vu^Ru,Bl:$u^Su},{Bh:vu,Bl:$u}={Bh:de(vu,$u,63),Bl:he$1(vu,$u,63)},S$1[2*Z]=Iu,S$1[2*Z+1]=Au,S$1[2*t]=$u,S$1[2*t+1]=vu,S$1[2*Hs]=Su,S$1[2*Hs+1]=Ru,S$1[2*zs]=Pu,S$1[2*zs+1]=Cu}function vc(Z,t={},Hs,zs,Ys){if(mt$2(Hs),Z<0||Z>Hs)throw new Error("outputLen bigger than keyLen");const{key:Zs,salt:_u,personalization:Eu}=t;if(Zs!==void 0&&(Zs.length<1||Zs.length>Hs))throw new Error("key length must be undefined or 1.."+Hs);if(_u!==void 0&&_u.length!==zs)throw new Error("salt must be undefined or "+zs);if(Eu!==void 0&&Eu.length!==Ys)throw new Error("personalization must be undefined or "+Ys)}class xc extends Re{constructor(t,Hs){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,mt$2(t),mt$2(Hs),this.blockLen=t,this.outputLen=Hs,this.buffer=new Uint8Array(t),this.buffer32=pe$1(this.buffer)}update(t){Nt$1(this),t=pt$1(t),ht(t);const{blockLen:Hs,buffer:zs,buffer32:Ys}=this,Zs=t.length,_u=t.byteOffset,Eu=t.buffer;for(let Iu=0;Iu<Zs;){this.pos===Hs&&(Ut$2(Ys),this.compress(Ys,0,!1),Ut$2(Ys),this.pos=0);const Au=Math.min(Hs-this.pos,Zs-Iu),$u=_u+Iu;if(Au===Hs&&!($u%4)&&Iu+Au<Zs){const vu=new Uint32Array(Eu,$u,Math.floor((Zs-Iu)/4));Ut$2(vu);for(let Su=0;Iu+Hs<Zs;Su+=Ys.length,Iu+=Hs)this.length+=Hs,this.compress(vu,Su,!1);Ut$2(vu);continue}zs.set(t.subarray(Iu,Iu+Au),this.pos),this.pos+=Au,this.length+=Au,Iu+=Au}return this}digestInto(t){Nt$1(this),un$1(t,this);const{pos:Hs,buffer32:zs}=this;this.finished=!0,lt(this.buffer.subarray(Hs)),Ut$2(zs),this.compress(zs,0,!0),Ut$2(zs);const Ys=pe$1(t);this.get().forEach((Zs,_u)=>Ys[_u]=wt$1(Zs))}digest(){const{buffer:t,outputLen:Hs}=this;this.digestInto(t);const zs=t.slice(0,Hs);return this.destroy(),zs}_cloneInto(t){const{buffer:Hs,length:zs,finished:Ys,destroyed:Zs,outputLen:_u,pos:Eu}=this;return t||(t=new this.constructor({dkLen:_u})),t.set(...this.get()),t.buffer.set(Hs),t.destroyed=Zs,t.finished=Ys,t.length=zs,t.pos=Eu,t.outputLen=_u,t}clone(){return this._cloneInto()}}class Ec extends xc{constructor(t={}){const Hs=t.dkLen===void 0?64:t.dkLen;super(128,Hs),this.v0l=z$1[0]|0,this.v0h=z$1[1]|0,this.v1l=z$1[2]|0,this.v1h=z$1[3]|0,this.v2l=z$1[4]|0,this.v2h=z$1[5]|0,this.v3l=z$1[6]|0,this.v3h=z$1[7]|0,this.v4l=z$1[8]|0,this.v4h=z$1[9]|0,this.v5l=z$1[10]|0,this.v5h=z$1[11]|0,this.v6l=z$1[12]|0,this.v6h=z$1[13]|0,this.v7l=z$1[14]|0,this.v7h=z$1[15]|0,vc(Hs,t,64,16,16);let{key:zs,personalization:Ys,salt:Zs}=t,_u=0;if(zs!==void 0&&(zs=pt$1(zs),_u=zs.length),this.v0l^=this.outputLen|_u<<8|65536|1<<24,Zs!==void 0){Zs=pt$1(Zs);const Eu=pe$1(Zs);this.v4l^=wt$1(Eu[0]),this.v4h^=wt$1(Eu[1]),this.v5l^=wt$1(Eu[2]),this.v5h^=wt$1(Eu[3])}if(Ys!==void 0){Ys=pt$1(Ys);const Eu=pe$1(Ys);this.v6l^=wt$1(Eu[0]),this.v6h^=wt$1(Eu[1]),this.v7l^=wt$1(Eu[2]),this.v7h^=wt$1(Eu[3])}if(zs!==void 0){const Eu=new Uint8Array(this.blockLen);Eu.set(zs),this.update(Eu)}}get(){let{v0l:t,v0h:Hs,v1l:zs,v1h:Ys,v2l:Zs,v2h:_u,v3l:Eu,v3h:Iu,v4l:Au,v4h:$u,v5l:vu,v5h:Su,v6l:Ru,v6h:Pu,v7l:Cu,v7h:Bu}=this;return[t,Hs,zs,Ys,Zs,_u,Eu,Iu,Au,$u,vu,Su,Ru,Pu,Cu,Bu]}set(t,Hs,zs,Ys,Zs,_u,Eu,Iu,Au,$u,vu,Su,Ru,Pu,Cu,Bu){this.v0l=t|0,this.v0h=Hs|0,this.v1l=zs|0,this.v1h=Ys|0,this.v2l=Zs|0,this.v2h=_u|0,this.v3l=Eu|0,this.v3h=Iu|0,this.v4l=Au|0,this.v4h=$u|0,this.v5l=vu|0,this.v5h=Su|0,this.v6l=Ru|0,this.v6h=Pu|0,this.v7l=Cu|0,this.v7h=Bu|0}compress(t,Hs,zs){this.get().forEach((Iu,Au)=>S$1[Au]=Iu),S$1.set(z$1,16);let{h:Ys,l:Zs}=Ur$1(BigInt(this.length));S$1[24]=z$1[8]^Zs,S$1[25]=z$1[9]^Ys,zs&&(S$1[28]=~S$1[28],S$1[29]=~S$1[29]);let _u=0;const Eu=wc;for(let Iu=0;Iu<12;Iu++)jt$2(0,4,8,12,t,Hs+2*Eu[_u++]),Lt$2(0,4,8,12,t,Hs+2*Eu[_u++]),jt$2(1,5,9,13,t,Hs+2*Eu[_u++]),Lt$2(1,5,9,13,t,Hs+2*Eu[_u++]),jt$2(2,6,10,14,t,Hs+2*Eu[_u++]),Lt$2(2,6,10,14,t,Hs+2*Eu[_u++]),jt$2(3,7,11,15,t,Hs+2*Eu[_u++]),Lt$2(3,7,11,15,t,Hs+2*Eu[_u++]),jt$2(0,5,10,15,t,Hs+2*Eu[_u++]),Lt$2(0,5,10,15,t,Hs+2*Eu[_u++]),jt$2(1,6,11,12,t,Hs+2*Eu[_u++]),Lt$2(1,6,11,12,t,Hs+2*Eu[_u++]),jt$2(2,7,8,13,t,Hs+2*Eu[_u++]),Lt$2(2,7,8,13,t,Hs+2*Eu[_u++]),jt$2(3,4,9,14,t,Hs+2*Eu[_u++]),Lt$2(3,4,9,14,t,Hs+2*Eu[_u++]);this.v0l^=S$1[0]^S$1[16],this.v0h^=S$1[1]^S$1[17],this.v1l^=S$1[2]^S$1[18],this.v1h^=S$1[3]^S$1[19],this.v2l^=S$1[4]^S$1[20],this.v2h^=S$1[5]^S$1[21],this.v3l^=S$1[6]^S$1[22],this.v3h^=S$1[7]^S$1[23],this.v4l^=S$1[8]^S$1[24],this.v4h^=S$1[9]^S$1[25],this.v5l^=S$1[10]^S$1[26],this.v5h^=S$1[11]^S$1[27],this.v6l^=S$1[12]^S$1[28],this.v6h^=S$1[13]^S$1[29],this.v7l^=S$1[14]^S$1[30],this.v7h^=S$1[15]^S$1[31],lt(S$1)}destroy(){this.destroyed=!0,lt(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Bc=Wi$1(Z=>new Ec(Z)),Ac="https://rpc.walletconnect.org/v1";function hn$1(Z){const t=`Ethereum Signed Message:
${Z.length}`,Hs=new TextEncoder().encode(t+Z);return"0x"+Buffer$1.from(ic(Hs)).toString("hex")}async function Zr$1(Z,t,Hs,zs,Ys,Zs){switch(Hs.t){case"eip191":return await Gr$1(Z,t,Hs.s);case"eip1271":return await zr$1(Z,t,Hs.s,zs,Ys,Zs);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${Hs.t}`)}}function Gr$1(Z,t,Hs){const zs=fromHex(Hs);return recoverAddress({payload:hn$1(t),signature:zs}).toLowerCase()===Z.toLowerCase()}async function zr$1(Z,t,Hs,zs,Ys,Zs){const _u=Je$1(zs);if(!_u.namespace||!_u.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${zs}`);try{const Eu="0x1626ba7e",Iu="0000000000000000000000000000000000000000000000000000000000000040",Au=Hs.substring(2),$u=(Au.length/2).toString(16).padStart(64,"0"),vu=(t.startsWith("0x")?t:hn$1(t)).substring(2),Su=Eu+vu+Iu+$u+Au,Ru=await fetch(`${Zs||Ac}/?chainId=${zs}&projectId=${Ys}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:Ic(),jsonrpc:"2.0",method:"eth_call",params:[{to:Z,data:Su},"latest"]})}),{result:Pu}=await Ru.json();return Pu?Pu.slice(0,Eu.length).toLowerCase()===Eu.toLowerCase():!1}catch(Eu){return console.error("isValidEip1271Signature: ",Eu),!1}}function Ic(){return Date.now()+Math.floor(Math.random()*1e3)}function Sc(Z){const t=atob(Z),Hs=new Uint8Array(t.length);for(let _u=0;_u<t.length;_u++)Hs[_u]=t.charCodeAt(_u);const zs=Hs[0];if(zs===0)throw new Error("No signatures found");const Ys=1+zs*64;if(Hs.length<Ys)throw new Error("Transaction data too short for claimed signature count");if(Hs.length<100)throw new Error("Transaction too short");const Zs=Buffer$1.from(Z,"base64").slice(1,65);return ue.encode(Zs)}function Oc(Z){const t=new Uint8Array(Buffer$1.from(Z,"base64")),Hs=Array.from("TransactionData::").map(Zs=>Zs.charCodeAt(0)),zs=new Uint8Array(Hs.length+t.length);zs.set(Hs),zs.set(t,Hs.length);const Ys=Bc(zs,{dkLen:32});return ue.encode(Ys)}function Nc(Z){const t=new Uint8Array($e$1(Yr$1(Z)));return ue.encode(t)}function Yr$1(Z){if(Z instanceof Uint8Array)return Z;if(Array.isArray(Z))return new Uint8Array(Z);if(typeof Z=="object"&&Z!=null&&Z.data)return new Uint8Array(Object.values(Z.data));if(typeof Z=="object"&&Z)return new Uint8Array(Object.values(Z));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function Uc(Z){const t=Buffer$1.from(Z,"base64"),Hs=decode$2(t).txn;if(!Hs)throw new Error("Invalid signed transaction: missing 'txn' field");const zs=encode$2(Hs),Ys=Buffer$1.from("TX"),Zs=Buffer$1.concat([Ys,Buffer$1.from(zs)]),_u=mc(Zs);return base32$2.encode(_u).replace(/=+$/,"")}function pn$1(Z){const t=[];let Hs=BigInt(Z);for(;Hs>=BigInt(128);)t.push(Number(Hs&BigInt(127)|BigInt(128))),Hs>>=BigInt(7);return t.push(Number(Hs)),Buffer$1.from(t)}function _c(Z){const t=Buffer$1.from(Z.signed.bodyBytes,"base64"),Hs=Buffer$1.from(Z.signed.authInfoBytes,"base64"),zs=Buffer$1.from(Z.signature.signature,"base64"),Ys=[];Ys.push(Buffer$1.from([10])),Ys.push(pn$1(t.length)),Ys.push(t),Ys.push(Buffer$1.from([18])),Ys.push(pn$1(Hs.length)),Ys.push(Hs),Ys.push(Buffer$1.from([26])),Ys.push(pn$1(zs.length)),Ys.push(zs);const Zs=Buffer$1.concat(Ys),_u=$e$1(Zs);return Buffer$1.from(_u).toString("hex").toUpperCase()}function Rc(Z){var t,Hs;const zs=[];try{if(typeof Z=="string")return zs.push(Z),zs;if(typeof Z!="object")return zs;Z!=null&&Z.id&&zs.push(Z.id);const Ys=(Hs=(t=Z==null?void 0:Z.capabilities)==null?void 0:t.caip345)==null?void 0:Hs.transactionHashes;Ys&&zs.push(...Ys)}catch(Ys){console.warn("getWalletSendCallsHashes failed: ",Ys)}return zs}var $c=Object.defineProperty,Tc=Object.defineProperties,Cc=Object.getOwnPropertyDescriptors,Wr$1=Object.getOwnPropertySymbols,jc=Object.prototype.hasOwnProperty,Lc=Object.prototype.propertyIsEnumerable,Xr$1=(Z,t,Hs)=>t in Z?$c(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,gn$1=(Z,t)=>{for(var Hs in t||(t={}))jc.call(t,Hs)&&Xr$1(Z,Hs,t[Hs]);if(Wr$1)for(var Hs of Wr$1(t))Lc.call(t,Hs)&&Xr$1(Z,Hs,t[Hs]);return Z},Jr$1=(Z,t)=>Tc(Z,Cc(t));const kc="did:pkh:",Te=Z=>Z==null?void 0:Z.split(":"),Qr$1=Z=>{const t=Z&&Te(Z);if(t)return Z.includes(kc)?t[3]:t[1]},to$1=Z=>{const t=Z&&Te(Z);if(t)return t[2]+":"+t[3]},bn$1=Z=>{const t=Z&&Te(Z);if(t)return t.pop()};async function Pc(Z){const{cacao:t,projectId:Hs}=Z,{s:zs,p:Ys}=t,Zs=eo$1(Ys,Ys.iss),_u=bn$1(Ys.iss);return await Zr$1(_u,Zs,zs,to$1(Ys.iss),Hs)}const eo$1=(Z,t)=>{const Hs=`${Z.domain} wants you to sign in with your Ethereum account:`,zs=bn$1(t);if(!Z.aud&&!Z.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let Ys=Z.statement||void 0;const Zs=`URI: ${Z.aud||Z.uri}`,_u=`Version: ${Z.version}`,Eu=`Chain ID: ${Qr$1(t)}`,Iu=`Nonce: ${Z.nonce}`,Au=`Issued At: ${Z.iat}`,$u=Z.exp?`Expiration Time: ${Z.exp}`:void 0,vu=Z.nbf?`Not Before: ${Z.nbf}`:void 0,Su=Z.requestId?`Request ID: ${Z.requestId}`:void 0,Ru=Z.resources?`Resources:${Z.resources.map(Cu=>`
- ${Cu}`).join("")}`:void 0,Pu=je(Z.resources);if(Pu){const Cu=kt$1(Pu);Ys=wn$1(Ys,Cu)}return[Hs,zs,"",Ys,"",Zs,_u,Eu,Iu,Au,$u,vu,Su,Ru].filter(Cu=>Cu!=null).join(`
`)};function Hc(Z,t,Hs){return Hs.includes("did:pkh:")||(Hs=`did:pkh:${Hs}`),{h:{t:"caip122"},p:{iss:Hs,domain:Z.domain,aud:Z.aud,version:Z.version,nonce:Z.nonce,iat:Z.iat,statement:Z.statement,requestId:Z.requestId,resources:Z.resources,nbf:Z.nbf,exp:Z.exp},s:t}}function Dc(Z){var t;const{authPayload:Hs,chains:zs,methods:Ys}=Z,Zs=Hs.statement||"";if(!(zs!=null&&zs.length))return Hs;const _u=Hs.chains,Eu=sn$2(_u,zs);if(!(Eu!=null&&Eu.length))throw new Error("No supported chains");const Iu=no$1(Hs.resources);if(!Iu)return Hs;yt$1(Iu);const Au=ro$1(Iu,"eip155");let $u=(Hs==null?void 0:Hs.resources)||[];if(Au!=null&&Au.length){const vu=oo$1(Au),Su=sn$2(vu,Ys);if(!(Su!=null&&Su.length))throw new Error(`Supported methods don't satisfy the requested: ${JSON.stringify(vu)}, supported: ${JSON.stringify(Ys)}`);const Ru=yn$1("request",Su,{chains:Eu}),Pu=fo$1(Iu,"eip155",Ru);$u=((t=Hs==null?void 0:Hs.resources)==null?void 0:t.slice(0,-1))||[],$u.push(Ce(Pu))}return Jr$1(gn$1({},Hs),{statement:uo$1(Zs,je($u)),chains:Eu,resources:Hs!=null&&Hs.resources||$u.length>0?$u:void 0})}function no$1(Z){const t=je(Z);if(t&&mn$1(t))return kt$1(t)}function Vc(Z,t){var Hs;return(Hs=Z==null?void 0:Z.att)==null?void 0:Hs.hasOwnProperty(t)}function ro$1(Z,t){var Hs,zs;return(Hs=Z==null?void 0:Z.att)!=null&&Hs[t]?Object.keys((zs=Z==null?void 0:Z.att)==null?void 0:zs[t]):[]}function Mc(Z){return(Z==null?void 0:Z.map(t=>Object.keys(t)))||[]}function oo$1(Z){return(Z==null?void 0:Z.map(t=>{var Hs;return(Hs=t.split("/"))==null?void 0:Hs[1]}))||[]}function so$1(Z){return Buffer$1.from(JSON.stringify(Z)).toString("base64")}function io$1(Z){return JSON.parse(Buffer$1.from(Z,"base64").toString("utf-8"))}function yt$1(Z){if(!Z)throw new Error("No recap provided, value is undefined");if(!Z.att)throw new Error("No `att` property found");const t=Object.keys(Z.att);if(!(t!=null&&t.length))throw new Error("No resources found in `att` property");t.forEach(Hs=>{const zs=Z.att[Hs];if(Array.isArray(zs))throw new Error(`Resource must be an object: ${Hs}`);if(typeof zs!="object")throw new Error(`Resource must be an object: ${Hs}`);if(!Object.keys(zs).length)throw new Error(`Resource object is empty: ${Hs}`);Object.keys(zs).forEach(Ys=>{const Zs=zs[Ys];if(!Array.isArray(Zs))throw new Error(`Ability limits ${Ys} must be an array of objects, found: ${Zs}`);if(!Zs.length)throw new Error(`Value of ${Ys} is empty array, must be an array with objects`);Zs.forEach(_u=>{if(typeof _u!="object")throw new Error(`Ability limits (${Ys}) must be an array of objects, found: ${_u}`)})})})}function co$1(Z,t,Hs,zs={}){return Hs==null||Hs.sort((Ys,Zs)=>Ys.localeCompare(Zs)),{att:{[Z]:yn$1(t,Hs,zs)}}}function fo$1(Z,t,Hs){var zs;Z.att[t]=gn$1({},Hs);const Ys=(zs=Object.keys(Z.att))==null?void 0:zs.sort((_u,Eu)=>_u.localeCompare(Eu)),Zs={att:{}};return Ys.reduce((_u,Eu)=>(_u.att[Eu]=Z.att[Eu],_u),Zs)}function yn$1(Z,t,Hs={}){t=t==null?void 0:t.sort((Ys,Zs)=>Ys.localeCompare(Zs));const zs=t.map(Ys=>({[`${Z}/${Ys}`]:[Hs]}));return Object.assign({},...zs)}function Ce(Z){return yt$1(Z),`urn:recap:${so$1(Z).replace(/=/g,"")}`}function kt$1(Z){const t=io$1(Z.replace("urn:recap:",""));return yt$1(t),t}function Kc(Z,t,Hs){const zs=co$1(Z,t,Hs);return Ce(zs)}function mn$1(Z){return Z&&Z.includes("urn:recap:")}function qc(Z,t){const Hs=kt$1(Z),zs=kt$1(t),Ys=ao$1(Hs,zs);return Ce(Ys)}function ao$1(Z,t){yt$1(Z),yt$1(t);const Hs=Object.keys(Z.att).concat(Object.keys(t.att)).sort((Ys,Zs)=>Ys.localeCompare(Zs)),zs={att:{}};return Hs.forEach(Ys=>{var Zs,_u;Object.keys(((Zs=Z.att)==null?void 0:Zs[Ys])||{}).concat(Object.keys(((_u=t.att)==null?void 0:_u[Ys])||{})).sort((Eu,Iu)=>Eu.localeCompare(Iu)).forEach(Eu=>{var Iu,Au;zs.att[Ys]=Jr$1(gn$1({},zs.att[Ys]),{[Eu]:((Iu=Z.att[Ys])==null?void 0:Iu[Eu])||((Au=t.att[Ys])==null?void 0:Au[Eu])})})}),zs}function wn$1(Z="",t){yt$1(t);const Hs="I further authorize the stated URI to perform the following actions on my behalf: ";if(Z.includes(Hs))return Z;const zs=[];let Ys=0;Object.keys(t.att).forEach(Eu=>{const Iu=Object.keys(t.att[Eu]).map(vu=>({ability:vu.split("/")[0],action:vu.split("/")[1]}));Iu.sort((vu,Su)=>vu.action.localeCompare(Su.action));const Au={};Iu.forEach(vu=>{Au[vu.ability]||(Au[vu.ability]=[]),Au[vu.ability].push(vu.action)});const $u=Object.keys(Au).map(vu=>(Ys++,`(${Ys}) '${vu}': '${Au[vu].join("', '")}' for '${Eu}'.`));zs.push($u.join(", ").replace(".,","."))});const Zs=zs.join(" "),_u=`${Hs}${Zs}`;return`${Z?Z+" ":""}${_u}`}function Fc(Z){var t;const Hs=kt$1(Z);yt$1(Hs);const zs=(t=Hs.att)==null?void 0:t.eip155;return zs?Object.keys(zs).map(Ys=>Ys.split("/")[1]):[]}function Zc(Z){const t=kt$1(Z);yt$1(t);const Hs=[];return Object.values(t.att).forEach(zs=>{Object.values(zs).forEach(Ys=>{var Zs;(Zs=Ys==null?void 0:Ys[0])!=null&&Zs.chains&&Hs.push(Ys[0].chains)})}),[...new Set(Hs.flat())]}function uo$1(Z,t){if(!t)return Z;const Hs=kt$1(t);return yt$1(Hs),wn$1(Z,Hs)}function je(Z){if(!Z)return;const t=Z==null?void 0:Z[Z.length-1];return mn$1(t)?t:void 0}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function lo$1(Z){return Z instanceof Uint8Array||ArrayBuffer.isView(Z)&&Z.constructor.name==="Uint8Array"}function vn$1(Z){if(typeof Z!="boolean")throw new Error(`boolean expected, not ${Z}`)}function xn$1(Z){if(!Number.isSafeInteger(Z)||Z<0)throw new Error("positive integer expected, got "+Z)}function ot$1(Z,...t){if(!lo$1(Z))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(Z.length))throw new Error("Uint8Array expected of length "+t+", got length="+Z.length)}function ho$1(Z,t=!0){if(Z.destroyed)throw new Error("Hash instance has been destroyed");if(t&&Z.finished)throw new Error("Hash#digest() has already been called")}function Gc(Z,t){ot$1(Z);const Hs=t.outputLen;if(Z.length<Hs)throw new Error("digestInto() expects output buffer of length at least "+Hs)}function Pt$2(Z){return new Uint32Array(Z.buffer,Z.byteOffset,Math.floor(Z.byteLength/4))}function Qt$2(...Z){for(let t=0;t<Z.length;t++)Z[t].fill(0)}function zc(Z){return new DataView(Z.buffer,Z.byteOffset,Z.byteLength)}const Yc=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Wc(Z){if(typeof Z!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(Z))}function En$1(Z){if(typeof Z=="string")Z=Wc(Z);else if(lo$1(Z))Z=Bn$1(Z);else throw new Error("Uint8Array expected, got "+typeof Z);return Z}function Xc(Z,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(Z,t)}function Jc(Z,t){if(Z.length!==t.length)return!1;let Hs=0;for(let zs=0;zs<Z.length;zs++)Hs|=Z[zs]^t[zs];return Hs===0}const Qc=(Z,t)=>{function Hs(zs,...Ys){if(ot$1(zs),!Yc)throw new Error("Non little-endian hardware is not yet supported");if(Z.nonceLength!==void 0){const Au=Ys[0];if(!Au)throw new Error("nonce / iv required");Z.varSizeNonce?ot$1(Au):ot$1(Au,Z.nonceLength)}const Zs=Z.tagLength;Zs&&Ys[1]!==void 0&&ot$1(Ys[1]);const _u=t(zs,...Ys),Eu=(Au,$u)=>{if($u!==void 0){if(Au!==2)throw new Error("cipher output not supported");ot$1($u)}};let Iu=!1;return{encrypt(Au,$u){if(Iu)throw new Error("cannot encrypt() twice with same key + nonce");return Iu=!0,ot$1(Au),Eu(_u.encrypt.length,$u),_u.encrypt(Au,$u)},decrypt(Au,$u){if(ot$1(Au),Zs&&Au.length<Zs)throw new Error("invalid ciphertext length: smaller than tagLength="+Zs);return Eu(_u.decrypt.length,$u),_u.decrypt(Au,$u)}}}return Object.assign(Hs,Z),Hs};function po$1(Z,t,Hs=!0){if(t===void 0)return new Uint8Array(Z);if(t.length!==Z)throw new Error("invalid output length, expected "+Z+", got: "+t.length);if(Hs&&!ef(t))throw new Error("invalid output, must be aligned");return t}function go$1(Z,t,Hs,zs){if(typeof Z.setBigUint64=="function")return Z.setBigUint64(t,Hs,zs);const Ys=BigInt(32),Zs=BigInt(4294967295),_u=Number(Hs>>Ys&Zs),Eu=Number(Hs&Zs),Iu=zs?4:0,Au=zs?0:4;Z.setUint32(t+Iu,_u,zs),Z.setUint32(t+Au,Eu,zs)}function tf(Z,t,Hs){vn$1(Hs);const zs=new Uint8Array(16),Ys=zc(zs);return go$1(Ys,0,BigInt(t),Hs),go$1(Ys,8,BigInt(Z),Hs),zs}function ef(Z){return Z.byteOffset%4===0}function Bn$1(Z){return Uint8Array.from(Z)}const bo$1=Z=>Uint8Array.from(Z.split("").map(t=>t.charCodeAt(0))),nf=bo$1("expand 16-byte k"),rf=bo$1("expand 32-byte k"),of=Pt$2(nf),sf=Pt$2(rf);function K$1(Z,t){return Z<<t|Z>>>32-t}function An$1(Z){return Z.byteOffset%4===0}const Le$1=64,cf=16,yo$1=2**32-1,mo$1=new Uint32Array;function ff(Z,t,Hs,zs,Ys,Zs,_u,Eu){const Iu=Ys.length,Au=new Uint8Array(Le$1),$u=Pt$2(Au),vu=An$1(Ys)&&An$1(Zs),Su=vu?Pt$2(Ys):mo$1,Ru=vu?Pt$2(Zs):mo$1;for(let Pu=0;Pu<Iu;_u++){if(Z(t,Hs,zs,$u,_u,Eu),_u>=yo$1)throw new Error("arx: counter overflow");const Cu=Math.min(Le$1,Iu-Pu);if(vu&&Cu===Le$1){const Bu=Pu/4;if(Pu%4!==0)throw new Error("arx: invalid block position");for(let Fu=0,zu;Fu<cf;Fu++)zu=Bu+Fu,Ru[zu]=Su[zu]^$u[Fu];Pu+=Le$1;continue}for(let Bu=0,Fu;Bu<Cu;Bu++)Fu=Pu+Bu,Zs[Fu]=Ys[Fu]^Au[Bu];Pu+=Cu}}function af(Z,t){const{allowShortKeys:Hs,extendNonceFn:zs,counterLength:Ys,counterRight:Zs,rounds:_u}=Xc({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof Z!="function")throw new Error("core must be a function");return xn$1(Ys),xn$1(_u),vn$1(Zs),vn$1(Hs),(Eu,Iu,Au,$u,vu=0)=>{ot$1(Eu),ot$1(Iu),ot$1(Au);const Su=Au.length;if($u===void 0&&($u=new Uint8Array(Su)),ot$1($u),xn$1(vu),vu<0||vu>=yo$1)throw new Error("arx: counter overflow");if($u.length<Su)throw new Error(`arx: output (${$u.length}) is shorter than data (${Su})`);const Ru=[];let Pu=Eu.length,Cu,Bu;if(Pu===32)Ru.push(Cu=Bn$1(Eu)),Bu=sf;else if(Pu===16&&Hs)Cu=new Uint8Array(32),Cu.set(Eu),Cu.set(Eu,16),Bu=of,Ru.push(Cu);else throw new Error(`arx: invalid 32-byte key, got length=${Pu}`);An$1(Iu)||Ru.push(Iu=Bn$1(Iu));const Fu=Pt$2(Cu);if(zs){if(Iu.length!==24)throw new Error("arx: extended nonce must be 24 bytes");zs(Bu,Fu,Pt$2(Iu.subarray(0,16)),Fu),Iu=Iu.subarray(16)}const zu=16-Ys;if(zu!==Iu.length)throw new Error(`arx: nonce must be ${zu} or 16 bytes`);if(zu!==12){const Wu=new Uint8Array(12);Wu.set(Iu,Zs?0:12-Iu.length),Iu=Wu,Ru.push(Iu)}const Hu=Pt$2(Iu);return ff(Z,Bu,Fu,Hu,Au,$u,vu,_u),Qt$2(...Ru),$u}}const W$2=(Z,t)=>Z[t++]&255|(Z[t++]&255)<<8;class uf{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,t=En$1(t),ot$1(t,32);const Hs=W$2(t,0),zs=W$2(t,2),Ys=W$2(t,4),Zs=W$2(t,6),_u=W$2(t,8),Eu=W$2(t,10),Iu=W$2(t,12),Au=W$2(t,14);this.r[0]=Hs&8191,this.r[1]=(Hs>>>13|zs<<3)&8191,this.r[2]=(zs>>>10|Ys<<6)&7939,this.r[3]=(Ys>>>7|Zs<<9)&8191,this.r[4]=(Zs>>>4|_u<<12)&255,this.r[5]=_u>>>1&8190,this.r[6]=(_u>>>14|Eu<<2)&8191,this.r[7]=(Eu>>>11|Iu<<5)&8065,this.r[8]=(Iu>>>8|Au<<8)&8191,this.r[9]=Au>>>5&127;for(let $u=0;$u<8;$u++)this.pad[$u]=W$2(t,16+2*$u)}process(t,Hs,zs=!1){const Ys=zs?0:2048,{h:Zs,r:_u}=this,Eu=_u[0],Iu=_u[1],Au=_u[2],$u=_u[3],vu=_u[4],Su=_u[5],Ru=_u[6],Pu=_u[7],Cu=_u[8],Bu=_u[9],Fu=W$2(t,Hs+0),zu=W$2(t,Hs+2),Hu=W$2(t,Hs+4),Wu=W$2(t,Hs+6),tl=W$2(t,Hs+8),Xu=W$2(t,Hs+10),ju=W$2(t,Hs+12),ku=W$2(t,Hs+14);let Uu=Zs[0]+(Fu&8191),Gu=Zs[1]+((Fu>>>13|zu<<3)&8191),Yu=Zs[2]+((zu>>>10|Hu<<6)&8191),Qu=Zs[3]+((Hu>>>7|Wu<<9)&8191),Lu=Zs[4]+((Wu>>>4|tl<<12)&8191),cl=Zs[5]+(tl>>>1&8191),el=Zs[6]+((tl>>>14|Xu<<2)&8191),Zu=Zs[7]+((Xu>>>11|ju<<5)&8191),dl=Zs[8]+((ju>>>8|ku<<8)&8191),El=Zs[9]+(ku>>>5|Ys),hl=0,_l=hl+Uu*Eu+Gu*(5*Bu)+Yu*(5*Cu)+Qu*(5*Pu)+Lu*(5*Ru);hl=_l>>>13,_l&=8191,_l+=cl*(5*Su)+el*(5*vu)+Zu*(5*$u)+dl*(5*Au)+El*(5*Iu),hl+=_l>>>13,_l&=8191;let Rl=hl+Uu*Iu+Gu*Eu+Yu*(5*Bu)+Qu*(5*Cu)+Lu*(5*Pu);hl=Rl>>>13,Rl&=8191,Rl+=cl*(5*Ru)+el*(5*Su)+Zu*(5*vu)+dl*(5*$u)+El*(5*Au),hl+=Rl>>>13,Rl&=8191;let ol=hl+Uu*Au+Gu*Iu+Yu*Eu+Qu*(5*Bu)+Lu*(5*Cu);hl=ol>>>13,ol&=8191,ol+=cl*(5*Pu)+el*(5*Ru)+Zu*(5*Su)+dl*(5*vu)+El*(5*$u),hl+=ol>>>13,ol&=8191;let gl=hl+Uu*$u+Gu*Au+Yu*Iu+Qu*Eu+Lu*(5*Bu);hl=gl>>>13,gl&=8191,gl+=cl*(5*Cu)+el*(5*Pu)+Zu*(5*Ru)+dl*(5*Su)+El*(5*vu),hl+=gl>>>13,gl&=8191;let nl=hl+Uu*vu+Gu*$u+Yu*Au+Qu*Iu+Lu*Eu;hl=nl>>>13,nl&=8191,nl+=cl*(5*Bu)+el*(5*Cu)+Zu*(5*Pu)+dl*(5*Ru)+El*(5*Su),hl+=nl>>>13,nl&=8191;let Sl=hl+Uu*Su+Gu*vu+Yu*$u+Qu*Au+Lu*Iu;hl=Sl>>>13,Sl&=8191,Sl+=cl*Eu+el*(5*Bu)+Zu*(5*Cu)+dl*(5*Pu)+El*(5*Ru),hl+=Sl>>>13,Sl&=8191;let ll=hl+Uu*Ru+Gu*Su+Yu*vu+Qu*$u+Lu*Au;hl=ll>>>13,ll&=8191,ll+=cl*Iu+el*Eu+Zu*(5*Bu)+dl*(5*Cu)+El*(5*Pu),hl+=ll>>>13,ll&=8191;let ul=hl+Uu*Pu+Gu*Ru+Yu*Su+Qu*vu+Lu*$u;hl=ul>>>13,ul&=8191,ul+=cl*Au+el*Iu+Zu*Eu+dl*(5*Bu)+El*(5*Cu),hl+=ul>>>13,ul&=8191;let Al=hl+Uu*Cu+Gu*Pu+Yu*Ru+Qu*Su+Lu*vu;hl=Al>>>13,Al&=8191,Al+=cl*$u+el*Au+Zu*Iu+dl*Eu+El*(5*Bu),hl+=Al>>>13,Al&=8191;let Tl=hl+Uu*Bu+Gu*Cu+Yu*Pu+Qu*Ru+Lu*Su;hl=Tl>>>13,Tl&=8191,Tl+=cl*vu+el*$u+Zu*Au+dl*Iu+El*Eu,hl+=Tl>>>13,Tl&=8191,hl=(hl<<2)+hl|0,hl=hl+_l|0,_l=hl&8191,hl=hl>>>13,Rl+=hl,Zs[0]=_l,Zs[1]=Rl,Zs[2]=ol,Zs[3]=gl,Zs[4]=nl,Zs[5]=Sl,Zs[6]=ll,Zs[7]=ul,Zs[8]=Al,Zs[9]=Tl}finalize(){const{h:t,pad:Hs}=this,zs=new Uint16Array(10);let Ys=t[1]>>>13;t[1]&=8191;for(let Eu=2;Eu<10;Eu++)t[Eu]+=Ys,Ys=t[Eu]>>>13,t[Eu]&=8191;t[0]+=Ys*5,Ys=t[0]>>>13,t[0]&=8191,t[1]+=Ys,Ys=t[1]>>>13,t[1]&=8191,t[2]+=Ys,zs[0]=t[0]+5,Ys=zs[0]>>>13,zs[0]&=8191;for(let Eu=1;Eu<10;Eu++)zs[Eu]=t[Eu]+Ys,Ys=zs[Eu]>>>13,zs[Eu]&=8191;zs[9]-=8192;let Zs=(Ys^1)-1;for(let Eu=0;Eu<10;Eu++)zs[Eu]&=Zs;Zs=~Zs;for(let Eu=0;Eu<10;Eu++)t[Eu]=t[Eu]&Zs|zs[Eu];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let _u=t[0]+Hs[0];t[0]=_u&65535;for(let Eu=1;Eu<8;Eu++)_u=(t[Eu]+Hs[Eu]|0)+(_u>>>16)|0,t[Eu]=_u&65535;Qt$2(zs)}update(t){ho$1(this),t=En$1(t),ot$1(t);const{buffer:Hs,blockLen:zs}=this,Ys=t.length;for(let Zs=0;Zs<Ys;){const _u=Math.min(zs-this.pos,Ys-Zs);if(_u===zs){for(;zs<=Ys-Zs;Zs+=zs)this.process(t,Zs);continue}Hs.set(t.subarray(Zs,Zs+_u),this.pos),this.pos+=_u,Zs+=_u,this.pos===zs&&(this.process(Hs,0,!1),this.pos=0)}return this}destroy(){Qt$2(this.h,this.r,this.buffer,this.pad)}digestInto(t){ho$1(this),Gc(t,this),this.finished=!0;const{buffer:Hs,h:zs}=this;let{pos:Ys}=this;if(Ys){for(Hs[Ys++]=1;Ys<16;Ys++)Hs[Ys]=0;this.process(Hs,0,!0)}this.finalize();let Zs=0;for(let _u=0;_u<8;_u++)t[Zs++]=zs[_u]>>>0,t[Zs++]=zs[_u]>>>8;return t}digest(){const{buffer:t,outputLen:Hs}=this;this.digestInto(t);const zs=t.slice(0,Hs);return this.destroy(),zs}}function lf(Z){const t=(zs,Ys)=>Z(Ys).update(En$1(zs)).digest(),Hs=Z(new Uint8Array(32));return t.outputLen=Hs.outputLen,t.blockLen=Hs.blockLen,t.create=zs=>Z(zs),t}const df=lf(Z=>new uf(Z));function hf(Z,t,Hs,zs,Ys,Zs=20){let _u=Z[0],Eu=Z[1],Iu=Z[2],Au=Z[3],$u=t[0],vu=t[1],Su=t[2],Ru=t[3],Pu=t[4],Cu=t[5],Bu=t[6],Fu=t[7],zu=Ys,Hu=Hs[0],Wu=Hs[1],tl=Hs[2],Xu=_u,ju=Eu,ku=Iu,Uu=Au,Gu=$u,Yu=vu,Qu=Su,Lu=Ru,cl=Pu,el=Cu,Zu=Bu,dl=Fu,El=zu,hl=Hu,_l=Wu,Rl=tl;for(let gl=0;gl<Zs;gl+=2)Xu=Xu+Gu|0,El=K$1(El^Xu,16),cl=cl+El|0,Gu=K$1(Gu^cl,12),Xu=Xu+Gu|0,El=K$1(El^Xu,8),cl=cl+El|0,Gu=K$1(Gu^cl,7),ju=ju+Yu|0,hl=K$1(hl^ju,16),el=el+hl|0,Yu=K$1(Yu^el,12),ju=ju+Yu|0,hl=K$1(hl^ju,8),el=el+hl|0,Yu=K$1(Yu^el,7),ku=ku+Qu|0,_l=K$1(_l^ku,16),Zu=Zu+_l|0,Qu=K$1(Qu^Zu,12),ku=ku+Qu|0,_l=K$1(_l^ku,8),Zu=Zu+_l|0,Qu=K$1(Qu^Zu,7),Uu=Uu+Lu|0,Rl=K$1(Rl^Uu,16),dl=dl+Rl|0,Lu=K$1(Lu^dl,12),Uu=Uu+Lu|0,Rl=K$1(Rl^Uu,8),dl=dl+Rl|0,Lu=K$1(Lu^dl,7),Xu=Xu+Yu|0,Rl=K$1(Rl^Xu,16),Zu=Zu+Rl|0,Yu=K$1(Yu^Zu,12),Xu=Xu+Yu|0,Rl=K$1(Rl^Xu,8),Zu=Zu+Rl|0,Yu=K$1(Yu^Zu,7),ju=ju+Qu|0,El=K$1(El^ju,16),dl=dl+El|0,Qu=K$1(Qu^dl,12),ju=ju+Qu|0,El=K$1(El^ju,8),dl=dl+El|0,Qu=K$1(Qu^dl,7),ku=ku+Lu|0,hl=K$1(hl^ku,16),cl=cl+hl|0,Lu=K$1(Lu^cl,12),ku=ku+Lu|0,hl=K$1(hl^ku,8),cl=cl+hl|0,Lu=K$1(Lu^cl,7),Uu=Uu+Gu|0,_l=K$1(_l^Uu,16),el=el+_l|0,Gu=K$1(Gu^el,12),Uu=Uu+Gu|0,_l=K$1(_l^Uu,8),el=el+_l|0,Gu=K$1(Gu^el,7);let ol=0;zs[ol++]=_u+Xu|0,zs[ol++]=Eu+ju|0,zs[ol++]=Iu+ku|0,zs[ol++]=Au+Uu|0,zs[ol++]=$u+Gu|0,zs[ol++]=vu+Yu|0,zs[ol++]=Su+Qu|0,zs[ol++]=Ru+Lu|0,zs[ol++]=Pu+cl|0,zs[ol++]=Cu+el|0,zs[ol++]=Bu+Zu|0,zs[ol++]=Fu+dl|0,zs[ol++]=zu+El|0,zs[ol++]=Hu+hl|0,zs[ol++]=Wu+_l|0,zs[ol++]=tl+Rl|0}const pf=af(hf,{counterRight:!1,counterLength:4,allowShortKeys:!1}),gf=new Uint8Array(16),wo$1=(Z,t)=>{Z.update(t);const Hs=t.length%16;Hs&&Z.update(gf.subarray(Hs))},bf=new Uint8Array(32);function vo$1(Z,t,Hs,zs,Ys){const Zs=Z(t,Hs,bf),_u=df.create(Zs);Ys&&wo$1(_u,Ys),wo$1(_u,zs);const Eu=tf(zs.length,Ys?Ys.length:0,!0);_u.update(Eu);const Iu=_u.digest();return Qt$2(Zs,Eu),Iu}const yf=Z=>(t,Hs,zs)=>({encrypt(Ys,Zs){const _u=Ys.length;Zs=po$1(_u+16,Zs,!1),Zs.set(Ys);const Eu=Zs.subarray(0,-16);Z(t,Hs,Eu,Eu,1);const Iu=vo$1(Z,t,Hs,Eu,zs);return Zs.set(Iu,_u),Qt$2(Iu),Zs},decrypt(Ys,Zs){Zs=po$1(Ys.length-16,Zs,!1);const _u=Ys.subarray(0,-16),Eu=Ys.subarray(-16),Iu=vo$1(Z,t,Hs,_u,zs);if(!Jc(Eu,Iu))throw new Error("invalid tag");return Zs.set(Ys.subarray(0,-16)),Z(t,Hs,Zs,Zs,1),Qt$2(Iu),Zs}}),xo$1=Qc({blockSize:64,nonceLength:12,tagLength:16},yf(pf));let Eo$1=class extends Re{constructor(t,Hs){super(),this.finished=!1,this.destroyed=!1,Ue$1(t);const zs=pt$1(Hs);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const Ys=this.blockLen,Zs=new Uint8Array(Ys);Zs.set(zs.length>Ys?t.create().update(zs).digest():zs);for(let _u=0;_u<Zs.length;_u++)Zs[_u]^=54;this.iHash.update(Zs),this.oHash=t.create();for(let _u=0;_u<Zs.length;_u++)Zs[_u]^=106;this.oHash.update(Zs),lt(Zs)}update(t){return Nt$1(this),this.iHash.update(t),this}digestInto(t){Nt$1(this),ht(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:Hs,iHash:zs,finished:Ys,destroyed:Zs,blockLen:_u,outputLen:Eu}=this;return t=t,t.finished=Ys,t.destroyed=Zs,t.blockLen=_u,t.outputLen=Eu,t.oHash=Hs._cloneInto(t.oHash),t.iHash=zs._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const ke$1=(Z,t,Hs)=>new Eo$1(Z,t).update(Hs).digest();ke$1.create=(Z,t)=>new Eo$1(Z,t);function mf(Z,t,Hs){return Ue$1(Z),Hs===void 0&&(Hs=new Uint8Array(Z.outputLen)),ke$1(Z,pt$1(Hs),pt$1(t))}const In$1=Uint8Array.from([0]),Bo$1=Uint8Array.of();function wf(Z,t,Hs,zs=32){Ue$1(Z),mt$2(zs);const Ys=Z.outputLen;if(zs>255*Ys)throw new Error("Length should be <= 255*HashLen");const Zs=Math.ceil(zs/Ys);Hs===void 0&&(Hs=Bo$1);const _u=new Uint8Array(Zs*Ys),Eu=ke$1.create(Z,t),Iu=Eu._cloneInto(),Au=new Uint8Array(Eu.outputLen);for(let $u=0;$u<Zs;$u++)In$1[0]=$u+1,Iu.update($u===0?Bo$1:Au).update(Hs).update(In$1).digestInto(Au),_u.set(Au,Ys*$u),Eu._cloneInto(Iu);return Eu.destroy(),Iu.destroy(),lt(Au,In$1),_u.slice(0,zs)}const vf=(Z,t,Hs,zs,Ys)=>wf(Z,mf(Z,t,Hs),zs,Ys),Pe$1=$e$1,Sn$1=BigInt(0),On$1=BigInt(1);function He$1(Z,t=""){if(typeof Z!="boolean"){const Hs=t&&`"${t}"`;throw new Error(Hs+"expected boolean, got type="+typeof Z)}return Z}function Kt$1(Z,t,Hs=""){const zs=Ne(Z),Ys=Z==null?void 0:Z.length,Zs=t!==void 0;if(!zs||Zs&&Ys!==t){const _u=Hs&&`"${Hs}" `,Eu=Zs?` of length ${t}`:"",Iu=zs?`length=${Ys}`:`type=${typeof Z}`;throw new Error(_u+"expected Uint8Array"+Eu+", got "+Iu)}return Z}function De$2(Z){const t=Z.toString(16);return t.length&1?"0"+t:t}function Ao$1(Z){if(typeof Z!="string")throw new Error("hex string expected, got "+typeof Z);return Z===""?Sn$1:BigInt("0x"+Z)}function Ve$2(Z){return Ao$1(Jt$2(Z))}function Me$2(Z){return ht(Z),Ao$1(Jt$2(Uint8Array.from(Z).reverse()))}function Nn$1(Z,t){return _e$2(Z.toString(16).padStart(t*2,"0"))}function Un$1(Z,t){return Nn$1(Z,t).reverse()}function tt$2(Z,t,Hs){let zs;if(typeof t=="string")try{zs=_e$2(t)}catch(Zs){throw new Error(Z+" must be hex string or Uint8Array, cause: "+Zs)}else if(Ne(t))zs=Uint8Array.from(t);else throw new Error(Z+" must be hex string or Uint8Array");const Ys=zs.length;if(typeof Hs=="number"&&Ys!==Hs)throw new Error(Z+" of length "+Hs+" expected, got "+Ys);return zs}const _n$2=Z=>typeof Z=="bigint"&&Sn$1<=Z;function xf(Z,t,Hs){return _n$2(Z)&&_n$2(t)&&_n$2(Hs)&&t<=Z&&Z<Hs}function Rn$1(Z,t,Hs,zs){if(!xf(t,Hs,zs))throw new Error("expected valid "+Z+": "+Hs+" <= n < "+zs+", got "+t)}function Io$1(Z){let t;for(t=0;Z>Sn$1;Z>>=On$1,t+=1);return t}const ye$1=Z=>(On$1<<BigInt(Z))-On$1;function Ef(Z,t,Hs){if(typeof Z!="number"||Z<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof Hs!="function")throw new Error("hmacFn must be a function");const zs=Su=>new Uint8Array(Su),Ys=Su=>Uint8Array.of(Su);let Zs=zs(Z),_u=zs(Z),Eu=0;const Iu=()=>{Zs.fill(1),_u.fill(0),Eu=0},Au=(...Su)=>Hs(_u,Zs,...Su),$u=(Su=zs(0))=>{_u=Au(Ys(0),Su),Zs=Au(),Su.length!==0&&(_u=Au(Ys(1),Su),Zs=Au())},vu=()=>{if(Eu++>=1e3)throw new Error("drbg: tried 1000 values");let Su=0;const Ru=[];for(;Su<t;){Zs=Au();const Pu=Zs.slice();Ru.push(Pu),Su+=Zs.length}return _t$2(...Ru)};return(Su,Ru)=>{Iu(),$u(Su);let Pu;for(;!(Pu=Ru(vu()));)$u();return Iu(),Pu}}function Ke$2(Z,t,Hs={}){if(!Z||typeof Z!="object")throw new Error("expected valid options object");function zs(Ys,Zs,_u){const Eu=Z[Ys];if(_u&&Eu===void 0)return;const Iu=typeof Eu;if(Iu!==Zs||Eu===null)throw new Error(`param "${Ys}" is invalid: expected ${Zs}, got ${Iu}`)}Object.entries(t).forEach(([Ys,Zs])=>zs(Ys,Zs,!1)),Object.entries(Hs).forEach(([Ys,Zs])=>zs(Ys,Zs,!0))}function So$1(Z){const t=new WeakMap;return(Hs,...zs)=>{const Ys=t.get(Hs);if(Ys!==void 0)return Ys;const Zs=Z(Hs,...zs);return t.set(Hs,Zs),Zs}}const st$1=BigInt(0),nt$1=BigInt(1),qt$1=BigInt(2),Oo$1=BigInt(3),No$1=BigInt(4),Uo$1=BigInt(5),Bf=BigInt(7),_o$1=BigInt(8),Af=BigInt(9),Ro$1=BigInt(16);function ct$1(Z,t){const Hs=Z%t;return Hs>=st$1?Hs:t+Hs}function gt$2(Z,t,Hs){let zs=Z;for(;t-- >st$1;)zs*=zs,zs%=Hs;return zs}function $o$1(Z,t){if(Z===st$1)throw new Error("invert: expected non-zero number");if(t<=st$1)throw new Error("invert: expected positive modulus, got "+t);let Hs=ct$1(Z,t),zs=t,Ys=st$1,Zs=nt$1;for(;Hs!==st$1;){const _u=zs/Hs,Eu=zs%Hs,Iu=Ys-Zs*_u;zs=Hs,Hs=Eu,Ys=Zs,Zs=Iu}if(zs!==nt$1)throw new Error("invert: does not exist");return ct$1(Ys,t)}function $n$1(Z,t,Hs){if(!Z.eql(Z.sqr(t),Hs))throw new Error("Cannot find square root")}function To$1(Z,t){const Hs=(Z.ORDER+nt$1)/No$1,zs=Z.pow(t,Hs);return $n$1(Z,zs,t),zs}function If(Z,t){const Hs=(Z.ORDER-Uo$1)/_o$1,zs=Z.mul(t,qt$1),Ys=Z.pow(zs,Hs),Zs=Z.mul(t,Ys),_u=Z.mul(Z.mul(Zs,qt$1),Ys),Eu=Z.mul(Zs,Z.sub(_u,Z.ONE));return $n$1(Z,Eu,t),Eu}function Sf(Z){const t=Ht$3(Z),Hs=Co$1(Z),zs=Hs(t,t.neg(t.ONE)),Ys=Hs(t,zs),Zs=Hs(t,t.neg(zs)),_u=(Z+Bf)/Ro$1;return(Eu,Iu)=>{let Au=Eu.pow(Iu,_u),$u=Eu.mul(Au,zs);const vu=Eu.mul(Au,Ys),Su=Eu.mul(Au,Zs),Ru=Eu.eql(Eu.sqr($u),Iu),Pu=Eu.eql(Eu.sqr(vu),Iu);Au=Eu.cmov(Au,$u,Ru),$u=Eu.cmov(Su,vu,Pu);const Cu=Eu.eql(Eu.sqr($u),Iu),Bu=Eu.cmov(Au,$u,Cu);return $n$1(Eu,Bu,Iu),Bu}}function Co$1(Z){if(Z<Oo$1)throw new Error("sqrt is not defined for small field");let t=Z-nt$1,Hs=0;for(;t%qt$1===st$1;)t/=qt$1,Hs++;let zs=qt$1;const Ys=Ht$3(Z);for(;Lo$1(Ys,zs)===1;)if(zs++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(Hs===1)return To$1;let Zs=Ys.pow(zs,t);const _u=(t+nt$1)/qt$1;return function(Eu,Iu){if(Eu.is0(Iu))return Iu;if(Lo$1(Eu,Iu)!==1)throw new Error("Cannot find square root");let Au=Hs,$u=Eu.mul(Eu.ONE,Zs),vu=Eu.pow(Iu,t),Su=Eu.pow(Iu,_u);for(;!Eu.eql(vu,Eu.ONE);){if(Eu.is0(vu))return Eu.ZERO;let Ru=1,Pu=Eu.sqr(vu);for(;!Eu.eql(Pu,Eu.ONE);)if(Ru++,Pu=Eu.sqr(Pu),Ru===Au)throw new Error("Cannot find square root");const Cu=nt$1<<BigInt(Au-Ru-1),Bu=Eu.pow($u,Cu);Au=Ru,$u=Eu.sqr(Bu),vu=Eu.mul(vu,$u),Su=Eu.mul(Su,Bu)}return Su}}function Of(Z){return Z%No$1===Oo$1?To$1:Z%_o$1===Uo$1?If:Z%Ro$1===Af?Sf(Z):Co$1(Z)}const Nf=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Uf(Z){const t={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},Hs=Nf.reduce((zs,Ys)=>(zs[Ys]="function",zs),t);return Ke$2(Z,Hs),Z}function _f(Z,t,Hs){if(Hs<st$1)throw new Error("invalid exponent, negatives unsupported");if(Hs===st$1)return Z.ONE;if(Hs===nt$1)return t;let zs=Z.ONE,Ys=t;for(;Hs>st$1;)Hs&nt$1&&(zs=Z.mul(zs,Ys)),Ys=Z.sqr(Ys),Hs>>=nt$1;return zs}function jo$1(Z,t,Hs=!1){const zs=new Array(t.length).fill(Hs?Z.ZERO:void 0),Ys=t.reduce((_u,Eu,Iu)=>Z.is0(Eu)?_u:(zs[Iu]=_u,Z.mul(_u,Eu)),Z.ONE),Zs=Z.inv(Ys);return t.reduceRight((_u,Eu,Iu)=>Z.is0(Eu)?_u:(zs[Iu]=Z.mul(_u,zs[Iu]),Z.mul(_u,Eu)),Zs),zs}function Lo$1(Z,t){const Hs=(Z.ORDER-nt$1)/qt$1,zs=Z.pow(t,Hs),Ys=Z.eql(zs,Z.ONE),Zs=Z.eql(zs,Z.ZERO),_u=Z.eql(zs,Z.neg(Z.ONE));if(!Ys&&!Zs&&!_u)throw new Error("invalid Legendre symbol result");return Ys?1:Zs?0:-1}function ko$1(Z,t){t!==void 0&&mt$2(t);const Hs=t!==void 0?t:Z.toString(2).length,zs=Math.ceil(Hs/8);return{nBitLength:Hs,nByteLength:zs}}function Ht$3(Z,t,Hs=!1,zs={}){if(Z<=st$1)throw new Error("invalid field: expected ORDER > 0, got "+Z);let Ys,Zs,_u=!1,Eu;if(typeof t=="object"&&t!=null){if(zs.sqrt||Hs)throw new Error("cannot specify opts in two arguments");const Su=t;Su.BITS&&(Ys=Su.BITS),Su.sqrt&&(Zs=Su.sqrt),typeof Su.isLE=="boolean"&&(Hs=Su.isLE),typeof Su.modFromBytes=="boolean"&&(_u=Su.modFromBytes),Eu=Su.allowedLengths}else typeof t=="number"&&(Ys=t),zs.sqrt&&(Zs=zs.sqrt);const{nBitLength:Iu,nByteLength:Au}=ko$1(Z,Ys);if(Au>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let $u;const vu=Object.freeze({ORDER:Z,isLE:Hs,BITS:Iu,BYTES:Au,MASK:ye$1(Iu),ZERO:st$1,ONE:nt$1,allowedLengths:Eu,create:Su=>ct$1(Su,Z),isValid:Su=>{if(typeof Su!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof Su);return st$1<=Su&&Su<Z},is0:Su=>Su===st$1,isValidNot0:Su=>!vu.is0(Su)&&vu.isValid(Su),isOdd:Su=>(Su&nt$1)===nt$1,neg:Su=>ct$1(-Su,Z),eql:(Su,Ru)=>Su===Ru,sqr:Su=>ct$1(Su*Su,Z),add:(Su,Ru)=>ct$1(Su+Ru,Z),sub:(Su,Ru)=>ct$1(Su-Ru,Z),mul:(Su,Ru)=>ct$1(Su*Ru,Z),pow:(Su,Ru)=>_f(vu,Su,Ru),div:(Su,Ru)=>ct$1(Su*$o$1(Ru,Z),Z),sqrN:Su=>Su*Su,addN:(Su,Ru)=>Su+Ru,subN:(Su,Ru)=>Su-Ru,mulN:(Su,Ru)=>Su*Ru,inv:Su=>$o$1(Su,Z),sqrt:Zs||(Su=>($u||($u=Of(Z)),$u(vu,Su))),toBytes:Su=>Hs?Un$1(Su,Au):Nn$1(Su,Au),fromBytes:(Su,Ru=!0)=>{if(Eu){if(!Eu.includes(Su.length)||Su.length>Au)throw new Error("Field.fromBytes: expected "+Eu+" bytes, got "+Su.length);const Cu=new Uint8Array(Au);Cu.set(Su,Hs?0:Cu.length-Su.length),Su=Cu}if(Su.length!==Au)throw new Error("Field.fromBytes: expected "+Au+" bytes, got "+Su.length);let Pu=Hs?Me$2(Su):Ve$2(Su);if(_u&&(Pu=ct$1(Pu,Z)),!Ru&&!vu.isValid(Pu))throw new Error("invalid field element: outside of range 0..ORDER");return Pu},invertBatch:Su=>jo$1(vu,Su),cmov:(Su,Ru,Pu)=>Pu?Ru:Su});return Object.freeze(vu)}function Po$1(Z){if(typeof Z!="bigint")throw new Error("field order must be bigint");const t=Z.toString(2).length;return Math.ceil(t/8)}function Ho$1(Z){const t=Po$1(Z);return t+Math.ceil(t/2)}function Rf(Z,t,Hs=!1){const zs=Z.length,Ys=Po$1(t),Zs=Ho$1(t);if(zs<16||zs<Zs||zs>1024)throw new Error("expected "+Zs+"-1024 bytes of input, got "+zs);const _u=Hs?Me$2(Z):Ve$2(Z),Eu=ct$1(_u,t-nt$1)+nt$1;return Hs?Un$1(Eu,Ys):Nn$1(Eu,Ys)}const te=BigInt(0),Ft$1=BigInt(1);function qe$1(Z,t){const Hs=t.negate();return Z?Hs:t}function Tn$1(Z,t){const Hs=jo$1(Z.Fp,t.map(zs=>zs.Z));return t.map((zs,Ys)=>Z.fromAffine(zs.toAffine(Hs[Ys])))}function Do$1(Z,t){if(!Number.isSafeInteger(Z)||Z<=0||Z>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+Z)}function Cn$1(Z,t){Do$1(Z,t);const Hs=Math.ceil(t/Z)+1,zs=2**(Z-1),Ys=2**Z,Zs=ye$1(Z),_u=BigInt(Z);return{windows:Hs,windowSize:zs,mask:Zs,maxNumber:Ys,shiftBy:_u}}function Vo$1(Z,t,Hs){const{windowSize:zs,mask:Ys,maxNumber:Zs,shiftBy:_u}=Hs;let Eu=Number(Z&Ys),Iu=Z>>_u;Eu>zs&&(Eu-=Zs,Iu+=Ft$1);const Au=t*zs,$u=Au+Math.abs(Eu)-1,vu=Eu===0,Su=Eu<0,Ru=t%2!==0;return{nextN:Iu,offset:$u,isZero:vu,isNeg:Su,isNegF:Ru,offsetF:Au}}function $f(Z,t){if(!Array.isArray(Z))throw new Error("array expected");Z.forEach((Hs,zs)=>{if(!(Hs instanceof t))throw new Error("invalid point at index "+zs)})}function Tf(Z,t){if(!Array.isArray(Z))throw new Error("array of scalars expected");Z.forEach((Hs,zs)=>{if(!t.isValid(Hs))throw new Error("invalid scalar at index "+zs)})}const jn$1=new WeakMap,Mo$1=new WeakMap;function Ln$1(Z){return Mo$1.get(Z)||1}function Ko$1(Z){if(Z!==te)throw new Error("invalid wNAF")}class Cf{constructor(t,Hs){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=Hs}_unsafeLadder(t,Hs,zs=this.ZERO){let Ys=t;for(;Hs>te;)Hs&Ft$1&&(zs=zs.add(Ys)),Ys=Ys.double(),Hs>>=Ft$1;return zs}precomputeWindow(t,Hs){const{windows:zs,windowSize:Ys}=Cn$1(Hs,this.bits),Zs=[];let _u=t,Eu=_u;for(let Iu=0;Iu<zs;Iu++){Eu=_u,Zs.push(Eu);for(let Au=1;Au<Ys;Au++)Eu=Eu.add(_u),Zs.push(Eu);_u=Eu.double()}return Zs}wNAF(t,Hs,zs){if(!this.Fn.isValid(zs))throw new Error("invalid scalar");let Ys=this.ZERO,Zs=this.BASE;const _u=Cn$1(t,this.bits);for(let Eu=0;Eu<_u.windows;Eu++){const{nextN:Iu,offset:Au,isZero:$u,isNeg:vu,isNegF:Su,offsetF:Ru}=Vo$1(zs,Eu,_u);zs=Iu,$u?Zs=Zs.add(qe$1(Su,Hs[Ru])):Ys=Ys.add(qe$1(vu,Hs[Au]))}return Ko$1(zs),{p:Ys,f:Zs}}wNAFUnsafe(t,Hs,zs,Ys=this.ZERO){const Zs=Cn$1(t,this.bits);for(let _u=0;_u<Zs.windows&&zs!==te;_u++){const{nextN:Eu,offset:Iu,isZero:Au,isNeg:$u}=Vo$1(zs,_u,Zs);if(zs=Eu,!Au){const vu=Hs[Iu];Ys=Ys.add($u?vu.negate():vu)}}return Ko$1(zs),Ys}getPrecomputes(t,Hs,zs){let Ys=jn$1.get(Hs);return Ys||(Ys=this.precomputeWindow(Hs,t),t!==1&&(typeof zs=="function"&&(Ys=zs(Ys)),jn$1.set(Hs,Ys))),Ys}cached(t,Hs,zs){const Ys=Ln$1(t);return this.wNAF(Ys,this.getPrecomputes(Ys,t,zs),Hs)}unsafe(t,Hs,zs,Ys){const Zs=Ln$1(t);return Zs===1?this._unsafeLadder(t,Hs,Ys):this.wNAFUnsafe(Zs,this.getPrecomputes(Zs,t,zs),Hs,Ys)}createCache(t,Hs){Do$1(Hs,this.bits),Mo$1.set(t,Hs),jn$1.delete(t)}hasCache(t){return Ln$1(t)!==1}}function jf(Z,t,Hs,zs){let Ys=t,Zs=Z.ZERO,_u=Z.ZERO;for(;Hs>te||zs>te;)Hs&Ft$1&&(Zs=Zs.add(Ys)),zs&Ft$1&&(_u=_u.add(Ys)),Ys=Ys.double(),Hs>>=Ft$1,zs>>=Ft$1;return{p1:Zs,p2:_u}}function Lf(Z,t,Hs,zs){$f(Hs,Z),Tf(zs,t);const Ys=Hs.length,Zs=zs.length;if(Ys!==Zs)throw new Error("arrays of points and scalars must have equal length");const _u=Z.ZERO,Eu=Io$1(BigInt(Ys));let Iu=1;Eu>12?Iu=Eu-3:Eu>4?Iu=Eu-2:Eu>0&&(Iu=2);const Au=ye$1(Iu),$u=new Array(Number(Au)+1).fill(_u),vu=Math.floor((t.BITS-1)/Iu)*Iu;let Su=_u;for(let Ru=vu;Ru>=0;Ru-=Iu){$u.fill(_u);for(let Cu=0;Cu<Zs;Cu++){const Bu=zs[Cu],Fu=Number(Bu>>BigInt(Ru)&Au);$u[Fu]=$u[Fu].add(Hs[Cu])}let Pu=_u;for(let Cu=$u.length-1,Bu=_u;Cu>0;Cu--)Bu=Bu.add($u[Cu]),Pu=Pu.add(Bu);if(Su=Su.add(Pu),Ru!==0)for(let Cu=0;Cu<Iu;Cu++)Su=Su.double()}return Su}function qo$1(Z,t,Hs){if(t){if(t.ORDER!==Z)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Uf(t),t}else return Ht$3(Z,{isLE:Hs})}function kf(Z,t,Hs={},zs){if(zs===void 0&&(zs=Z==="edwards"),!t||typeof t!="object")throw new Error(`expected valid ${Z} CURVE object`);for(const Eu of["p","n","h"]){const Iu=t[Eu];if(!(typeof Iu=="bigint"&&Iu>te))throw new Error(`CURVE.${Eu} must be positive bigint`)}const Ys=qo$1(t.p,Hs.Fp,zs),Zs=qo$1(t.n,Hs.Fn,zs),_u=["Gx","Gy","a",Z==="weierstrass"?"b":"d"];for(const Eu of _u)if(!Ys.isValid(t[Eu]))throw new Error(`CURVE.${Eu} must be valid field element of CURVE.Fp`);return t=Object.freeze(Object.assign({},t)),{CURVE:t,Fp:Ys,Fn:Zs}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),kr$1("HashToScalar-");const me$2=BigInt(0),ee$1=BigInt(1),Fe$1=BigInt(2);function Pf(Z){return Ke$2(Z,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...Z})}function Hf(Z){const t=Pf(Z),{P:Hs,type:zs,adjustScalarBytes:Ys,powPminus2:Zs,randomBytes:_u}=t,Eu=zs==="x25519";if(!Eu&&zs!=="x448")throw new Error("invalid type");const Iu=_u||Mt$1,Au=Eu?255:448,$u=Eu?32:56,vu=BigInt(Eu?9:5),Su=BigInt(Eu?121665:39081),Ru=Eu?Fe$1**BigInt(254):Fe$1**BigInt(447),Pu=Eu?BigInt(8)*Fe$1**BigInt(251)-ee$1:BigInt(4)*Fe$1**BigInt(445)-ee$1,Cu=Ru+Pu+ee$1,Bu=Qu=>ct$1(Qu,Hs),Fu=zu(vu);function zu(Qu){return Un$1(Bu(Qu),$u)}function Hu(Qu){const Lu=tt$2("u coordinate",Qu,$u);return Eu&&(Lu[31]&=127),Bu(Me$2(Lu))}function Wu(Qu){return Me$2(Ys(tt$2("scalar",Qu,$u)))}function tl(Qu,Lu){const cl=ku(Hu(Lu),Wu(Qu));if(cl===me$2)throw new Error("invalid private or public key received");return zu(cl)}function Xu(Qu){return tl(Qu,Fu)}function ju(Qu,Lu,cl){const el=Bu(Qu*(Lu-cl));return Lu=Bu(Lu-el),cl=Bu(cl+el),{x_2:Lu,x_3:cl}}function ku(Qu,Lu){Rn$1("u",Qu,me$2,Hs),Rn$1("scalar",Lu,Ru,Cu);const cl=Lu,el=Qu;let Zu=ee$1,dl=me$2,El=Qu,hl=ee$1,_l=me$2;for(let ol=BigInt(Au-1);ol>=me$2;ol--){const gl=cl>>ol&ee$1;_l^=gl,{x_2:Zu,x_3:El}=ju(_l,Zu,El),{x_2:dl,x_3:hl}=ju(_l,dl,hl),_l=gl;const nl=Zu+dl,Sl=Bu(nl*nl),ll=Zu-dl,ul=Bu(ll*ll),Al=Sl-ul,Tl=El+hl,qu=El-hl,Ou=Bu(qu*nl),Vu=Bu(Tl*ll),il=Ou+Vu,sl=Ou-Vu;El=Bu(il*il),hl=Bu(el*Bu(sl*sl)),Zu=Bu(Sl*ul),dl=Bu(Al*(Sl+Bu(Su*Al)))}({x_2:Zu,x_3:El}=ju(_l,Zu,El)),{x_2:dl,x_3:hl}=ju(_l,dl,hl);const Rl=Zs(dl);return Bu(Zu*Rl)}const Uu={secretKey:$u,publicKey:$u,seed:$u},Gu=(Qu=Iu($u))=>(ht(Qu,Uu.seed),Qu);function Yu(Qu){const Lu=Gu(Qu);return{secretKey:Lu,publicKey:Xu(Lu)}}return{keygen:Yu,getSharedSecret:(Qu,Lu)=>tl(Qu,Lu),getPublicKey:Qu=>Xu(Qu),scalarMult:tl,scalarMultBase:Xu,utils:{randomSecretKey:Gu,randomPrivateKey:Gu},GuBytes:Fu.slice(),lengths:Uu}}const Df=BigInt(1),Fo$1=BigInt(2),Vf=BigInt(3),Mf=BigInt(5),Kf=BigInt(8),Zo$1=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),qf={p:Zo$1,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:Kf,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function Ff(Z){const t=BigInt(10),Hs=BigInt(20),zs=BigInt(40),Ys=BigInt(80),Zs=Zo$1,_u=Z*Z%Zs*Z%Zs,Eu=gt$2(_u,Fo$1,Zs)*_u%Zs,Iu=gt$2(Eu,Df,Zs)*Z%Zs,Au=gt$2(Iu,Mf,Zs)*Iu%Zs,$u=gt$2(Au,t,Zs)*Au%Zs,vu=gt$2($u,Hs,Zs)*$u%Zs,Su=gt$2(vu,zs,Zs)*vu%Zs,Ru=gt$2(Su,Ys,Zs)*Su%Zs,Pu=gt$2(Ru,Ys,Zs)*Su%Zs,Cu=gt$2(Pu,t,Zs)*Au%Zs;return{pow_p_5_8:gt$2(Cu,Fo$1,Zs)*Z%Zs,b2:_u}}function Zf(Z){return Z[0]&=248,Z[31]&=127,Z[31]|=64,Z}const Gf=Ht$3(qf.p,{isLE:!0}),kn$1=(()=>{const Z=Gf.ORDER;return Hf({P:Z,type:"x25519",powPminus2:t=>{const{pow_p_5_8:Hs,b2:zs}=Ff(t);return ct$1(gt$2(Hs,Vf,Z)*zs,Z)},adjustScalarBytes:Zf})})(),Go$1=(Z,t)=>(Z+(Z>=0?t:-t)/zo$1)/t;function zf(Z,t,Hs){const[[zs,Ys],[Zs,_u]]=t,Eu=Go$1(_u*Z,Hs),Iu=Go$1(-Ys*Z,Hs);let Au=Z-Eu*zs-Iu*Zs,$u=-Eu*Ys-Iu*_u;const vu=Au<Et$3,Su=$u<Et$3;vu&&(Au=-Au),Su&&($u=-$u);const Ru=ye$1(Math.ceil(Io$1(Hs)/2))+ne;if(Au<Et$3||Au>=Ru||$u<Et$3||$u>=Ru)throw new Error("splitScalar (endomorphism): failed, k="+Z);return{k1neg:vu,k1:Au,k2neg:Su,k2:$u}}function Pn$1(Z){if(!["compact","recovered","der"].includes(Z))throw new Error('Signature format must be "compact", "recovered", or "der"');return Z}function Hn$1(Z,t){const Hs={};for(let zs of Object.keys(t))Hs[zs]=Z[zs]===void 0?t[zs]:Z[zs];return He$1(Hs.lowS,"lowS"),He$1(Hs.prehash,"prehash"),Hs.format!==void 0&&Pn$1(Hs.format),Hs}class Yf extends Error{constructor(t=""){super(t)}}const xt$1={Err:Yf,_tlv:{encode:(Z,t)=>{const{Err:Hs}=xt$1;if(Z<0||Z>256)throw new Hs("tlv.encode: wrong tag");if(t.length&1)throw new Hs("tlv.encode: unpadded data");const zs=t.length/2,Ys=De$2(zs);if(Ys.length/2&128)throw new Hs("tlv.encode: long form length too big");const Zs=zs>127?De$2(Ys.length/2|128):"";return De$2(Z)+Zs+Ys+t},decode(Z,t){const{Err:Hs}=xt$1;let zs=0;if(Z<0||Z>256)throw new Hs("tlv.encode: wrong tag");if(t.length<2||t[zs++]!==Z)throw new Hs("tlv.decode: wrong tlv");const Ys=t[zs++],Zs=!!(Ys&128);let _u=0;if(!Zs)_u=Ys;else{const Iu=Ys&127;if(!Iu)throw new Hs("tlv.decode(long): indefinite length not supported");if(Iu>4)throw new Hs("tlv.decode(long): byte length is too big");const Au=t.subarray(zs,zs+Iu);if(Au.length!==Iu)throw new Hs("tlv.decode: length bytes not complete");if(Au[0]===0)throw new Hs("tlv.decode(long): zero leftmost byte");for(const $u of Au)_u=_u<<8|$u;if(zs+=Iu,_u<128)throw new Hs("tlv.decode(long): not minimal encoding")}const Eu=t.subarray(zs,zs+_u);if(Eu.length!==_u)throw new Hs("tlv.decode: wrong value length");return{v:Eu,l:t.subarray(zs+_u)}}},_int:{encode(Z){const{Err:t}=xt$1;if(Z<Et$3)throw new t("integer: negative integers are not allowed");let Hs=De$2(Z);if(Number.parseInt(Hs[0],16)&8&&(Hs="00"+Hs),Hs.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return Hs},decode(Z){const{Err:t}=xt$1;if(Z[0]&128)throw new t("invalid signature integer: negative");if(Z[0]===0&&!(Z[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return Ve$2(Z)}},toSig(Z){const{Err:t,_int:Hs,_tlv:zs}=xt$1,Ys=tt$2("signature",Z),{v:Zs,l:_u}=zs.decode(48,Ys);if(_u.length)throw new t("invalid signature: left bytes after parsing");const{v:Eu,l:Iu}=zs.decode(2,Zs),{v:Au,l:$u}=zs.decode(2,Iu);if($u.length)throw new t("invalid signature: left bytes after parsing");return{r:Hs.decode(Eu),s:Hs.decode(Au)}},hexFromSig(Z){const{_tlv:t,_int:Hs}=xt$1,zs=t.encode(2,Hs.encode(Z.r)),Ys=t.encode(2,Hs.encode(Z.s)),Zs=zs+Ys;return t.encode(48,Zs)}},Et$3=BigInt(0),ne=BigInt(1),zo$1=BigInt(2),Ze$1=BigInt(3),Wf=BigInt(4);function re(Z,t){const{BYTES:Hs}=Z;let zs;if(typeof t=="bigint")zs=t;else{let Ys=tt$2("private key",t);try{zs=Z.fromBytes(Ys)}catch{throw new Error(`invalid private key: expected ui8a of size ${Hs}, got ${typeof t}`)}}if(!Z.isValidNot0(zs))throw new Error("invalid private key: out of range [1..N-1]");return zs}function Xf(Z,t={}){const Hs=kf("weierstrass",Z,t),{Fp:zs,Fn:Ys}=Hs;let Zs=Hs.CURVE;const{h:_u,n:Eu}=Zs;Ke$2(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:Iu}=t;if(Iu&&(!zs.is0(Zs.a)||typeof Iu.beta!="bigint"||!Array.isArray(Iu.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const Au=Wo$1(zs,Ys);function $u(){if(!zs.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function vu(Qu,Lu,cl){const{x:el,y:Zu}=Lu.toAffine(),dl=zs.toBytes(el);if(He$1(cl,"isCompressed"),cl){$u();const El=!zs.isOdd(Zu);return _t$2(Yo$1(El),dl)}else return _t$2(Uint8Array.of(4),dl,zs.toBytes(Zu))}function Su(Qu){Kt$1(Qu,void 0,"Point");const{publicKey:Lu,publicKeyUncompressed:cl}=Au,el=Qu.length,Zu=Qu[0],dl=Qu.subarray(1);if(el===Lu&&(Zu===2||Zu===3)){const El=zs.fromBytes(dl);if(!zs.isValid(El))throw new Error("bad point: is not on curve, wrong x");const hl=Cu(El);let _l;try{_l=zs.sqrt(hl)}catch(ol){const gl=ol instanceof Error?": "+ol.message:"";throw new Error("bad point: is not on curve, sqrt error"+gl)}$u();const Rl=zs.isOdd(_l);return(Zu&1)===1!==Rl&&(_l=zs.neg(_l)),{x:El,y:_l}}else if(el===cl&&Zu===4){const El=zs.BYTES,hl=zs.fromBytes(dl.subarray(0,El)),_l=zs.fromBytes(dl.subarray(El,El*2));if(!Bu(hl,_l))throw new Error("bad point: is not on curve");return{x:hl,y:_l}}else throw new Error(`bad point: got length ${el}, expected compressed=${Lu} or uncompressed=${cl}`)}const Ru=t.toBytes||vu,Pu=t.fromBytes||Su;function Cu(Qu){const Lu=zs.sqr(Qu),cl=zs.mul(Lu,Qu);return zs.add(zs.add(cl,zs.mul(Qu,Zs.a)),Zs.b)}function Bu(Qu,Lu){const cl=zs.sqr(Lu),el=Cu(Qu);return zs.eql(cl,el)}if(!Bu(Zs.Gx,Zs.Gy))throw new Error("bad curve params: generator point");const Fu=zs.mul(zs.pow(Zs.a,Ze$1),Wf),zu=zs.mul(zs.sqr(Zs.b),BigInt(27));if(zs.is0(zs.add(Fu,zu)))throw new Error("bad curve params: a or b");function Hu(Qu,Lu,cl=!1){if(!zs.isValid(Lu)||cl&&zs.is0(Lu))throw new Error(`bad point coordinate ${Qu}`);return Lu}function Wu(Qu){if(!(Qu instanceof Uu))throw new Error("ProjectivePoint expected")}function tl(Qu){if(!Iu||!Iu.basises)throw new Error("no endo");return zf(Qu,Iu.basises,Ys.ORDER)}const Xu=So$1((Qu,Lu)=>{const{X:cl,Y:el,Z:Zu}=Qu;if(zs.eql(Zu,zs.ONE))return{x:cl,y:el};const dl=Qu.is0();Lu==null&&(Lu=dl?zs.ONE:zs.inv(Zu));const El=zs.mul(cl,Lu),hl=zs.mul(el,Lu),_l=zs.mul(Zu,Lu);if(dl)return{x:zs.ZERO,y:zs.ZERO};if(!zs.eql(_l,zs.ONE))throw new Error("invZ was invalid");return{x:El,y:hl}}),ju=So$1(Qu=>{if(Qu.is0()){if(t.allowInfinityPoint&&!zs.is0(Qu.Y))return;throw new Error("bad point: ZERO")}const{x:Lu,y:cl}=Qu.toAffine();if(!zs.isValid(Lu)||!zs.isValid(cl))throw new Error("bad point: x or y not field elements");if(!Bu(Lu,cl))throw new Error("bad point: equation left != right");if(!Qu.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function ku(Qu,Lu,cl,el,Zu){return cl=new Uu(zs.mul(cl.X,Qu),cl.Y,cl.Z),Lu=qe$1(el,Lu),cl=qe$1(Zu,cl),Lu.add(cl)}class Uu{constructor(Lu,cl,el){this.X=Hu("x",Lu),this.Y=Hu("y",cl,!0),this.Z=Hu("z",el),Object.freeze(this)}static CURVE(){return Zs}static fromAffine(Lu){const{x:cl,y:el}=Lu||{};if(!Lu||!zs.isValid(cl)||!zs.isValid(el))throw new Error("invalid affine point");if(Lu instanceof Uu)throw new Error("projective point not allowed");return zs.is0(cl)&&zs.is0(el)?Uu.ZERO:new Uu(cl,el,zs.ONE)}static fromBytes(Lu){const cl=Uu.fromAffine(Pu(Kt$1(Lu,void 0,"point")));return cl.assertValidity(),cl}static fromHex(Lu){return Uu.fromBytes(tt$2("pointHex",Lu))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(Lu=8,cl=!0){return Yu.createCache(this,Lu),cl||this.multiply(Ze$1),this}assertValidity(){ju(this)}hasEvenY(){const{y:Lu}=this.toAffine();if(!zs.isOdd)throw new Error("Field doesn't support isOdd");return!zs.isOdd(Lu)}equals(Lu){Wu(Lu);const{X:cl,Y:el,Z:Zu}=this,{X:dl,Y:El,Z:hl}=Lu,_l=zs.eql(zs.mul(cl,hl),zs.mul(dl,Zu)),Rl=zs.eql(zs.mul(el,hl),zs.mul(El,Zu));return _l&&Rl}negate(){return new Uu(this.X,zs.neg(this.Y),this.Z)}double(){const{a:Lu,b:cl}=Zs,el=zs.mul(cl,Ze$1),{X:Zu,Y:dl,Z:El}=this;let hl=zs.ZERO,_l=zs.ZERO,Rl=zs.ZERO,ol=zs.mul(Zu,Zu),gl=zs.mul(dl,dl),nl=zs.mul(El,El),Sl=zs.mul(Zu,dl);return Sl=zs.add(Sl,Sl),Rl=zs.mul(Zu,El),Rl=zs.add(Rl,Rl),hl=zs.mul(Lu,Rl),_l=zs.mul(el,nl),_l=zs.add(hl,_l),hl=zs.sub(gl,_l),_l=zs.add(gl,_l),_l=zs.mul(hl,_l),hl=zs.mul(Sl,hl),Rl=zs.mul(el,Rl),nl=zs.mul(Lu,nl),Sl=zs.sub(ol,nl),Sl=zs.mul(Lu,Sl),Sl=zs.add(Sl,Rl),Rl=zs.add(ol,ol),ol=zs.add(Rl,ol),ol=zs.add(ol,nl),ol=zs.mul(ol,Sl),_l=zs.add(_l,ol),nl=zs.mul(dl,El),nl=zs.add(nl,nl),ol=zs.mul(nl,Sl),hl=zs.sub(hl,ol),Rl=zs.mul(nl,gl),Rl=zs.add(Rl,Rl),Rl=zs.add(Rl,Rl),new Uu(hl,_l,Rl)}add(Lu){Wu(Lu);const{X:cl,Y:el,Z:Zu}=this,{X:dl,Y:El,Z:hl}=Lu;let _l=zs.ZERO,Rl=zs.ZERO,ol=zs.ZERO;const gl=Zs.a,nl=zs.mul(Zs.b,Ze$1);let Sl=zs.mul(cl,dl),ll=zs.mul(el,El),ul=zs.mul(Zu,hl),Al=zs.add(cl,el),Tl=zs.add(dl,El);Al=zs.mul(Al,Tl),Tl=zs.add(Sl,ll),Al=zs.sub(Al,Tl),Tl=zs.add(cl,Zu);let qu=zs.add(dl,hl);return Tl=zs.mul(Tl,qu),qu=zs.add(Sl,ul),Tl=zs.sub(Tl,qu),qu=zs.add(el,Zu),_l=zs.add(El,hl),qu=zs.mul(qu,_l),_l=zs.add(ll,ul),qu=zs.sub(qu,_l),ol=zs.mul(gl,Tl),_l=zs.mul(nl,ul),ol=zs.add(_l,ol),_l=zs.sub(ll,ol),ol=zs.add(ll,ol),Rl=zs.mul(_l,ol),ll=zs.add(Sl,Sl),ll=zs.add(ll,Sl),ul=zs.mul(gl,ul),Tl=zs.mul(nl,Tl),ll=zs.add(ll,ul),ul=zs.sub(Sl,ul),ul=zs.mul(gl,ul),Tl=zs.add(Tl,ul),Sl=zs.mul(ll,Tl),Rl=zs.add(Rl,Sl),Sl=zs.mul(qu,Tl),_l=zs.mul(Al,_l),_l=zs.sub(_l,Sl),Sl=zs.mul(Al,ll),ol=zs.mul(qu,ol),ol=zs.add(ol,Sl),new Uu(_l,Rl,ol)}subtract(Lu){return this.add(Lu.negate())}is0(){return this.equals(Uu.ZERO)}multiply(Lu){const{endo:cl}=t;if(!Ys.isValidNot0(Lu))throw new Error("invalid scalar: out of range");let el,Zu;const dl=El=>Yu.cached(this,El,hl=>Tn$1(Uu,hl));if(cl){const{k1neg:El,k1:hl,k2neg:_l,k2:Rl}=tl(Lu),{p:ol,f:gl}=dl(hl),{p:nl,f:Sl}=dl(Rl);Zu=gl.add(Sl),el=ku(cl.beta,ol,nl,El,_l)}else{const{p:El,f:hl}=dl(Lu);el=El,Zu=hl}return Tn$1(Uu,[el,Zu])[0]}multiplyUnsafe(Lu){const{endo:cl}=t,el=this;if(!Ys.isValid(Lu))throw new Error("invalid scalar: out of range");if(Lu===Et$3||el.is0())return Uu.ZERO;if(Lu===ne)return el;if(Yu.hasCache(this))return this.multiply(Lu);if(cl){const{k1neg:Zu,k1:dl,k2neg:El,k2:hl}=tl(Lu),{p1:_l,p2:Rl}=jf(Uu,el,dl,hl);return ku(cl.beta,_l,Rl,Zu,El)}else return Yu.unsafe(el,Lu)}multiplyAndAddUnsafe(Lu,cl,el){const Zu=this.multiplyUnsafe(cl).add(Lu.multiplyUnsafe(el));return Zu.is0()?void 0:Zu}toAffine(Lu){return Xu(this,Lu)}isTorsionFree(){const{isTorsionFree:Lu}=t;return _u===ne?!0:Lu?Lu(Uu,this):Yu.unsafe(this,Eu).is0()}clearCofactor(){const{clearCofactor:Lu}=t;return _u===ne?this:Lu?Lu(Uu,this):this.multiplyUnsafe(_u)}isSmallOrder(){return this.multiplyUnsafe(_u).is0()}toBytes(Lu=!0){return He$1(Lu,"isCompressed"),this.assertValidity(),Ru(Uu,this,Lu)}toHex(Lu=!0){return Jt$2(this.toBytes(Lu))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(Lu=!0){return this.toBytes(Lu)}_setWindowSize(Lu){this.precompute(Lu)}static normalizeZ(Lu){return Tn$1(Uu,Lu)}static msm(Lu,cl){return Lf(Uu,Ys,Lu,cl)}static fromPrivateKey(Lu){return Uu.BASE.multiply(re(Ys,Lu))}}Uu.BASE=new Uu(Zs.Gx,Zs.Gy,zs.ONE),Uu.ZERO=new Uu(zs.ZERO,zs.ONE,zs.ZERO),Uu.Fp=zs,Uu.Fn=Ys;const Gu=Ys.BITS,Yu=new Cf(Uu,t.endo?Math.ceil(Gu/2):Gu);return Uu.BASE.precompute(8),Uu}function Yo$1(Z){return Uint8Array.of(Z?2:3)}function Wo$1(Z,t){return{secretKey:t.BYTES,publicKey:1+Z.BYTES,publicKeyUncompressed:1+2*Z.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function Jf(Z,t={}){const{Fn:Hs}=Z,zs=t.randomBytes||Mt$1,Ys=Object.assign(Wo$1(Z.Fp,Hs),{seed:Ho$1(Hs.ORDER)});function Zs(Su){try{return!!re(Hs,Su)}catch{return!1}}function _u(Su,Ru){const{publicKey:Pu,publicKeyUncompressed:Cu}=Ys;try{const Bu=Su.length;return Ru===!0&&Bu!==Pu||Ru===!1&&Bu!==Cu?!1:!!Z.fromBytes(Su)}catch{return!1}}function Eu(Su=zs(Ys.seed)){return Rf(Kt$1(Su,Ys.seed,"seed"),Hs.ORDER)}function Iu(Su,Ru=!0){return Z.BASE.multiply(re(Hs,Su)).toBytes(Ru)}function Au(Su){const Ru=Eu(Su);return{secretKey:Ru,publicKey:Iu(Ru)}}function $u(Su){if(typeof Su=="bigint")return!1;if(Su instanceof Z)return!0;const{secretKey:Ru,publicKey:Pu,publicKeyUncompressed:Cu}=Ys;if(Hs.allowedLengths||Ru===Pu)return;const Bu=tt$2("key",Su).length;return Bu===Pu||Bu===Cu}function vu(Su,Ru,Pu=!0){if($u(Su)===!0)throw new Error("first arg must be private key");if($u(Ru)===!1)throw new Error("second arg must be public key");const Cu=re(Hs,Su);return Z.fromHex(Ru).multiply(Cu).toBytes(Pu)}return Object.freeze({getPublicKey:Iu,getSharedSecret:vu,keygen:Au,Point:Z,utils:{isValidSecretKey:Zs,isValidPublicKey:_u,randomSecretKey:Eu,isValidPrivateKey:Zs,randomPrivateKey:Eu,normPrivateKeyToScalar:Su=>re(Hs,Su),precompute(Su=8,Ru=Z.BASE){return Ru.precompute(Su,!1)}},lengths:Ys})}function Qf(Z,t,Hs={}){Ue$1(t),Ke$2(Hs,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const zs=Hs.randomBytes||Mt$1,Ys=Hs.hmac||((cl,...el)=>ke$1(t,cl,_t$2(...el))),{Fp:Zs,Fn:_u}=Z,{ORDER:Eu,BITS:Iu}=_u,{keygen:Au,getPublicKey:$u,getSharedSecret:vu,utils:Su,lengths:Ru}=Jf(Z,Hs),Pu={prehash:!1,lowS:typeof Hs.lowS=="boolean"?Hs.lowS:!1,format:void 0,extraEntropy:!1},Cu="compact";function Bu(cl){const el=Eu>>ne;return cl>el}function Fu(cl,el){if(!_u.isValidNot0(el))throw new Error(`invalid signature ${cl}: out of range 1..Point.Fn.ORDER`);return el}function zu(cl,el){Pn$1(el);const Zu=Ru.signature,dl=el==="compact"?Zu:el==="recovered"?Zu+1:void 0;return Kt$1(cl,dl,`${el} signature`)}class Hu{constructor(el,Zu,dl){this.r=Fu("r",el),this.s=Fu("s",Zu),dl!=null&&(this.recovery=dl),Object.freeze(this)}static fromBytes(el,Zu=Cu){zu(el,Zu);let dl;if(Zu==="der"){const{r:Rl,s:ol}=xt$1.toSig(Kt$1(el));return new Hu(Rl,ol)}Zu==="recovered"&&(dl=el[0],Zu="compact",el=el.subarray(1));const El=_u.BYTES,hl=el.subarray(0,El),_l=el.subarray(El,El*2);return new Hu(_u.fromBytes(hl),_u.fromBytes(_l),dl)}static fromHex(el,Zu){return this.fromBytes(_e$2(el),Zu)}addRecoveryBit(el){return new Hu(this.r,this.s,el)}recoverPublicKey(el){const Zu=Zs.ORDER,{r:dl,s:El,recovery:hl}=this;if(hl==null||![0,1,2,3].includes(hl))throw new Error("recovery id invalid");if(Eu*zo$1<Zu&&hl>1)throw new Error("recovery id is ambiguous for h>1 curve");const _l=hl===2||hl===3?dl+Eu:dl;if(!Zs.isValid(_l))throw new Error("recovery id 2 or 3 invalid");const Rl=Zs.toBytes(_l),ol=Z.fromBytes(_t$2(Yo$1((hl&1)===0),Rl)),gl=_u.inv(_l),nl=tl(tt$2("msgHash",el)),Sl=_u.create(-nl*gl),ll=_u.create(El*gl),ul=Z.BASE.multiplyUnsafe(Sl).add(ol.multiplyUnsafe(ll));if(ul.is0())throw new Error("point at infinify");return ul.assertValidity(),ul}hasHighS(){return Bu(this.s)}toBytes(el=Cu){if(Pn$1(el),el==="der")return _e$2(xt$1.hexFromSig(this));const Zu=_u.toBytes(this.r),dl=_u.toBytes(this.s);if(el==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return _t$2(Uint8Array.of(this.recovery),Zu,dl)}return _t$2(Zu,dl)}toHex(el){return Jt$2(this.toBytes(el))}assertValidity(){}static fromCompact(el){return Hu.fromBytes(tt$2("sig",el),"compact")}static fromDER(el){return Hu.fromBytes(tt$2("sig",el),"der")}normalizeS(){return this.hasHighS()?new Hu(this.r,_u.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Jt$2(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Jt$2(this.toBytes("compact"))}}const Wu=Hs.bits2int||function(cl){if(cl.length>8192)throw new Error("input is too large");const el=Ve$2(cl),Zu=cl.length*8-Iu;return Zu>0?el>>BigInt(Zu):el},tl=Hs.bits2int_modN||function(cl){return _u.create(Wu(cl))},Xu=ye$1(Iu);function ju(cl){return Rn$1("num < 2^"+Iu,cl,Et$3,Xu),_u.toBytes(cl)}function ku(cl,el){return Kt$1(cl,void 0,"message"),el?Kt$1(t(cl),void 0,"prehashed message"):cl}function Uu(cl,el,Zu){if(["recovered","canonical"].some(ll=>ll in Zu))throw new Error("sign() legacy options not supported");const{lowS:dl,prehash:El,extraEntropy:hl}=Hn$1(Zu,Pu);cl=ku(cl,El);const _l=tl(cl),Rl=re(_u,el),ol=[ju(Rl),ju(_l)];if(hl!=null&&hl!==!1){const ll=hl===!0?zs(Ru.secretKey):hl;ol.push(tt$2("extraEntropy",ll))}const gl=_t$2(...ol),nl=_l;function Sl(ll){const ul=Wu(ll);if(!_u.isValidNot0(ul))return;const Al=_u.inv(ul),Tl=Z.BASE.multiply(ul).toAffine(),qu=_u.create(Tl.x);if(qu===Et$3)return;const Ou=_u.create(Al*_u.create(nl+qu*Rl));if(Ou===Et$3)return;let Vu=(Tl.x===qu?0:2)|Number(Tl.y&ne),il=Ou;return dl&&Bu(Ou)&&(il=_u.neg(Ou),Vu^=1),new Hu(qu,il,Vu)}return{seed:gl,k2sig:Sl}}function Gu(cl,el,Zu={}){cl=tt$2("message",cl);const{seed:dl,k2sig:El}=Uu(cl,el,Zu);return Ef(t.outputLen,_u.BYTES,Ys)(dl,El)}function Yu(cl){let el;const Zu=typeof cl=="string"||Ne(cl),dl=!Zu&&cl!==null&&typeof cl=="object"&&typeof cl.r=="bigint"&&typeof cl.s=="bigint";if(!Zu&&!dl)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(dl)el=new Hu(cl.r,cl.s);else if(Zu){try{el=Hu.fromBytes(tt$2("sig",cl),"der")}catch(El){if(!(El instanceof xt$1.Err))throw El}if(!el)try{el=Hu.fromBytes(tt$2("sig",cl),"compact")}catch{return!1}}return el||!1}function Qu(cl,el,Zu,dl={}){const{lowS:El,prehash:hl,format:_l}=Hn$1(dl,Pu);if(Zu=tt$2("publicKey",Zu),el=ku(tt$2("message",el),hl),"strict"in dl)throw new Error("options.strict was renamed to lowS");const Rl=_l===void 0?Yu(cl):Hu.fromBytes(tt$2("sig",cl),_l);if(Rl===!1)return!1;try{const ol=Z.fromBytes(Zu);if(El&&Rl.hasHighS())return!1;const{r:gl,s:nl}=Rl,Sl=tl(el),ll=_u.inv(nl),ul=_u.create(Sl*ll),Al=_u.create(gl*ll),Tl=Z.BASE.multiplyUnsafe(ul).add(ol.multiplyUnsafe(Al));return Tl.is0()?!1:_u.create(Tl.x)===gl}catch{return!1}}function Lu(cl,el,Zu={}){const{prehash:dl}=Hn$1(Zu,Pu);return el=ku(el,dl),Hu.fromBytes(cl,"recovered").recoverPublicKey(el).toBytes()}return Object.freeze({keygen:Au,getPublicKey:$u,getSharedSecret:vu,utils:Su,lengths:Ru,Point:Z,sign:Gu,verify:Qu,recoverPublicKey:Lu,Signature:Hu,hash:t})}function ta$1(Z){const t={a:Z.a,b:Z.b,p:Z.Fp.ORDER,n:Z.n,h:Z.h,Gx:Z.Gx,Gy:Z.Gy},Hs=Z.Fp;let zs=Z.allowedPrivateKeyLengths?Array.from(new Set(Z.allowedPrivateKeyLengths.map(_u=>Math.ceil(_u/2)))):void 0;const Ys=Ht$3(t.n,{BITS:Z.nBitLength,allowedLengths:zs,modFromBytes:Z.wrapPrivateKey}),Zs={Fp:Hs,Fn:Ys,allowInfinityPoint:Z.allowInfinityPoint,endo:Z.endo,isTorsionFree:Z.isTorsionFree,clearCofactor:Z.clearCofactor,fromBytes:Z.fromBytes,toBytes:Z.toBytes};return{CURVE:t,curveOpts:Zs}}function ea$1(Z){const{CURVE:t,curveOpts:Hs}=ta$1(Z),zs={hmac:Z.hmac,randomBytes:Z.randomBytes,lowS:Z.lowS,bits2int:Z.bits2int,bits2int_modN:Z.bits2int_modN};return{CURVE:t,curveOpts:Hs,hash:Z.hash,ecdsaOpts:zs}}function na(Z,t){const Hs=t.Point;return Object.assign({},t,{ProjectivePoint:Hs,CURVE:Object.assign({},Z,ko$1(Hs.Fn.ORDER,Hs.Fn.BITS))})}function ra(Z){const{CURVE:t,curveOpts:Hs,hash:zs,ecdsaOpts:Ys}=ea$1(Z),Zs=Xf(t,Hs),_u=Qf(Zs,zs,Ys);return na(Z,_u)}function Dn$1(Z,t){const Hs=zs=>ra({...Z,hash:zs});return{...Hs(t),create:Hs}}const Xo$1={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},Jo$1={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},Qo$1={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},oa=Ht$3(Xo$1.p),sa=Ht$3(Jo$1.p),ia=Ht$3(Qo$1.p),ca=Dn$1({...Xo$1,Fp:oa,lowS:!1},$e$1);Dn$1({...Jo$1,Fp:sa,lowS:!1},yc),Dn$1({...Qo$1,Fp:ia,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},bc);const fa=ca,Vn$1="base10",rt$1="base16",oe$1="base64pad",Ge$1="base64url",se="utf8",Mn$1=0,ie=1,we$1=2,aa=0,ts=1,ve$1=12,Kn$1=32;function ua(){const Z=kn$1.utils.randomPrivateKey(),t=kn$1.getPublicKey(Z);return{privateKey:toString(Z,rt$1),publicKey:toString(t,rt$1)}}function la(){const Z=Mt$1(Kn$1);return toString(Z,rt$1)}function da(Z,t){const Hs=kn$1.getSharedSecret(fromString(Z,rt$1),fromString(t,rt$1)),zs=vf(Pe$1,Hs,void 0,void 0,Kn$1);return toString(zs,rt$1)}function ha(Z){const t=Pe$1(fromString(Z,rt$1));return toString(t,rt$1)}function pa(Z){const t=Pe$1(fromString(Z,se));return toString(t,rt$1)}function qn$1(Z){return fromString(`${Z}`,Vn$1)}function Zt$2(Z){return Number(toString(Z,Vn$1))}function es(Z){return Z.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function ns(Z){const t=Z.replace(/-/g,"+").replace(/_/g,"/"),Hs=(4-t.length%4)%4;return t+"=".repeat(Hs)}function ga(Z){const t=qn$1(typeof Z.type<"u"?Z.type:Mn$1);if(Zt$2(t)===ie&&typeof Z.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const Hs=typeof Z.senderPublicKey<"u"?fromString(Z.senderPublicKey,rt$1):void 0,zs=typeof Z.iv<"u"?fromString(Z.iv,rt$1):Mt$1(ve$1),Ys=fromString(Z.symKey,rt$1),Zs=xo$1(Ys,zs).encrypt(fromString(Z.message,se)),_u=Fn$1({type:t,sealed:Zs,iv:zs,senderPublicKey:Hs});return Z.encoding===Ge$1?es(_u):_u}function ba(Z){const t=fromString(Z.symKey,rt$1),{sealed:Hs,iv:zs}=ze({encoded:Z.encoded,encoding:Z.encoding}),Ys=xo$1(t,zs).decrypt(Hs);if(Ys===null)throw new Error("Failed to decrypt");return toString(Ys,se)}function ya(Z,t){const Hs=qn$1(we$1),zs=Mt$1(ve$1),Ys=fromString(Z,se),Zs=Fn$1({type:Hs,sealed:Ys,iv:zs});return t===Ge$1?es(Zs):Zs}function ma(Z,t){const{sealed:Hs}=ze({encoded:Z,encoding:t});return toString(Hs,se)}function Fn$1(Z){if(Zt$2(Z.type)===we$1)return toString(concat([Z.type,Z.sealed]),oe$1);if(Zt$2(Z.type)===ie){if(typeof Z.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return toString(concat([Z.type,Z.senderPublicKey,Z.iv,Z.sealed]),oe$1)}return toString(concat([Z.type,Z.iv,Z.sealed]),oe$1)}function ze(Z){const t=(Z.encoding||oe$1)===Ge$1?ns(Z.encoded):Z.encoded,Hs=fromString(t,oe$1),zs=Hs.slice(aa,ts),Ys=ts;if(Zt$2(zs)===ie){const Iu=Ys+Kn$1,Au=Iu+ve$1,$u=Hs.slice(Ys,Iu),vu=Hs.slice(Iu,Au),Su=Hs.slice(Au);return{type:zs,sealed:Su,iv:vu,senderPublicKey:$u}}if(Zt$2(zs)===we$1){const Iu=Hs.slice(Ys),Au=Mt$1(ve$1);return{type:zs,sealed:Iu,iv:Au}}const Zs=Ys+ve$1,_u=Hs.slice(Ys,Zs),Eu=Hs.slice(Zs);return{type:zs,sealed:Eu,iv:_u}}function wa(Z,t){const Hs=ze({encoded:Z,encoding:t==null?void 0:t.encoding});return rs({type:Zt$2(Hs.type),senderPublicKey:typeof Hs.senderPublicKey<"u"?toString(Hs.senderPublicKey,rt$1):void 0,receiverPublicKey:t==null?void 0:t.receiverPublicKey})}function rs(Z){const t=(Z==null?void 0:Z.type)||Mn$1;if(t===ie){if(typeof(Z==null?void 0:Z.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(Z==null?void 0:Z.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:Z==null?void 0:Z.senderPublicKey,receiverPublicKey:Z==null?void 0:Z.receiverPublicKey}}function va(Z){return Z.type===ie&&typeof Z.senderPublicKey=="string"&&typeof Z.receiverPublicKey=="string"}function xa(Z){return Z.type===we$1}function os(Z){const t=Buffer$1.from(Z.x,"base64"),Hs=Buffer$1.from(Z.y,"base64");return concat([new Uint8Array([4]),t,Hs])}function Ea(Z,t){const[Hs,zs,Ys]=Z.split("."),Zs=Buffer$1.from(ns(Ys),"base64");if(Zs.length!==64)throw new Error("Invalid signature length");const _u=Zs.slice(0,32),Eu=Zs.slice(32,64),Iu=`${Hs}.${zs}`,Au=Pe$1(Iu),$u=os(t);if(!fa.verify(concat([_u,Eu]),Au,$u))throw new Error("Invalid signature");return sn$3(Z).payload}const ss="irn";function Ba(Z){return(Z==null?void 0:Z.relay)||{protocol:ss}}function Aa(Z){const t=C$2[Z];if(typeof t>"u")throw new Error(`Relay Protocol not supported: ${Z}`);return t}var Ia=Object.defineProperty,Sa=Object.defineProperties,Oa=Object.getOwnPropertyDescriptors,is=Object.getOwnPropertySymbols,Na=Object.prototype.hasOwnProperty,Ua=Object.prototype.propertyIsEnumerable,cs=(Z,t,Hs)=>t in Z?Ia(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,Zn$1=(Z,t)=>{for(var Hs in t||(t={}))Na.call(t,Hs)&&cs(Z,Hs,t[Hs]);if(is)for(var Hs of is(t))Ua.call(t,Hs)&&cs(Z,Hs,t[Hs]);return Z},_a=(Z,t)=>Sa(Z,Oa(t));function fs(Z,t="-"){const Hs={},zs="relay"+t;return Object.keys(Z).forEach(Ys=>{if(Ys.startsWith(zs)){const Zs=Ys.replace(zs,""),_u=Z[Ys];Hs[Zs]=_u}}),Hs}function Ra(Z){if(!Z.includes("wc:")){const Au=cn$1(Z);Au!=null&&Au.includes("wc:")&&(Z=Au)}Z=Z.includes("wc://")?Z.replace("wc://",""):Z,Z=Z.includes("wc:")?Z.replace("wc:",""):Z;const t=Z.indexOf(":"),Hs=Z.indexOf("?")!==-1?Z.indexOf("?"):void 0,zs=Z.substring(0,t),Ys=Z.substring(t+1,Hs).split("@"),Zs=typeof Hs<"u"?Z.substring(Hs):"",_u=new URLSearchParams(Zs),Eu=Object.fromEntries(_u.entries()),Iu=typeof Eu.methods=="string"?Eu.methods.split(","):void 0;return{protocol:zs,topic:as(Ys[0]),version:parseInt(Ys[1],10),symKey:Eu.symKey,relay:fs(Eu),methods:Iu,expiryTimestamp:Eu.expiryTimestamp?parseInt(Eu.expiryTimestamp,10):void 0}}function as(Z){return Z.startsWith("//")?Z.substring(2):Z}function us(Z,t="-"){const Hs="relay",zs={};return Object.keys(Z).forEach(Ys=>{const Zs=Ys,_u=Hs+t+Zs;Z[Zs]&&(zs[_u]=Z[Zs])}),zs}function $a(Z){const t=new URLSearchParams,Hs=Zn$1(Zn$1(_a(Zn$1({},us(Z.relay)),{symKey:Z.symKey}),Z.expiryTimestamp&&{expiryTimestamp:Z.expiryTimestamp.toString()}),Z.methods&&{methods:Z.methods.join(",")});return Object.entries(Hs).sort(([zs],[Ys])=>zs.localeCompare(Ys)).forEach(([zs,Ys])=>{Ys!==void 0&&t.append(zs,String(Ys))}),`${Z.protocol}:${Z.topic}@${Z.version}?${t}`}function Ta(Z,t,Hs){return`${Z}?wc_ev=${Hs}&topic=${t}`}var Ca=Object.defineProperty,ja=Object.defineProperties,La=Object.getOwnPropertyDescriptors,ls=Object.getOwnPropertySymbols,ka=Object.prototype.hasOwnProperty,Pa=Object.prototype.propertyIsEnumerable,ds=(Z,t,Hs)=>t in Z?Ca(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,Ha=(Z,t)=>{for(var Hs in t||(t={}))ka.call(t,Hs)&&ds(Z,Hs,t[Hs]);if(ls)for(var Hs of ls(t))Pa.call(t,Hs)&&ds(Z,Hs,t[Hs]);return Z},Da=(Z,t)=>ja(Z,La(t));function Gt$2(Z){const t=[];return Z.forEach(Hs=>{const[zs,Ys]=Hs.split(":");t.push(`${zs}:${Ys}`)}),t}function hs(Z){const t=[];return Object.values(Z).forEach(Hs=>{t.push(...Gt$2(Hs.accounts))}),t}function ps(Z,t){const Hs=[];return Object.values(Z).forEach(zs=>{Gt$2(zs.accounts).includes(t)&&Hs.push(...zs.methods)}),Hs}function gs(Z,t){const Hs=[];return Object.values(Z).forEach(zs=>{Gt$2(zs.accounts).includes(t)&&Hs.push(...zs.events)}),Hs}function Va(Z,t){const Hs=Ss$1(Z,t);if(Hs)throw new Error(Hs.message);const zs={};for(const[Ys,Zs]of Object.entries(Z))zs[Ys]={methods:Zs.methods,events:Zs.events,chains:Zs.accounts.map(_u=>`${_u.split(":")[0]}:${_u.split(":")[1]}`)};return zs}function Ma(Z){var t;const{proposal:{requiredNamespaces:Hs,optionalNamespaces:zs={}},supportedNamespaces:Ys}=Z,Zs=xe(Hs),_u=xe(zs),Eu={};Object.keys(Ys).forEach($u=>{const vu=Ys[$u].chains,Su=Ys[$u].methods,Ru=Ys[$u].events,Pu=Ys[$u].accounts;vu.forEach(Cu=>{if(!Pu.some(Bu=>Bu.includes(Cu)))throw new Error(`No accounts provided for chain ${Cu} in namespace ${$u}`)}),Eu[$u]={chains:vu,methods:Su,events:Ru,accounts:Pu}});const Iu=Ns$1(Hs,Eu,"approve()");if(Iu)throw new Error(Iu.message);const Au={};if(!Object.keys(Hs).length&&!Object.keys(zs).length)return Eu;Object.keys(Zs).forEach($u=>{const vu=Ys[$u].chains.filter(Cu=>{var Bu,Fu;return(Fu=(Bu=Zs[$u])==null?void 0:Bu.chains)==null?void 0:Fu.includes(Cu)}),Su=Ys[$u].methods.filter(Cu=>{var Bu,Fu;return(Fu=(Bu=Zs[$u])==null?void 0:Bu.methods)==null?void 0:Fu.includes(Cu)}),Ru=Ys[$u].events.filter(Cu=>{var Bu,Fu;return(Fu=(Bu=Zs[$u])==null?void 0:Bu.events)==null?void 0:Fu.includes(Cu)}),Pu=vu.map(Cu=>Ys[$u].accounts.filter(Bu=>Bu.includes(`${Cu}:`))).flat();Au[$u]={chains:vu,methods:Su,events:Ru,accounts:Pu}}),Object.keys(_u).forEach($u=>{var vu,Su,Ru,Pu,Cu,Bu;if(!Ys[$u])return;const Fu=(Su=(vu=_u[$u])==null?void 0:vu.chains)==null?void 0:Su.filter(tl=>Ys[$u].chains.includes(tl)),zu=Ys[$u].methods.filter(tl=>{var Xu,ju;return(ju=(Xu=_u[$u])==null?void 0:Xu.methods)==null?void 0:ju.includes(tl)}),Hu=Ys[$u].events.filter(tl=>{var Xu,ju;return(ju=(Xu=_u[$u])==null?void 0:Xu.events)==null?void 0:ju.includes(tl)}),Wu=Fu==null?void 0:Fu.map(tl=>Ys[$u].accounts.filter(Xu=>Xu.includes(`${tl}:`))).flat();Au[$u]={chains:ut$2((Ru=Au[$u])==null?void 0:Ru.chains,Fu),methods:ut$2((Pu=Au[$u])==null?void 0:Pu.methods,zu),events:ut$2((Cu=Au[$u])==null?void 0:Cu.events,Hu),accounts:ut$2((Bu=Au[$u])==null?void 0:Bu.accounts,Wu)}});for(const[$u,vu]of Object.entries(Au))(vu.accounts.length===0||((t=vu==null?void 0:vu.chains)==null?void 0:t.length)===0)&&delete Au[$u];return Au}function Gn$1(Z){return Z.includes(":")}function bs$1(Z){return Gn$1(Z)?Z.split(":")[0]:Z}function xe(Z){var t,Hs,zs;const Ys={};if(!Ye$1(Z))return Ys;for(const[Zs,_u]of Object.entries(Z)){const Eu=Gn$1(Zs)?[Zs]:_u.chains,Iu=_u.methods||[],Au=_u.events||[],$u=bs$1(Zs);Ys[$u]=Da(Ha({},Ys[$u]),{chains:ut$2(Eu,(t=Ys[$u])==null?void 0:t.chains),methods:ut$2(Iu,(Hs=Ys[$u])==null?void 0:Hs.methods),events:ut$2(Au,(zs=Ys[$u])==null?void 0:zs.events)})}return Ys}function ys(Z){const t={};return Z==null||Z.forEach(Hs=>{var zs;const[Ys,Zs]=Hs.split(":");t[Ys]||(t[Ys]={accounts:[],chains:[],events:[],methods:[]}),t[Ys].accounts.push(Hs),(zs=t[Ys].chains)==null||zs.push(`${Ys}:${Zs}`)}),t}function Ka(Z,t){t=t.map(zs=>zs.replace("did:pkh:",""));const Hs=ys(t);for(const[zs,Ys]of Object.entries(Hs))Ys.methods?Ys.methods=ut$2(Ys.methods,Z):Ys.methods=Z,Ys.events=["chainChanged","accountsChanged"];return Hs}function qa(Z,t){var Hs,zs,Ys,Zs,_u,Eu;const Iu=xe(Z),Au=xe(t),$u={},vu=Object.keys(Iu).concat(Object.keys(Au));for(const Su of vu)$u[Su]={chains:ut$2((Hs=Iu[Su])==null?void 0:Hs.chains,(zs=Au[Su])==null?void 0:zs.chains),methods:ut$2((Ys=Iu[Su])==null?void 0:Ys.methods,(Zs=Au[Su])==null?void 0:Zs.methods),events:ut$2((_u=Iu[Su])==null?void 0:_u.events,(Eu=Au[Su])==null?void 0:Eu.events)};return $u}const ms={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},ws={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function Bt$2(Z,t){const{message:Hs,code:zs}=ws[Z];return{message:t?`${Hs} ${t}`:Hs,code:zs}}function zt$2(Z,t){const{message:Hs,code:zs}=ms[Z];return{message:t?`${Hs} ${t}`:Hs,code:zs}}function Ee(Z,t){return Array.isArray(Z)?typeof t<"u"&&Z.length?Z.every(t):!0:!1}function Ye$1(Z){return Object.getPrototypeOf(Z)===Object.prototype&&Object.keys(Z).length}function Dt$1(Z){return typeof Z>"u"}function ft$2(Z,t){return t&&Dt$1(Z)?!0:typeof Z=="string"&&!!Z.trim().length}function We$1(Z,t){return t&&Dt$1(Z)?!0:typeof Z=="number"&&!isNaN(Z)}function Fa(Z,t){const{requiredNamespaces:Hs}=t,zs=Object.keys(Z.namespaces),Ys=Object.keys(Hs);let Zs=!0;return It$3(Ys,zs)?(zs.forEach(_u=>{const{accounts:Eu,methods:Iu,events:Au}=Z.namespaces[_u],$u=Gt$2(Eu),vu=Hs[_u];(!It$3(Ie(_u,vu),$u)||!It$3(vu.methods,Iu)||!It$3(vu.events,Au))&&(Zs=!1)}),Zs):!1}function Be$1(Z){return ft$2(Z,!1)&&Z.includes(":")?Z.split(":").length===2:!1}function vs$1(Z){if(ft$2(Z,!1)&&Z.includes(":")){const t=Z.split(":");if(t.length===3){const Hs=t[0]+":"+t[1];return!!t[2]&&Be$1(Hs)}}return!1}function Za(Z){function t(Hs){try{return typeof new URL(Hs)<"u"}catch{return!1}}try{if(ft$2(Z,!1)){if(t(Z))return!0;const Hs=cn$1(Z);return t(Hs)}}catch{}return!1}function Ga(Z){var t;return(t=Z==null?void 0:Z.proposer)==null?void 0:t.publicKey}function za(Z){return Z==null?void 0:Z.topic}function Ya(Z,t){let Hs=null;return ft$2(Z==null?void 0:Z.publicKey,!1)||(Hs=Bt$2("MISSING_OR_INVALID",`${t} controller public key should be a string`)),Hs}function zn$1(Z){let t=!0;return Ee(Z)?Z.length&&(t=Z.every(Hs=>ft$2(Hs,!1))):t=!1,t}function xs$1(Z,t,Hs){let zs=null;return Ee(t)&&t.length?t.forEach(Ys=>{zs||Be$1(Ys)||(zs=zt$2("UNSUPPORTED_CHAINS",`${Hs}, chain ${Ys} should be a string and conform to "namespace:chainId" format`))}):Be$1(Z)||(zs=zt$2("UNSUPPORTED_CHAINS",`${Hs}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),zs}function Es(Z,t,Hs){let zs=null;return Object.entries(Z).forEach(([Ys,Zs])=>{if(zs)return;const _u=xs$1(Ys,Ie(Ys,Zs),`${t} ${Hs}`);_u&&(zs=_u)}),zs}function Bs(Z,t){let Hs=null;return Ee(Z)?Z.forEach(zs=>{Hs||vs$1(zs)||(Hs=zt$2("UNSUPPORTED_ACCOUNTS",`${t}, account ${zs} should be a string and conform to "namespace:chainId:address" format`))}):Hs=zt$2("UNSUPPORTED_ACCOUNTS",`${t}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),Hs}function As$1(Z,t){let Hs=null;return Object.values(Z).forEach(zs=>{if(Hs)return;const Ys=Bs(zs==null?void 0:zs.accounts,`${t} namespace`);Ys&&(Hs=Ys)}),Hs}function Is$1(Z,t){let Hs=null;return zn$1(Z==null?void 0:Z.methods)?zn$1(Z==null?void 0:Z.events)||(Hs=zt$2("UNSUPPORTED_EVENTS",`${t}, events should be an array of strings or empty array for no events`)):Hs=zt$2("UNSUPPORTED_METHODS",`${t}, methods should be an array of strings or empty array for no methods`),Hs}function Yn$1(Z,t){let Hs=null;return Object.values(Z).forEach(zs=>{if(Hs)return;const Ys=Is$1(zs,`${t}, namespace`);Ys&&(Hs=Ys)}),Hs}function Wa(Z,t,Hs){let zs=null;if(Z&&Ye$1(Z)){const Ys=Yn$1(Z,t);Ys&&(zs=Ys);const Zs=Es(Z,t,Hs);Zs&&(zs=Zs)}else zs=Bt$2("MISSING_OR_INVALID",`${t}, ${Hs} should be an object with data`);return zs}function Ss$1(Z,t){let Hs=null;if(Z&&Ye$1(Z)){const zs=Yn$1(Z,t);zs&&(Hs=zs);const Ys=As$1(Z,t);Ys&&(Hs=Ys)}else Hs=Bt$2("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return Hs}function Os$1(Z){return ft$2(Z.protocol,!0)}function Xa(Z,t){let Hs=!1;return t&&!Z?Hs=!0:Z&&Ee(Z)&&Z.length&&Z.forEach(zs=>{Hs=Os$1(zs)}),Hs}function Ja(Z){return typeof Z=="number"}function Qa(Z){return typeof Z<"u"&&typeof Z!==null}function tu(Z){return!(!Z||typeof Z!="object"||!Z.code||!We$1(Z.code,!1)||!Z.message||!ft$2(Z.message,!1))}function eu(Z){return!(Dt$1(Z)||!ft$2(Z.method,!1))}function nu(Z){return!(Dt$1(Z)||Dt$1(Z.result)&&Dt$1(Z.error)||!We$1(Z.id,!1)||!ft$2(Z.jsonrpc,!1))}function ru(Z){return!(Dt$1(Z)||!ft$2(Z.name,!1))}function ou(Z,t){return!(!Be$1(t)||!hs(Z).includes(t))}function su(Z,t,Hs){return ft$2(Hs,!1)?ps(Z,t).includes(Hs):!1}function iu(Z,t,Hs){return ft$2(Hs,!1)?gs(Z,t).includes(Hs):!1}function Ns$1(Z,t,Hs){let zs=null;const Ys=cu(Z),Zs=fu(t),_u=Object.keys(Ys),Eu=Object.keys(Zs),Iu=Us$1(Object.keys(Z)),Au=Us$1(Object.keys(t)),$u=Iu.filter(vu=>!Au.includes(vu));return $u.length&&(zs=Bt$2("NON_CONFORMING_NAMESPACES",`${Hs} namespaces keys don't satisfy requiredNamespaces.
      Required: ${$u.toString()}
      Received: ${Object.keys(t).toString()}`)),It$3(_u,Eu)||(zs=Bt$2("NON_CONFORMING_NAMESPACES",`${Hs} namespaces chains don't satisfy required namespaces.
      Required: ${_u.toString()}
      Approved: ${Eu.toString()}`)),Object.keys(t).forEach(vu=>{if(!vu.includes(":")||zs)return;const Su=Gt$2(t[vu].accounts);Su.includes(vu)||(zs=Bt$2("NON_CONFORMING_NAMESPACES",`${Hs} namespaces accounts don't satisfy namespace accounts for ${vu}
        Required: ${vu}
        Approved: ${Su.toString()}`))}),_u.forEach(vu=>{zs||(It$3(Ys[vu].methods,Zs[vu].methods)?It$3(Ys[vu].events,Zs[vu].events)||(zs=Bt$2("NON_CONFORMING_NAMESPACES",`${Hs} namespaces events don't satisfy namespace events for ${vu}`)):zs=Bt$2("NON_CONFORMING_NAMESPACES",`${Hs} namespaces methods don't satisfy namespace methods for ${vu}`))}),zs}function cu(Z){const t={};return Object.keys(Z).forEach(Hs=>{var zs;Hs.includes(":")?t[Hs]=Z[Hs]:(zs=Z[Hs].chains)==null||zs.forEach(Ys=>{t[Ys]={methods:Z[Hs].methods,events:Z[Hs].events}})}),t}function Us$1(Z){return[...new Set(Z.map(t=>t.includes(":")?t.split(":")[0]:t))]}function fu(Z){const t={};return Object.keys(Z).forEach(Hs=>{if(Hs.includes(":"))t[Hs]=Z[Hs];else{const zs=Gt$2(Z[Hs].accounts);zs==null||zs.forEach(Ys=>{t[Ys]={accounts:Z[Hs].accounts.filter(Zs=>Zs.includes(`${Ys}:`)),methods:Z[Hs].methods,events:Z[Hs].events}})}}),t}function au(Z,t){return We$1(Z,!1)&&Z<=t.max&&Z>=t.min}function uu(){const Z=Vt$2();return new Promise(t=>{switch(Z){case et$2.browser:t(_s());break;case et$2.reactNative:t(Rs$1());break;case et$2.node:t($s$1());break;default:t(!0)}})}function _s(){return Wt$2()&&(navigator==null?void 0:navigator.onLine)}async function Rs$1(){if(At$2()&&typeof globalThis<"u"&&globalThis!=null&&globalThis.NetInfo){const Z=await(globalThis==null?void 0:globalThis.NetInfo.fetch());return Z==null?void 0:Z.isConnected}return!0}function $s$1(){return!0}function lu(Z){switch(Vt$2()){case et$2.browser:Ts$1(Z);break;case et$2.reactNative:Cs$1(Z);break;case et$2.node:break}}function Ts$1(Z){!At$2()&&Wt$2()&&(window.addEventListener("online",()=>Z(!0)),window.addEventListener("offline",()=>Z(!1)))}function Cs$1(Z){At$2()&&typeof globalThis<"u"&&globalThis!=null&&globalThis.NetInfo&&(globalThis==null||globalThis.NetInfo.addEventListener(t=>Z(t==null?void 0:t.isConnected)))}function du(){var Z;return Wt$2()&&getDocument_1()?((Z=getDocument_1())==null?void 0:Z.visibilityState)==="visible":!0}const Wn$1={};class hu{static get(t){return Wn$1[t]}static set(t,Hs){Wn$1[t]=Hs}static delete(t){delete Wn$1[t]}}function js$1(Z){const t=ue.decode(Z);if(t.length<33)throw new Error("Too short to contain a public key");return t.slice(1,33)}function Ls$1({publicKey:Z,signature:t,payload:Hs}){var zs;const Ys=Xn$1(Hs.method),Zs=128|parseInt(((zs=Hs.version)==null?void 0:zs.toString())||"4"),_u=gu(Hs.address),Eu=Hs.era==="00"?new Uint8Array([0]):Xn$1(Hs.era);if(Eu.length!==1&&Eu.length!==2)throw new Error("Invalid era length");const Iu=parseInt(Hs.nonce,16),Au=new Uint8Array([Iu&255,Iu>>8&255]),$u=BigInt(`0x${pu(Hs.tip)}`),vu=yu($u),Su=new Uint8Array([0,...Z,_u,...t,...Eu,...Au,...vu,...Ys]),Ru=bu(Su.length+1);return new Uint8Array([...Ru,Zs,...Su])}function ks$1(Z){const t=Xn$1(Z),Hs=blakejs.blake2b(t,void 0,32);return"0x"+Buffer$1.from(Hs).toString("hex")}function Xn$1(Z){return new Uint8Array(Z.replace(/^0x/,"").match(/.{1,2}/g).map(t=>parseInt(t,16)))}function pu(Z){return Z.startsWith("0x")?Z.slice(2):Z}function gu(Z){const t=ue.decode(Z)[0];return t===42?0:t===60?2:1}function bu(Z){if(Z<64)return new Uint8Array([Z<<2]);if(Z<16384){const t=Z<<2|1;return new Uint8Array([t&255,t>>8&255])}else if(Z<1<<30){const t=Z<<2|2;return new Uint8Array([t&255,t>>8&255,t>>16&255,t>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function yu(Z){if(Z<BigInt(1)<<BigInt(6))return new Uint8Array([Number(Z<<BigInt(2))]);if(Z<BigInt(1)<<BigInt(14)){const t=Z<<BigInt(2)|BigInt(1);return new Uint8Array([Number(t&BigInt(255)),Number(t>>BigInt(8)&BigInt(255))])}else if(Z<BigInt(1)<<BigInt(30)){const t=Z<<BigInt(2)|BigInt(2);return new Uint8Array([Number(t&BigInt(255)),Number(t>>BigInt(8)&BigInt(255)),Number(t>>BigInt(16)&BigInt(255)),Number(t>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function mu(Z){const t=Uint8Array.from(Buffer$1.from(Z.signature,"hex")),Hs=js$1(Z.transaction.address),zs=Ls$1({publicKey:Hs,signature:t,payload:Z.transaction}),Ys=Buffer$1.from(zs).toString("hex");return ks$1(Ys)}function wu({logger:Z,name:t}){const Hs=typeof Z=="string"?Y$1({opts:{level:Z,name:t}}).logger:Z;return Hs.level=typeof Z=="string"?Z:Z.level,Hs}const dist$1=Object.freeze(Object.defineProperty({__proto__:null,BASE10:Vn$1,BASE16:rt$1,BASE64:oe$1,BASE64URL:Ge$1,COLON:ci$1,DEFAULT_DEPTH:nn$2,EMPTY_SPACE:Se$1,ENV_MAP:et$2,INTERNAL_ERRORS:ws,LimitedSet:ki$1,MemoryStore:hu,ONE_THOUSAND:fi$1,REACT_NATIVE_PRODUCT:dr$1,RELAYER_DEFAULT_PROTOCOL:ss,SDK_ERRORS:ms,SDK_TYPE:pr$1,SLASH:hr$1,TYPE_0:Mn$1,TYPE_1:ie,TYPE_2:we$1,UTF8:se,addResourceToRecap:fo$1,addSignatureToExtrinsic:Ls$1,appendToQueryString:gr$1,assertType:bi$1,assignAbilityToActions:yn$1,base64Decode:io$1,base64Encode:so$1,buildApprovedNamespaces:Ma,buildAuthObject:Hc,buildNamespacesFromAuth:Ka,buildRecapStatement:uo$1,buildSignedExtrinsicHash:mu,calcExpiry:Ni$1,capitalize:Ei$1,capitalizeWord:Er$1,createDelayedPromise:Bi$1,createEncodedRecap:Kc,createExpiringPromise:Ai$1,createLogger:wu,createRecap:co$1,decodeRecap:kt$1,decodeTypeByte:Zt$2,decodeTypeTwoEnvelope:ma,decrypt:ba,deriveExtrinsicHash:ks$1,deriveSymKey:da,deserialize:ze,encodeRecap:Ce,encodeTypeByte:qn$1,encodeTypeTwoEnvelope:ya,encrypt:ga,engineEvent:_i$1,enumify:xi$1,extractSolanaTransactionId:Sc,formatAccountId:sr,formatAccountWithChain:Ws,formatChainId:or$1,formatDeeplinkUrl:Br$1,formatExpirerTarget:on$1,formatIdTarget:Si$1,formatMessage:eo$1,formatMessageContext:yi$1,formatRelayParams:us,formatRelayRpcUrl:pi$1,formatStatementFromRecap:wn$1,formatTopicTarget:Ii$1,formatUA:wr$1,formatUri:$a,fromBase64:cn$1,generateKeyPair:ua,generateRandomBytes32:la,getAccountsChains:Gt$2,getAccountsFromNamespaces:Js,getAddressFromAccount:ir$1,getAddressesFromAccounts:Xs,getAlgorandTransactionId:Uc,getAppId:li$1,getAppMetadata:br$1,getBrowserOnlineStatus:_s,getChainFromAccount:cr$1,getChainsFromAccounts:fr$1,getChainsFromNamespace:Ie,getChainsFromNamespaces:Qs$1,getChainsFromRecap:Zc,getChainsFromRequiredNamespaces:ti$1,getCommonValuesInArrays:sn$2,getCryptoKeyFromKeyData:os,getDecodedRecapFromResources:no$1,getDeepLink:$i$1,getDidAddress:bn$1,getDidAddressSegments:Te,getDidChainId:Qr$1,getEnvironment:Vt$2,getHttpUrl:gi$1,getInternalError:Bt$2,getJavascriptID:mr$1,getJavascriptOS:yr$1,getLastItems:xr$1,getLinkModeURL:Ta,getMethodsFromRecap:Fc,getNamespacedDidChainId:to$1,getNamespacesChains:hs,getNamespacesEventsForChainId:gs,getNamespacesFromAccounts:ys,getNamespacesMethodsForChainId:ps,getNearTransactionIdFromSignedTransaction:Nc,getNearUint8ArrayFromBytes:Yr$1,getNodeOnlineStatus:$s$1,getReCapActions:oo$1,getReactNativeOnlineStatus:Rs$1,getRecapAbilitiesFromResource:Mc,getRecapFromResources:je,getRecapResource:ro$1,getRelayClientMetadata:hi$1,getRelayProtocolApi:Aa,getRelayProtocolName:Ba,getRequiredNamespacesFromNamespaces:Va,getSdkError:zt$2,getSearchParamFromURL:Ti$1,getSignDirectHash:_c,getSuiDigest:Oc,getUniqueValues:tn$2,getWalletSendCallsHashes:Rc,handleDeeplinkRedirect:Ri$1,hasOverlap:It$3,hashEthereumMessage:hn$1,hashKey:ha,hashMessage:pa,isAndroid:ai$1,isAppVisible:du,isBrowser:Wt$2,isCaipNamespace:Gn$1,isConformingNamespaces:Ns$1,isExpired:Ui$1,isIframe:Sr$1,isIos:ui$1,isNode:rn$2,isOnline:uu,isProposalStruct:Ga,isReactNative:At$2,isRecap:mn$1,isSessionCompatible:Fa,isSessionStruct:za,isTelegram:Ir$1,isTestRun:ji$1,isTypeOneEnvelope:va,isTypeTwoEnvelope:xa,isUndefined:Dt$1,isValidAccountId:vs$1,isValidAccounts:Bs,isValidActions:Is$1,isValidArray:Ee,isValidChainId:Be$1,isValidChains:xs$1,isValidController:Ya,isValidEip1271Signature:zr$1,isValidEip191Signature:Gr$1,isValidErrorReason:tu,isValidEvent:ru,isValidId:Ja,isValidNamespaceAccounts:As$1,isValidNamespaceActions:Yn$1,isValidNamespaceChains:Es,isValidNamespaceMethodsOrEvents:zn$1,isValidNamespaces:Ss$1,isValidNamespacesChainId:ou,isValidNamespacesEvent:iu,isValidNamespacesRequest:su,isValidNumber:We$1,isValidObject:Ye$1,isValidParams:Qa,isValidRecap:yt$1,isValidRelay:Os$1,isValidRelays:Xa,isValidRequest:eu,isValidRequestExpiry:au,isValidRequiredNamespaces:Wa,isValidResponse:nu,isValidString:ft$2,isValidUrl:Za,mapEntries:vi$1,mapToObj:mi$1,mergeArrays:ut$2,mergeEncodedRecaps:qc,mergeRecaps:ao$1,mergeRequiredAndOptionalNamespaces:qa,normalizeNamespaces:xe,objToMap:wi$1,openDeeplink:Ar$1,parseAccountId:Qe$1,parseChainId:Je$1,parseContextNames:vr$1,parseExpirerTarget:Oi$1,parseNamespaceKey:bs$1,parseRelayParams:fs,parseTopic:as,parseUri:Ra,populateAppMetadata:di$1,populateAuthPayload:Dc,recapHasResource:Vc,serialize:Fn$1,sleep:Li$1,ss58AddressToPublicKey:js$1,subscribeToBrowserNetworkChange:Ts$1,subscribeToNetworkChange:lu,subscribeToReactNativeNetworkChange:Cs$1,toBase64:Or$1,uuidv4:Ci$1,validateDecoding:wa,validateEncoding:rs,validateSignedCacao:Pc,verifyP256Jwt:Ea,verifySignature:Zr$1},Symbol.toStringTag,{value:"Module"})),PARSE_ERROR="PARSE_ERROR",INVALID_REQUEST="INVALID_REQUEST",METHOD_NOT_FOUND="METHOD_NOT_FOUND",INVALID_PARAMS="INVALID_PARAMS",INTERNAL_ERROR="INTERNAL_ERROR",SERVER_ERROR="SERVER_ERROR",RESERVED_ERROR_CODES=[-32700,-32600,-32601,-32602,-32603],STANDARD_ERROR_MAP={[PARSE_ERROR]:{code:-32700,message:"Parse error"},[INVALID_REQUEST]:{code:-32600,message:"Invalid Request"},[METHOD_NOT_FOUND]:{code:-32601,message:"Method not found"},[INVALID_PARAMS]:{code:-32602,message:"Invalid params"},[INTERNAL_ERROR]:{code:-32603,message:"Internal error"},[SERVER_ERROR]:{code:-32e3,message:"Server error"}},DEFAULT_ERROR=SERVER_ERROR;function isReservedErrorCode(Z){return RESERVED_ERROR_CODES.includes(Z)}function getError(Z){return Object.keys(STANDARD_ERROR_MAP).includes(Z)?STANDARD_ERROR_MAP[Z]:STANDARD_ERROR_MAP[DEFAULT_ERROR]}function getErrorByCode(Z){const t=Object.values(STANDARD_ERROR_MAP).find(Hs=>Hs.code===Z);return t||STANDARD_ERROR_MAP[DEFAULT_ERROR]}function parseConnectionError(Z,t,Hs){return Z.message.includes("getaddrinfo ENOTFOUND")||Z.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${Hs} RPC url at ${t}`):Z}var cjs={},crypto$1={},hasRequiredCrypto;function requireCrypto(){if(hasRequiredCrypto)return crypto$1;hasRequiredCrypto=1,Object.defineProperty(crypto$1,"__esModule",{value:!0}),crypto$1.isBrowserCryptoAvailable=crypto$1.getSubtleCrypto=crypto$1.getBrowerCrypto=void 0;function Z(){return(globalThis==null?void 0:globalThis.crypto)||(globalThis==null?void 0:globalThis.msCrypto)||{}}crypto$1.getBrowerCrypto=Z;function t(){const zs=Z();return zs.subtle||zs.webkitSubtle}crypto$1.getSubtleCrypto=t;function Hs(){return!!Z()&&!!t()}return crypto$1.isBrowserCryptoAvailable=Hs,crypto$1}var env={},hasRequiredEnv;function requireEnv(){if(hasRequiredEnv)return env;hasRequiredEnv=1,Object.defineProperty(env,"__esModule",{value:!0}),env.isBrowser=env.isNode=env.isReactNative=void 0;function Z(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}env.isReactNative=Z;function t(){return typeof process$1<"u"&&typeof process$1.versions<"u"&&typeof process$1.versions.node<"u"}env.isNode=t;function Hs(){return!Z()&&!t()}return env.isBrowser=Hs,env}(function(Z){Object.defineProperty(Z,"__esModule",{value:!0});const t=require$$0;t.__exportStar(requireCrypto(),Z),t.__exportStar(requireEnv(),Z)})(cjs);function payloadId(Z=3){const t=Date.now()*Math.pow(10,Z),Hs=Math.floor(Math.random()*Math.pow(10,Z));return t+Hs}function getBigIntRpcId(Z=6){return BigInt(payloadId(Z))}function formatJsonRpcRequest(Z,t,Hs){return{id:Hs||payloadId(),jsonrpc:"2.0",method:Z,params:t}}function formatJsonRpcResult(Z,t){return{id:Z,jsonrpc:"2.0",result:t}}function formatJsonRpcError(Z,t,Hs){return{id:Z,jsonrpc:"2.0",error:formatErrorMessage(t,Hs)}}function formatErrorMessage(Z,t){return typeof Z>"u"?getError(INTERNAL_ERROR):(typeof Z=="string"&&(Z=Object.assign(Object.assign({},getError(SERVER_ERROR)),{message:Z})),typeof t<"u"&&(Z.data=t),isReservedErrorCode(Z.code)&&(Z=getErrorByCode(Z.code)),Z)}class e{}class n extends e{constructor(){super()}}class r extends n{constructor(t){super()}}const WS_REGEX="^wss?:";function getUrlProtocol(Z){const t=Z.match(new RegExp(/^\w+:/,"gi"));if(!(!t||!t.length))return t[0]}function matchRegexProtocol(Z,t){const Hs=getUrlProtocol(Z);return typeof Hs>"u"?!1:new RegExp(t).test(Hs)}function isWsUrl(Z){return matchRegexProtocol(Z,WS_REGEX)}function isLocalhostUrl(Z){return new RegExp("wss?://localhost(:d{2,5})?").test(Z)}function isJsonRpcPayload(Z){return typeof Z=="object"&&"id"in Z&&"jsonrpc"in Z&&Z.jsonrpc==="2.0"}function isJsonRpcRequest(Z){return isJsonRpcPayload(Z)&&"method"in Z}function isJsonRpcResponse(Z){return isJsonRpcPayload(Z)&&(isJsonRpcResult(Z)||isJsonRpcError(Z))}function isJsonRpcResult(Z){return"result"in Z}function isJsonRpcError(Z){return"error"in Z}class o extends r{constructor(t){super(t),this.events=new eventsExports.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,Hs){this.events.on(t,Hs)}once(t,Hs){this.events.once(t,Hs)}off(t,Hs){this.events.off(t,Hs)}removeListener(t,Hs){this.events.removeListener(t,Hs)}async request(t,Hs){return this.requestStrict(formatJsonRpcRequest(t.method,t.params||[],t.id||getBigIntRpcId().toString()),Hs)}async requestStrict(t,Hs){return new Promise(async(zs,Ys)=>{if(!this.connection.connected)try{await this.open()}catch(Zs){Ys(Zs)}this.events.on(`${t.id}`,Zs=>{isJsonRpcError(Zs)?Ys(Zs.error):zs(Zs.result)});try{await this.connection.send(t,Hs)}catch(Zs){Ys(Zs)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),isJsonRpcResponse(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const v$3=()=>typeof WebSocket<"u"?WebSocket:typeof globalThis<"u"&&typeof globalThis.WebSocket<"u"?globalThis.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),w=()=>typeof WebSocket<"u"||typeof globalThis<"u"&&typeof globalThis.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",d$1=Z=>Z.split("?")[0],h=10,b=v$3();let f$2=class{constructor(t){if(this.url=t,this.events=new eventsExports.EventEmitter,this.registering=!1,!isWsUrl(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,Hs){this.events.on(t,Hs)}once(t,Hs){this.events.once(t,Hs)}off(t,Hs){this.events.off(t,Hs)}removeListener(t,Hs){this.events.removeListener(t,Hs)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,Hs)=>{if(typeof this.socket>"u"){Hs(new Error("Connection already closed"));return}this.socket.onclose=zs=>{this.onClose(zs),t()},this.socket.close()})}async send(t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(safeJsonStringify(t))}catch(Hs){this.onError(t.id,Hs)}}register(t=this.url){if(!isWsUrl(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const Hs=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=Hs||this.events.listenerCount("open")>=Hs)&&this.events.setMaxListeners(Hs+1),new Promise((zs,Ys)=>{this.events.once("register_error",Zs=>{this.resetMaxListeners(),Ys(Zs)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return Ys(new Error("WebSocket connection is missing or invalid"));zs(this.socket)})})}return this.url=t,this.registering=!0,new Promise((Hs,zs)=>{const Ys=cjs.isReactNative()?void 0:{rejectUnauthorized:!isLocalhostUrl(t)},Zs=new b(t,[],Ys);w()?Zs.onerror=_u=>{const Eu=_u;zs(this.emitError(Eu.error))}:Zs.on("error",_u=>{zs(this.emitError(_u))}),Zs.onopen=()=>{this.onOpen(Zs),Hs(Zs)}})}onOpen(t){t.onmessage=Hs=>this.onPayload(Hs),t.onclose=Hs=>this.onClose(Hs),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const Hs=typeof t.data=="string"?safeJsonParse(t.data):t.data;this.events.emit("payload",Hs)}onError(t,Hs){const zs=this.parseError(Hs),Ys=zs.message||zs.toString(),Zs=formatJsonRpcError(t,Ys);this.events.emit("payload",Zs)}parseError(t,Hs=this.url){return parseConnectionError(t,d$1(Hs),"WS")}resetMaxListeners(){this.events.getMaxListeners()>h&&this.events.setMaxListeners(h)}emitError(t){const Hs=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${d$1(this.url)}`));return this.events.emit("register_error",Hs),Hs}};const Ue="wc",Fe=2,ge="core",W$1=`${Ue}@2:${ge}:`,Et$2={name:ge,logger:"error"},It$2={database:":memory:"},Tt$1="crypto",Me$1="client_ed25519_seed",Ct$1=cjs$3.ONE_DAY,Pt$1="keychain",St$2="0.3",Ot="messages",Rt$2="0.3",At$1=cjs$3.SIX_HOURS,xt="publisher",Nt="irn",$t$1="error",Ke$1="wss://relay.walletconnect.org",zt$1="relayer",C$1={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Lt$1="_subscription",M$1={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},kt=.1,Pe="2.22.4",ee={link_mode:"link_mode",relay:"relay"},ye={inbound:"inbound",outbound:"outbound"},jt$1="0.3",Ut$1="WALLETCONNECT_CLIENT_ID",Be="WALLETCONNECT_LINK_MODE_APPS",j={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Ft="subscription",Mt="0.3",Kt="pairing",Bt$1="0.3",oe={wc_pairingDelete:{req:{ttl:cjs$3.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:cjs$3.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:cjs$3.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:cjs$3.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:cjs$3.ONE_DAY,prompt:!1,tag:0},res:{ttl:cjs$3.ONE_DAY,prompt:!1,tag:0}}},ae={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},V={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Vt$1="history",qt="0.3",Gt$1="expirer",q={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Wt$1="0.3",Ht$2="verify-api",ir="https://verify.walletconnect.com",Yt$1="https://verify.walletconnect.org",be=Yt$1,Jt$1=`${be}/v3`,Xt$1=[ir,Yt$1],Zt$1="echo",Qt$1="https://echo.walletconnect.com",Y={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},X={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},rr={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success",session_request_response_started:"session_request_response_started",session_request_response_validation_success:"session_request_response_validation_success",session_request_response_publish_started:"session_request_response_publish_started"},nr={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found",session_request_response_validation_failure:"session_request_response_validation_failure",session_request_response_publish_failure:"session_request_response_publish_failure"},or={authenticated_session_approve_started:"authenticated_session_approve_started",authenticated_session_not_expired:"authenticated_session_not_expired",chains_caip2_compliant:"chains_caip2_compliant",chains_evm_compliant:"chains_evm_compliant",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve",authenticated_session_approve_publish_success:"authenticated_session_approve_publish_success"},ar={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",missing_session_authenticate_request:"missing_session_authenticate_request",session_authenticate_request_expired:"session_authenticate_request_expired",chains_caip2_compliant_failure:"chains_caip2_compliant_failure",chains_evm_compliant_failure:"chains_evm_compliant_failure",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},ei=.1,ti="event-client",ii=86400,si="https://pulse.walletconnect.org/batch";function cr(Z,t){if(Z.length>=255)throw new TypeError("Alphabet too long");for(var Hs=new Uint8Array(256),zs=0;zs<Hs.length;zs++)Hs[zs]=255;for(var Ys=0;Ys<Z.length;Ys++){var Zs=Z.charAt(Ys),_u=Zs.charCodeAt(0);if(Hs[_u]!==255)throw new TypeError(Zs+" is ambiguous");Hs[_u]=Ys}var Eu=Z.length,Iu=Z.charAt(0),Au=Math.log(Eu)/Math.log(256),$u=Math.log(256)/Math.log(Eu);function vu(Pu){if(Pu instanceof Uint8Array||(ArrayBuffer.isView(Pu)?Pu=new Uint8Array(Pu.buffer,Pu.byteOffset,Pu.byteLength):Array.isArray(Pu)&&(Pu=Uint8Array.from(Pu))),!(Pu instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(Pu.length===0)return"";for(var Cu=0,Bu=0,Fu=0,zu=Pu.length;Fu!==zu&&Pu[Fu]===0;)Fu++,Cu++;for(var Hu=(zu-Fu)*$u+1>>>0,Wu=new Uint8Array(Hu);Fu!==zu;){for(var tl=Pu[Fu],Xu=0,ju=Hu-1;(tl!==0||Xu<Bu)&&ju!==-1;ju--,Xu++)tl+=256*Wu[ju]>>>0,Wu[ju]=tl%Eu>>>0,tl=tl/Eu>>>0;if(tl!==0)throw new Error("Non-zero carry");Bu=Xu,Fu++}for(var ku=Hu-Bu;ku!==Hu&&Wu[ku]===0;)ku++;for(var Uu=Iu.repeat(Cu);ku<Hu;++ku)Uu+=Z.charAt(Wu[ku]);return Uu}function Su(Pu){if(typeof Pu!="string")throw new TypeError("Expected String");if(Pu.length===0)return new Uint8Array;var Cu=0;if(Pu[Cu]!==" "){for(var Bu=0,Fu=0;Pu[Cu]===Iu;)Bu++,Cu++;for(var zu=(Pu.length-Cu)*Au+1>>>0,Hu=new Uint8Array(zu);Pu[Cu];){var Wu=Hs[Pu.charCodeAt(Cu)];if(Wu===255)return;for(var tl=0,Xu=zu-1;(Wu!==0||tl<Fu)&&Xu!==-1;Xu--,tl++)Wu+=Eu*Hu[Xu]>>>0,Hu[Xu]=Wu%256>>>0,Wu=Wu/256>>>0;if(Wu!==0)throw new Error("Non-zero carry");Fu=tl,Cu++}if(Pu[Cu]!==" "){for(var ju=zu-Fu;ju!==zu&&Hu[ju]===0;)ju++;for(var ku=new Uint8Array(Bu+(zu-ju)),Uu=Bu;ju!==zu;)ku[Uu++]=Hu[ju++];return ku}}}function Ru(Pu){var Cu=Su(Pu);if(Cu)return Cu;throw new Error(`Non-${t} character`)}return{encode:vu,decodeUnsafe:Su,decode:Ru}}var hr=cr,lr=hr;const ri=Z=>{if(Z instanceof Uint8Array&&Z.constructor.name==="Uint8Array")return Z;if(Z instanceof ArrayBuffer)return new Uint8Array(Z);if(ArrayBuffer.isView(Z))return new Uint8Array(Z.buffer,Z.byteOffset,Z.byteLength);throw new Error("Unknown type, must be binary type")},ur=Z=>new TextEncoder().encode(Z),dr=Z=>new TextDecoder().decode(Z);class pr{constructor(t,Hs,zs){this.name=t,this.prefix=Hs,this.baseEncode=zs}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class gr{constructor(t,Hs,zs){if(this.name=t,this.prefix=Hs,Hs.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=Hs.codePointAt(0),this.baseDecode=zs}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return ni(this,t)}}class yr{constructor(t){this.decoders=t}or(t){return ni(this,t)}decode(t){const Hs=t[0],zs=this.decoders[Hs];if(zs)return zs.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ni=(Z,t)=>new yr({...Z.decoders||{[Z.prefix]:Z},...t.decoders||{[t.prefix]:t}});class br{constructor(t,Hs,zs,Ys){this.name=t,this.prefix=Hs,this.baseEncode=zs,this.baseDecode=Ys,this.encoder=new pr(t,Hs,zs),this.decoder=new gr(t,Hs,Ys)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const Se=({name:Z,prefix:t,encode:Hs,decode:zs})=>new br(Z,t,Hs,zs),me$1=({prefix:Z,name:t,alphabet:Hs})=>{const{encode:zs,decode:Ys}=lr(Hs,t);return Se({prefix:Z,name:t,encode:zs,decode:Zs=>ri(Ys(Zs))})},mr=(Z,t,Hs,zs)=>{const Ys={};for(let $u=0;$u<t.length;++$u)Ys[t[$u]]=$u;let Zs=Z.length;for(;Z[Zs-1]==="=";)--Zs;const _u=new Uint8Array(Zs*Hs/8|0);let Eu=0,Iu=0,Au=0;for(let $u=0;$u<Zs;++$u){const vu=Ys[Z[$u]];if(vu===void 0)throw new SyntaxError(`Non-${zs} character`);Iu=Iu<<Hs|vu,Eu+=Hs,Eu>=8&&(Eu-=8,_u[Au++]=255&Iu>>Eu)}if(Eu>=Hs||255&Iu<<8-Eu)throw new SyntaxError("Unexpected end of data");return _u},fr=(Z,t,Hs)=>{const zs=t[t.length-1]==="=",Ys=(1<<Hs)-1;let Zs="",_u=0,Eu=0;for(let Iu=0;Iu<Z.length;++Iu)for(Eu=Eu<<8|Z[Iu],_u+=8;_u>Hs;)_u-=Hs,Zs+=t[Ys&Eu>>_u];if(_u&&(Zs+=t[Ys&Eu<<Hs-_u]),zs)for(;Zs.length*Hs&7;)Zs+="=";return Zs},x$1=({name:Z,prefix:t,bitsPerChar:Hs,alphabet:zs})=>Se({prefix:t,name:Z,encode(Ys){return fr(Ys,zs,Hs)},decode(Ys){return mr(Ys,zs,Hs,Z)}}),Dr=Se({prefix:"\0",name:"identity",encode:Z=>dr(Z),decode:Z=>ur(Z)});var vr=Object.freeze({__proto__:null,identity:Dr});const _r=x$1({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var wr=Object.freeze({__proto__:null,base2:_r});const Er=x$1({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Ir=Object.freeze({__proto__:null,base8:Er});const Tr=me$1({prefix:"9",name:"base10",alphabet:"0123456789"});var Cr=Object.freeze({__proto__:null,base10:Tr});const Pr=x$1({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Sr=x$1({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Or=Object.freeze({__proto__:null,base16:Pr,base16upper:Sr});const Rr=x$1({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ar=x$1({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),xr=x$1({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Nr=x$1({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),$r=x$1({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),zr=x$1({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Lr=x$1({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),kr=x$1({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),jr=x$1({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Ur=Object.freeze({__proto__:null,base32:Rr,base32upper:Ar,base32pad:xr,base32padupper:Nr,base32hex:$r,base32hexupper:zr,base32hexpad:Lr,base32hexpadupper:kr,base32z:jr});const Fr=me$1({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Mr=me$1({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Kr=Object.freeze({__proto__:null,base36:Fr,base36upper:Mr});const Br=me$1({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Vr=me$1({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var qr=Object.freeze({__proto__:null,base58btc:Br,base58flickr:Vr});const Gr=x$1({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Wr=x$1({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Hr=x$1({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Yr=x$1({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Jr=Object.freeze({__proto__:null,base64:Gr,base64pad:Wr,base64url:Hr,base64urlpad:Yr});const oi=Array.from(""),Xr=oi.reduce((Z,t,Hs)=>(Z[Hs]=t,Z),[]),Zr=oi.reduce((Z,t,Hs)=>(Z[t.codePointAt(0)]=Hs,Z),[]);function Qr(Z){return Z.reduce((t,Hs)=>(t+=Xr[Hs],t),"")}function en$1(Z){const t=[];for(const Hs of Z){const zs=Zr[Hs.codePointAt(0)];if(zs===void 0)throw new Error(`Non-base256emoji character: ${Hs}`);t.push(zs)}return new Uint8Array(t)}const tn$1=Se({prefix:"",name:"base256emoji",encode:Qr,decode:en$1});var sn$1=Object.freeze({__proto__:null,base256emoji:tn$1}),rn$1=ci,ai=128,nn$1=127,on=~nn$1,an$1=Math.pow(2,31);function ci(Z,t,Hs){t=t||[],Hs=Hs||0;for(var zs=Hs;Z>=an$1;)t[Hs++]=Z&255|ai,Z/=128;for(;Z&on;)t[Hs++]=Z&255|ai,Z>>>=7;return t[Hs]=Z|0,ci.bytes=Hs-zs+1,t}var cn=Ve$1,hn=128,hi=127;function Ve$1(Z,zs){var Hs=0,zs=zs||0,Ys=0,Zs=zs,_u,Eu=Z.length;do{if(Zs>=Eu)throw Ve$1.bytes=0,new RangeError("Could not decode varint");_u=Z[Zs++],Hs+=Ys<28?(_u&hi)<<Ys:(_u&hi)*Math.pow(2,Ys),Ys+=7}while(_u>=hn);return Ve$1.bytes=Zs-zs,Hs}var ln=Math.pow(2,7),un=Math.pow(2,14),dn=Math.pow(2,21),pn=Math.pow(2,28),gn=Math.pow(2,35),yn=Math.pow(2,42),bn=Math.pow(2,49),mn=Math.pow(2,56),fn=Math.pow(2,63),Dn=function(Z){return Z<ln?1:Z<un?2:Z<dn?3:Z<pn?4:Z<gn?5:Z<yn?6:Z<bn?7:Z<mn?8:Z<fn?9:10},vn={encode:rn$1,decode:cn,encodingLength:Dn},li=vn;const ui=(Z,t,Hs=0)=>(li.encode(Z,t,Hs),t),di=Z=>li.encodingLength(Z),qe=(Z,t)=>{const Hs=t.byteLength,zs=di(Z),Ys=zs+di(Hs),Zs=new Uint8Array(Ys+Hs);return ui(Z,Zs,0),ui(Hs,Zs,zs),Zs.set(t,Ys),new _n$1(Z,Hs,t,Zs)};let _n$1=class{constructor(t,Hs,zs,Ys){this.code=t,this.size=Hs,this.digest=zs,this.bytes=Ys}};const pi=({name:Z,code:t,encode:Hs})=>new wn(Z,t,Hs);class wn{constructor(t,Hs,zs){this.name=t,this.code=Hs,this.encode=zs}digest(t){if(t instanceof Uint8Array){const Hs=this.encode(t);return Hs instanceof Uint8Array?qe(this.code,Hs):Hs.then(zs=>qe(this.code,zs))}else throw Error("Unknown type, must be binary type")}}const gi=Z=>async t=>new Uint8Array(await crypto.subtle.digest(Z,t)),En=pi({name:"sha2-256",code:18,encode:gi("SHA-256")}),In=pi({name:"sha2-512",code:19,encode:gi("SHA-512")});var Tn=Object.freeze({__proto__:null,sha256:En,sha512:In});const yi=0,Cn="identity",bi=ri,Pn=Z=>qe(yi,bi(Z)),Sn={code:yi,name:Cn,encode:bi,digest:Pn};var On=Object.freeze({__proto__:null,identity:Sn});new TextEncoder,new TextDecoder;const mi={...vr,...wr,...Ir,...Cr,...Or,...Ur,...Kr,...qr,...Jr,...sn$1};({...Tn,...On});function fi(Z){return globalThis.Buffer!=null?new Uint8Array(Z.buffer,Z.byteOffset,Z.byteLength):Z}function Rn(Z=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?fi(globalThis.Buffer.allocUnsafe(Z)):new Uint8Array(Z)}function Di(Z,t,Hs,zs){return{name:Z,prefix:t,encoder:{name:Z,prefix:t,encode:Hs},decoder:{decode:zs}}}const vi=Di("utf8","u",Z=>"u"+new TextDecoder("utf8").decode(Z),Z=>new TextEncoder().encode(Z.substring(1))),Ge=Di("ascii","a",Z=>{let t="a";for(let Hs=0;Hs<Z.length;Hs++)t+=String.fromCharCode(Z[Hs]);return t},Z=>{Z=Z.substring(1);const t=Rn(Z.length);for(let Hs=0;Hs<Z.length;Hs++)t[Hs]=Z.charCodeAt(Hs);return t}),An={utf8:vi,"utf-8":vi,hex:mi.base16,latin1:Ge,ascii:Ge,binary:Ge,...mi};function xn(Z,t="utf8"){const Hs=An[t];if(!Hs)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?fi(globalThis.Buffer.from(Z,"utf-8")):Hs.decoder.decode(`${Hs.prefix}${Z}`)}var Nn=Object.defineProperty,$n=(Z,t,Hs)=>t in Z?Nn(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,J=(Z,t,Hs)=>$n(Z,typeof t!="symbol"?t+"":t,Hs);class _i{constructor(t,Hs){this.core=t,this.logger=Hs,J(this,"keychain",new Map),J(this,"name",Pt$1),J(this,"version",St$2),J(this,"initialized",!1),J(this,"storagePrefix",W$1),J(this,"init",async()=>{if(!this.initialized){const zs=await this.getKeyChain();typeof zs<"u"&&(this.keychain=zs),this.initialized=!0}}),J(this,"has",zs=>(this.isInitialized(),this.keychain.has(zs))),J(this,"set",async(zs,Ys)=>{this.isInitialized(),this.keychain.set(zs,Ys),await this.persist()}),J(this,"get",zs=>{this.isInitialized();const Ys=this.keychain.get(zs);if(typeof Ys>"u"){const{message:Zs}=Bt$2("NO_MATCHING_KEY",`${this.name}: ${zs}`);throw new Error(Zs)}return Ys}),J(this,"del",async zs=>{this.isInitialized(),this.keychain.delete(zs),await this.persist()}),this.core=t,this.logger=X$2(Hs,this.name)}get context(){return w$1(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,mi$1(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?wi$1(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=Bt$2("NOT_INITIALIZED",this.name);throw new Error(t)}}}var zn=Object.defineProperty,Ln=(Z,t,Hs)=>t in Z?zn(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,R$1=(Z,t,Hs)=>Ln(Z,typeof t!="symbol"?t+"":t,Hs);class wi{constructor(t,Hs,zs){this.core=t,this.logger=Hs,R$1(this,"name",Tt$1),R$1(this,"keychain"),R$1(this,"randomSessionIdentifier",la()),R$1(this,"initialized",!1),R$1(this,"clientId"),R$1(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),R$1(this,"hasKeys",Ys=>(this.isInitialized(),this.keychain.has(Ys))),R$1(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;const Ys=await this.getClientSeed(),Zs=Po$2(Ys),_u=Qe$2(Zs.publicKey);return this.clientId=_u,_u}),R$1(this,"generateKeyPair",()=>{this.isInitialized();const Ys=ua();return this.setPrivateKey(Ys.publicKey,Ys.privateKey)}),R$1(this,"signJWT",async Ys=>{this.isInitialized();const Zs=await this.getClientSeed(),_u=Po$2(Zs),Eu=this.randomSessionIdentifier;return await Qo$2(Eu,Ys,Ct$1,_u)}),R$1(this,"generateSharedKey",(Ys,Zs,_u)=>{this.isInitialized();const Eu=this.getPrivateKey(Ys),Iu=da(Eu,Zs);return this.setSymKey(Iu,_u)}),R$1(this,"setSymKey",async(Ys,Zs)=>{this.isInitialized();const _u=Zs||ha(Ys);return await this.keychain.set(_u,Ys),_u}),R$1(this,"deleteKeyPair",async Ys=>{this.isInitialized(),await this.keychain.del(Ys)}),R$1(this,"deleteSymKey",async Ys=>{this.isInitialized(),await this.keychain.del(Ys)}),R$1(this,"encode",async(Ys,Zs,_u)=>{this.isInitialized();const Eu=rs(_u),Iu=safeJsonStringify(Zs);if(xa(Eu))return ya(Iu,_u==null?void 0:_u.encoding);if(va(Eu)){const Su=Eu.senderPublicKey,Ru=Eu.receiverPublicKey;Ys=await this.generateSharedKey(Su,Ru)}const Au=this.getSymKey(Ys),{type:$u,senderPublicKey:vu}=Eu;return ga({type:$u,symKey:Au,message:Iu,senderPublicKey:vu,encoding:_u==null?void 0:_u.encoding})}),R$1(this,"decode",async(Ys,Zs,_u)=>{this.isInitialized();const Eu=wa(Zs,_u);if(xa(Eu)){const Iu=ma(Zs,_u==null?void 0:_u.encoding);return safeJsonParse(Iu)}if(va(Eu)){const Iu=Eu.receiverPublicKey,Au=Eu.senderPublicKey;Ys=await this.generateSharedKey(Iu,Au)}try{const Iu=this.getSymKey(Ys),Au=ba({symKey:Iu,encoded:Zs,encoding:_u==null?void 0:_u.encoding});return safeJsonParse(Au)}catch(Iu){this.logger.error(`Failed to decode message from topic: '${Ys}', clientId: '${await this.getClientId()}'`),this.logger.error(Iu)}}),R$1(this,"getPayloadType",(Ys,Zs=oe$1)=>{const _u=ze({encoded:Ys,encoding:Zs});return Zt$2(_u.type)}),R$1(this,"getPayloadSenderPublicKey",(Ys,Zs=oe$1)=>{const _u=ze({encoded:Ys,encoding:Zs});return _u.senderPublicKey?toString(_u.senderPublicKey,rt$1):void 0}),this.core=t,this.logger=X$2(Hs,this.name),this.keychain=zs||new _i(this.core,this.logger)}get context(){return w$1(this.logger)}async setPrivateKey(t,Hs){return await this.keychain.set(t,Hs),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(Me$1)}catch{t=la(),await this.keychain.set(Me$1,t)}return xn(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=Bt$2("NOT_INITIALIZED",this.name);throw new Error(t)}}}var kn=Object.defineProperty,jn=Object.defineProperties,Un=Object.getOwnPropertyDescriptors,Ei=Object.getOwnPropertySymbols,Fn=Object.prototype.hasOwnProperty,Mn=Object.prototype.propertyIsEnumerable,We=(Z,t,Hs)=>t in Z?kn(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,Kn=(Z,t)=>{for(var Hs in t||(t={}))Fn.call(t,Hs)&&We(Z,Hs,t[Hs]);if(Ei)for(var Hs of Ei(t))Mn.call(t,Hs)&&We(Z,Hs,t[Hs]);return Z},Bn=(Z,t)=>jn(Z,Un(t)),K=(Z,t,Hs)=>We(Z,typeof t!="symbol"?t+"":t,Hs);class Ii extends y{constructor(t,Hs){super(t,Hs),this.logger=t,this.core=Hs,K(this,"messages",new Map),K(this,"messagesWithoutClientAck",new Map),K(this,"name",Ot),K(this,"version",Rt$2),K(this,"initialized",!1),K(this,"storagePrefix",W$1),K(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const zs=await this.getRelayerMessages();typeof zs<"u"&&(this.messages=zs);const Ys=await this.getRelayerMessagesWithoutClientAck();typeof Ys<"u"&&(this.messagesWithoutClientAck=Ys),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(zs){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(zs)}finally{this.initialized=!0}}}),K(this,"set",async(zs,Ys,Zs)=>{this.isInitialized();const _u=pa(Ys);let Eu=this.messages.get(zs);if(typeof Eu>"u"&&(Eu={}),typeof Eu[_u]<"u")return _u;if(Eu[_u]=Ys,this.messages.set(zs,Eu),Zs===ye.inbound){const Iu=this.messagesWithoutClientAck.get(zs)||{};this.messagesWithoutClientAck.set(zs,Bn(Kn({},Iu),{[_u]:Ys}))}return await this.persist(),_u}),K(this,"get",zs=>{this.isInitialized();let Ys=this.messages.get(zs);return typeof Ys>"u"&&(Ys={}),Ys}),K(this,"getWithoutAck",zs=>{this.isInitialized();const Ys={};for(const Zs of zs){const _u=this.messagesWithoutClientAck.get(Zs)||{};Ys[Zs]=Object.values(_u)}return Ys}),K(this,"has",(zs,Ys)=>{this.isInitialized();const Zs=this.get(zs),_u=pa(Ys);return typeof Zs[_u]<"u"}),K(this,"ack",async(zs,Ys)=>{this.isInitialized();const Zs=this.messagesWithoutClientAck.get(zs);if(typeof Zs>"u")return;const _u=pa(Ys);delete Zs[_u],Object.keys(Zs).length===0?this.messagesWithoutClientAck.delete(zs):this.messagesWithoutClientAck.set(zs,Zs),await this.persist()}),K(this,"del",async zs=>{this.isInitialized(),this.messages.delete(zs),this.messagesWithoutClientAck.delete(zs),await this.persist()}),this.logger=X$2(t,this.name),this.core=Hs}get context(){return w$1(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,mi$1(t))}async setRelayerMessagesWithoutClientAck(t){await this.core.storage.setItem(this.storageKeyWithoutClientAck,mi$1(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?wi$1(t):void 0}async getRelayerMessagesWithoutClientAck(){const t=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof t<"u"?wi$1(t):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:t}=Bt$2("NOT_INITIALIZED",this.name);throw new Error(t)}}}var Vn=Object.defineProperty,qn=Object.defineProperties,Gn=Object.getOwnPropertyDescriptors,Ti=Object.getOwnPropertySymbols,Wn=Object.prototype.hasOwnProperty,Hn=Object.prototype.propertyIsEnumerable,He=(Z,t,Hs)=>t in Z?Vn(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,ce=(Z,t)=>{for(var Hs in t||(t={}))Wn.call(t,Hs)&&He(Z,Hs,t[Hs]);if(Ti)for(var Hs of Ti(t))Hn.call(t,Hs)&&He(Z,Hs,t[Hs]);return Z},Ci=(Z,t)=>qn(Z,Gn(t)),G=(Z,t,Hs)=>He(Z,typeof t!="symbol"?t+"":t,Hs);class Yn extends m$3{constructor(t,Hs){super(t,Hs),this.relayer=t,this.logger=Hs,G(this,"events",new eventsExports.EventEmitter),G(this,"name",xt),G(this,"queue",new Map),G(this,"publishTimeout",cjs$3.toMiliseconds(cjs$3.ONE_MINUTE)),G(this,"initialPublishTimeout",cjs$3.toMiliseconds(cjs$3.ONE_SECOND*15)),G(this,"needsTransportRestart",!1),G(this,"publish",async(zs,Ys,Zs)=>{var _u,Eu,Iu,Au,$u;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:zs,message:Ys,opts:Zs}});const vu=(Zs==null?void 0:Zs.ttl)||At$1,Su=(Zs==null?void 0:Zs.prompt)||!1,Ru=(Zs==null?void 0:Zs.tag)||0,Pu=(Zs==null?void 0:Zs.id)||getBigIntRpcId().toString(),Cu=Aa(Ba().protocol),Bu={id:Pu,method:(Zs==null?void 0:Zs.publishMethod)||Cu.publish,params:ce({topic:zs,message:Ys,ttl:vu,prompt:Su,tag:Ru,attestation:Zs==null?void 0:Zs.attestation},Zs==null?void 0:Zs.tvf)},Fu=`Failed to publish payload, please try again. id:${Pu} tag:${Ru}`;try{Dt$1((_u=Bu.params)==null?void 0:_u.prompt)&&((Eu=Bu.params)==null||delete Eu.prompt),Dt$1((Iu=Bu.params)==null?void 0:Iu.tag)&&((Au=Bu.params)==null||delete Au.tag);const zu=new Promise(async Hu=>{const Wu=({id:Xu})=>{var ju;((ju=Bu.id)==null?void 0:ju.toString())===Xu.toString()&&(this.removeRequestFromQueue(Xu),this.relayer.events.removeListener(C$1.publish,Wu),Hu())};this.relayer.events.on(C$1.publish,Wu);const tl=Ai$1(new Promise((Xu,ju)=>{this.rpcPublish(Bu,Zs).then(Xu).catch(ku=>{this.logger.warn(ku,ku==null?void 0:ku.message),ju(ku)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${Pu} tag:${Ru}`);try{await tl,this.events.removeListener(C$1.publish,Wu)}catch(Xu){this.queue.set(Pu,{request:Bu,opts:Zs,attempt:1}),this.logger.warn(Xu,Xu==null?void 0:Xu.message)}});this.logger.trace({type:"method",method:"publish",params:{id:Pu,topic:zs,message:Ys,opts:Zs}}),await Ai$1(zu,this.publishTimeout,Fu)}catch(zu){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(zu),($u=Zs==null?void 0:Zs.internal)!=null&&$u.throwOnFailedPublish)throw zu}finally{this.queue.delete(Pu)}}),G(this,"publishCustom",async zs=>{var Ys,Zs,_u,Eu,Iu;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:zs});const{payload:Au,opts:$u={}}=zs,{attestation:vu,tvf:Su,publishMethod:Ru,prompt:Pu,tag:Cu,ttl:Bu=cjs$3.FIVE_MINUTES}=$u,Fu=$u.id||getBigIntRpcId().toString(),zu=Aa(Ba().protocol),Hu=Ru||zu.publish,Wu={id:Fu,method:Hu,params:ce(Ci(ce({},Au),{ttl:Bu,prompt:Pu,tag:Cu,attestation:vu}),Su)},tl=`Failed to publish custom payload, please try again. id:${Fu} tag:${Cu}`;try{Dt$1((Ys=Wu.params)==null?void 0:Ys.prompt)&&((Zs=Wu.params)==null||delete Zs.prompt),Dt$1((_u=Wu.params)==null?void 0:_u.tag)&&((Eu=Wu.params)==null||delete Eu.tag);const Xu=new Promise(async ju=>{const ku=({id:Gu})=>{var Yu;((Yu=Wu.id)==null?void 0:Yu.toString())===Gu.toString()&&(this.removeRequestFromQueue(Gu),this.relayer.events.removeListener(C$1.publish,ku),ju())};this.relayer.events.on(C$1.publish,ku);const Uu=Ai$1(new Promise((Gu,Yu)=>{this.rpcPublish(Wu,$u).then(Gu).catch(Qu=>{this.logger.warn(Qu,Qu==null?void 0:Qu.message),Yu(Qu)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${Hu} id:${Fu} tag:${Cu}`);try{await Uu,this.events.removeListener(C$1.publish,ku)}catch(Gu){this.queue.set(Fu,{request:Wu,opts:$u,attempt:1}),this.logger.warn(Gu,Gu==null?void 0:Gu.message)}});this.logger.trace({type:"method",method:"publish",params:{id:Fu,payload:Au,opts:$u}}),await Ai$1(Xu,this.publishTimeout,tl)}catch(Xu){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(Xu),(Iu=$u==null?void 0:$u.internal)!=null&&Iu.throwOnFailedPublish)throw Xu}finally{this.queue.delete(Fu)}}),G(this,"on",(zs,Ys)=>{this.events.on(zs,Ys)}),G(this,"once",(zs,Ys)=>{this.events.once(zs,Ys)}),G(this,"off",(zs,Ys)=>{this.events.off(zs,Ys)}),G(this,"removeListener",(zs,Ys)=>{this.events.removeListener(zs,Ys)}),this.relayer=t,this.logger=X$2(Hs,this.name),this.registerEventListeners()}get context(){return w$1(this.logger)}async rpcPublish(t,Hs){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:t});const zs=await this.relayer.request(t);return this.relayer.events.emit(C$1.publish,ce(ce({},t),Hs)),this.logger.debug("Successfully Published Payload"),zs}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async(t,Hs)=>{var zs;const Ys=t.attempt+1;this.queue.set(Hs,Ci(ce({},t),{attempt:Ys})),this.logger.warn({},`Publisher: queue->publishing: ${t.request.id}, tag: ${(zs=t.request.params)==null?void 0:zs.tag}, attempt: ${Ys}`),await this.rpcPublish(t.request,t.opts),this.logger.warn({},`Publisher: queue->published: ${t.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(r$1.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(C$1.connection_stalled);return}this.checkQueue()}),this.relayer.on(C$1.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}var Jn=Object.defineProperty,Xn=(Z,t,Hs)=>t in Z?Jn(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,he=(Z,t,Hs)=>Xn(Z,typeof t!="symbol"?t+"":t,Hs);class Zn{constructor(){he(this,"map",new Map),he(this,"set",(t,Hs)=>{const zs=this.get(t);this.exists(t,Hs)||this.map.set(t,[...zs,Hs])}),he(this,"get",t=>this.map.get(t)||[]),he(this,"exists",(t,Hs)=>this.get(t).includes(Hs)),he(this,"delete",(t,Hs)=>{if(typeof Hs>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const zs=this.get(t);if(!this.exists(t,Hs))return;const Ys=zs.filter(Zs=>Zs!==Hs);if(!Ys.length){this.map.delete(t);return}this.map.set(t,Ys)}),he(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var Qn=Object.defineProperty,eo=Object.defineProperties,to=Object.getOwnPropertyDescriptors,Pi=Object.getOwnPropertySymbols,io=Object.prototype.hasOwnProperty,so=Object.prototype.propertyIsEnumerable,Ye=(Z,t,Hs)=>t in Z?Qn(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,fe$1=(Z,t)=>{for(var Hs in t||(t={}))io.call(t,Hs)&&Ye(Z,Hs,t[Hs]);if(Pi)for(var Hs of Pi(t))so.call(t,Hs)&&Ye(Z,Hs,t[Hs]);return Z},Je=(Z,t)=>eo(Z,to(t)),f$1=(Z,t,Hs)=>Ye(Z,typeof t!="symbol"?t+"":t,Hs);class Si extends P$3{constructor(t,Hs){super(t,Hs),this.relayer=t,this.logger=Hs,f$1(this,"subscriptions",new Map),f$1(this,"topicMap",new Zn),f$1(this,"events",new eventsExports.EventEmitter),f$1(this,"name",Ft),f$1(this,"version",Mt),f$1(this,"pending",new Map),f$1(this,"cached",[]),f$1(this,"initialized",!1),f$1(this,"storagePrefix",W$1),f$1(this,"subscribeTimeout",cjs$3.toMiliseconds(cjs$3.ONE_MINUTE)),f$1(this,"initialSubscribeTimeout",cjs$3.toMiliseconds(cjs$3.ONE_SECOND*15)),f$1(this,"clientId"),f$1(this,"batchSubscribeTopicsLimit",500),f$1(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),f$1(this,"subscribe",async(zs,Ys)=>{var Zs;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:zs,opts:Ys}});try{const _u=Ba(Ys),Eu={topic:zs,relay:_u,transportType:Ys==null?void 0:Ys.transportType};(Zs=Ys==null?void 0:Ys.internal)!=null&&Zs.skipSubscribe||this.pending.set(zs,Eu);const Iu=await this.rpcSubscribe(zs,_u,Ys);return typeof Iu=="string"&&(this.onSubscribe(Iu,Eu),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:zs,opts:Ys}})),Iu}catch(_u){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(_u),_u}}),f$1(this,"unsubscribe",async(zs,Ys)=>{this.isInitialized(),typeof(Ys==null?void 0:Ys.id)<"u"?await this.unsubscribeById(zs,Ys.id,Ys):await this.unsubscribeByTopic(zs,Ys)}),f$1(this,"isSubscribed",zs=>new Promise(Ys=>{Ys(this.topicMap.topics.includes(zs))})),f$1(this,"isKnownTopic",zs=>new Promise(Ys=>{Ys(this.topicMap.topics.includes(zs)||this.pending.has(zs)||this.cached.some(Zs=>Zs.topic===zs))})),f$1(this,"on",(zs,Ys)=>{this.events.on(zs,Ys)}),f$1(this,"once",(zs,Ys)=>{this.events.once(zs,Ys)}),f$1(this,"off",(zs,Ys)=>{this.events.off(zs,Ys)}),f$1(this,"removeListener",(zs,Ys)=>{this.events.removeListener(zs,Ys)}),f$1(this,"start",async()=>{await this.onConnect()}),f$1(this,"stop",async()=>{await this.onDisconnect()}),f$1(this,"restart",async()=>{await this.restore(),await this.onRestart()}),f$1(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const zs=[];this.pending.forEach(Ys=>{zs.push(Ys)}),await this.batchSubscribe(zs)}),f$1(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(r$1.pulse,async()=>{await this.checkPending()}),this.events.on(j.created,async zs=>{const Ys=j.created;this.logger.info(`Emitting ${Ys}`),this.logger.debug({type:"event",event:Ys,data:zs}),await this.persist()}),this.events.on(j.deleted,async zs=>{const Ys=j.deleted;this.logger.info(`Emitting ${Ys}`),this.logger.debug({type:"event",event:Ys,data:zs}),await this.persist()})}),this.relayer=t,this.logger=X$2(Hs,this.name),this.clientId=""}get context(){return w$1(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(t,Hs){let zs=!1;try{zs=this.getSubscription(t).topic===Hs}catch{}return zs}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,Hs){const zs=this.topicMap.get(t);await Promise.all(zs.map(async Ys=>await this.unsubscribeById(t,Ys,Hs)))}async unsubscribeById(t,Hs,zs){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:Hs,opts:zs}});try{const Ys=Ba(zs);await this.restartToComplete({topic:t,id:Hs,relay:Ys}),await this.rpcUnsubscribe(t,Hs,Ys);const Zs=zt$2("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,Hs,Zs),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:Hs,opts:zs}})}catch(Ys){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(Ys),Ys}}async rpcSubscribe(t,Hs,zs){var Ys,Zs;const _u=await this.getSubscriptionId(t);if((Ys=zs==null?void 0:zs.internal)!=null&&Ys.skipSubscribe)return _u;(!zs||(zs==null?void 0:zs.transportType)===ee.relay)&&await this.restartToComplete({topic:t,id:t,relay:Hs});const Eu={method:Aa(Hs.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:Eu});const Iu=(Zs=zs==null?void 0:zs.internal)==null?void 0:Zs.throwOnFailedPublish;try{if((zs==null?void 0:zs.transportType)===ee.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(Eu).catch(vu=>this.logger.warn(vu))},cjs$3.toMiliseconds(cjs$3.ONE_SECOND)),_u;const Au=new Promise(async vu=>{const Su=Ru=>{Ru.topic===t&&(this.events.removeListener(j.created,Su),vu(Ru.id))};this.events.on(j.created,Su);try{const Ru=await Ai$1(new Promise((Pu,Cu)=>{this.relayer.request(Eu).catch(Bu=>{this.logger.warn(Bu,Bu==null?void 0:Bu.message),Cu(Bu)}).then(Pu)}),this.initialSubscribeTimeout,`Subscribing to ${t} failed, please try again`);this.events.removeListener(j.created,Su),vu(Ru)}catch{}}),$u=await Ai$1(Au,this.subscribeTimeout,`Subscribing to ${t} failed, please try again`);if(!$u&&Iu)throw new Error(`Subscribing to ${t} failed, please try again`);return $u?_u:null}catch(Au){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(C$1.connection_stalled),Iu)throw Au}return null}async rpcBatchSubscribe(t){if(!t.length)return;const Hs=t[0].relay,zs={method:Aa(Hs.protocol).batchSubscribe,params:{topics:t.map(Ys=>Ys.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:zs});try{await await Ai$1(new Promise(Ys=>{this.relayer.request(zs).catch(Zs=>this.logger.warn(Zs)).then(Ys)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(C$1.connection_stalled)}}async rpcBatchFetchMessages(t){if(!t.length)return;const Hs=t[0].relay,zs={method:Aa(Hs.protocol).batchFetchMessages,params:{topics:t.map(Zs=>Zs.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:zs});let Ys;try{Ys=await await Ai$1(new Promise((Zs,_u)=>{this.relayer.request(zs).catch(Eu=>{this.logger.warn(Eu),_u(Eu)}).then(Zs)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(C$1.connection_stalled)}return Ys}rpcUnsubscribe(t,Hs,zs){const Ys={method:Aa(zs.protocol).unsubscribe,params:{topic:t,id:Hs}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:Ys}),this.relayer.request(Ys)}onSubscribe(t,Hs){this.setSubscription(t,Je(fe$1({},Hs),{id:t})),this.pending.delete(Hs.topic)}onBatchSubscribe(t){t.length&&t.forEach(Hs=>{this.setSubscription(Hs.id,fe$1({},Hs)),this.pending.delete(Hs.topic)})}async onUnsubscribe(t,Hs,zs){this.events.removeAllListeners(Hs),this.hasSubscription(Hs,t)&&this.deleteSubscription(Hs,zs),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,Hs){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:Hs}),this.addSubscription(t,Hs)}addSubscription(t,Hs){this.subscriptions.set(t,fe$1({},Hs)),this.topicMap.set(Hs.topic,t),this.events.emit(j.created,Hs)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const Hs=this.subscriptions.get(t);if(!Hs){const{message:zs}=Bt$2("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(zs)}return Hs}deleteSubscription(t,Hs){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:Hs});const zs=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(zs.topic,t),this.events.emit(j.deleted,Je(fe$1({},zs),{reason:Hs}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(j.sync)}async onRestart(){if(this.cached.length){const t=[...this.cached],Hs=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let zs=0;zs<Hs;zs++){const Ys=t.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(Ys)}}this.events.emit(j.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size&&!t.every(Hs=>{var zs;return Hs.topic===((zs=this.subscriptions.get(Hs.id))==null?void 0:zs.topic)})){const{message:Hs}=Bt$2("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(Hs),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(Hs)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){t.length&&(await this.rpcBatchSubscribe(t),this.onBatchSubscribe(await Promise.all(t.map(async Hs=>Je(fe$1({},Hs),{id:await this.getSubscriptionId(Hs.topic)})))))}async batchFetchMessages(t){if(!t.length)return;this.logger.trace(`Fetching batch messages for ${t.length} subscriptions`);const Hs=await this.rpcBatchFetchMessages(t);Hs&&Hs.messages&&(await Li$1(cjs$3.toMiliseconds(cjs$3.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(Hs.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:t}=Bt$2("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(t){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(t),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(t){return pa(t+await this.getClientId())}}var ro=Object.defineProperty,Oi=Object.getOwnPropertySymbols,no=Object.prototype.hasOwnProperty,oo=Object.prototype.propertyIsEnumerable,Xe=(Z,t,Hs)=>t in Z?ro(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,Ri=(Z,t)=>{for(var Hs in t||(t={}))no.call(t,Hs)&&Xe(Z,Hs,t[Hs]);if(Oi)for(var Hs of Oi(t))oo.call(t,Hs)&&Xe(Z,Hs,t[Hs]);return Z},p=(Z,t,Hs)=>Xe(Z,typeof t!="symbol"?t+"":t,Hs);class Ai extends d$2{constructor(t){var Hs;super(t),p(this,"protocol","wc"),p(this,"version",2),p(this,"core"),p(this,"logger"),p(this,"events",new eventsExports.EventEmitter),p(this,"provider"),p(this,"messages"),p(this,"subscriber"),p(this,"publisher"),p(this,"name",zt$1),p(this,"transportExplicitlyClosed",!1),p(this,"initialized",!1),p(this,"connectionAttemptInProgress",!1),p(this,"relayUrl"),p(this,"projectId"),p(this,"packageName"),p(this,"bundleId"),p(this,"hasExperiencedNetworkDisruption",!1),p(this,"pingTimeout"),p(this,"heartBeatTimeout",cjs$3.toMiliseconds(cjs$3.THIRTY_SECONDS+cjs$3.FIVE_SECONDS)),p(this,"reconnectTimeout"),p(this,"connectPromise"),p(this,"reconnectInProgress",!1),p(this,"requestsInFlight",[]),p(this,"connectTimeout",cjs$3.toMiliseconds(cjs$3.ONE_SECOND*15)),p(this,"request",async zs=>{var Ys,Zs;this.logger.debug("Publishing Request Payload");const _u=zs.id||getBigIntRpcId().toString();await this.toEstablishConnection();try{this.logger.trace({id:_u,method:zs.method,topic:(Ys=zs.params)==null?void 0:Ys.topic},"relayer.request - publishing...");const Eu=`${_u}:${((Zs=zs.params)==null?void 0:Zs.tag)||""}`;this.requestsInFlight.push(Eu);const Iu=await this.provider.request(zs);return this.requestsInFlight=this.requestsInFlight.filter(Au=>Au!==Eu),Iu}catch(Eu){throw this.logger.debug(`Failed to Publish Request: ${_u}`),Eu}}),p(this,"resetPingTimeout",()=>{rn$2()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var zs,Ys,Zs,_u;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(_u=(Zs=(Ys=(zs=this.provider)==null?void 0:zs.connection)==null?void 0:Ys.socket)==null?void 0:Zs.terminate)==null||_u.call(Zs)}catch(Eu){this.logger.warn(Eu,Eu==null?void 0:Eu.message)}},this.heartBeatTimeout))}),p(this,"onPayloadHandler",zs=>{this.onProviderPayload(zs),this.resetPingTimeout()}),p(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(C$1.connect)}),p(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),p(this,"onProviderErrorHandler",zs=>{this.logger.fatal(`Fatal socket error: ${zs.message}`),this.events.emit(C$1.error,zs),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),p(this,"registerProviderListeners",()=>{this.provider.on(M$1.payload,this.onPayloadHandler),this.provider.on(M$1.connect,this.onConnectHandler),this.provider.on(M$1.disconnect,this.onDisconnectHandler),this.provider.on(M$1.error,this.onProviderErrorHandler)}),this.core=t.core,this.logger=wu({logger:(Hs=t.logger)!=null?Hs:$t$1,name:this.name}),this.messages=new Ii(this.logger,t.core),this.subscriber=new Si(this,this.logger),this.publisher=new Yn(this,this.logger),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||Ke$1,ai$1()?this.packageName=li$1():ui$1()&&(this.bundleId=li$1()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(t=>this.logger.warn(t,t==null?void 0:t.message))}get context(){return w$1(this.logger)}get connected(){var t,Hs,zs;return((zs=(Hs=(t=this.provider)==null?void 0:t.connection)==null?void 0:Hs.socket)==null?void 0:zs.readyState)===1||!1}get connecting(){var t,Hs,zs;return((zs=(Hs=(t=this.provider)==null?void 0:t.connection)==null?void 0:Hs.socket)==null?void 0:zs.readyState)===0||this.connectPromise!==void 0||!1}async publish(t,Hs,zs){this.isInitialized(),await this.publisher.publish(t,Hs,zs),await this.recordMessageEvent({topic:t,message:Hs,publishedAt:Date.now(),transportType:ee.relay},ye.outbound)}async publishCustom(t){this.isInitialized(),await this.publisher.publishCustom(t)}async subscribe(t,Hs){var zs,Ys,Zs;this.isInitialized(),(!(Hs!=null&&Hs.transportType)||(Hs==null?void 0:Hs.transportType)==="relay")&&await this.toEstablishConnection();const _u=typeof((zs=Hs==null?void 0:Hs.internal)==null?void 0:zs.throwOnFailedPublish)>"u"?!0:(Ys=Hs==null?void 0:Hs.internal)==null?void 0:Ys.throwOnFailedPublish;let Eu=((Zs=this.subscriber.topicMap.get(t))==null?void 0:Zs[0])||"",Iu;const Au=$u=>{$u.topic===t&&(this.subscriber.off(j.created,Au),Iu())};return await Promise.all([new Promise($u=>{Iu=$u,this.subscriber.on(j.created,Au)}),new Promise(async($u,vu)=>{Eu=await this.subscriber.subscribe(t,Ri({internal:{throwOnFailedPublish:_u}},Hs)).catch(Su=>{_u&&vu(Su)})||Eu,$u()})]),Eu}async unsubscribe(t,Hs){this.isInitialized(),await this.subscriber.unsubscribe(t,Hs)}on(t,Hs){this.events.on(t,Hs)}once(t,Hs){this.events.once(t,Hs)}off(t,Hs){this.events.off(t,Hs)}removeListener(t,Hs){this.events.removeListener(t,Hs)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Ai$1(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(t){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(Hs,zs)=>{await this.connect(t).then(Hs).catch(zs).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(t){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await uu())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(t){if((t==null?void 0:t.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const Hs=t.sort((zs,Ys)=>zs.publishedAt-Ys.publishedAt);this.logger.debug(`Batch of ${Hs.length} message events sorted`);for(const zs of Hs)try{await this.onMessageEvent(zs)}catch(Ys){this.logger.warn(Ys,"Error while processing batch message event: "+(Ys==null?void 0:Ys.message))}this.logger.trace(`Batch of ${Hs.length} message events processed`)}async onLinkMessageEvent(t,Hs){const{topic:zs}=t;if(!Hs.sessionExists){const Ys=Ni$1(cjs$3.FIVE_MINUTES),Zs={topic:zs,expiry:Ys,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(zs,Zs)}this.events.emit(C$1.message,t),await this.recordMessageEvent(t,ye.inbound)}async connect(t){await this.confirmOnlineStateOrThrow(),t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let Hs=1;for(;Hs<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${Hs}...`),await this.createProvider(),await new Promise(async(zs,Ys)=>{const Zs=()=>{Ys(new Error("Connection interrupted while trying to connect"))};this.provider.once(M$1.disconnect,Zs),await Ai$1(new Promise((_u,Eu)=>{this.provider.connect().then(_u).catch(Eu)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(_u=>{Ys(_u)}).finally(()=>{this.provider.off(M$1.disconnect,Zs),clearTimeout(this.reconnectTimeout)}),await new Promise(async(_u,Eu)=>{const Iu=()=>{Ys(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(M$1.disconnect,Iu),await this.subscriber.start().then(_u).catch(Eu).finally(()=>{this.provider.off(M$1.disconnect,Iu)})}),this.hasExperiencedNetworkDisruption=!1,zs()})}catch(zs){await this.subscriber.stop();const Ys=zs;this.logger.warn({},Ys.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${Hs}`);break}await new Promise(zs=>setTimeout(zs,cjs$3.toMiliseconds(Hs*1))),Hs++}}startPingTimeout(){var t,Hs,zs,Ys,Zs;if(rn$2())try{(Hs=(t=this.provider)==null?void 0:t.connection)!=null&&Hs.socket&&((Zs=(Ys=(zs=this.provider)==null?void 0:zs.connection)==null?void 0:Ys.socket)==null||Zs.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(_u){this.logger.warn(_u,_u==null?void 0:_u.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new o(new f$2(pi$1({sdkVersion:Pe,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(t,Hs){const{topic:zs,message:Ys}=t;await this.messages.set(zs,Ys,Hs)}async shouldIgnoreMessageEvent(t){const{topic:Hs,message:zs}=t;if(!zs||zs.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${zs}`),!0;if(!await this.subscriber.isKnownTopic(Hs))return this.logger.warn(`Ignoring message for unknown topic ${Hs}`),!0;const Ys=this.messages.has(Hs,zs);return Ys&&this.logger.warn(`Ignoring duplicate message: ${zs}`),Ys}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),isJsonRpcRequest(t)){if(!t.method.endsWith(Lt$1))return;const Hs=t.params,{topic:zs,message:Ys,publishedAt:Zs,attestation:_u}=Hs.data,Eu={topic:zs,message:Ys,publishedAt:Zs,transportType:ee.relay,attestation:_u};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Ri({type:"event",event:Hs.id},Eu)),this.events.emit(Hs.id,Eu),await this.acknowledgePayload(t),await this.onMessageEvent(Eu)}else isJsonRpcResponse(t)&&this.events.emit(C$1.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(await this.recordMessageEvent(t,ye.inbound),this.events.emit(C$1.message,t))}async acknowledgePayload(t){const Hs=formatJsonRpcResult(t.id,!0);await this.provider.connection.send(Hs)}unregisterProviderListeners(){this.provider.off(M$1.payload,this.onPayloadHandler),this.provider.off(M$1.connect,this.onConnectHandler),this.provider.off(M$1.disconnect,this.onDisconnectHandler),this.provider.off(M$1.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let t=await uu();lu(async Hs=>{t!==Hs&&(t=Hs,Hs?await this.transportOpen().catch(zs=>this.logger.error(zs,zs==null?void 0:zs.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(r$1.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&du())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(Hs){this.logger.warn(Hs,Hs==null?void 0:Hs.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(C$1.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(t=>this.logger.error(t,t==null?void 0:t.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},cjs$3.toMiliseconds(kt)))))}isInitialized(){if(!this.initialized){const{message:t}=Bt$2("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function ao(Z,t){return Z===t||Number.isNaN(Z)&&Number.isNaN(t)}function xi(Z){return Object.getOwnPropertySymbols(Z).filter(t=>Object.prototype.propertyIsEnumerable.call(Z,t))}function Ni(Z){return Z==null?Z===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(Z)}const co="[object RegExp]",ho="[object String]",lo="[object Number]",uo="[object Boolean]",$i="[object Arguments]",po="[object Symbol]",go="[object Date]",yo="[object Map]",bo="[object Set]",mo="[object Array]",fo="[object Function]",Do="[object ArrayBuffer]",Ze="[object Object]",vo="[object Error]",_o="[object DataView]",wo="[object Uint8Array]",Eo="[object Uint8ClampedArray]",Io="[object Uint16Array]",To="[object Uint32Array]",Co="[object BigUint64Array]",Po="[object Int8Array]",So="[object Int16Array]",Oo="[object Int32Array]",Ro="[object BigInt64Array]",Ao="[object Float32Array]",xo="[object Float64Array]";function No(){}function zi(Z){if(!Z||typeof Z!="object")return!1;const t=Object.getPrototypeOf(Z);return t===null||t===Object.prototype||Object.getPrototypeOf(t)===null?Object.prototype.toString.call(Z)==="[object Object]":!1}function $o(Z,t,Hs){return De$1(Z,t,void 0,void 0,void 0,void 0,Hs)}function De$1(Z,t,Hs,zs,Ys,Zs,_u){const Eu=_u(Z,t,Hs,zs,Ys,Zs);if(Eu!==void 0)return Eu;if(typeof Z==typeof t)switch(typeof Z){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return Z===t;case"number":return Z===t||Object.is(Z,t);case"function":return Z===t;case"object":return ve(Z,t,Zs,_u)}return ve(Z,t,Zs,_u)}function ve(Z,t,Hs,zs){if(Object.is(Z,t))return!0;let Ys=Ni(Z),Zs=Ni(t);if(Ys===$i&&(Ys=Ze),Zs===$i&&(Zs=Ze),Ys!==Zs)return!1;switch(Ys){case ho:return Z.toString()===t.toString();case lo:{const Iu=Z.valueOf(),Au=t.valueOf();return ao(Iu,Au)}case uo:case go:case po:return Object.is(Z.valueOf(),t.valueOf());case co:return Z.source===t.source&&Z.flags===t.flags;case fo:return Z===t}Hs=Hs??new Map;const _u=Hs.get(Z),Eu=Hs.get(t);if(_u!=null&&Eu!=null)return _u===t;Hs.set(Z,t),Hs.set(t,Z);try{switch(Ys){case yo:{if(Z.size!==t.size)return!1;for(const[Iu,Au]of Z.entries())if(!t.has(Iu)||!De$1(Au,t.get(Iu),Iu,Z,t,Hs,zs))return!1;return!0}case bo:{if(Z.size!==t.size)return!1;const Iu=Array.from(Z.values()),Au=Array.from(t.values());for(let $u=0;$u<Iu.length;$u++){const vu=Iu[$u],Su=Au.findIndex(Ru=>De$1(vu,Ru,void 0,Z,t,Hs,zs));if(Su===-1)return!1;Au.splice(Su,1)}return!0}case mo:case wo:case Eo:case Io:case To:case Co:case Po:case So:case Oo:case Ro:case Ao:case xo:{if(typeof Buffer$1<"u"&&Buffer$1.isBuffer(Z)!==Buffer$1.isBuffer(t)||Z.length!==t.length)return!1;for(let Iu=0;Iu<Z.length;Iu++)if(!De$1(Z[Iu],t[Iu],Iu,Z,t,Hs,zs))return!1;return!0}case Do:return Z.byteLength!==t.byteLength?!1:ve(new Uint8Array(Z),new Uint8Array(t),Hs,zs);case _o:return Z.byteLength!==t.byteLength||Z.byteOffset!==t.byteOffset?!1:ve(new Uint8Array(Z),new Uint8Array(t),Hs,zs);case vo:return Z.name===t.name&&Z.message===t.message;case Ze:{if(!(ve(Z.constructor,t.constructor,Hs,zs)||zi(Z)&&zi(t)))return!1;const Iu=[...Object.keys(Z),...xi(Z)],Au=[...Object.keys(t),...xi(t)];if(Iu.length!==Au.length)return!1;for(let $u=0;$u<Iu.length;$u++){const vu=Iu[$u],Su=Z[vu];if(!Object.hasOwn(t,vu))return!1;const Ru=t[vu];if(!De$1(Su,Ru,vu,Z,t,Hs,zs))return!1}return!0}default:return!1}}finally{Hs.delete(Z),Hs.delete(t)}}function zo(Z,t){return $o(Z,t,No)}var Lo=Object.defineProperty,Li=Object.getOwnPropertySymbols,ko=Object.prototype.hasOwnProperty,jo=Object.prototype.propertyIsEnumerable,Qe=(Z,t,Hs)=>t in Z?Lo(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,ki=(Z,t)=>{for(var Hs in t||(t={}))ko.call(t,Hs)&&Qe(Z,Hs,t[Hs]);if(Li)for(var Hs of Li(t))jo.call(t,Hs)&&Qe(Z,Hs,t[Hs]);return Z},U$1=(Z,t,Hs)=>Qe(Z,typeof t!="symbol"?t+"":t,Hs);class ji extends f$3{constructor(t,Hs,zs,Ys=W$1,Zs=void 0){super(t,Hs,zs,Ys),this.core=t,this.logger=Hs,this.name=zs,U$1(this,"map",new Map),U$1(this,"version",jt$1),U$1(this,"cached",[]),U$1(this,"initialized",!1),U$1(this,"getKey"),U$1(this,"storagePrefix",W$1),U$1(this,"recentlyDeleted",[]),U$1(this,"recentlyDeletedLimit",200),U$1(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(_u=>{this.getKey&&_u!==null&&!Dt$1(_u)?this.map.set(this.getKey(_u),_u):Ga(_u)?this.map.set(_u.id,_u):za(_u)&&this.map.set(_u.topic,_u)}),this.cached=[],this.initialized=!0)}),U$1(this,"set",async(_u,Eu)=>{this.isInitialized(),this.map.has(_u)?await this.update(_u,Eu):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:_u,value:Eu}),this.map.set(_u,Eu),await this.persist())}),U$1(this,"get",_u=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:_u}),this.getData(_u))),U$1(this,"getAll",_u=>(this.isInitialized(),_u?this.values.filter(Eu=>Object.keys(_u).every(Iu=>zo(Eu[Iu],_u[Iu]))):this.values)),U$1(this,"update",async(_u,Eu)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:_u,update:Eu});const Iu=ki(ki({},this.getData(_u)),Eu);this.map.set(_u,Iu),await this.persist()}),U$1(this,"delete",async(_u,Eu)=>{this.isInitialized(),this.map.has(_u)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:_u,reason:Eu}),this.map.delete(_u),this.addToRecentlyDeleted(_u),await this.persist())}),this.logger=X$2(Hs,this.name),this.storagePrefix=Ys,this.getKey=Zs}get context(){return w$1(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(t){this.recentlyDeleted.push(t),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const Hs=this.map.get(t);if(!Hs){if(this.recentlyDeleted.includes(t)){const{message:Ys}=Bt$2("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${t}`);throw this.logger.error(Ys),new Error(Ys)}const{message:zs}=Bt$2("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(zs),new Error(zs)}return Hs}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:Hs}=Bt$2("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(Hs),new Error(Hs)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=Bt$2("NOT_INITIALIZED",this.name);throw new Error(t)}}}var Uo=Object.defineProperty,Fo=(Z,t,Hs)=>t in Z?Uo(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,d=(Z,t,Hs)=>Fo(Z,typeof t!="symbol"?t+"":t,Hs);class Ui{constructor(t,Hs){this.core=t,this.logger=Hs,d(this,"name",Kt),d(this,"version",Bt$1),d(this,"events",new Nt$3),d(this,"pairings"),d(this,"initialized",!1),d(this,"storagePrefix",W$1),d(this,"ignoredPayloadTypes",[ie]),d(this,"registeredMethods",[]),d(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),d(this,"register",({methods:zs})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...zs])]}),d(this,"create",async zs=>{this.isInitialized();const Ys=la(),Zs=await this.core.crypto.setSymKey(Ys),_u=Ni$1(cjs$3.FIVE_MINUTES),Eu={protocol:Nt},Iu={topic:Zs,expiry:_u,relay:Eu,active:!1,methods:zs==null?void 0:zs.methods},Au=$a({protocol:this.core.protocol,version:this.core.version,topic:Zs,symKey:Ys,relay:Eu,expiryTimestamp:_u,methods:zs==null?void 0:zs.methods});return this.events.emit(ae.create,Iu),this.core.expirer.set(Zs,_u),await this.pairings.set(Zs,Iu),await this.core.relayer.subscribe(Zs,{transportType:zs==null?void 0:zs.transportType,internal:zs==null?void 0:zs.internal}),{topic:Zs,uri:Au}}),d(this,"pair",async zs=>{this.isInitialized();const Ys=this.core.eventClient.createEvent({properties:{topic:zs==null?void 0:zs.uri,trace:[Y.pairing_started]}});this.isValidPair(zs,Ys);const{topic:Zs,symKey:_u,relay:Eu,expiryTimestamp:Iu,methods:Au}=Ra(zs.uri);Ys.props.properties.topic=Zs,Ys.addTrace(Y.pairing_uri_validation_success),Ys.addTrace(Y.pairing_uri_not_expired);let $u;if(this.pairings.keys.includes(Zs)){if($u=this.pairings.get(Zs),Ys.addTrace(Y.existing_pairing),$u.active)throw Ys.setError(X.active_pairing_already_exists),new Error(`Pairing already exists: ${Zs}. Please try again with a new connection URI.`);Ys.addTrace(Y.pairing_not_expired)}const vu=Iu||Ni$1(cjs$3.FIVE_MINUTES),Su={topic:Zs,relay:Eu,expiry:vu,active:!1,methods:Au};this.core.expirer.set(Zs,vu),await this.pairings.set(Zs,Su),Ys.addTrace(Y.store_new_pairing),zs.activatePairing&&await this.activate({topic:Zs}),this.events.emit(ae.create,Su),Ys.addTrace(Y.emit_inactive_pairing),this.core.crypto.keychain.has(Zs)||await this.core.crypto.setSymKey(_u,Zs),Ys.addTrace(Y.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{Ys.setError(X.no_internet_connection)}try{await this.core.relayer.subscribe(Zs,{relay:Eu})}catch(Ru){throw Ys.setError(X.subscribe_pairing_topic_failure),Ru}return Ys.addTrace(Y.subscribe_pairing_topic_success),Su}),d(this,"activate",async({topic:zs})=>{this.isInitialized();const Ys=Ni$1(cjs$3.FIVE_MINUTES);this.core.expirer.set(zs,Ys),await this.pairings.update(zs,{active:!0,expiry:Ys})}),d(this,"ping",async zs=>{this.isInitialized(),await this.isValidPing(zs),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:Ys}=zs;if(this.pairings.keys.includes(Ys)){const Zs=await this.sendRequest(Ys,"wc_pairingPing",{}),{done:_u,resolve:Eu,reject:Iu}=Bi$1();this.events.once(_i$1("pairing_ping",Zs),({error:Au})=>{Au?Iu(Au):Eu()}),await _u()}}),d(this,"updateExpiry",async({topic:zs,expiry:Ys})=>{this.isInitialized(),await this.pairings.update(zs,{expiry:Ys})}),d(this,"updateMetadata",async({topic:zs,metadata:Ys})=>{this.isInitialized(),await this.pairings.update(zs,{peerMetadata:Ys})}),d(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),d(this,"disconnect",async zs=>{this.isInitialized(),await this.isValidDisconnect(zs);const{topic:Ys}=zs;this.pairings.keys.includes(Ys)&&(await this.sendRequest(Ys,"wc_pairingDelete",zt$2("USER_DISCONNECTED")),await this.deletePairing(Ys))}),d(this,"formatUriFromPairing",zs=>{this.isInitialized();const{topic:Ys,relay:Zs,expiry:_u,methods:Eu}=zs,Iu=this.core.crypto.keychain.get(Ys);return $a({protocol:this.core.protocol,version:this.core.version,topic:Ys,symKey:Iu,relay:Zs,expiryTimestamp:_u,methods:Eu})}),d(this,"sendRequest",async(zs,Ys,Zs)=>{const _u=formatJsonRpcRequest(Ys,Zs),Eu=await this.core.crypto.encode(zs,_u),Iu=oe[Ys].req;return this.core.history.set(zs,_u),this.core.relayer.publish(zs,Eu,Iu),_u.id}),d(this,"sendResult",async(zs,Ys,Zs)=>{const _u=formatJsonRpcResult(zs,Zs),Eu=await this.core.crypto.encode(Ys,_u),Iu=(await this.core.history.get(Ys,zs)).request.method,Au=oe[Iu].res;await this.core.relayer.publish(Ys,Eu,Au),await this.core.history.resolve(_u)}),d(this,"sendError",async(zs,Ys,Zs)=>{const _u=formatJsonRpcError(zs,Zs),Eu=await this.core.crypto.encode(Ys,_u),Iu=(await this.core.history.get(Ys,zs)).request.method,Au=oe[Iu]?oe[Iu].res:oe.unregistered_method.res;await this.core.relayer.publish(Ys,Eu,Au),await this.core.history.resolve(_u)}),d(this,"deletePairing",async(zs,Ys)=>{await this.core.relayer.unsubscribe(zs),await Promise.all([this.pairings.delete(zs,zt$2("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(zs),Ys?Promise.resolve():this.core.expirer.del(zs)])}),d(this,"cleanup",async()=>{const zs=this.pairings.getAll().filter(Ys=>Ui$1(Ys.expiry));await Promise.all(zs.map(Ys=>this.deletePairing(Ys.topic)))}),d(this,"onRelayEventRequest",async zs=>{const{topic:Ys,payload:Zs}=zs;switch(Zs.method){case"wc_pairingPing":return await this.onPairingPingRequest(Ys,Zs);case"wc_pairingDelete":return await this.onPairingDeleteRequest(Ys,Zs);default:return await this.onUnknownRpcMethodRequest(Ys,Zs)}}),d(this,"onRelayEventResponse",async zs=>{const{topic:Ys,payload:Zs}=zs,_u=(await this.core.history.get(Ys,Zs.id)).request.method;switch(_u){case"wc_pairingPing":return this.onPairingPingResponse(Ys,Zs);default:return this.onUnknownRpcMethodResponse(_u)}}),d(this,"onPairingPingRequest",async(zs,Ys)=>{const{id:Zs}=Ys;try{this.isValidPing({topic:zs}),await this.sendResult(Zs,zs,!0),this.events.emit(ae.ping,{id:Zs,topic:zs})}catch(_u){await this.sendError(Zs,zs,_u),this.logger.error(_u)}}),d(this,"onPairingPingResponse",(zs,Ys)=>{const{id:Zs}=Ys;setTimeout(()=>{isJsonRpcResult(Ys)?this.events.emit(_i$1("pairing_ping",Zs),{}):isJsonRpcError(Ys)&&this.events.emit(_i$1("pairing_ping",Zs),{error:Ys.error})},500)}),d(this,"onPairingDeleteRequest",async(zs,Ys)=>{const{id:Zs}=Ys;try{this.isValidDisconnect({topic:zs}),await this.deletePairing(zs),this.events.emit(ae.delete,{id:Zs,topic:zs})}catch(_u){await this.sendError(Zs,zs,_u),this.logger.error(_u)}}),d(this,"onUnknownRpcMethodRequest",async(zs,Ys)=>{const{id:Zs,method:_u}=Ys;try{if(this.registeredMethods.includes(_u))return;const Eu=zt$2("WC_METHOD_UNSUPPORTED",_u);await this.sendError(Zs,zs,Eu),this.logger.error(Eu)}catch(Eu){await this.sendError(Zs,zs,Eu),this.logger.error(Eu)}}),d(this,"onUnknownRpcMethodResponse",zs=>{this.registeredMethods.includes(zs)||this.logger.error(zt$2("WC_METHOD_UNSUPPORTED",zs))}),d(this,"isValidPair",(zs,Ys)=>{var Zs;if(!Qa(zs)){const{message:Eu}=Bt$2("MISSING_OR_INVALID",`pair() params: ${zs}`);throw Ys.setError(X.malformed_pairing_uri),new Error(Eu)}if(!Za(zs.uri)){const{message:Eu}=Bt$2("MISSING_OR_INVALID",`pair() uri: ${zs.uri}`);throw Ys.setError(X.malformed_pairing_uri),new Error(Eu)}const _u=Ra(zs==null?void 0:zs.uri);if(!((Zs=_u==null?void 0:_u.relay)!=null&&Zs.protocol)){const{message:Eu}=Bt$2("MISSING_OR_INVALID","pair() uri#relay-protocol");throw Ys.setError(X.malformed_pairing_uri),new Error(Eu)}if(!(_u!=null&&_u.symKey)){const{message:Eu}=Bt$2("MISSING_OR_INVALID","pair() uri#symKey");throw Ys.setError(X.malformed_pairing_uri),new Error(Eu)}if(_u!=null&&_u.expiryTimestamp&&cjs$3.toMiliseconds(_u==null?void 0:_u.expiryTimestamp)<Date.now()){Ys.setError(X.pairing_expired);const{message:Eu}=Bt$2("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(Eu)}}),d(this,"isValidPing",async zs=>{if(!Qa(zs)){const{message:Zs}=Bt$2("MISSING_OR_INVALID",`ping() params: ${zs}`);throw new Error(Zs)}const{topic:Ys}=zs;await this.isValidPairingTopic(Ys)}),d(this,"isValidDisconnect",async zs=>{if(!Qa(zs)){const{message:Zs}=Bt$2("MISSING_OR_INVALID",`disconnect() params: ${zs}`);throw new Error(Zs)}const{topic:Ys}=zs;await this.isValidPairingTopic(Ys)}),d(this,"isValidPairingTopic",async zs=>{if(!ft$2(zs,!1)){const{message:Ys}=Bt$2("MISSING_OR_INVALID",`pairing topic should be a string: ${zs}`);throw new Error(Ys)}if(!this.pairings.keys.includes(zs)){const{message:Ys}=Bt$2("NO_MATCHING_KEY",`pairing topic doesn't exist: ${zs}`);throw new Error(Ys)}if(Ui$1(this.pairings.get(zs).expiry)){await this.deletePairing(zs);const{message:Ys}=Bt$2("EXPIRED",`pairing topic: ${zs}`);throw new Error(Ys)}}),this.core=t,this.logger=X$2(Hs,this.name),this.pairings=new ji(this.core,this.logger,this.name,this.storagePrefix)}get context(){return w$1(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=Bt$2("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(C$1.message,async t=>{const{topic:Hs,message:zs,transportType:Ys}=t;if(this.pairings.keys.includes(Hs)&&Ys!==ee.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(zs)))try{const Zs=await this.core.crypto.decode(Hs,zs);isJsonRpcRequest(Zs)?(this.core.history.set(Hs,Zs),await this.onRelayEventRequest({topic:Hs,payload:Zs})):isJsonRpcResponse(Zs)&&(await this.core.history.resolve(Zs),await this.onRelayEventResponse({topic:Hs,payload:Zs}),this.core.history.delete(Hs,Zs.id)),await this.core.relayer.messages.ack(Hs,zs)}catch(Zs){this.logger.error(Zs)}})}registerExpirerEvents(){this.core.expirer.on(q.expired,async t=>{const{topic:Hs}=Oi$1(t.target);Hs&&this.pairings.keys.includes(Hs)&&(await this.deletePairing(Hs,!0),this.events.emit(ae.expire,{topic:Hs}))})}}var Mo=Object.defineProperty,Ko=(Z,t,Hs)=>t in Z?Mo(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,N$1=(Z,t,Hs)=>Ko(Z,typeof t!="symbol"?t+"":t,Hs);class Fi extends I{constructor(t,Hs){super(t,Hs),this.core=t,this.logger=Hs,N$1(this,"records",new Map),N$1(this,"events",new eventsExports.EventEmitter),N$1(this,"name",Vt$1),N$1(this,"version",qt),N$1(this,"cached",[]),N$1(this,"initialized",!1),N$1(this,"storagePrefix",W$1),N$1(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(zs=>this.records.set(zs.id,zs)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),N$1(this,"set",(zs,Ys,Zs)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:zs,request:Ys,chainId:Zs}),this.records.has(Ys.id))return;const _u={id:Ys.id,topic:zs,request:{method:Ys.method,params:Ys.params||null},chainId:Zs,expiry:Ni$1(cjs$3.THIRTY_DAYS)};this.records.set(_u.id,_u),this.persist(),this.events.emit(V.created,_u)}),N$1(this,"resolve",async zs=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:zs}),!this.records.has(zs.id))return;const Ys=await this.getRecord(zs.id);typeof Ys.response>"u"&&(Ys.response=isJsonRpcError(zs)?{error:zs.error}:{result:zs.result},this.records.set(Ys.id,Ys),this.persist(),this.events.emit(V.updated,Ys))}),N$1(this,"get",async(zs,Ys)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:zs,id:Ys}),await this.getRecord(Ys))),N$1(this,"delete",(zs,Ys)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:Ys}),this.values.forEach(Zs=>{if(Zs.topic===zs){if(typeof Ys<"u"&&Zs.id!==Ys)return;this.records.delete(Zs.id),this.events.emit(V.deleted,Zs)}}),this.persist()}),N$1(this,"exists",async(zs,Ys)=>(this.isInitialized(),this.records.has(Ys)?(await this.getRecord(Ys)).topic===zs:!1)),N$1(this,"on",(zs,Ys)=>{this.events.on(zs,Ys)}),N$1(this,"once",(zs,Ys)=>{this.events.once(zs,Ys)}),N$1(this,"off",(zs,Ys)=>{this.events.off(zs,Ys)}),N$1(this,"removeListener",(zs,Ys)=>{this.events.removeListener(zs,Ys)}),this.logger=X$2(Hs,this.name)}get context(){return w$1(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(Hs=>{if(typeof Hs.response<"u")return;const zs={topic:Hs.topic,request:formatJsonRpcRequest(Hs.request.method,Hs.request.params,Hs.id),chainId:Hs.chainId};return t.push(zs)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const Hs=this.records.get(t);if(!Hs){const{message:zs}=Bt$2("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(zs)}return Hs}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(V.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:Hs}=Bt$2("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(Hs),new Error(Hs)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(V.created,t=>{const Hs=V.created;this.logger.info(`Emitting ${Hs}`),this.logger.debug({type:"event",event:Hs,record:t})}),this.events.on(V.updated,t=>{const Hs=V.updated;this.logger.info(`Emitting ${Hs}`),this.logger.debug({type:"event",event:Hs,record:t})}),this.events.on(V.deleted,t=>{const Hs=V.deleted;this.logger.info(`Emitting ${Hs}`),this.logger.debug({type:"event",event:Hs,record:t})}),this.core.heartbeat.on(r$1.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let t=!1;this.records.forEach(Hs=>{cjs$3.toMiliseconds(Hs.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${Hs.id}`),this.records.delete(Hs.id),this.events.emit(V.deleted,Hs,!1),t=!0)}),t&&this.persist()}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=Bt$2("NOT_INITIALIZED",this.name);throw new Error(t)}}}var Bo=Object.defineProperty,Vo=(Z,t,Hs)=>t in Z?Bo(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,z=(Z,t,Hs)=>Vo(Z,typeof t!="symbol"?t+"":t,Hs);class Mi extends S$2{constructor(t,Hs){super(t,Hs),this.core=t,this.logger=Hs,z(this,"expirations",new Map),z(this,"events",new eventsExports.EventEmitter),z(this,"name",Gt$1),z(this,"version",Wt$1),z(this,"cached",[]),z(this,"initialized",!1),z(this,"storagePrefix",W$1),z(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(zs=>this.expirations.set(zs.target,zs)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),z(this,"has",zs=>{try{const Ys=this.formatTarget(zs);return typeof this.getExpiration(Ys)<"u"}catch{return!1}}),z(this,"set",(zs,Ys)=>{this.isInitialized();const Zs=this.formatTarget(zs),_u={target:Zs,expiry:Ys};this.expirations.set(Zs,_u),this.checkExpiry(Zs,_u),this.events.emit(q.created,{target:Zs,expiration:_u})}),z(this,"get",zs=>{this.isInitialized();const Ys=this.formatTarget(zs);return this.getExpiration(Ys)}),z(this,"del",zs=>{if(this.isInitialized(),this.has(zs)){const Ys=this.formatTarget(zs),Zs=this.getExpiration(Ys);this.expirations.delete(Ys),this.events.emit(q.deleted,{target:Ys,expiration:Zs})}}),z(this,"on",(zs,Ys)=>{this.events.on(zs,Ys)}),z(this,"once",(zs,Ys)=>{this.events.once(zs,Ys)}),z(this,"off",(zs,Ys)=>{this.events.off(zs,Ys)}),z(this,"removeListener",(zs,Ys)=>{this.events.removeListener(zs,Ys)}),this.logger=X$2(Hs,this.name)}get context(){return w$1(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return Ii$1(t);if(typeof t=="number")return Si$1(t);const{message:Hs}=Bt$2("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(Hs)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(q.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:Hs}=Bt$2("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(Hs),new Error(Hs)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const Hs=this.expirations.get(t);if(!Hs){const{message:zs}=Bt$2("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.warn(zs),new Error(zs)}return Hs}checkExpiry(t,Hs){const{expiry:zs}=Hs;cjs$3.toMiliseconds(zs)-Date.now()<=0&&this.expire(t,Hs)}expire(t,Hs){this.expirations.delete(t),this.events.emit(q.expired,{target:t,expiration:Hs})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,Hs)=>this.checkExpiry(Hs,t))}registerEventListeners(){this.core.heartbeat.on(r$1.pulse,()=>this.checkExpirations()),this.events.on(q.created,t=>{const Hs=q.created;this.logger.info(`Emitting ${Hs}`),this.logger.debug({type:"event",event:Hs,data:t}),this.persist()}),this.events.on(q.expired,t=>{const Hs=q.expired;this.logger.info(`Emitting ${Hs}`),this.logger.debug({type:"event",event:Hs,data:t}),this.persist()}),this.events.on(q.deleted,t=>{const Hs=q.deleted;this.logger.info(`Emitting ${Hs}`),this.logger.debug({type:"event",event:Hs,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=Bt$2("NOT_INITIALIZED",this.name);throw new Error(t)}}}var qo=Object.defineProperty,Go=(Z,t,Hs)=>t in Z?qo(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,P$1=(Z,t,Hs)=>Go(Z,typeof t!="symbol"?t+"":t,Hs);class Ki extends M$3{constructor(t,Hs,zs){super(t,Hs,zs),this.core=t,this.logger=Hs,this.store=zs,P$1(this,"name",Ht$2),P$1(this,"abortController"),P$1(this,"isDevEnv"),P$1(this,"verifyUrlV3",Jt$1),P$1(this,"storagePrefix",W$1),P$1(this,"version",Fe),P$1(this,"publicKey"),P$1(this,"fetchPromise"),P$1(this,"init",async()=>{var Ys;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&cjs$3.toMiliseconds((Ys=this.publicKey)==null?void 0:Ys.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),P$1(this,"register",async Ys=>{if(!Wt$2()||this.isDevEnv)return;const Zs=window.location.origin,{id:_u,decryptedId:Eu}=Ys,Iu=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${Zs}&id=${_u}&decryptedId=${Eu}`;try{const Au=getDocument_1(),$u=this.startAbortTimer(cjs$3.ONE_SECOND*5),vu=await new Promise((Su,Ru)=>{const Pu=()=>{window.removeEventListener("message",Bu),Au.body.removeChild(Cu),Ru("attestation aborted")};this.abortController.signal.addEventListener("abort",Pu);const Cu=Au.createElement("iframe");Cu.src=Iu,Cu.style.display="none",Cu.addEventListener("error",Pu,{signal:this.abortController.signal});const Bu=Fu=>{if(Fu.data&&typeof Fu.data=="string")try{const zu=JSON.parse(Fu.data);if(zu.type==="verify_attestation"){if(sn$3(zu.attestation).payload.id!==_u)return;clearInterval($u),Au.body.removeChild(Cu),this.abortController.signal.removeEventListener("abort",Pu),window.removeEventListener("message",Bu),Su(zu.attestation===null?"":zu.attestation)}}catch(zu){this.logger.warn(zu)}};Au.body.appendChild(Cu),window.addEventListener("message",Bu,{signal:this.abortController.signal})});return this.logger.debug(vu,"jwt attestation"),vu}catch(Au){this.logger.warn(Au)}return""}),P$1(this,"resolve",async Ys=>{if(this.isDevEnv)return"";const{attestationId:Zs,hash:_u,encryptedId:Eu}=Ys;if(Zs===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(Zs){if(sn$3(Zs).payload.id!==Eu)return;const Au=await this.isValidJwtAttestation(Zs);if(Au){if(!Au.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return Au}}if(!_u)return;const Iu=this.getVerifyUrl(Ys==null?void 0:Ys.verifyUrl);return this.fetchAttestation(_u,Iu)}),P$1(this,"fetchAttestation",async(Ys,Zs)=>{this.logger.debug(`resolving attestation: ${Ys} from url: ${Zs}`);const _u=this.startAbortTimer(cjs$3.ONE_SECOND*5),Eu=await fetch(`${Zs}/attestation/${Ys}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(_u),Eu.status===200?await Eu.json():void 0}),P$1(this,"getVerifyUrl",Ys=>{let Zs=Ys||be;return Xt$1.includes(Zs)||(this.logger.info(`verify url: ${Zs}, not included in trusted list, assigning default: ${be}`),Zs=be),Zs}),P$1(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const Ys=this.startAbortTimer(cjs$3.FIVE_SECONDS),Zs=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(Ys),await Zs.json()}catch(Ys){this.logger.warn(Ys)}}),P$1(this,"persistPublicKey",async Ys=>{this.logger.debug(Ys,"persisting public key to local storage"),await this.store.setItem(this.storeKey,Ys),this.publicKey=Ys}),P$1(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),P$1(this,"isValidJwtAttestation",async Ys=>{const Zs=await this.getPublicKey();try{if(Zs)return this.validateAttestation(Ys,Zs)}catch(Eu){this.logger.error(Eu),this.logger.warn("error validating attestation")}const _u=await this.fetchAndPersistPublicKey();try{if(_u)return this.validateAttestation(Ys,_u)}catch(Eu){this.logger.error(Eu),this.logger.warn("error validating attestation")}}),P$1(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),P$1(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async Zs=>{const _u=await this.fetchPublicKey();_u&&(await this.persistPublicKey(_u),Zs(_u))});const Ys=await this.fetchPromise;return this.fetchPromise=void 0,Ys}),P$1(this,"validateAttestation",(Ys,Zs)=>{const _u=Ea(Ys,Zs.publicKey),Eu={hasExpired:cjs$3.toMiliseconds(_u.exp)<Date.now(),payload:_u};if(Eu.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:Eu.payload.origin,isScam:Eu.payload.isScam,isVerified:Eu.payload.isVerified}}),this.logger=X$2(Hs,this.name),this.abortController=new AbortController,this.isDevEnv=ji$1(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return w$1(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),cjs$3.toMiliseconds(t))}}var Wo=Object.defineProperty,Ho=(Z,t,Hs)=>t in Z?Wo(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,Bi=(Z,t,Hs)=>Ho(Z,typeof t!="symbol"?t+"":t,Hs);class Vi extends O$2{constructor(t,Hs){super(t,Hs),this.projectId=t,this.logger=Hs,Bi(this,"context",Zt$1),Bi(this,"registerDeviceToken",async zs=>{const{clientId:Ys,token:Zs,notificationType:_u,enableEncrypted:Eu=!1}=zs,Iu=`${Qt$1}/${this.projectId}/clients`;await fetch(Iu,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:Ys,type:_u,token:Zs,always_raw:Eu})})}),this.logger=X$2(Hs,this.context)}}var Yo=Object.defineProperty,qi=Object.getOwnPropertySymbols,Jo=Object.prototype.hasOwnProperty,Xo=Object.prototype.propertyIsEnumerable,et$1=(Z,t,Hs)=>t in Z?Yo(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,_e$1=(Z,t)=>{for(var Hs in t||(t={}))Jo.call(t,Hs)&&et$1(Z,Hs,t[Hs]);if(qi)for(var Hs of qi(t))Xo.call(t,Hs)&&et$1(Z,Hs,t[Hs]);return Z},A=(Z,t,Hs)=>et$1(Z,typeof t!="symbol"?t+"":t,Hs);class Gi extends R$2{constructor(t,Hs,zs=!0){super(t,Hs,zs),this.core=t,this.logger=Hs,A(this,"context",ti),A(this,"storagePrefix",W$1),A(this,"storageVersion",ei),A(this,"events",new Map),A(this,"shouldPersist",!1),A(this,"init",async()=>{if(!ji$1())try{const Ys={eventId:Ci$1(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:wr$1(this.core.relayer.protocol,this.core.relayer.version,Pe)}}};await this.sendEvent([Ys])}catch(Ys){this.logger.warn(Ys)}}),A(this,"createEvent",Ys=>{const{event:Zs="ERROR",type:_u="",properties:{topic:Eu,trace:Iu}}=Ys,Au=Ci$1(),$u=this.core.projectId||"",vu=Date.now(),Su=_e$1({eventId:Au,timestamp:vu,props:{event:Zs,type:_u,properties:{topic:Eu,trace:Iu}},bundleId:$u,domain:this.getAppDomain()},this.setMethods(Au));return this.telemetryEnabled&&(this.events.set(Au,Su),this.shouldPersist=!0),Su}),A(this,"getEvent",Ys=>{const{eventId:Zs,topic:_u}=Ys;if(Zs)return this.events.get(Zs);const Eu=Array.from(this.events.values()).find(Iu=>Iu.props.properties.topic===_u);if(Eu)return _e$1(_e$1({},Eu),this.setMethods(Eu.eventId))}),A(this,"deleteEvent",Ys=>{const{eventId:Zs}=Ys;this.events.delete(Zs),this.shouldPersist=!0}),A(this,"setEventListeners",()=>{this.core.heartbeat.on(r$1.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(Ys=>{cjs$3.fromMiliseconds(Date.now())-cjs$3.fromMiliseconds(Ys.timestamp)>ii&&(this.events.delete(Ys.eventId),this.shouldPersist=!0)})})}),A(this,"setMethods",Ys=>({addTrace:Zs=>this.addTrace(Ys,Zs),setError:Zs=>this.setError(Ys,Zs)})),A(this,"addTrace",(Ys,Zs)=>{const _u=this.events.get(Ys);_u&&(_u.props.properties.trace.push(Zs),this.events.set(Ys,_u),this.shouldPersist=!0)}),A(this,"setError",(Ys,Zs)=>{const _u=this.events.get(Ys);_u&&(_u.props.type=Zs,_u.timestamp=Date.now(),this.events.set(Ys,_u),this.shouldPersist=!0)}),A(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),A(this,"restore",async()=>{try{const Ys=await this.core.storage.getItem(this.storageKey)||[];if(!Ys.length)return;Ys.forEach(Zs=>{this.events.set(Zs.eventId,_e$1(_e$1({},Zs),this.setMethods(Zs.eventId)))})}catch(Ys){this.logger.warn(Ys)}}),A(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const Ys=[];for(const[Zs,_u]of this.events)_u.props.type&&Ys.push(_u);if(Ys.length!==0)try{if((await this.sendEvent(Ys)).ok)for(const Zs of Ys)this.events.delete(Zs.eventId),this.shouldPersist=!0}catch(Zs){this.logger.warn(Zs)}}),A(this,"sendEvent",async Ys=>{const Zs=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${si}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Pe}${Zs}`,{method:"POST",body:JSON.stringify(Ys)})}),A(this,"getAppDomain",()=>br$1().url),this.logger=X$2(Hs,this.context),this.telemetryEnabled=zs,zs?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var Zo=Object.defineProperty,Wi=Object.getOwnPropertySymbols,Qo=Object.prototype.hasOwnProperty,ea=Object.prototype.propertyIsEnumerable,tt$1=(Z,t,Hs)=>t in Z?Zo(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,Hi=(Z,t)=>{for(var Hs in t||(t={}))Qo.call(t,Hs)&&tt$1(Z,Hs,t[Hs]);if(Wi)for(var Hs of Wi(t))ea.call(t,Hs)&&tt$1(Z,Hs,t[Hs]);return Z},v$2=(Z,t,Hs)=>tt$1(Z,typeof t!="symbol"?t+"":t,Hs);class Oe extends h$1{constructor(t){var Hs;super(t),v$2(this,"protocol",Ue),v$2(this,"version",Fe),v$2(this,"name",ge),v$2(this,"relayUrl"),v$2(this,"projectId"),v$2(this,"customStoragePrefix"),v$2(this,"events",new eventsExports.EventEmitter),v$2(this,"logger"),v$2(this,"heartbeat"),v$2(this,"relayer"),v$2(this,"crypto"),v$2(this,"storage"),v$2(this,"history"),v$2(this,"expirer"),v$2(this,"pairing"),v$2(this,"verify"),v$2(this,"echoClient"),v$2(this,"linkModeSupportedApps"),v$2(this,"eventClient"),v$2(this,"initialized",!1),v$2(this,"logChunkController"),v$2(this,"on",(Eu,Iu)=>this.events.on(Eu,Iu)),v$2(this,"once",(Eu,Iu)=>this.events.once(Eu,Iu)),v$2(this,"off",(Eu,Iu)=>this.events.off(Eu,Iu)),v$2(this,"removeListener",(Eu,Iu)=>this.events.removeListener(Eu,Iu)),v$2(this,"dispatchEnvelope",({topic:Eu,message:Iu,sessionExists:Au})=>{if(!Eu||!Iu)return;const $u={topic:Eu,message:Iu,publishedAt:Date.now(),transportType:ee.link_mode};this.relayer.onLinkMessageEvent($u,{sessionExists:Au})});const zs=this.getGlobalCore(t==null?void 0:t.customStoragePrefix);if(zs)try{return this.customStoragePrefix=zs.customStoragePrefix,this.logger=zs.logger,this.heartbeat=zs.heartbeat,this.crypto=zs.crypto,this.history=zs.history,this.expirer=zs.expirer,this.storage=zs.storage,this.relayer=zs.relayer,this.pairing=zs.pairing,this.verify=zs.verify,this.echoClient=zs.echoClient,this.linkModeSupportedApps=zs.linkModeSupportedApps,this.eventClient=zs.eventClient,this.initialized=zs.initialized,this.logChunkController=zs.logChunkController,zs}catch(Eu){console.warn("Failed to copy globalThis core",Eu)}this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||Ke$1,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const Ys=D$1({level:typeof(t==null?void 0:t.logger)=="string"&&t.logger?t.logger:Et$2.logger,name:ge}),{logger:Zs,chunkLoggerController:_u}=Y$1({opts:Ys,maxSizeInBytes:t==null?void 0:t.maxLogBlobSizeInBytes,loggerOverride:t==null?void 0:t.logger});this.logChunkController=_u,(Hs=this.logChunkController)!=null&&Hs.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var Eu,Iu;(Eu=this.logChunkController)!=null&&Eu.downloadLogsBlobInBrowser&&((Iu=this.logChunkController)==null||Iu.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=X$2(Zs,this.name),this.heartbeat=new i$2,this.crypto=new wi(this,this.logger,t==null?void 0:t.keychain),this.history=new Fi(this,this.logger),this.expirer=new Mi(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new h$3(Hi(Hi({},It$2),t==null?void 0:t.storageOptions)),this.relayer=new Ai({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Ui(this,this.logger),this.verify=new Ki(this,this.logger,this.storage),this.echoClient=new Vi(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new Gi(this,this.logger,t==null?void 0:t.telemetryEnabled),this.setGlobalCore(this)}static async init(t){const Hs=new Oe(t);await Hs.initialize();const zs=await Hs.crypto.getClientId();return await Hs.storage.setItem(Ut$1,zs),Hs}get context(){return w$1(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var t;return(t=this.logChunkController)==null?void 0:t.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(t){this.linkModeSupportedApps.includes(t)||(this.linkModeSupportedApps.push(t),await this.storage.setItem(Be,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(Be)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(t,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(t.message),t}}getGlobalCore(t=""){try{if(this.isGlobalCoreDisabled())return;const Hs=`_walletConnectCore_${t}`,zs=`${Hs}_count`;return globalThis[zs]=(globalThis[zs]||0)+1,globalThis[zs]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[zs]} times.`),globalThis[Hs]}catch(Hs){console.warn("Failed to get globalThis WalletConnect core",Hs);return}}setGlobalCore(t){var Hs;try{if(this.isGlobalCoreDisabled())return;const zs=`_walletConnectCore_${((Hs=t.opts)==null?void 0:Hs.customStoragePrefix)||""}`;globalThis[zs]=t}catch(zs){console.warn("Failed to set globalThis WalletConnect core",zs)}}isGlobalCoreDisabled(){try{return typeof process$1<"u"&&{}.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}}const ta=Oe,Ve="wc",ke=2,De="client",we=`${Ve}@${ke}:${De}:`,me={name:De,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.org"},Ss={session_proposal:"session_proposal",session_update:"session_update",session_extend:"session_extend",session_ping:"session_ping",session_delete:"session_delete",session_expire:"session_expire",session_request:"session_request",session_request_sent:"session_request_sent",session_event:"session_event",proposal_expire:"proposal_expire",session_authenticate:"session_authenticate",session_request_expire:"session_request_expire",session_connect:"session_connect"},Rs={database:":memory:"},Le="WALLETCONNECT_DEEPLINK_CHOICE",vs={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Is="history",Ts="0.3",dt="proposal",qs=cjs$3.THIRTY_DAYS,Me="Proposal expired",ut$1="session",W=cjs$3.SEVEN_DAYS,gt$1="engine",P={wc_sessionPropose:{req:{ttl:cjs$3.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:cjs$3.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:cjs$3.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:cjs$3.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:cjs$3.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:cjs$3.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:cjs$3.ONE_DAY,prompt:!1,tag:1104},res:{ttl:cjs$3.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:cjs$3.ONE_DAY,prompt:!1,tag:1106},res:{ttl:cjs$3.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:cjs$3.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:cjs$3.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:cjs$3.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:cjs$3.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:cjs$3.ONE_DAY,prompt:!1,tag:1112},res:{ttl:cjs$3.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:cjs$3.ONE_DAY,prompt:!1,tag:1114},res:{ttl:cjs$3.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:cjs$3.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:cjs$3.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:cjs$3.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:cjs$3.FIVE_MINUTES,prompt:!1,tag:1119}}},_e={min:cjs$3.FIVE_MINUTES,max:cjs$3.SEVEN_DAYS},$$1={idle:"IDLE",active:"ACTIVE"},yt={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},wt="request",mt$1=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],_t$1="wc",Ps=1.5,ft$1="auth",Et$1="authKeys",St$1="pairingTopics",Rt$1="requests",le=`${_t$1}@${1.5}:${ft$1}:`,pe=`${le}:PUB_KEY`;var Ns=Object.defineProperty,Os=Object.defineProperties,bs=Object.getOwnPropertyDescriptors,vt$1=Object.getOwnPropertySymbols,As=Object.prototype.hasOwnProperty,xs=Object.prototype.propertyIsEnumerable,$e=(Z,t,Hs)=>t in Z?Ns(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,R=(Z,t)=>{for(var Hs in t||(t={}))As.call(t,Hs)&&$e(Z,Hs,t[Hs]);if(vt$1)for(var Hs of vt$1(t))xs.call(t,Hs)&&$e(Z,Hs,t[Hs]);return Z},O$1=(Z,t)=>Os(Z,bs(t)),c=(Z,t,Hs)=>$e(Z,typeof t!="symbol"?t+"":t,Hs);class Cs extends V$1{constructor(t){super(t),c(this,"name",gt$1),c(this,"events",new Nt$3),c(this,"initialized",!1),c(this,"requestQueue",{state:$$1.idle,queue:[]}),c(this,"sessionRequestQueue",{state:$$1.idle,queue:[]}),c(this,"emittedSessionRequests",new ki$1({limit:500})),c(this,"requestQueueDelay",cjs$3.ONE_SECOND),c(this,"expectedPairingMethodMap",new Map),c(this,"recentlyDeletedMap",new Map),c(this,"recentlyDeletedLimit",200),c(this,"relayMessageCache",[]),c(this,"pendingSessions",new Map),c(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(P)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},cjs$3.toMiliseconds(this.requestQueueDelay)))}),c(this,"connect",async Hs=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const zs=O$1(R({},Hs),{requiredNamespaces:Hs.requiredNamespaces||{},optionalNamespaces:Hs.optionalNamespaces||{}});await this.isValidConnect(zs),zs.optionalNamespaces=qa(zs.requiredNamespaces,zs.optionalNamespaces),zs.requiredNamespaces={};const{pairingTopic:Ys,requiredNamespaces:Zs,optionalNamespaces:_u,sessionProperties:Eu,scopedProperties:Iu,relays:Au}=zs;let $u=Ys,vu,Su=!1;try{if($u){const Xu=this.client.core.pairing.pairings.get($u);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),Su=Xu.active}}catch(Xu){throw this.client.logger.error(`connect() -> pairing.get(${$u}) failed`),Xu}if(!$u||!Su){const{topic:Xu,uri:ju}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});$u=Xu,vu=ju}if(!$u){const{message:Xu}=Bt$2("NO_MATCHING_KEY",`connect() pairing topic: ${$u}`);throw new Error(Xu)}const Ru=await this.client.core.crypto.generateKeyPair(),Pu=P.wc_sessionPropose.req.ttl||cjs$3.FIVE_MINUTES,Cu=Ni$1(Pu),Bu=O$1(R(R({requiredNamespaces:Zs,optionalNamespaces:_u,relays:Au??[{protocol:Nt}],proposer:{publicKey:Ru,metadata:this.client.metadata},expiryTimestamp:Cu,pairingTopic:$u},Eu&&{sessionProperties:Eu}),Iu&&{scopedProperties:Iu}),{id:payloadId()}),Fu=_i$1("session_connect",Bu.id),{reject:zu,resolve:Hu,done:Wu}=Bi$1(Pu,Me),tl=({id:Xu})=>{Xu===Bu.id&&(this.client.events.off("proposal_expire",tl),this.pendingSessions.delete(Bu.id),this.events.emit(Fu,{error:{message:Me,code:0}}))};return this.client.events.on("proposal_expire",tl),this.events.once(Fu,({error:Xu,session:ju})=>{this.client.events.off("proposal_expire",tl),Xu?zu(Xu):ju&&Hu(ju)}),await this.sendProposeSession({proposal:Bu,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:Bu.id}}}),await this.setProposal(Bu.id,Bu),{uri:vu,approval:Wu}}),c(this,"pair",async Hs=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(Hs)}catch(zs){throw this.client.logger.error("pair() failed"),zs}}),c(this,"approve",async Hs=>{var zs,Ys,Zs;const _u=this.client.core.eventClient.createEvent({properties:{topic:(zs=Hs==null?void 0:Hs.id)==null?void 0:zs.toString(),trace:[rr.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(Uu){throw _u.setError(nr.no_internet_connection),Uu}try{await this.isValidProposalId(Hs==null?void 0:Hs.id)}catch(Uu){throw this.client.logger.error(`approve() -> proposal.get(${Hs==null?void 0:Hs.id}) failed`),_u.setError(nr.proposal_not_found),Uu}try{await this.isValidApprove(Hs)}catch(Uu){throw this.client.logger.error("approve() -> isValidApprove() failed"),_u.setError(nr.session_approve_namespace_validation_failure),Uu}const{id:Eu,relayProtocol:Iu,namespaces:Au,sessionProperties:$u,scopedProperties:vu,sessionConfig:Su}=Hs,Ru=this.client.proposal.get(Eu);this.client.core.eventClient.deleteEvent({eventId:_u.eventId});const{pairingTopic:Pu,proposer:Cu,requiredNamespaces:Bu,optionalNamespaces:Fu}=Ru;let zu=(Ys=this.client.core.eventClient)==null?void 0:Ys.getEvent({topic:Pu});zu||(zu=(Zs=this.client.core.eventClient)==null?void 0:Zs.createEvent({type:rr.session_approve_started,properties:{topic:Pu,trace:[rr.session_approve_started,rr.session_namespaces_validation_success]}}));const Hu=await this.client.core.crypto.generateKeyPair(),Wu=Cu.publicKey,tl=await this.client.core.crypto.generateSharedKey(Hu,Wu),Xu=R(R(R({relay:{protocol:Iu??"irn"},namespaces:Au,controller:{publicKey:Hu,metadata:this.client.metadata},expiry:Ni$1(W)},$u&&{sessionProperties:$u}),vu&&{scopedProperties:vu}),Su&&{sessionConfig:Su}),ju=ee.relay;zu.addTrace(rr.subscribing_session_topic);try{await this.client.core.relayer.subscribe(tl,{transportType:ju,internal:{skipSubscribe:!0}})}catch(Uu){throw zu.setError(nr.subscribe_session_topic_failure),Uu}zu.addTrace(rr.subscribe_session_topic_success);const ku=O$1(R({},Xu),{topic:tl,requiredNamespaces:Bu,optionalNamespaces:Fu,pairingTopic:Pu,acknowledged:!1,self:Xu.controller,peer:{publicKey:Cu.publicKey,metadata:Cu.metadata},controller:Hu,transportType:ee.relay});await this.client.session.set(tl,ku),zu.addTrace(rr.store_session);try{await this.sendApproveSession({sessionTopic:tl,proposal:Ru,pairingProposalResponse:{relay:{protocol:Iu??"irn"},responderPublicKey:Hu},sessionSettleRequest:Xu,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:Eu}}}),zu.addTrace(rr.session_approve_publish_success)}catch(Uu){throw this.client.logger.error(Uu),this.client.session.delete(tl,zt$2("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(tl),Uu}return this.client.core.eventClient.deleteEvent({eventId:zu.eventId}),await this.client.core.pairing.updateMetadata({topic:Pu,metadata:Cu.metadata}),await this.deleteProposal(Eu),await this.client.core.pairing.activate({topic:Pu}),await this.setExpiry(tl,Ni$1(W)),{topic:tl,acknowledged:()=>Promise.resolve(this.client.session.get(tl))}}),c(this,"reject",async Hs=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(Hs)}catch(_u){throw this.client.logger.error("reject() -> isValidReject() failed"),_u}const{id:zs,reason:Ys}=Hs;let Zs;try{Zs=this.client.proposal.get(zs).pairingTopic}catch(_u){throw this.client.logger.error(`reject() -> proposal.get(${zs}) failed`),_u}Zs&&await this.sendError({id:zs,topic:Zs,error:Ys,rpcOpts:P.wc_sessionPropose.reject}),await this.deleteProposal(zs)}),c(this,"update",async Hs=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(Hs)}catch(vu){throw this.client.logger.error("update() -> isValidUpdate() failed"),vu}const{topic:zs,namespaces:Ys}=Hs,{done:Zs,resolve:_u,reject:Eu}=Bi$1(),Iu=payloadId(),Au=getBigIntRpcId().toString(),$u=this.client.session.get(zs).namespaces;return this.events.once(_i$1("session_update",Iu),({error:vu})=>{vu?Eu(vu):_u()}),await this.client.session.update(zs,{namespaces:Ys}),await this.sendRequest({topic:zs,method:"wc_sessionUpdate",params:{namespaces:Ys},throwOnFailedPublish:!0,clientRpcId:Iu,relayRpcId:Au}).catch(vu=>{this.client.logger.error(vu),this.client.session.update(zs,{namespaces:$u}),Eu(vu)}),{acknowledged:Zs}}),c(this,"extend",async Hs=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(Hs)}catch(Iu){throw this.client.logger.error("extend() -> isValidExtend() failed"),Iu}const{topic:zs}=Hs,Ys=payloadId(),{done:Zs,resolve:_u,reject:Eu}=Bi$1();return this.events.once(_i$1("session_extend",Ys),({error:Iu})=>{Iu?Eu(Iu):_u()}),await this.setExpiry(zs,Ni$1(W)),this.sendRequest({topic:zs,method:"wc_sessionExtend",params:{},clientRpcId:Ys,throwOnFailedPublish:!0}).catch(Iu=>{Eu(Iu)}),{acknowledged:Zs}}),c(this,"request",async Hs=>{this.isInitialized();try{await this.isValidRequest(Hs)}catch(Bu){throw this.client.logger.error("request() -> isValidRequest() failed"),Bu}const{chainId:zs,request:Ys,topic:Zs,expiry:_u=P.wc_sessionRequest.req.ttl}=Hs,Eu=this.client.session.get(Zs);(Eu==null?void 0:Eu.transportType)===ee.relay&&await this.confirmOnlineStateOrThrow();const Iu=payloadId(),Au=getBigIntRpcId().toString(),{done:$u,resolve:vu,reject:Su}=Bi$1(_u,"Request expired. Please try again.");this.events.once(_i$1("session_request",Iu),({error:Bu,result:Fu})=>{Bu?Su(Bu):vu(Fu)});const Ru="wc_sessionRequest",Pu=this.getAppLinkIfEnabled(Eu.peer.metadata,Eu.transportType);if(Pu)return await this.sendRequest({clientRpcId:Iu,relayRpcId:Au,topic:Zs,method:Ru,params:{request:O$1(R({},Ys),{expiryTimestamp:Ni$1(_u)}),chainId:zs},expiry:_u,throwOnFailedPublish:!0,appLink:Pu}).catch(Bu=>Su(Bu)),this.client.events.emit("session_request_sent",{topic:Zs,request:Ys,chainId:zs,id:Iu}),await $u();const Cu={request:O$1(R({},Ys),{expiryTimestamp:Ni$1(_u)}),chainId:zs};return await Promise.all([new Promise(async Bu=>{await this.sendRequest({clientRpcId:Iu,relayRpcId:Au,topic:Zs,method:Ru,params:Cu,expiry:_u,throwOnFailedPublish:!0,tvf:this.getTVFParams(Iu,Cu)}).catch(Fu=>Su(Fu)),this.client.events.emit("session_request_sent",{topic:Zs,request:Ys,chainId:zs,id:Iu}),Bu()}),new Promise(async Bu=>{var Fu;if(!((Fu=Eu.sessionConfig)!=null&&Fu.disableDeepLink)){const zu=await $i$1(this.client.core.storage,Le);await Ri$1({id:Iu,topic:Zs,wcDeepLink:zu})}Bu()}),$u()]).then(Bu=>Bu[2])}),c(this,"respond",async Hs=>{var zs,Ys;this.isInitialized();const Zs=this.client.core.eventClient.createEvent({properties:{topic:(Hs==null?void 0:Hs.topic)||((Ys=(zs=Hs==null?void 0:Hs.response)==null?void 0:zs.id)==null?void 0:Ys.toString()),trace:[rr.session_request_response_started]}});try{await this.isValidRespond(Hs)}catch(vu){throw Zs.addTrace(vu==null?void 0:vu.message),Zs.setError(nr.session_request_response_validation_failure),vu}Zs.addTrace(rr.session_request_response_validation_success);const{topic:_u,response:Eu}=Hs,{id:Iu}=Eu,Au=this.client.session.get(_u);Au.transportType===ee.relay&&await this.confirmOnlineStateOrThrow();const $u=this.getAppLinkIfEnabled(Au.peer.metadata,Au.transportType);try{Zs.addTrace(rr.session_request_response_publish_started),isJsonRpcResult(Eu)?await this.sendResult({id:Iu,topic:_u,result:Eu.result,throwOnFailedPublish:!0,appLink:$u}):isJsonRpcError(Eu)&&await this.sendError({id:Iu,topic:_u,error:Eu.error,appLink:$u}),this.cleanupAfterResponse(Hs)}catch(vu){throw Zs.addTrace(vu==null?void 0:vu.message),Zs.setError(nr.session_request_response_publish_failure),vu}}),c(this,"ping",async Hs=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(Hs)}catch(Ys){throw this.client.logger.error("ping() -> isValidPing() failed"),Ys}const{topic:zs}=Hs;if(this.client.session.keys.includes(zs)){const Ys=payloadId(),Zs=getBigIntRpcId().toString(),{done:_u,resolve:Eu,reject:Iu}=Bi$1();this.events.once(_i$1("session_ping",Ys),({error:Au})=>{Au?Iu(Au):Eu()}),await Promise.all([this.sendRequest({topic:zs,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:Ys,relayRpcId:Zs}),_u()])}else this.client.core.pairing.pairings.keys.includes(zs)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:zs}))}),c(this,"emit",async Hs=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(Hs);const{topic:zs,event:Ys,chainId:Zs}=Hs,_u=getBigIntRpcId().toString(),Eu=payloadId();await this.sendRequest({topic:zs,method:"wc_sessionEvent",params:{event:Ys,chainId:Zs},throwOnFailedPublish:!0,relayRpcId:_u,clientRpcId:Eu})}),c(this,"disconnect",async Hs=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(Hs);const{topic:zs}=Hs;if(this.client.session.keys.includes(zs))await this.sendRequest({topic:zs,method:"wc_sessionDelete",params:zt$2("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:zs,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(zs))await this.client.core.pairing.disconnect({topic:zs});else{const{message:Ys}=Bt$2("MISMATCHED_TOPIC",`Session or pairing topic not found: ${zs}`);throw new Error(Ys)}}),c(this,"find",Hs=>(this.isInitialized(),this.client.session.getAll().filter(zs=>Fa(zs,Hs)))),c(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),c(this,"authenticate",async(Hs,zs)=>{var Ys;this.isInitialized(),this.isValidAuthenticate(Hs);const Zs=zs&&this.client.core.linkModeSupportedApps.includes(zs)&&((Ys=this.client.metadata.redirect)==null?void 0:Ys.linkMode),_u=Zs?ee.link_mode:ee.relay;_u===ee.relay&&await this.confirmOnlineStateOrThrow();const{chains:Eu,statement:Iu="",uri:Au,domain:$u,nonce:vu,type:Su,exp:Ru,nbf:Pu,methods:Cu=[],expiry:Bu}=Hs,Fu=[...Hs.resources||[]],{topic:zu,uri:Hu}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:_u});this.client.logger.info({message:"Generated new pairing",pairing:{topic:zu,uri:Hu}});const Wu=await this.client.core.crypto.generateKeyPair(),tl=ha(Wu);if(await Promise.all([this.client.auth.authKeys.set(pe,{responseTopic:tl,publicKey:Wu}),this.client.auth.pairingTopics.set(tl,{topic:tl,pairingTopic:zu})]),await this.client.core.relayer.subscribe(tl,{transportType:_u}),this.client.logger.info(`sending request to new pairing topic: ${zu}`),Cu.length>0){const{namespace:hl}=Je$1(Eu[0]);let _l=Kc(hl,"request",Cu);je(Fu)&&(_l=qc(_l,Fu.pop())),Fu.push(_l)}const Xu=Bu&&Bu>P.wc_sessionAuthenticate.req.ttl?Bu:P.wc_sessionAuthenticate.req.ttl,ju={authPayload:{type:Su??"caip122",chains:Eu,statement:Iu,aud:Au,domain:$u,version:"1",nonce:vu,iat:new Date().toISOString(),exp:Ru,nbf:Pu,resources:Fu},requester:{publicKey:Wu,metadata:this.client.metadata},expiryTimestamp:Ni$1(Xu)},ku={eip155:{chains:Eu,methods:[...new Set(["personal_sign",...Cu])],events:["chainChanged","accountsChanged"]}},Uu={requiredNamespaces:{},optionalNamespaces:ku,relays:[{protocol:"irn"}],pairingTopic:zu,proposer:{publicKey:Wu,metadata:this.client.metadata},expiryTimestamp:Ni$1(P.wc_sessionPropose.req.ttl),id:payloadId()},{done:Gu,resolve:Yu,reject:Qu}=Bi$1(Xu,"Request expired"),Lu=payloadId(),cl=_i$1("session_connect",Uu.id),el=_i$1("session_request",Lu),Zu=async({error:hl,session:_l})=>{this.events.off(el,dl),hl?Qu(hl):_l&&Yu({session:_l})},dl=async hl=>{var _l,Rl,ol;if(await this.deletePendingAuthRequest(Lu,{message:"fulfilled",code:0}),hl.error){const Tl=zt$2("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return hl.error.code===Tl.code?void 0:(this.events.off(cl,Zu),Qu(hl.error.message))}await this.deleteProposal(Uu.id),this.events.off(cl,Zu);const{cacaos:gl,responder:nl}=hl.result,Sl=[],ll=[];for(const Tl of gl){await Pc({cacao:Tl,projectId:this.client.core.projectId})||(this.client.logger.error(Tl,"Signature verification failed"),Qu(zt$2("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:qu}=Tl,Ou=je(qu.resources),Vu=[to$1(qu.iss)],il=bn$1(qu.iss);if(Ou){const sl=Fc(Ou),pl=Zc(Ou);Sl.push(...sl),Vu.push(...pl)}for(const sl of Vu)ll.push(`${sl}:${il}`)}const ul=await this.client.core.crypto.generateSharedKey(Wu,nl.publicKey);let Al;Sl.length>0&&(Al={topic:ul,acknowledged:!0,self:{publicKey:Wu,metadata:this.client.metadata},peer:nl,controller:nl.publicKey,expiry:Ni$1(W),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:zu,namespaces:Ka([...new Set(Sl)],[...new Set(ll)]),transportType:_u},await this.client.core.relayer.subscribe(ul,{transportType:_u}),await this.client.session.set(ul,Al),zu&&await this.client.core.pairing.updateMetadata({topic:zu,metadata:nl.metadata}),Al=this.client.session.get(ul)),(_l=this.client.metadata.redirect)!=null&&_l.linkMode&&(Rl=nl.metadata.redirect)!=null&&Rl.linkMode&&(ol=nl.metadata.redirect)!=null&&ol.universal&&zs&&(this.client.core.addLinkModeSupportedApp(nl.metadata.redirect.universal),this.client.session.update(ul,{transportType:ee.link_mode})),Yu({auths:gl,session:Al})};this.events.once(cl,Zu),this.events.once(el,dl);let El;try{if(Zs){const hl=formatJsonRpcRequest("wc_sessionAuthenticate",ju,Lu);this.client.core.history.set(zu,hl);const _l=await this.client.core.crypto.encode("",hl,{type:we$1,encoding:Ge$1});El=Ta(zs,zu,_l)}else await Promise.all([this.sendRequest({topic:zu,method:"wc_sessionAuthenticate",params:ju,expiry:Hs.expiry,throwOnFailedPublish:!0,clientRpcId:Lu}),this.sendRequest({topic:zu,method:"wc_sessionPropose",params:Uu,expiry:P.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:Uu.id})])}catch(hl){throw this.events.off(cl,Zu),this.events.off(el,dl),hl}return await this.setProposal(Uu.id,Uu),await this.setAuthRequest(Lu,{request:O$1(R({},ju),{verifyContext:{}}),pairingTopic:zu,transportType:_u}),{uri:El??Hu,response:Gu}}),c(this,"approveSessionAuthenticate",async Hs=>{const{id:zs,auths:Ys}=Hs,Zs=this.client.core.eventClient.createEvent({properties:{topic:zs.toString(),trace:[or.authenticated_session_approve_started]}});try{this.isInitialized()}catch(Bu){throw Zs.setError(ar.no_internet_connection),Bu}const _u=this.getPendingAuthRequest(zs);if(!_u)throw Zs.setError(ar.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${zs}`);const Eu=_u.transportType||ee.relay;Eu===ee.relay&&await this.confirmOnlineStateOrThrow();const Iu=_u.requester.publicKey,Au=await this.client.core.crypto.generateKeyPair(),$u=ha(Iu),vu={type:ie,receiverPublicKey:Iu,senderPublicKey:Au},Su=[],Ru=[];for(const Bu of Ys){if(!await Pc({cacao:Bu,projectId:this.client.core.projectId})){Zs.setError(ar.invalid_cacao);const tl=zt$2("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:zs,topic:$u,error:tl,encodeOpts:vu}),new Error(tl.message)}Zs.addTrace(or.cacaos_verified);const{p:Fu}=Bu,zu=je(Fu.resources),Hu=[to$1(Fu.iss)],Wu=bn$1(Fu.iss);if(zu){const tl=Fc(zu),Xu=Zc(zu);Su.push(...tl),Hu.push(...Xu)}for(const tl of Hu)Ru.push(`${tl}:${Wu}`)}const Pu=await this.client.core.crypto.generateSharedKey(Au,Iu);Zs.addTrace(or.create_authenticated_session_topic);let Cu;if((Su==null?void 0:Su.length)>0){Cu={topic:Pu,acknowledged:!0,self:{publicKey:Au,metadata:this.client.metadata},peer:{publicKey:Iu,metadata:_u.requester.metadata},controller:Iu,expiry:Ni$1(W),authentication:Ys,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:_u.pairingTopic,namespaces:Ka([...new Set(Su)],[...new Set(Ru)]),transportType:Eu},Zs.addTrace(or.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(Pu,{transportType:Eu})}catch(Bu){throw Zs.setError(ar.subscribe_authenticated_session_topic_failure),Bu}Zs.addTrace(or.subscribe_authenticated_session_topic_success),await this.client.session.set(Pu,Cu),Zs.addTrace(or.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:_u.pairingTopic,metadata:_u.requester.metadata})}Zs.addTrace(or.publishing_authenticated_session_approve);try{await this.sendResult({topic:$u,id:zs,result:{cacaos:Ys,responder:{publicKey:Au,metadata:this.client.metadata}},encodeOpts:vu,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(_u.requester.metadata,Eu)})}catch(Bu){throw Zs.setError(ar.authenticated_session_approve_publish_failure),Bu}return await this.client.auth.requests.delete(zs,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:_u.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:Zs.eventId}),{session:Cu}}),c(this,"rejectSessionAuthenticate",async Hs=>{this.isInitialized();const{id:zs,reason:Ys}=Hs,Zs=this.getPendingAuthRequest(zs);if(!Zs)throw new Error(`Could not find pending auth request with id ${zs}`);Zs.transportType===ee.relay&&await this.confirmOnlineStateOrThrow();const _u=Zs.requester.publicKey,Eu=await this.client.core.crypto.generateKeyPair(),Iu=ha(_u),Au={type:ie,receiverPublicKey:_u,senderPublicKey:Eu};await this.sendError({id:zs,topic:Iu,error:Ys,encodeOpts:Au,rpcOpts:P.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(Zs.requester.metadata,Zs.transportType)}),await this.client.auth.requests.delete(zs,{message:"rejected",code:0}),await this.deleteProposal(zs)}),c(this,"formatAuthMessage",Hs=>{this.isInitialized();const{request:zs,iss:Ys}=Hs;return eo$1(zs,Ys)}),c(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const Hs=this.relayMessageCache.shift();Hs&&await this.onRelayMessage(Hs)}catch(Hs){this.client.logger.error(Hs)}},50)}),c(this,"cleanupDuplicatePairings",async Hs=>{if(Hs.pairingTopic)try{const zs=this.client.core.pairing.pairings.get(Hs.pairingTopic),Ys=this.client.core.pairing.pairings.getAll().filter(Zs=>{var _u,Eu;return((_u=Zs.peerMetadata)==null?void 0:_u.url)&&((Eu=Zs.peerMetadata)==null?void 0:Eu.url)===Hs.peer.metadata.url&&Zs.topic&&Zs.topic!==zs.topic});if(Ys.length===0)return;this.client.logger.info(`Cleaning up ${Ys.length} duplicate pairing(s)`),await Promise.all(Ys.map(Zs=>this.client.core.pairing.disconnect({topic:Zs.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(zs){this.client.logger.error(zs)}}),c(this,"deleteSession",async Hs=>{var zs;const{topic:Ys,expirerHasDeleted:Zs=!1,emitEvent:_u=!0,id:Eu=0}=Hs,{self:Iu}=this.client.session.get(Ys);await this.client.core.relayer.unsubscribe(Ys),await this.client.session.delete(Ys,zt$2("USER_DISCONNECTED")),this.addToRecentlyDeleted(Ys,"session"),this.client.core.crypto.keychain.has(Iu.publicKey)&&await this.client.core.crypto.deleteKeyPair(Iu.publicKey),this.client.core.crypto.keychain.has(Ys)&&await this.client.core.crypto.deleteSymKey(Ys),Zs||this.client.core.expirer.del(Ys),this.client.core.storage.removeItem(Le).catch(Au=>this.client.logger.warn(Au)),this.getPendingSessionRequests().forEach(Au=>{Au.topic===Ys&&this.deletePendingSessionRequest(Au.id,zt$2("USER_DISCONNECTED"))}),Ys===((zs=this.sessionRequestQueue.queue[0])==null?void 0:zs.topic)&&(this.sessionRequestQueue.state=$$1.idle),_u&&this.client.events.emit("session_delete",{id:Eu,topic:Ys})}),c(this,"deleteProposal",async(Hs,zs)=>{if(zs)try{const Ys=this.client.proposal.get(Hs),Zs=this.client.core.eventClient.getEvent({topic:Ys.pairingTopic});Zs==null||Zs.setError(nr.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(Hs,zt$2("USER_DISCONNECTED")),zs?Promise.resolve():this.client.core.expirer.del(Hs)]),this.addToRecentlyDeleted(Hs,"proposal")}),c(this,"deletePendingSessionRequest",async(Hs,zs,Ys=!1)=>{await Promise.all([this.client.pendingRequest.delete(Hs,zs),Ys?Promise.resolve():this.client.core.expirer.del(Hs)]),this.addToRecentlyDeleted(Hs,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(Zs=>Zs.id!==Hs),Ys&&(this.sessionRequestQueue.state=$$1.idle,this.client.events.emit("session_request_expire",{id:Hs}))}),c(this,"deletePendingAuthRequest",async(Hs,zs,Ys=!1)=>{await Promise.all([this.client.auth.requests.delete(Hs,zs),Ys?Promise.resolve():this.client.core.expirer.del(Hs)])}),c(this,"setExpiry",async(Hs,zs)=>{this.client.session.keys.includes(Hs)&&(this.client.core.expirer.set(Hs,zs),await this.client.session.update(Hs,{expiry:zs}))}),c(this,"setProposal",async(Hs,zs)=>{this.client.core.expirer.set(Hs,Ni$1(P.wc_sessionPropose.req.ttl)),await this.client.proposal.set(Hs,zs)}),c(this,"setAuthRequest",async(Hs,zs)=>{const{request:Ys,pairingTopic:Zs,transportType:_u=ee.relay}=zs;this.client.core.expirer.set(Hs,Ys.expiryTimestamp),await this.client.auth.requests.set(Hs,{authPayload:Ys.authPayload,requester:Ys.requester,expiryTimestamp:Ys.expiryTimestamp,id:Hs,pairingTopic:Zs,verifyContext:Ys.verifyContext,transportType:_u})}),c(this,"setPendingSessionRequest",async Hs=>{const{id:zs,topic:Ys,params:Zs,verifyContext:_u}=Hs,Eu=Zs.request.expiryTimestamp||Ni$1(P.wc_sessionRequest.req.ttl);this.client.core.expirer.set(zs,Eu),await this.client.pendingRequest.set(zs,{id:zs,topic:Ys,params:Zs,verifyContext:_u})}),c(this,"sendRequest",async Hs=>{const{topic:zs,method:Ys,params:Zs,expiry:_u,relayRpcId:Eu,clientRpcId:Iu,throwOnFailedPublish:Au,appLink:$u,tvf:vu,publishOpts:Su={}}=Hs,Ru=formatJsonRpcRequest(Ys,Zs,Iu);let Pu;const Cu=!!$u;try{const zu=Cu?Ge$1:oe$1;Pu=await this.client.core.crypto.encode(zs,Ru,{encoding:zu})}catch(zu){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${zs} failed`),zu}let Bu;if(mt$1.includes(Ys)){const zu=pa(JSON.stringify(Ru)),Hu=pa(Pu);Bu=await this.client.core.verify.register({id:Hu,decryptedId:zu})}const Fu=R(R({},P[Ys].req),Su);if(Fu.attestation=Bu,_u&&(Fu.ttl=_u),Eu&&(Fu.id=Eu),this.client.core.history.set(zs,Ru),Cu){const zu=Ta($u,zs,Pu);await globalThis.Linking.openURL(zu,this.client.name)}else Fu.tvf=O$1(R({},vu),{correlationId:Ru.id}),Au?(Fu.internal=O$1(R({},Fu.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(zs,Pu,Fu)):this.client.core.relayer.publish(zs,Pu,Fu).catch(zu=>this.client.logger.error(zu));return Ru.id}),c(this,"sendProposeSession",async Hs=>{const{proposal:zs,publishOpts:Ys}=Hs,Zs=formatJsonRpcRequest("wc_sessionPropose",zs,zs.id);this.client.core.history.set(zs.pairingTopic,Zs);const _u=await this.client.core.crypto.encode(zs.pairingTopic,Zs,{encoding:oe$1}),Eu=pa(JSON.stringify(Zs)),Iu=pa(_u),Au=await this.client.core.verify.register({id:Iu,decryptedId:Eu});await this.client.core.relayer.publishCustom({payload:{pairingTopic:zs.pairingTopic,sessionProposal:_u},opts:O$1(R({},Ys),{publishMethod:"wc_proposeSession",attestation:Au})})}),c(this,"sendApproveSession",async Hs=>{const{sessionTopic:zs,pairingProposalResponse:Ys,proposal:Zs,sessionSettleRequest:_u,publishOpts:Eu}=Hs,Iu=formatJsonRpcResult(Zs.id,Ys),Au=await this.client.core.crypto.encode(Zs.pairingTopic,Iu,{encoding:oe$1}),$u=formatJsonRpcRequest("wc_sessionSettle",_u,Eu==null?void 0:Eu.id),vu=await this.client.core.crypto.encode(zs,$u,{encoding:oe$1});this.client.core.history.set(zs,$u),await this.client.core.relayer.publishCustom({payload:{sessionTopic:zs,pairingTopic:Zs.pairingTopic,sessionProposalResponse:Au,sessionSettlementRequest:vu},opts:O$1(R({},Eu),{publishMethod:"wc_approveSession"})})}),c(this,"sendResult",async Hs=>{const{id:zs,topic:Ys,result:Zs,throwOnFailedPublish:_u,encodeOpts:Eu,appLink:Iu}=Hs,Au=formatJsonRpcResult(zs,Zs);let $u;const vu=Iu&&typeof(globalThis==null?void 0:globalThis.Linking)<"u";try{const Pu=vu?Ge$1:oe$1;$u=await this.client.core.crypto.encode(Ys,Au,O$1(R({},Eu||{}),{encoding:Pu}))}catch(Pu){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${Ys} failed`),Pu}let Su,Ru;try{Su=await this.client.core.history.get(Ys,zs);const Pu=Su.request;try{Ru=this.getTVFParams(zs,Pu.params,Zs)}catch(Cu){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${Cu==null?void 0:Cu.message}`)}}catch(Pu){throw this.client.logger.error(`sendResult() -> history.get(${Ys}, ${zs}) failed`),Pu}if(vu){const Pu=Ta(Iu,Ys,$u);await globalThis.Linking.openURL(Pu,this.client.name)}else{const Pu=Su.request.method,Cu=P[Pu].res;Cu.tvf=O$1(R({},Ru),{correlationId:zs}),_u?(Cu.internal=O$1(R({},Cu.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(Ys,$u,Cu)):this.client.core.relayer.publish(Ys,$u,Cu).catch(Bu=>this.client.logger.error(Bu))}await this.client.core.history.resolve(Au)}),c(this,"sendError",async Hs=>{const{id:zs,topic:Ys,error:Zs,encodeOpts:_u,rpcOpts:Eu,appLink:Iu}=Hs,Au=formatJsonRpcError(zs,Zs);let $u;const vu=Iu&&typeof(globalThis==null?void 0:globalThis.Linking)<"u";try{const Ru=vu?Ge$1:oe$1;$u=await this.client.core.crypto.encode(Ys,Au,O$1(R({},_u||{}),{encoding:Ru}))}catch(Ru){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${Ys} failed`),Ru}let Su;try{Su=await this.client.core.history.get(Ys,zs)}catch(Ru){throw this.client.logger.error(`sendError() -> history.get(${Ys}, ${zs}) failed`),Ru}if(vu){const Ru=Ta(Iu,Ys,$u);await globalThis.Linking.openURL(Ru,this.client.name)}else{const Ru=Su.request.method,Pu=Eu||P[Ru].res;this.client.core.relayer.publish(Ys,$u,Pu)}await this.client.core.history.resolve(Au)}),c(this,"cleanup",async()=>{const Hs=[],zs=[];this.client.session.getAll().forEach(Ys=>{let Zs=!1;Ui$1(Ys.expiry)&&(Zs=!0),this.client.core.crypto.keychain.has(Ys.topic)||(Zs=!0),Zs&&Hs.push(Ys.topic)}),this.client.proposal.getAll().forEach(Ys=>{Ui$1(Ys.expiryTimestamp)&&zs.push(Ys.id)}),await Promise.all([...Hs.map(Ys=>this.deleteSession({topic:Ys})),...zs.map(Ys=>this.deleteProposal(Ys))])}),c(this,"onProviderMessageEvent",async Hs=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(Hs):await this.onRelayMessage(Hs)}),c(this,"onRelayEventRequest",async Hs=>{this.requestQueue.queue.push(Hs),await this.processRequestsQueue()}),c(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===$$1.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=$$1.active;const Hs=this.requestQueue.queue.shift();if(Hs)try{await this.processRequest(Hs)}catch(zs){this.client.logger.warn(zs)}}this.requestQueue.state=$$1.idle}),c(this,"processRequest",async Hs=>{const{topic:zs,payload:Ys,attestation:Zs,transportType:_u,encryptedId:Eu}=Hs,Iu=Ys.method;if(!this.shouldIgnorePairingRequest({topic:zs,requestMethod:Iu}))switch(Iu){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:zs,payload:Ys,attestation:Zs,encryptedId:Eu});case"wc_sessionSettle":return await this.onSessionSettleRequest(zs,Ys);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(zs,Ys);case"wc_sessionExtend":return await this.onSessionExtendRequest(zs,Ys);case"wc_sessionPing":return await this.onSessionPingRequest(zs,Ys);case"wc_sessionDelete":return await this.onSessionDeleteRequest(zs,Ys);case"wc_sessionRequest":return await this.onSessionRequest({topic:zs,payload:Ys,attestation:Zs,encryptedId:Eu,transportType:_u});case"wc_sessionEvent":return await this.onSessionEventRequest(zs,Ys);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:zs,payload:Ys,attestation:Zs,encryptedId:Eu,transportType:_u});default:return this.client.logger.info(`Unsupported request method ${Iu}`)}}),c(this,"onRelayEventResponse",async Hs=>{const{topic:zs,payload:Ys,transportType:Zs}=Hs,_u=(await this.client.core.history.get(zs,Ys.id)).request.method;switch(_u){case"wc_sessionPropose":return this.onSessionProposeResponse(zs,Ys,Zs);case"wc_sessionSettle":return this.onSessionSettleResponse(zs,Ys);case"wc_sessionUpdate":return this.onSessionUpdateResponse(zs,Ys);case"wc_sessionExtend":return this.onSessionExtendResponse(zs,Ys);case"wc_sessionPing":return this.onSessionPingResponse(zs,Ys);case"wc_sessionRequest":return this.onSessionRequestResponse(zs,Ys);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(zs,Ys);default:return this.client.logger.info(`Unsupported response method ${_u}`)}}),c(this,"onRelayEventUnknownPayload",Hs=>{const{topic:zs}=Hs,{message:Ys}=Bt$2("MISSING_OR_INVALID",`Decoded payload on topic ${zs} is not identifiable as a JSON-RPC request or a response.`);throw new Error(Ys)}),c(this,"shouldIgnorePairingRequest",Hs=>{const{topic:zs,requestMethod:Ys}=Hs,Zs=this.expectedPairingMethodMap.get(zs);return!Zs||Zs.includes(Ys)?!1:!!(Zs.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),c(this,"onSessionProposeRequest",async Hs=>{const{topic:zs,payload:Ys,attestation:Zs,encryptedId:_u}=Hs,{params:Eu,id:Iu}=Ys;try{const Au=this.client.core.eventClient.getEvent({topic:zs});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),Au==null||Au.setError(X.proposal_listener_not_found)),this.isValidConnect(R({},Ys.params));const $u=Eu.expiryTimestamp||Ni$1(P.wc_sessionPropose.req.ttl),vu=R({id:Iu,pairingTopic:zs,expiryTimestamp:$u,attestation:Zs,encryptedId:_u},Eu);await this.setProposal(Iu,vu);const Su=await this.getVerifyContext({attestationId:Zs,hash:pa(JSON.stringify(Ys)),encryptedId:_u,metadata:vu.proposer.metadata});Au==null||Au.addTrace(Y.emit_session_proposal),this.client.events.emit("session_proposal",{id:Iu,params:vu,verifyContext:Su})}catch(Au){await this.sendError({id:Iu,topic:zs,error:Au,rpcOpts:P.wc_sessionPropose.autoReject}),this.client.logger.error(Au)}}),c(this,"onSessionProposeResponse",async(Hs,zs,Ys)=>{const{id:Zs}=zs;if(isJsonRpcResult(zs)){const{result:_u}=zs;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:_u});const Eu=this.client.proposal.get(Zs);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:Eu});const Iu=Eu.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:Iu});const Au=_u.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:Au});const $u=await this.client.core.crypto.generateSharedKey(Iu,Au);this.pendingSessions.set(Zs,{sessionTopic:$u,pairingTopic:Hs,proposalId:Zs,publicKey:Iu});const vu=await this.client.core.relayer.subscribe($u,{transportType:Ys});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:vu}),await this.client.core.pairing.activate({topic:Hs})}else if(isJsonRpcError(zs)){await this.deleteProposal(Zs);const _u=_i$1("session_connect",Zs);if(this.events.listenerCount(_u)===0)throw new Error(`emitting ${_u} without any listeners, 954`);this.events.emit(_u,{error:zs.error})}}),c(this,"onSessionSettleRequest",async(Hs,zs)=>{const{id:Ys,params:Zs}=zs;try{this.isValidSessionSettleRequest(Zs);const{relay:_u,controller:Eu,expiry:Iu,namespaces:Au,sessionProperties:$u,scopedProperties:vu,sessionConfig:Su}=zs.params,Ru=[...this.pendingSessions.values()].find(Bu=>Bu.sessionTopic===Hs);if(!Ru)return this.client.logger.error(`Pending session not found for topic ${Hs}`);const Pu=this.client.proposal.get(Ru.proposalId),Cu=O$1(R(R(R({topic:Hs,relay:_u,expiry:Iu,namespaces:Au,acknowledged:!0,pairingTopic:Ru.pairingTopic,requiredNamespaces:Pu.requiredNamespaces,optionalNamespaces:Pu.optionalNamespaces,controller:Eu.publicKey,self:{publicKey:Ru.publicKey,metadata:this.client.metadata},peer:{publicKey:Eu.publicKey,metadata:Eu.metadata}},$u&&{sessionProperties:$u}),vu&&{scopedProperties:vu}),Su&&{sessionConfig:Su}),{transportType:ee.relay});await this.client.session.set(Cu.topic,Cu),await this.setExpiry(Cu.topic,Cu.expiry),await this.client.core.pairing.updateMetadata({topic:Ru.pairingTopic,metadata:Cu.peer.metadata}),this.client.events.emit("session_connect",{session:Cu}),this.events.emit(_i$1("session_connect",Ru.proposalId),{session:Cu}),this.pendingSessions.delete(Ru.proposalId),this.deleteProposal(Ru.proposalId,!1),this.cleanupDuplicatePairings(Cu),await this.sendResult({id:zs.id,topic:Hs,result:!0})}catch(_u){await this.sendError({id:Ys,topic:Hs,error:_u}),this.client.logger.error(_u)}}),c(this,"onSessionSettleResponse",async(Hs,zs)=>{const{id:Ys}=zs;isJsonRpcResult(zs)?(await this.client.session.update(Hs,{acknowledged:!0}),this.events.emit(_i$1("session_approve",Ys),{})):isJsonRpcError(zs)&&(await this.client.session.delete(Hs,zt$2("USER_DISCONNECTED")),this.events.emit(_i$1("session_approve",Ys),{error:zs.error}))}),c(this,"onSessionUpdateRequest",async(Hs,zs)=>{const{params:Ys,id:Zs}=zs;try{const _u=`${Hs}_session_update`,Eu=hu.get(_u);if(Eu&&this.isRequestOutOfSync(Eu,Zs)){this.client.logger.warn(`Discarding out of sync request - ${Zs}`),this.sendError({id:Zs,topic:Hs,error:zt$2("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(R({topic:Hs},Ys));try{hu.set(_u,Zs),await this.client.session.update(Hs,{namespaces:Ys.namespaces}),await this.sendResult({id:Zs,topic:Hs,result:!0})}catch(Iu){throw hu.delete(_u),Iu}this.client.events.emit("session_update",{id:Zs,topic:Hs,params:Ys})}catch(_u){await this.sendError({id:Zs,topic:Hs,error:_u}),this.client.logger.error(_u)}}),c(this,"isRequestOutOfSync",(Hs,zs)=>zs.toString().slice(0,-3)<Hs.toString().slice(0,-3)),c(this,"onSessionUpdateResponse",(Hs,zs)=>{const{id:Ys}=zs,Zs=_i$1("session_update",Ys);if(this.events.listenerCount(Zs)===0)throw new Error(`emitting ${Zs} without any listeners`);isJsonRpcResult(zs)?this.events.emit(_i$1("session_update",Ys),{}):isJsonRpcError(zs)&&this.events.emit(_i$1("session_update",Ys),{error:zs.error})}),c(this,"onSessionExtendRequest",async(Hs,zs)=>{const{id:Ys}=zs;try{this.isValidExtend({topic:Hs}),await this.setExpiry(Hs,Ni$1(W)),await this.sendResult({id:Ys,topic:Hs,result:!0}),this.client.events.emit("session_extend",{id:Ys,topic:Hs})}catch(Zs){await this.sendError({id:Ys,topic:Hs,error:Zs}),this.client.logger.error(Zs)}}),c(this,"onSessionExtendResponse",(Hs,zs)=>{const{id:Ys}=zs,Zs=_i$1("session_extend",Ys);if(this.events.listenerCount(Zs)===0)throw new Error(`emitting ${Zs} without any listeners`);isJsonRpcResult(zs)?this.events.emit(_i$1("session_extend",Ys),{}):isJsonRpcError(zs)&&this.events.emit(_i$1("session_extend",Ys),{error:zs.error})}),c(this,"onSessionPingRequest",async(Hs,zs)=>{const{id:Ys}=zs;try{this.isValidPing({topic:Hs}),await this.sendResult({id:Ys,topic:Hs,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:Ys,topic:Hs})}catch(Zs){await this.sendError({id:Ys,topic:Hs,error:Zs}),this.client.logger.error(Zs)}}),c(this,"onSessionPingResponse",(Hs,zs)=>{const{id:Ys}=zs,Zs=_i$1("session_ping",Ys);setTimeout(()=>{if(this.events.listenerCount(Zs)===0)throw new Error(`emitting ${Zs} without any listeners 2176`);isJsonRpcResult(zs)?this.events.emit(_i$1("session_ping",Ys),{}):isJsonRpcError(zs)&&this.events.emit(_i$1("session_ping",Ys),{error:zs.error})},500)}),c(this,"onSessionDeleteRequest",async(Hs,zs)=>{const{id:Ys}=zs;try{this.isValidDisconnect({topic:Hs,reason:zs.params}),await Promise.all([new Promise(Zs=>{this.client.core.relayer.once(C$1.publish,async()=>{Zs(await this.deleteSession({topic:Hs,id:Ys}))})}),this.sendResult({id:Ys,topic:Hs,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:Hs,error:zt$2("USER_DISCONNECTED")})]).catch(Zs=>this.client.logger.error(Zs))}catch(Zs){this.client.logger.error(Zs)}}),c(this,"onSessionRequest",async Hs=>{var zs,Ys,Zs;const{topic:_u,payload:Eu,attestation:Iu,encryptedId:Au,transportType:$u}=Hs,{id:vu,params:Su}=Eu;try{await this.isValidRequest(R({topic:_u},Su));const Ru=this.client.session.get(_u),Pu=await this.getVerifyContext({attestationId:Iu,hash:pa(JSON.stringify(formatJsonRpcRequest("wc_sessionRequest",Su,vu))),encryptedId:Au,metadata:Ru.peer.metadata,transportType:$u}),Cu={id:vu,topic:_u,params:Su,verifyContext:Pu};await this.setPendingSessionRequest(Cu),$u===ee.link_mode&&(zs=Ru.peer.metadata.redirect)!=null&&zs.universal&&this.client.core.addLinkModeSupportedApp((Ys=Ru.peer.metadata.redirect)==null?void 0:Ys.universal),(Zs=this.client.signConfig)!=null&&Zs.disableRequestQueue?this.emitSessionRequest(Cu):(this.addSessionRequestToSessionRequestQueue(Cu),this.processSessionRequestQueue())}catch(Ru){await this.sendError({id:vu,topic:_u,error:Ru}),this.client.logger.error(Ru)}}),c(this,"onSessionRequestResponse",(Hs,zs)=>{const{id:Ys}=zs,Zs=_i$1("session_request",Ys);if(this.events.listenerCount(Zs)===0)throw new Error(`emitting ${Zs} without any listeners`);isJsonRpcResult(zs)?this.events.emit(_i$1("session_request",Ys),{result:zs.result}):isJsonRpcError(zs)&&this.events.emit(_i$1("session_request",Ys),{error:zs.error})}),c(this,"onSessionEventRequest",async(Hs,zs)=>{const{id:Ys,params:Zs}=zs;try{const _u=`${Hs}_session_event_${Zs.event.name}`,Eu=hu.get(_u);if(Eu&&this.isRequestOutOfSync(Eu,Ys)){this.client.logger.info(`Discarding out of sync request - ${Ys}`);return}this.isValidEmit(R({topic:Hs},Zs)),this.client.events.emit("session_event",{id:Ys,topic:Hs,params:Zs}),hu.set(_u,Ys)}catch(_u){await this.sendError({id:Ys,topic:Hs,error:_u}),this.client.logger.error(_u)}}),c(this,"onSessionAuthenticateResponse",(Hs,zs)=>{const{id:Ys}=zs;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:Hs,payload:zs}),isJsonRpcResult(zs)?this.events.emit(_i$1("session_request",Ys),{result:zs.result}):isJsonRpcError(zs)&&this.events.emit(_i$1("session_request",Ys),{error:zs.error})}),c(this,"onSessionAuthenticateRequest",async Hs=>{var zs;const{topic:Ys,payload:Zs,attestation:_u,encryptedId:Eu,transportType:Iu}=Hs;try{const{requester:Au,authPayload:$u,expiryTimestamp:vu}=Zs.params,Su=await this.getVerifyContext({attestationId:_u,hash:pa(JSON.stringify(Zs)),encryptedId:Eu,metadata:Au.metadata,transportType:Iu}),Ru={requester:Au,pairingTopic:Ys,id:Zs.id,authPayload:$u,verifyContext:Su,expiryTimestamp:vu};await this.setAuthRequest(Zs.id,{request:Ru,pairingTopic:Ys,transportType:Iu}),Iu===ee.link_mode&&(zs=Au.metadata.redirect)!=null&&zs.universal&&this.client.core.addLinkModeSupportedApp(Au.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:Ys,params:Zs.params,id:Zs.id,verifyContext:Su})}catch(Au){this.client.logger.error(Au);const $u=Zs.params.requester.publicKey,vu=await this.client.core.crypto.generateKeyPair(),Su=this.getAppLinkIfEnabled(Zs.params.requester.metadata,Iu),Ru={type:ie,receiverPublicKey:$u,senderPublicKey:vu};await this.sendError({id:Zs.id,topic:Ys,error:Au,encodeOpts:Ru,rpcOpts:P.wc_sessionAuthenticate.autoReject,appLink:Su})}}),c(this,"addSessionRequestToSessionRequestQueue",Hs=>{this.sessionRequestQueue.queue.push(Hs)}),c(this,"cleanupAfterResponse",Hs=>{this.deletePendingSessionRequest(Hs.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=$$1.idle,this.processSessionRequestQueue()},cjs$3.toMiliseconds(this.requestQueueDelay))}),c(this,"cleanupPendingSentRequestsForTopic",({topic:Hs,error:zs})=>{const Ys=this.client.core.history.pending;Ys.length>0&&Ys.filter(Zs=>Zs.topic===Hs&&Zs.request.method==="wc_sessionRequest").forEach(Zs=>{const _u=Zs.request.id,Eu=_i$1("session_request",_u);if(this.events.listenerCount(Eu)===0)throw new Error(`emitting ${Eu} without any listeners`);this.events.emit(_i$1("session_request",Zs.request.id),{error:zs})})}),c(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===$$1.active){this.client.logger.info("session request queue is already active.");return}const Hs=this.sessionRequestQueue.queue[0];if(!Hs){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(Hs)}catch(zs){this.client.logger.error(zs)}}),c(this,"emitSessionRequest",Hs=>{if(this.emittedSessionRequests.has(Hs.id)){this.client.logger.warn({id:Hs.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${Hs.id}`);return}this.sessionRequestQueue.state=$$1.active,this.emittedSessionRequests.add(Hs.id),this.client.events.emit("session_request",Hs)}),c(this,"onPairingCreated",Hs=>{if(Hs.methods&&this.expectedPairingMethodMap.set(Hs.topic,Hs.methods),Hs.active)return;const zs=this.client.proposal.getAll().find(Ys=>Ys.pairingTopic===Hs.topic);zs&&this.onSessionProposeRequest({topic:Hs.topic,payload:formatJsonRpcRequest("wc_sessionPropose",O$1(R({},zs),{requiredNamespaces:zs.requiredNamespaces,optionalNamespaces:zs.optionalNamespaces,relays:zs.relays,proposer:zs.proposer,sessionProperties:zs.sessionProperties,scopedProperties:zs.scopedProperties}),zs.id),attestation:zs.attestation,encryptedId:zs.encryptedId})}),c(this,"isValidConnect",async Hs=>{if(!Qa(Hs)){const{message:Au}=Bt$2("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(Hs)}`);throw new Error(Au)}const{pairingTopic:zs,requiredNamespaces:Ys,optionalNamespaces:Zs,sessionProperties:_u,scopedProperties:Eu,relays:Iu}=Hs;if(Dt$1(zs)||await this.isValidPairingTopic(zs),!Xa(Iu,!0)){const{message:Au}=Bt$2("MISSING_OR_INVALID",`connect() relays: ${Iu}`);throw new Error(Au)}if(Ys&&!Dt$1(Ys)&&Ye$1(Ys)!==0){const Au="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(Au):this.client.logger.warn(Au),this.validateNamespaces(Ys,"requiredNamespaces")}if(Zs&&!Dt$1(Zs)&&Ye$1(Zs)!==0&&this.validateNamespaces(Zs,"optionalNamespaces"),_u&&!Dt$1(_u)&&this.validateSessionProps(_u,"sessionProperties"),Eu&&!Dt$1(Eu)){this.validateSessionProps(Eu,"scopedProperties");const Au=Object.keys(Ys||{}).concat(Object.keys(Zs||{}));if(!Object.keys(Eu).every($u=>Au.includes($u.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(Eu)}, required/optional namespaces: ${JSON.stringify(Au)}`)}}),c(this,"validateNamespaces",(Hs,zs)=>{const Ys=Wa(Hs,"connect()",zs);if(Ys)throw new Error(Ys.message)}),c(this,"isValidApprove",async Hs=>{if(!Qa(Hs))throw new Error(Bt$2("MISSING_OR_INVALID",`approve() params: ${Hs}`).message);const{id:zs,namespaces:Ys,relayProtocol:Zs,sessionProperties:_u,scopedProperties:Eu}=Hs;this.checkRecentlyDeleted(zs),await this.isValidProposalId(zs);const Iu=this.client.proposal.get(zs),Au=Ss$1(Ys,"approve()");if(Au)throw new Error(Au.message);const $u=Ns$1(Iu.requiredNamespaces,Ys,"approve()");if($u)throw new Error($u.message);if(!ft$2(Zs,!0)){const{message:vu}=Bt$2("MISSING_OR_INVALID",`approve() relayProtocol: ${Zs}`);throw new Error(vu)}if(_u&&!Dt$1(_u)&&this.validateSessionProps(_u,"sessionProperties"),Eu&&!Dt$1(Eu)){this.validateSessionProps(Eu,"scopedProperties");const vu=new Set(Object.keys(Ys));if(!Object.keys(Eu).every(Su=>vu.has(Su.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(Eu)}, approved namespaces: ${Array.from(vu).join(", ")}`)}}),c(this,"isValidReject",async Hs=>{if(!Qa(Hs)){const{message:Zs}=Bt$2("MISSING_OR_INVALID",`reject() params: ${Hs}`);throw new Error(Zs)}const{id:zs,reason:Ys}=Hs;if(this.checkRecentlyDeleted(zs),await this.isValidProposalId(zs),!tu(Ys)){const{message:Zs}=Bt$2("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(Ys)}`);throw new Error(Zs)}}),c(this,"isValidSessionSettleRequest",Hs=>{if(!Qa(Hs)){const{message:Au}=Bt$2("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${Hs}`);throw new Error(Au)}const{relay:zs,controller:Ys,namespaces:Zs,expiry:_u}=Hs;if(!Os$1(zs)){const{message:Au}=Bt$2("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(Au)}const Eu=Ya(Ys,"onSessionSettleRequest()");if(Eu)throw new Error(Eu.message);const Iu=Ss$1(Zs,"onSessionSettleRequest()");if(Iu)throw new Error(Iu.message);if(Ui$1(_u)){const{message:Au}=Bt$2("EXPIRED","onSessionSettleRequest()");throw new Error(Au)}}),c(this,"isValidUpdate",async Hs=>{if(!Qa(Hs)){const{message:Iu}=Bt$2("MISSING_OR_INVALID",`update() params: ${Hs}`);throw new Error(Iu)}const{topic:zs,namespaces:Ys}=Hs;this.checkRecentlyDeleted(zs),await this.isValidSessionTopic(zs);const Zs=this.client.session.get(zs),_u=Ss$1(Ys,"update()");if(_u)throw new Error(_u.message);const Eu=Ns$1(Zs.requiredNamespaces,Ys,"update()");if(Eu)throw new Error(Eu.message)}),c(this,"isValidExtend",async Hs=>{if(!Qa(Hs)){const{message:Ys}=Bt$2("MISSING_OR_INVALID",`extend() params: ${Hs}`);throw new Error(Ys)}const{topic:zs}=Hs;this.checkRecentlyDeleted(zs),await this.isValidSessionTopic(zs)}),c(this,"isValidRequest",async Hs=>{if(!Qa(Hs)){const{message:Iu}=Bt$2("MISSING_OR_INVALID",`request() params: ${Hs}`);throw new Error(Iu)}const{topic:zs,request:Ys,chainId:Zs,expiry:_u}=Hs;this.checkRecentlyDeleted(zs),await this.isValidSessionTopic(zs);const{namespaces:Eu}=this.client.session.get(zs);if(!ou(Eu,Zs)){const{message:Iu}=Bt$2("MISSING_OR_INVALID",`request() chainId: ${Zs}`);throw new Error(Iu)}if(!eu(Ys)){const{message:Iu}=Bt$2("MISSING_OR_INVALID",`request() ${JSON.stringify(Ys)}`);throw new Error(Iu)}if(!su(Eu,Zs,Ys.method)){const{message:Iu}=Bt$2("MISSING_OR_INVALID",`request() method: ${Ys.method}`);throw new Error(Iu)}if(_u&&!au(_u,_e)){const{message:Iu}=Bt$2("MISSING_OR_INVALID",`request() expiry: ${_u}. Expiry must be a number (in seconds) between ${_e.min} and ${_e.max}`);throw new Error(Iu)}}),c(this,"isValidRespond",async Hs=>{var zs;if(!Qa(Hs)){const{message:Eu}=Bt$2("MISSING_OR_INVALID",`respond() params: ${Hs}`);throw new Error(Eu)}const{topic:Ys,response:Zs}=Hs;try{await this.isValidSessionTopic(Ys)}catch(Eu){throw(zs=Hs==null?void 0:Hs.response)!=null&&zs.id&&this.cleanupAfterResponse(Hs),Eu}if(!nu(Zs)){const{message:Eu}=Bt$2("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(Zs)}`);throw new Error(Eu)}const _u=this.client.pendingRequest.get(Zs.id);if(_u.topic!==Ys){const{message:Eu}=Bt$2("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${Zs.id}, expected topic: ${_u.topic}, received topic: ${Ys}`);throw new Error(Eu)}}),c(this,"isValidPing",async Hs=>{if(!Qa(Hs)){const{message:Ys}=Bt$2("MISSING_OR_INVALID",`ping() params: ${Hs}`);throw new Error(Ys)}const{topic:zs}=Hs;await this.isValidSessionOrPairingTopic(zs)}),c(this,"isValidEmit",async Hs=>{if(!Qa(Hs)){const{message:Eu}=Bt$2("MISSING_OR_INVALID",`emit() params: ${Hs}`);throw new Error(Eu)}const{topic:zs,event:Ys,chainId:Zs}=Hs;await this.isValidSessionTopic(zs);const{namespaces:_u}=this.client.session.get(zs);if(!ou(_u,Zs)){const{message:Eu}=Bt$2("MISSING_OR_INVALID",`emit() chainId: ${Zs}`);throw new Error(Eu)}if(!ru(Ys)){const{message:Eu}=Bt$2("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(Ys)}`);throw new Error(Eu)}if(!iu(_u,Zs,Ys.name)){const{message:Eu}=Bt$2("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(Ys)}`);throw new Error(Eu)}}),c(this,"isValidDisconnect",async Hs=>{if(!Qa(Hs)){const{message:Ys}=Bt$2("MISSING_OR_INVALID",`disconnect() params: ${Hs}`);throw new Error(Ys)}const{topic:zs}=Hs;await this.isValidSessionOrPairingTopic(zs)}),c(this,"isValidAuthenticate",Hs=>{const{chains:zs,uri:Ys,domain:Zs,nonce:_u}=Hs;if(!Array.isArray(zs)||zs.length===0)throw new Error("chains is required and must be a non-empty array");if(!ft$2(Ys,!1))throw new Error("uri is required parameter");if(!ft$2(Zs,!1))throw new Error("domain is required parameter");if(!ft$2(_u,!1))throw new Error("nonce is required parameter");if([...new Set(zs.map(Iu=>Je$1(Iu).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:Eu}=Je$1(zs[0]);if(Eu!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),c(this,"getVerifyContext",async Hs=>{const{attestationId:zs,hash:Ys,encryptedId:Zs,metadata:_u,transportType:Eu}=Hs,Iu={verified:{verifyUrl:_u.verifyUrl||be,validation:"UNKNOWN",origin:_u.url||""}};try{if(Eu===ee.link_mode){const $u=this.getAppLinkIfEnabled(_u,Eu);return Iu.verified.validation=$u&&new URL($u).origin===new URL(_u.url).origin?"VALID":"INVALID",Iu}const Au=await this.client.core.verify.resolve({attestationId:zs,hash:Ys,encryptedId:Zs,verifyUrl:_u.verifyUrl});Au&&(Iu.verified.origin=Au.origin,Iu.verified.isScam=Au.isScam,Iu.verified.validation=Au.origin===new URL(_u.url).origin?"VALID":"INVALID")}catch(Au){this.client.logger.warn(Au)}return this.client.logger.debug(`Verify context: ${JSON.stringify(Iu)}`),Iu}),c(this,"validateSessionProps",(Hs,zs)=>{Object.values(Hs).forEach((Ys,Zs)=>{if(Ys==null){const{message:_u}=Bt$2("MISSING_OR_INVALID",`${zs} must contain an existing value for each key. Received: ${Ys} for key ${Object.keys(Hs)[Zs]}`);throw new Error(_u)}})}),c(this,"getPendingAuthRequest",Hs=>{const zs=this.client.auth.requests.get(Hs);return typeof zs=="object"?zs:void 0}),c(this,"addToRecentlyDeleted",(Hs,zs)=>{if(this.recentlyDeletedMap.set(Hs,zs),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let Ys=0;const Zs=this.recentlyDeletedLimit/2;for(const _u of this.recentlyDeletedMap.keys()){if(Ys++>=Zs)break;this.recentlyDeletedMap.delete(_u)}}}),c(this,"checkRecentlyDeleted",Hs=>{const zs=this.recentlyDeletedMap.get(Hs);if(zs){const{message:Ys}=Bt$2("MISSING_OR_INVALID",`Record was recently deleted - ${zs}: ${Hs}`);throw new Error(Ys)}}),c(this,"isLinkModeEnabled",(Hs,zs)=>{var Ys,Zs,_u,Eu,Iu,Au,$u,vu,Su;return!Hs||zs!==ee.link_mode?!1:((Zs=(Ys=this.client.metadata)==null?void 0:Ys.redirect)==null?void 0:Zs.linkMode)===!0&&((Eu=(_u=this.client.metadata)==null?void 0:_u.redirect)==null?void 0:Eu.universal)!==void 0&&((Au=(Iu=this.client.metadata)==null?void 0:Iu.redirect)==null?void 0:Au.universal)!==""&&(($u=Hs==null?void 0:Hs.redirect)==null?void 0:$u.universal)!==void 0&&((vu=Hs==null?void 0:Hs.redirect)==null?void 0:vu.universal)!==""&&((Su=Hs==null?void 0:Hs.redirect)==null?void 0:Su.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(Hs.redirect.universal)&&typeof(globalThis==null?void 0:globalThis.Linking)<"u"}),c(this,"getAppLinkIfEnabled",(Hs,zs)=>{var Ys;return this.isLinkModeEnabled(Hs,zs)?(Ys=Hs==null?void 0:Hs.redirect)==null?void 0:Ys.universal:void 0}),c(this,"handleLinkModeMessage",({url:Hs})=>{if(!Hs||!Hs.includes("wc_ev")||!Hs.includes("topic"))return;const zs=Ti$1(Hs,"topic")||"",Ys=decodeURIComponent(Ti$1(Hs,"wc_ev")||""),Zs=this.client.session.keys.includes(zs);Zs&&this.client.session.update(zs,{transportType:ee.link_mode}),this.client.core.dispatchEnvelope({topic:zs,message:Ys,sessionExists:Zs})}),c(this,"registerLinkModeListeners",async()=>{var Hs;if(ji$1()||At$2()&&(Hs=this.client.metadata.redirect)!=null&&Hs.linkMode){const zs=globalThis==null?void 0:globalThis.Linking;if(typeof zs<"u"){zs.addEventListener("url",this.handleLinkModeMessage,this.client.name);const Ys=await zs.getInitialURL();Ys&&setTimeout(()=>{this.handleLinkModeMessage({url:Ys})},50)}}}),c(this,"getTVFParams",(Hs,zs,Ys)=>{var Zs,_u,Eu;if(!((Zs=zs.request)!=null&&Zs.method))return{};const Iu={correlationId:Hs,rpcMethods:[zs.request.method],chainId:zs.chainId};try{const Au=this.extractTxHashesFromResult(zs.request,Ys);Iu.txHashes=Au,Iu.contractAddresses=this.isValidContractData(zs.request.params)?[(Eu=(_u=zs.request.params)==null?void 0:_u[0])==null?void 0:Eu.to]:[]}catch(Au){this.client.logger.warn(Au,"Error getting TVF params")}return Iu}),c(this,"isValidContractData",Hs=>{var zs;if(!Hs)return!1;try{const Ys=(Hs==null?void 0:Hs.data)||((zs=Hs==null?void 0:Hs[0])==null?void 0:zs.data);if(!Ys.startsWith("0x"))return!1;const Zs=Ys.slice(2);return/^[0-9a-fA-F]*$/.test(Zs)?Zs.length%2===0:!1}catch{}return!1}),c(this,"extractTxHashesFromResult",(Hs,zs)=>{var Ys;try{if(!zs)return[];const Zs=Hs.method,_u=yt[Zs];if(Zs==="sui_signTransaction")return[Oc(zs.transactionBytes)];if(Zs==="near_signTransaction")return[Nc(zs)];if(Zs==="near_signTransactions")return zs.map(Iu=>Nc(Iu));if(Zs==="xrpl_signTransactionFor"||Zs==="xrpl_signTransaction")return[(Ys=zs.tx_json)==null?void 0:Ys.hash];if(Zs==="polkadot_signTransaction")return[mu({transaction:Hs.params.transactionPayload,signature:zs.signature})];if(Zs==="algo_signTxn")return Ee(zs)?zs.map(Iu=>Uc(Iu)):[Uc(zs)];if(Zs==="cosmos_signDirect")return[_c(zs)];if(Zs==="wallet_sendCalls")return Rc(zs);if(typeof zs=="string")return[zs];const Eu=zs[_u.key];if(Ee(Eu))return Zs==="solana_signAllTransactions"?Eu.map(Iu=>Sc(Iu)):Eu;if(typeof Eu=="string")return[Eu]}catch(Zs){this.client.logger.warn(Zs,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{const t=this.client.session.keys,Hs=this.client.core.relayer.messages.getWithoutAck(t);for(const[zs,Ys]of Object.entries(Hs))for(const Zs of Ys)try{await this.onProviderMessageEvent({topic:zs,message:Zs,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${zs}, message: ${Zs}`)}}catch(t){this.client.logger.warn(t,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){const{message:t}=Bt$2("NOT_INITIALIZED",this.name);throw new Error(t)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(C$1.message,t=>{this.onProviderMessageEvent(t)})}async onRelayMessage(t){const{topic:Hs,message:zs,attestation:Ys,transportType:Zs}=t,{publicKey:_u}=this.client.auth.authKeys.keys.includes(pe)?this.client.auth.authKeys.get(pe):{responseTopic:void 0,publicKey:void 0};try{const Eu=await this.client.core.crypto.decode(Hs,zs,{receiverPublicKey:_u,encoding:Zs===ee.link_mode?Ge$1:oe$1});isJsonRpcRequest(Eu)?(this.client.core.history.set(Hs,Eu),await this.onRelayEventRequest({topic:Hs,payload:Eu,attestation:Ys,transportType:Zs,encryptedId:pa(zs)})):isJsonRpcResponse(Eu)?(await this.client.core.history.resolve(Eu),await this.onRelayEventResponse({topic:Hs,payload:Eu,transportType:Zs}),this.client.core.history.delete(Hs,Eu.id)):await this.onRelayEventUnknownPayload({topic:Hs,payload:Eu,transportType:Zs}),await this.client.core.relayer.messages.ack(Hs,zs)}catch(Eu){this.client.logger.error(Eu)}}registerExpirerEvents(){this.client.core.expirer.on(q.expired,async t=>{const{topic:Hs,id:zs}=Oi$1(t.target);if(zs&&this.client.pendingRequest.keys.includes(zs))return await this.deletePendingSessionRequest(zs,Bt$2("EXPIRED"),!0);if(zs&&this.client.auth.requests.keys.includes(zs))return await this.deletePendingAuthRequest(zs,Bt$2("EXPIRED"),!0);Hs?this.client.session.keys.includes(Hs)&&(await this.deleteSession({topic:Hs,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:Hs})):zs&&(await this.deleteProposal(zs,!0),this.client.events.emit("proposal_expire",{id:zs}))})}registerPairingEvents(){this.client.core.pairing.events.on(ae.create,t=>this.onPairingCreated(t)),this.client.core.pairing.events.on(ae.delete,t=>{this.addToRecentlyDeleted(t.topic,"pairing")})}isValidPairingTopic(t){if(!ft$2(t,!1)){const{message:Hs}=Bt$2("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(Hs)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:Hs}=Bt$2("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(Hs)}if(Ui$1(this.client.core.pairing.pairings.get(t).expiry)){const{message:Hs}=Bt$2("EXPIRED",`pairing topic: ${t}`);throw new Error(Hs)}}async isValidSessionTopic(t){if(!ft$2(t,!1)){const{message:Hs}=Bt$2("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(Hs)}if(this.checkRecentlyDeleted(t),!this.client.session.keys.includes(t)){const{message:Hs}=Bt$2("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(Hs)}if(Ui$1(this.client.session.get(t).expiry)){await this.deleteSession({topic:t});const{message:Hs}=Bt$2("EXPIRED",`session topic: ${t}`);throw new Error(Hs)}if(!this.client.core.crypto.keychain.has(t)){const{message:Hs}=Bt$2("MISSING_OR_INVALID",`session topic does not exist in keychain: ${t}`);throw await this.deleteSession({topic:t}),new Error(Hs)}}async isValidSessionOrPairingTopic(t){if(this.checkRecentlyDeleted(t),this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(ft$2(t,!1)){const{message:Hs}=Bt$2("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(Hs)}else{const{message:Hs}=Bt$2("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(Hs)}}async isValidProposalId(t){if(!Ja(t)){const{message:Hs}=Bt$2("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(Hs)}if(!this.client.proposal.keys.includes(t)){const{message:Hs}=Bt$2("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(Hs)}if(Ui$1(this.client.proposal.get(t).expiryTimestamp)){await this.deleteProposal(t);const{message:Hs}=Bt$2("EXPIRED",`proposal id: ${t}`);throw new Error(Hs)}}}class Vs extends ji{constructor(t,Hs){super(t,Hs,dt,we),this.core=t,this.logger=Hs}}let It$1=class extends ji{constructor(t,Hs){super(t,Hs,ut$1,we),this.core=t,this.logger=Hs}};class ks extends ji{constructor(t,Hs){super(t,Hs,wt,we,zs=>zs.id),this.core=t,this.logger=Hs}}class Ds extends ji{constructor(t,Hs){super(t,Hs,Et$1,le,()=>pe),this.core=t,this.logger=Hs}}class Ls extends ji{constructor(t,Hs){super(t,Hs,St$1,le),this.core=t,this.logger=Hs}}class Ms extends ji{constructor(t,Hs){super(t,Hs,Rt$1,le,zs=>zs.id),this.core=t,this.logger=Hs}}var $s=Object.defineProperty,Ks=(Z,t,Hs)=>t in Z?$s(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,Ke=(Z,t,Hs)=>Ks(Z,typeof t!="symbol"?t+"":t,Hs);class Us{constructor(t,Hs){this.core=t,this.logger=Hs,Ke(this,"authKeys"),Ke(this,"pairingTopics"),Ke(this,"requests"),this.authKeys=new Ds(this.core,this.logger),this.pairingTopics=new Ls(this.core,this.logger),this.requests=new Ms(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var Gs=Object.defineProperty,js=(Z,t,Hs)=>t in Z?Gs(Z,t,{enumerable:!0,configurable:!0,writable:!0,value:Hs}):Z[t]=Hs,f=(Z,t,Hs)=>js(Z,typeof t!="symbol"?t+"":t,Hs);class fe extends J$3{constructor(t){super(t),f(this,"protocol",Ve),f(this,"version",ke),f(this,"name",me.name),f(this,"metadata"),f(this,"core"),f(this,"logger"),f(this,"events",new eventsExports.EventEmitter),f(this,"engine"),f(this,"session"),f(this,"proposal"),f(this,"pendingRequest"),f(this,"auth"),f(this,"signConfig"),f(this,"on",(zs,Ys)=>this.events.on(zs,Ys)),f(this,"once",(zs,Ys)=>this.events.once(zs,Ys)),f(this,"off",(zs,Ys)=>this.events.off(zs,Ys)),f(this,"removeListener",(zs,Ys)=>this.events.removeListener(zs,Ys)),f(this,"removeAllListeners",zs=>this.events.removeAllListeners(zs)),f(this,"connect",async zs=>{try{return await this.engine.connect(zs)}catch(Ys){throw this.logger.error(Ys.message),Ys}}),f(this,"pair",async zs=>{try{return await this.engine.pair(zs)}catch(Ys){throw this.logger.error(Ys.message),Ys}}),f(this,"approve",async zs=>{try{return await this.engine.approve(zs)}catch(Ys){throw this.logger.error(Ys.message),Ys}}),f(this,"reject",async zs=>{try{return await this.engine.reject(zs)}catch(Ys){throw this.logger.error(Ys.message),Ys}}),f(this,"update",async zs=>{try{return await this.engine.update(zs)}catch(Ys){throw this.logger.error(Ys.message),Ys}}),f(this,"extend",async zs=>{try{return await this.engine.extend(zs)}catch(Ys){throw this.logger.error(Ys.message),Ys}}),f(this,"request",async zs=>{try{return await this.engine.request(zs)}catch(Ys){throw this.logger.error(Ys.message),Ys}}),f(this,"respond",async zs=>{try{return await this.engine.respond(zs)}catch(Ys){throw this.logger.error(Ys.message),Ys}}),f(this,"ping",async zs=>{try{return await this.engine.ping(zs)}catch(Ys){throw this.logger.error(Ys.message),Ys}}),f(this,"emit",async zs=>{try{return await this.engine.emit(zs)}catch(Ys){throw this.logger.error(Ys.message),Ys}}),f(this,"disconnect",async zs=>{try{return await this.engine.disconnect(zs)}catch(Ys){throw this.logger.error(Ys.message),Ys}}),f(this,"find",zs=>{try{return this.engine.find(zs)}catch(Ys){throw this.logger.error(Ys.message),Ys}}),f(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(zs){throw this.logger.error(zs.message),zs}}),f(this,"authenticate",async(zs,Ys)=>{try{return await this.engine.authenticate(zs,Ys)}catch(Zs){throw this.logger.error(Zs.message),Zs}}),f(this,"formatAuthMessage",zs=>{try{return this.engine.formatAuthMessage(zs)}catch(Ys){throw this.logger.error(Ys.message),Ys}}),f(this,"approveSessionAuthenticate",async zs=>{try{return await this.engine.approveSessionAuthenticate(zs)}catch(Ys){throw this.logger.error(Ys.message),Ys}}),f(this,"rejectSessionAuthenticate",async zs=>{try{return await this.engine.rejectSessionAuthenticate(zs)}catch(Ys){throw this.logger.error(Ys.message),Ys}}),this.name=(t==null?void 0:t.name)||me.name,this.metadata=di$1(t==null?void 0:t.metadata),this.signConfig=t==null?void 0:t.signConfig;const Hs=wu({logger:(t==null?void 0:t.logger)||me.logger,name:this.name});this.logger=Hs,this.core=(t==null?void 0:t.core)||new ta(t),this.session=new It$1(this.core,this.logger),this.proposal=new Vs(this.core,this.logger),this.pendingRequest=new ks(this.core,this.logger),this.engine=new Cs(this),this.auth=new Us(this.core,this.logger)}static async init(t){const Hs=new fe(t);return await Hs.initialize(),Hs}get context(){return w$1(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}}const Fs=It$1,Qs=fe,dist=Object.freeze(Object.defineProperty({__proto__:null,AUTH_CONTEXT:ft$1,AUTH_KEYS_CONTEXT:Et$1,AUTH_PAIRING_TOPIC_CONTEXT:St$1,AUTH_PROTOCOL:_t$1,AUTH_PUBLIC_KEY_NAME:pe,AUTH_REQUEST_CONTEXT:Rt$1,AUTH_STORAGE_PREFIX:le,AUTH_VERSION:Ps,ENGINE_CONTEXT:gt$1,ENGINE_QUEUE_STATES:$$1,ENGINE_RPC_OPTS:P,HISTORY_CONTEXT:Is,HISTORY_EVENTS:vs,HISTORY_STORAGE_VERSION:Ts,METHODS_TO_VERIFY:mt$1,PROPOSAL_CONTEXT:dt,PROPOSAL_EXPIRY:qs,PROPOSAL_EXPIRY_MESSAGE:Me,REQUEST_CONTEXT:wt,SESSION_CONTEXT:ut$1,SESSION_EXPIRY:W,SESSION_REQUEST_EXPIRY_BOUNDARIES:_e,SIGN_CLIENT_CONTEXT:De,SIGN_CLIENT_DEFAULT:me,SIGN_CLIENT_EVENTS:Ss,SIGN_CLIENT_PROTOCOL:Ve,SIGN_CLIENT_STORAGE_OPTIONS:Rs,SIGN_CLIENT_STORAGE_PREFIX:we,SIGN_CLIENT_VERSION:ke,SessionStore:Fs,SignClient:Qs,TVF_METHODS:yt,WALLETCONNECT_DEEPLINK_CHOICE:Le,default:fe},Symbol.toStringTag,{value:"Module"})),require$$2=getAugmentedNamespace(dist),require$$3=getAugmentedNamespace(dist$1);var constants={},operation$1={};Object.defineProperty(operation$1,"__esModule",{value:!0});operation$1.OptionalOperation=operation$1.Operation=void 0;var Operation$1;(function(Z){Z.SIGN_TRANSACTION="mvx_signTransaction",Z.SIGN_TRANSACTIONS="mvx_signTransactions",Z.SIGN_MESSAGE="mvx_signMessage"})(Operation$1||(operation$1.Operation=Operation$1={}));var OptionalOperation;(function(Z){Z.SIGN_LOGIN_TOKEN="mvx_signLoginToken",Z.SIGN_NATIVE_AUTH_TOKEN="mvx_signNativeAuthToken",Z.CANCEL_ACTION="mvx_cancelAction"})(OptionalOperation||(operation$1.OptionalOperation=OptionalOperation={}));Object.defineProperty(constants,"__esModule",{value:!0});constants.WALLETCONNECT_SIGN_LOGIN_DELAY=constants.WALLETCONNECT_MULTIVERSX_OPTIONAL_METHODS=constants.WALLETCONNECT_MULTIVERSX_METHODS=constants.WALLETCONNECT_MULTIVERSX_NAMESPACE=void 0;const operation_1$2=operation$1;constants.WALLETCONNECT_MULTIVERSX_NAMESPACE="mvx";constants.WALLETCONNECT_MULTIVERSX_METHODS=Object.values(operation_1$2.Operation);constants.WALLETCONNECT_MULTIVERSX_OPTIONAL_METHODS=Object.values(operation_1$2.OptionalOperation);constants.WALLETCONNECT_SIGN_LOGIN_DELAY=500;var errors$3={};Object.defineProperty(errors$3,"__esModule",{value:!0});errors$3.WalletConnectV2ProviderErrorMessagesEnum=errors$3.ErrBadAddress=errors$3.ErrNotImplemented=errors$3.Err=void 0;let Err$1=class extends Error{constructor(t,Hs){super(t),this.inner=void 0,this.inner=Hs}};errors$3.Err=Err$1;class ErrNotImplemented extends Err$1{constructor(){super("Method not yet implemented")}}errors$3.ErrNotImplemented=ErrNotImplemented;class ErrBadAddress extends Err$1{constructor(t,Hs){super(`Bad address: ${t}`,Hs)}}errors$3.ErrBadAddress=ErrBadAddress;var WalletConnectV2ProviderErrorMessagesEnum;(function(Z){Z.unableToInit="WalletConnect is unable to init",Z.notInitialized="WalletConnect is not initialized",Z.unableToConnect="WalletConnect is unable to connect",Z.unableToConnectExisting="WalletConnect is unable to connect to existing pairing",Z.unableToSignLoginToken="WalletConnect could not sign login token",Z.unableToSign="WalletConnect could not sign the message",Z.unableToLogin="WalletConnect is unable to login",Z.unableToHandleTopic="WalletConnect: Unable to handle topic update",Z.unableToHandleEvent="WalletConnect: Unable to handle events",Z.unableToHandleCleanup="WalletConnect: Unable to handle cleanup",Z.sessionNotConnected="WalletConnect Session is not connected",Z.sessionDeleted="WalletConnect Session Deleted",Z.sessionExpired="WalletConnect Session Expired",Z.alreadyLoggedOut="WalletConnect: Already logged out",Z.pingFailed="WalletConnect Ping Failed",Z.invalidAddress="WalletConnect: Invalid address",Z.requestDifferentChain="WalletConnect: Request Chain Id different than Connection Chain Id",Z.invalidMessageResponse="WalletConnect could not sign the message",Z.invalidMessageSignature="WalletConnect: Invalid message signature",Z.invalidTransactionResponse="WalletConnect could not sign the transactions. Invalid signatures",Z.invalidCustomRequestResponse="WalletConnect could not send the custom request",Z.transactionError="Transaction canceled",Z.connectionError="WalletConnect could not establish a connection",Z.invalidGuardian="WalletConnect: Invalid Guardian"})(WalletConnectV2ProviderErrorMessagesEnum||(errors$3.WalletConnectV2ProviderErrorMessagesEnum=WalletConnectV2ProviderErrorMessagesEnum={}));var logger$1={};Object.defineProperty(logger$1,"__esModule",{value:!0});logger$1.Logger=void 0;let Logger$1=class{static error(t){console.error(t)}static trace(t){console.trace(t)}};logger$1.Logger=Logger$1;var utils={},__awaiter$1=commonjsGlobal$2&&commonjsGlobal$2.__awaiter||function(Z,t,Hs,zs){function Ys(Zs){return Zs instanceof Hs?Zs:new Hs(function(_u){_u(Zs)})}return new(Hs||(Hs=Promise))(function(Zs,_u){function Eu($u){try{Au(zs.next($u))}catch(vu){_u(vu)}}function Iu($u){try{Au(zs.throw($u))}catch(vu){_u(vu)}}function Au($u){$u.done?Zs($u.value):Ys($u.value).then(Eu,Iu)}Au((zs=zs.apply(Z,t||[])).next())})};Object.defineProperty(utils,"__esModule",{value:!0});utils.getCurrentSession=getCurrentSession;utils.getCurrentTopic=getCurrentTopic;utils.getConnectionParams=getConnectionParams;utils.getExistingConnectionParams=getExistingConnectionParams;utils.getMvxNamespace=getMvxNamespace;utils.addressIsValid=addressIsValid;utils.getAddressFromSession=getAddressFromSession;utils.applyTransactionSignature=applyTransactionSignature;utils.getMetadata=getMetadata;utils.sleep=sleep;const address_1$3=address,utils_1$1=require$$3,constants_1$3=constants,errors_1$1=errors$3,logger_1=logger$1,operation_1$1=operation$1;function getCurrentSession(Z,t){if(!t)throw new Error(errors_1$1.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);const Hs=t.find(getExistingConnectionParams(Z)).filter(zs=>zs.acknowledged);if(Hs.length>0){const zs=Hs.length-1;return Hs[zs]}if(t.session.length>0){const zs=t.session.keys.length-1;return t.session.get(t.session.keys[zs])}throw logger_1.Logger.error(errors_1$1.WalletConnectV2ProviderErrorMessagesEnum.sessionNotConnected),new Error(errors_1$1.WalletConnectV2ProviderErrorMessagesEnum.sessionNotConnected)}function getCurrentTopic(Z,t){if(!t)throw new Error(errors_1$1.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);const Hs=getCurrentSession(Z,t);if(!(Hs!=null&&Hs.topic))throw new Error(errors_1$1.WalletConnectV2ProviderErrorMessagesEnum.sessionNotConnected);return Hs.topic}function getConnectionParams(Z,t){return{optionalNamespaces:getMvxNamespace(Z,t)}}function getExistingConnectionParams(Z,t){return{requiredNamespaces:getMvxNamespace(Z,t)}}function getMvxNamespace(Z,t){var Hs,zs,Ys;const Zs=[...constants_1$3.WALLETCONNECT_MULTIVERSX_METHODS,...(Hs=t==null?void 0:t.methods)!==null&&Hs!==void 0?Hs:[]];!((zs=t==null?void 0:t.methods)===null||zs===void 0)&&zs.includes(operation_1$1.OptionalOperation.SIGN_LOGIN_TOKEN)||Zs.push(operation_1$1.OptionalOperation.SIGN_LOGIN_TOKEN);const _u=[`${constants_1$3.WALLETCONNECT_MULTIVERSX_NAMESPACE}:${Z}`],Eu=(Ys=t==null?void 0:t.events)!==null&&Ys!==void 0?Ys:[];return{[constants_1$3.WALLETCONNECT_MULTIVERSX_NAMESPACE]:{methods:Zs,chains:_u,events:Eu}}}function addressIsValid(Z){try{return!address_1$3.Address.newFromBech32(Z).isEmpty()}catch{return!1}}function getAddressFromSession(Z){const t=Z.namespaces[constants_1$3.WALLETCONNECT_MULTIVERSX_NAMESPACE];if(t&&t.accounts){const Hs=t.accounts[0],[zs,Ys,Zs]=Hs.split(":");return Zs}return""}function applyTransactionSignature({transaction:Z,response:t}){if(!t)throw logger_1.Logger.error(errors_1$1.WalletConnectV2ProviderErrorMessagesEnum.invalidTransactionResponse),new Error(errors_1$1.WalletConnectV2ProviderErrorMessagesEnum.invalidTransactionResponse);const{signature:Hs,guardianSignature:zs,version:Ys,options:Zs,guardian:_u}=t,Eu=Z.guardian.toBech32();if(Eu&&Eu!==_u)throw logger_1.Logger.error(errors_1$1.WalletConnectV2ProviderErrorMessagesEnum.invalidGuardian),new Error(errors_1$1.WalletConnectV2ProviderErrorMessagesEnum.invalidGuardian);return _u&&(Z.guardian=address_1$3.Address.newFromBech32(_u)),Ys&&(Z.version=Ys),Zs!=null&&(Z.options=Zs),Z.signature=Buffer$1.from(Hs,"hex"),zs&&(Z.guardianSignature=Buffer$1.from(zs,"hex")),Z}function getMetadata(Z){if(Z)return Object.assign(Object.assign({},Z),{url:(0,utils_1$1.getAppMetadata)().url})}function sleep(Z){return __awaiter$1(this,void 0,void 0,function*(){return yield new Promise(t=>setTimeout(()=>{t()},Z))})}(function(Z){var t=commonjsGlobal$2&&commonjsGlobal$2.__awaiter||function(Ru,Pu,Cu,Bu){function Fu(zu){return zu instanceof Cu?zu:new Cu(function(Hu){Hu(zu)})}return new(Cu||(Cu=Promise))(function(zu,Hu){function Wu(ju){try{Xu(Bu.next(ju))}catch(ku){Hu(ku)}}function tl(ju){try{Xu(Bu.throw(ju))}catch(ku){Hu(ku)}}function Xu(ju){ju.done?zu(ju.value):Fu(ju.value).then(Wu,tl)}Xu((Bu=Bu.apply(Ru,Pu||[])).next())})},Hs=commonjsGlobal$2&&commonjsGlobal$2.__importDefault||function(Ru){return Ru&&Ru.__esModule?Ru:{default:Ru}};Object.defineProperty(Z,"__esModule",{value:!0}),Z.WalletConnectV2Provider=Z.OptionalOperation=Z.Operation=Z.WalletConnectV2ProviderErrorMessagesEnum=void 0;const zs=message,Ys=address,Zs=Hs(require$$2),_u=require$$3,Eu=constants,Iu=errors$3;Object.defineProperty(Z,"WalletConnectV2ProviderErrorMessagesEnum",{enumerable:!0,get:function(){return Iu.WalletConnectV2ProviderErrorMessagesEnum}});const Au=logger$1,$u=operation$1;Object.defineProperty(Z,"Operation",{enumerable:!0,get:function(){return $u.Operation}}),Object.defineProperty(Z,"OptionalOperation",{enumerable:!0,get:function(){return $u.OptionalOperation}});const vu=utils;class Su{constructor(Pu,Cu,Bu,Fu,zu){this.chainId="",this.isInitializing=!1,this.processingTopic="",this.options={},this.account={address:""},this.onClientConnect=Pu,this.chainId=Cu,this.walletConnectV2Relay=Bu,this.walletConnectV2ProjectId=Fu,this.options=zu}disconnect(){this.account={address:"",signature:""},this.walletConnector=void 0,this.session=void 0,this.pairings=void 0}init(){return t(this,void 0,void 0,function*(){var Pu,Cu;if(this.isInitialized())return this.isInitialized();try{if(!this.isInitializing){this.isInitializing=!0,this.disconnect();const Bu=!((Pu=this.options)===null||Pu===void 0)&&Pu.metadata?{metadata:(0,vu.getMetadata)((Cu=this.options)===null||Cu===void 0?void 0:Cu.metadata)}:{},Fu=yield Zs.default.init(Object.assign(Object.assign(Object.assign({},this.options),{relayUrl:this.walletConnectV2Relay,projectId:this.walletConnectV2ProjectId}),Bu));this.walletConnector=Fu,this.isInitializing=!1,yield this.subscribeToEvents(Fu),yield this.checkPersistedState(Fu)}}catch{throw new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.unableToInit)}finally{return this.isInitializing=!1,this.isInitialized()}})}isInitialized(){return!!this.walletConnector&&!this.isInitializing}isConnected(){return!!(this.isInitialized()&&typeof this.session<"u")}getAccount(){return this.account}setAccount(Pu){this.account=Pu}connect(Pu){return t(this,void 0,void 0,function*(){var Cu,Bu;if(typeof this.walletConnector>"u")throw new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);const Fu=(0,vu.getConnectionParams)(this.chainId,Pu);try{return yield this.walletConnector.connect(Object.assign({pairingTopic:Pu==null?void 0:Pu.topic},Fu))}catch{if(Pu!=null&&Pu.topic)try{(Bu=(Cu=this.walletConnector.core)===null||Cu===void 0?void 0:Cu.expirer)===null||Bu===void 0||Bu.set(Pu.topic,0)}catch{Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.unableToHandleCleanup)}throw this.disconnect(),Au.Logger.error(Pu!=null&&Pu.topic?Iu.WalletConnectV2ProviderErrorMessagesEnum.unableToConnectExisting:Iu.WalletConnectV2ProviderErrorMessagesEnum.unableToConnect),new Error(Pu!=null&&Pu.topic?Iu.WalletConnectV2ProviderErrorMessagesEnum.unableToConnectExisting:Iu.WalletConnectV2ProviderErrorMessagesEnum.unableToConnect)}})}login(Pu){return t(this,void 0,void 0,function*(){var Cu;if(this.isInitializing=!0,typeof this.walletConnector>"u"&&(yield this.connect()),typeof this.walletConnector>"u")throw new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);typeof this.session<"u"&&(yield this.logout({topic:(Cu=this.session)===null||Cu===void 0?void 0:Cu.topic}));try{if(Pu&&Pu.approval){const Bu=yield Pu.approval();if(Pu.token){yield(0,vu.sleep)(Eu.WALLETCONNECT_SIGN_LOGIN_DELAY);const Fu=(0,vu.getAddressFromSession)(Bu),Hu=Bu.namespaces[Eu.WALLETCONNECT_MULTIVERSX_NAMESPACE].methods.includes($u.OptionalOperation.SIGN_NATIVE_AUTH_TOKEN)?$u.OptionalOperation.SIGN_NATIVE_AUTH_TOKEN:$u.OptionalOperation.SIGN_LOGIN_TOKEN,{signature:Wu}=yield this.walletConnector.request({chainId:`${Eu.WALLETCONNECT_MULTIVERSX_NAMESPACE}:${this.chainId}`,topic:Bu.topic,request:{method:Hu,params:{token:Pu.token,address:Fu}}});if(!Wu)throw Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.unableToSignLoginToken),new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.unableToSignLoginToken);return yield this.onSessionConnected({session:Bu,signature:Wu})}return yield this.onSessionConnected({session:Bu,signature:""})}}catch{throw this.disconnect(),Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.unableToLogin),new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.unableToLogin)}finally{this.isInitializing=!1}return null})}logout(Pu){return t(this,void 0,void 0,function*(){if(typeof this.walletConnector>"u")throw Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.notInitialized),new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);try{if(this.processingTopic===((Pu==null?void 0:Pu.topic)||(0,vu.getCurrentTopic)(this.chainId,this.walletConnector)))return!0;if(Pu!=null&&Pu.topic)this.processingTopic=Pu.topic,yield this.walletConnector.disconnect({topic:Pu.topic,reason:(0,_u.getSdkError)("USER_DISCONNECTED")});else{const Cu=(0,vu.getCurrentTopic)(this.chainId,this.walletConnector);this.processingTopic=Cu,yield this.walletConnector.disconnect({topic:Cu,reason:(0,_u.getSdkError)("USER_DISCONNECTED")}),this.disconnect(),yield this.cleanupPendingPairings({deletePairings:!0})}}catch{Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.alreadyLoggedOut)}finally{this.processingTopic=""}return!0})}getAddress(){if(typeof this.walletConnector>"u")throw Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.notInitialized),new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);return this.account.address}getSignature(){if(typeof this.walletConnector>"u")throw Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.notInitialized),new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);return this.account.signature}getPairings(){return t(this,void 0,void 0,function*(){var Pu,Cu,Bu,Fu,zu;if(typeof this.walletConnector>"u")throw Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.notInitialized),new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);return(zu=(Fu=(Bu=(Cu=(Pu=this.walletConnector)===null||Pu===void 0?void 0:Pu.core)===null||Cu===void 0?void 0:Cu.pairing)===null||Bu===void 0?void 0:Bu.pairings)===null||Fu===void 0?void 0:Fu.getAll({active:!0}))!==null&&zu!==void 0?zu:[]})}signMessage(Pu){return t(this,void 0,void 0,function*(){var Cu;const Bu=new zs.Message({data:Buffer$1.from(Pu.data),address:(Cu=Pu.address)!==null&&Cu!==void 0?Cu:Ys.Address.newFromBech32(this.account.address),signer:"wallet-connect-v2",version:Pu.version});if(typeof this.walletConnector>"u")throw Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.notInitialized),new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);if(typeof this.session>"u")throw Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.sessionNotConnected),this.onClientConnect.onClientLogout(),new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.sessionNotConnected);try{const Fu=this.getAddress(),{signature:zu}=yield this.walletConnector.request({chainId:`${Eu.WALLETCONNECT_MULTIVERSX_NAMESPACE}:${this.chainId}`,topic:(0,vu.getCurrentTopic)(this.chainId,this.walletConnector),request:{method:$u.Operation.SIGN_MESSAGE,params:{address:Fu,message:Bu.data.toString()}}});if(!zu)throw Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.invalidMessageResponse),new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.invalidMessageResponse);try{Bu.signature=Buffer$1.from(zu,"hex")}catch{throw Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.invalidMessageSignature),new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.invalidMessageSignature)}}catch{throw new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.unableToSign)}return Bu})}signTransaction(Pu){return t(this,void 0,void 0,function*(){if(typeof this.walletConnector>"u")throw Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.notInitialized),new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);if(typeof this.session>"u")throw Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.sessionNotConnected),this.onClientConnect.onClientLogout(),new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.sessionNotConnected);const Cu=Pu.toPlainObject();if(this.chainId!==Pu.chainID.valueOf())throw Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.requestDifferentChain),new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.requestDifferentChain);try{const Bu=yield this.walletConnector.request({chainId:`${Eu.WALLETCONNECT_MULTIVERSX_NAMESPACE}:${this.chainId}`,topic:(0,vu.getCurrentTopic)(this.chainId,this.walletConnector),request:{method:$u.Operation.SIGN_TRANSACTION,params:{transaction:Cu}}});return(0,vu.applyTransactionSignature)({transaction:Pu,response:Bu})}catch{throw new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.transactionError)}})}signTransactions(Pu){return t(this,void 0,void 0,function*(){if(typeof this.walletConnector>"u")throw Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.notInitialized),new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);if(typeof this.session>"u")throw Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.sessionNotConnected),this.onClientConnect.onClientLogout(),new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.sessionNotConnected);const Cu=Pu.map(Bu=>{if(this.chainId!==Bu.chainID.valueOf())throw Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.requestDifferentChain),new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.requestDifferentChain);return Bu.toPlainObject()});try{const{signatures:Bu}=yield this.walletConnector.request({chainId:`${Eu.WALLETCONNECT_MULTIVERSX_NAMESPACE}:${this.chainId}`,topic:(0,vu.getCurrentTopic)(this.chainId,this.walletConnector),request:{method:$u.Operation.SIGN_TRANSACTIONS,params:{transactions:Cu}}});if(!Bu)throw Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.invalidTransactionResponse),new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.invalidTransactionResponse);if(!Array.isArray(Bu)||Pu.length!==Bu.length)throw new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.invalidTransactionResponse);for(const[Fu,zu]of Pu.entries()){const Hu=Bu[Fu];(0,vu.applyTransactionSignature)({transaction:zu,response:Hu})}return Pu}catch{throw new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.transactionError)}})}sendCustomRequest(Pu){return t(this,void 0,void 0,function*(){var Cu;if(typeof this.walletConnector>"u")throw Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.notInitialized),new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);if(typeof this.session>"u")throw Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.sessionNotConnected),this.onClientConnect.onClientLogout(),new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.sessionNotConnected);if(!((Cu=Pu==null?void 0:Pu.request)===null||Cu===void 0)&&Cu.method){try{const Bu=Object.assign({},Pu.request);let{method:Fu}=Bu;const{response:zu}=yield this.walletConnector.request({chainId:`${Eu.WALLETCONNECT_MULTIVERSX_NAMESPACE}:${this.chainId}`,topic:(0,vu.getCurrentTopic)(this.chainId,this.walletConnector),request:Object.assign(Object.assign({},Bu),{method:Fu})});zu||Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.invalidCustomRequestResponse)}catch{Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.invalidCustomRequestResponse)}return}})}ping(){return t(this,void 0,void 0,function*(){if(typeof this.walletConnector>"u")throw Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.notInitialized),new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);typeof this.session>"u"&&Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.sessionNotConnected);try{const Pu=(0,vu.getCurrentTopic)(this.chainId,this.walletConnector);return yield this.walletConnector.ping({topic:Pu}),!0}catch{return Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.pingFailed),!1}})}loginAccount(Pu){return t(this,void 0,void 0,function*(){return Pu?(0,vu.addressIsValid)(Pu.address)?(this.account.address=Pu.address,Pu.signature&&(this.account.signature=Pu.signature),this.onClientConnect.onClientLogin(),this.account.address):(Au.Logger.error(`${Iu.WalletConnectV2ProviderErrorMessagesEnum.invalidAddress} ${Pu.address}`),this.walletConnector&&(yield this.logout()),""):""})}onSessionConnected(Pu){return t(this,void 0,void 0,function*(){if(!Pu)return null;this.session=Pu.session,this.account.signature=Pu.signature||"";const Cu=(0,vu.getAddressFromSession)(Pu.session);return Cu?(yield this.loginAccount({address:Cu,signature:Pu.signature}),this.account.address=Cu,this.account):null})}handleSessionEvents(Pu){return t(this,arguments,void 0,function*({topic:Cu,params:Bu}){var Fu;if(typeof this.walletConnector>"u")throw new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);if(this.session&&((Fu=this.session)===null||Fu===void 0?void 0:Fu.topic)!==Cu)return;const{event:zu}=Bu;if(zu!=null&&zu.name&&(0,vu.getCurrentTopic)(this.chainId,this.walletConnector)===Cu){const Hu=zu.data;this.onClientConnect.onClientEvent(Hu)}})}subscribeToEvents(Pu){return t(this,void 0,void 0,function*(){if(typeof Pu>"u")throw new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);try{Pu.on("session_update",({topic:Cu,params:Bu})=>{var Fu;if(!this.session||((Fu=this.session)===null||Fu===void 0?void 0:Fu.topic)!==Cu)return;const{namespaces:zu}=Bu,Hu=Pu.session.get(Cu),Wu=Object.assign(Object.assign({},Hu),{namespaces:zu});this.onSessionConnected({session:Wu})}),Pu.on("session_event",this.handleSessionEvents.bind(this)),Pu.on("session_delete",Cu=>t(this,[Cu],void 0,function*({topic:Bu}){var Fu;this.isInitializing&&(this.onClientConnect.onClientLogout(),this.disconnect()),!(!this.session||((Fu=this.session)===null||Fu===void 0?void 0:Fu.topic)!==Bu)&&(Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.sessionDeleted),this.onClientConnect.onClientLogout(),this.disconnect(),yield this.cleanupPendingPairings({deletePairings:!0}))})),Pu.on("session_expire",Cu=>t(this,[Cu],void 0,function*({topic:Bu}){var Fu;!this.session||((Fu=this.session)===null||Fu===void 0?void 0:Fu.topic)!==Bu||(Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.sessionExpired),this.onClientConnect.onClientLogout(),this.disconnect(),yield this.cleanupPendingPairings({deletePairings:!0}))}))}catch{Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.unableToHandleEvent)}})}checkPersistedState(Pu){return t(this,void 0,void 0,function*(){if(typeof Pu>"u")throw new Error(Iu.WalletConnectV2ProviderErrorMessagesEnum.notInitialized);if(this.pairings=yield this.getPairings(),!(typeof this.session<"u")&&Pu.session.length&&!this.account.address&&!this.isInitializing){const Cu=(0,vu.getCurrentSession)(this.chainId,Pu);if(Cu)return yield this.onSessionConnected({session:Cu}),Cu}})}cleanupPendingPairings(){return t(this,arguments,void 0,function*(Pu={}){var Cu,Bu,Fu,zu,Hu,Wu,tl,Xu;if(!(typeof this.walletConnector>"u"))try{const ju=(Fu=(Bu=(Cu=this.walletConnector.core)===null||Cu===void 0?void 0:Cu.pairing)===null||Bu===void 0?void 0:Bu.pairings)===null||Fu===void 0?void 0:Fu.getAll({active:!1});if(!(0,_u.isValidArray)(ju))return;for(const ku of ju)if(Pu.deletePairings)(Hu=(zu=this.walletConnector.core)===null||zu===void 0?void 0:zu.expirer)===null||Hu===void 0||Hu.set(ku.topic,0);else try{yield(Xu=(tl=(Wu=this.walletConnector.core)===null||Wu===void 0?void 0:Wu.relayer)===null||tl===void 0?void 0:tl.subscriber)===null||Xu===void 0?void 0:Xu.unsubscribe(ku.topic)}catch{Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.unableToHandleCleanup)}}catch{Au.Logger.error(Iu.WalletConnectV2ProviderErrorMessagesEnum.unableToHandleCleanup)}})}}Z.WalletConnectV2Provider=Su})(walletConnectV2Provider);(function(Z){var t=commonjsGlobal$2&&commonjsGlobal$2.__createBinding||(Object.create?function(zs,Ys,Zs,_u){_u===void 0&&(_u=Zs);var Eu=Object.getOwnPropertyDescriptor(Ys,Zs);(!Eu||("get"in Eu?!Ys.__esModule:Eu.writable||Eu.configurable))&&(Eu={enumerable:!0,get:function(){return Ys[Zs]}}),Object.defineProperty(zs,_u,Eu)}:function(zs,Ys,Zs,_u){_u===void 0&&(_u=Zs),zs[_u]=Ys[Zs]}),Hs=commonjsGlobal$2&&commonjsGlobal$2.__exportStar||function(zs,Ys){for(var Zs in zs)Zs!=="default"&&!Object.prototype.hasOwnProperty.call(Ys,Zs)&&t(Ys,zs,Zs)};Object.defineProperty(Z,"__esModule",{value:!0}),Hs(walletConnectV2Provider,Z)})(out$1);var out={},extensionProvider={},transaction={},transactionComputer={},proto={},serializer={};function commonjsRequire(Z){throw new Error('Could not dynamically require "'+Z+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var compiled={exports:{}},indexMinimal={},minimal$1={},aspromise,hasRequiredAspromise;function requireAspromise(){if(hasRequiredAspromise)return aspromise;hasRequiredAspromise=1,aspromise=Z;function Z(t,Hs){for(var zs=new Array(arguments.length-1),Ys=0,Zs=2,_u=!0;Zs<arguments.length;)zs[Ys++]=arguments[Zs++];return new Promise(function(Iu,Au){zs[Ys]=function(vu){if(_u)if(_u=!1,vu)Au(vu);else{for(var Su=new Array(arguments.length-1),Ru=0;Ru<Su.length;)Su[Ru++]=arguments[Ru];Iu.apply(null,Su)}};try{t.apply(Hs||null,zs)}catch($u){_u&&(_u=!1,Au($u))}})}return aspromise}var base64$1={},hasRequiredBase64;function requireBase64(){return hasRequiredBase64||(hasRequiredBase64=1,function(Z){var t=Z;t.length=function(Eu){var Iu=Eu.length;if(!Iu)return 0;for(var Au=0;--Iu%4>1&&Eu.charAt(Iu)==="=";)++Au;return Math.ceil(Eu.length*3)/4-Au};for(var Hs=new Array(64),zs=new Array(123),Ys=0;Ys<64;)zs[Hs[Ys]=Ys<26?Ys+65:Ys<52?Ys+71:Ys<62?Ys-4:Ys-59|43]=Ys++;t.encode=function(Eu,Iu,Au){for(var $u=null,vu=[],Su=0,Ru=0,Pu;Iu<Au;){var Cu=Eu[Iu++];switch(Ru){case 0:vu[Su++]=Hs[Cu>>2],Pu=(Cu&3)<<4,Ru=1;break;case 1:vu[Su++]=Hs[Pu|Cu>>4],Pu=(Cu&15)<<2,Ru=2;break;case 2:vu[Su++]=Hs[Pu|Cu>>6],vu[Su++]=Hs[Cu&63],Ru=0;break}Su>8191&&(($u||($u=[])).push(String.fromCharCode.apply(String,vu)),Su=0)}return Ru&&(vu[Su++]=Hs[Pu],vu[Su++]=61,Ru===1&&(vu[Su++]=61)),$u?(Su&&$u.push(String.fromCharCode.apply(String,vu.slice(0,Su))),$u.join("")):String.fromCharCode.apply(String,vu.slice(0,Su))};var Zs="invalid encoding";t.decode=function(Eu,Iu,Au){for(var $u=Au,vu=0,Su,Ru=0;Ru<Eu.length;){var Pu=Eu.charCodeAt(Ru++);if(Pu===61&&vu>1)break;if((Pu=zs[Pu])===void 0)throw Error(Zs);switch(vu){case 0:Su=Pu,vu=1;break;case 1:Iu[Au++]=Su<<2|(Pu&48)>>4,Su=Pu,vu=2;break;case 2:Iu[Au++]=(Su&15)<<4|(Pu&60)>>2,Su=Pu,vu=3;break;case 3:Iu[Au++]=(Su&3)<<6|Pu,vu=0;break}}if(vu===1)throw Error(Zs);return Au-$u},t.test=function(Eu){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(Eu)}}(base64$1)),base64$1}var eventemitter,hasRequiredEventemitter;function requireEventemitter(){if(hasRequiredEventemitter)return eventemitter;hasRequiredEventemitter=1,eventemitter=Z;function Z(){this._listeners={}}return Z.prototype.on=function(Hs,zs,Ys){return(this._listeners[Hs]||(this._listeners[Hs]=[])).push({fn:zs,ctx:Ys||this}),this},Z.prototype.off=function(Hs,zs){if(Hs===void 0)this._listeners={};else if(zs===void 0)this._listeners[Hs]=[];else for(var Ys=this._listeners[Hs],Zs=0;Zs<Ys.length;)Ys[Zs].fn===zs?Ys.splice(Zs,1):++Zs;return this},Z.prototype.emit=function(Hs){var zs=this._listeners[Hs];if(zs){for(var Ys=[],Zs=1;Zs<arguments.length;)Ys.push(arguments[Zs++]);for(Zs=0;Zs<zs.length;)zs[Zs].fn.apply(zs[Zs++].ctx,Ys)}return this},eventemitter}var float,hasRequiredFloat;function requireFloat(){if(hasRequiredFloat)return float;hasRequiredFloat=1,float=Z(Z);function Z(Zs){return typeof Float32Array<"u"?function(){var _u=new Float32Array([-0]),Eu=new Uint8Array(_u.buffer),Iu=Eu[3]===128;function Au(Ru,Pu,Cu){_u[0]=Ru,Pu[Cu]=Eu[0],Pu[Cu+1]=Eu[1],Pu[Cu+2]=Eu[2],Pu[Cu+3]=Eu[3]}function $u(Ru,Pu,Cu){_u[0]=Ru,Pu[Cu]=Eu[3],Pu[Cu+1]=Eu[2],Pu[Cu+2]=Eu[1],Pu[Cu+3]=Eu[0]}Zs.writeFloatLE=Iu?Au:$u,Zs.writeFloatBE=Iu?$u:Au;function vu(Ru,Pu){return Eu[0]=Ru[Pu],Eu[1]=Ru[Pu+1],Eu[2]=Ru[Pu+2],Eu[3]=Ru[Pu+3],_u[0]}function Su(Ru,Pu){return Eu[3]=Ru[Pu],Eu[2]=Ru[Pu+1],Eu[1]=Ru[Pu+2],Eu[0]=Ru[Pu+3],_u[0]}Zs.readFloatLE=Iu?vu:Su,Zs.readFloatBE=Iu?Su:vu}():function(){function _u(Iu,Au,$u,vu){var Su=Au<0?1:0;if(Su&&(Au=-Au),Au===0)Iu(1/Au>0?0:2147483648,$u,vu);else if(isNaN(Au))Iu(2143289344,$u,vu);else if(Au>34028234663852886e22)Iu((Su<<31|2139095040)>>>0,$u,vu);else if(Au<11754943508222875e-54)Iu((Su<<31|Math.round(Au/1401298464324817e-60))>>>0,$u,vu);else{var Ru=Math.floor(Math.log(Au)/Math.LN2),Pu=Math.round(Au*Math.pow(2,-Ru)*8388608)&8388607;Iu((Su<<31|Ru+127<<23|Pu)>>>0,$u,vu)}}Zs.writeFloatLE=_u.bind(null,t),Zs.writeFloatBE=_u.bind(null,Hs);function Eu(Iu,Au,$u){var vu=Iu(Au,$u),Su=(vu>>31)*2+1,Ru=vu>>>23&255,Pu=vu&8388607;return Ru===255?Pu?NaN:Su*(1/0):Ru===0?Su*1401298464324817e-60*Pu:Su*Math.pow(2,Ru-150)*(Pu+8388608)}Zs.readFloatLE=Eu.bind(null,zs),Zs.readFloatBE=Eu.bind(null,Ys)}(),typeof Float64Array<"u"?function(){var _u=new Float64Array([-0]),Eu=new Uint8Array(_u.buffer),Iu=Eu[7]===128;function Au(Ru,Pu,Cu){_u[0]=Ru,Pu[Cu]=Eu[0],Pu[Cu+1]=Eu[1],Pu[Cu+2]=Eu[2],Pu[Cu+3]=Eu[3],Pu[Cu+4]=Eu[4],Pu[Cu+5]=Eu[5],Pu[Cu+6]=Eu[6],Pu[Cu+7]=Eu[7]}function $u(Ru,Pu,Cu){_u[0]=Ru,Pu[Cu]=Eu[7],Pu[Cu+1]=Eu[6],Pu[Cu+2]=Eu[5],Pu[Cu+3]=Eu[4],Pu[Cu+4]=Eu[3],Pu[Cu+5]=Eu[2],Pu[Cu+6]=Eu[1],Pu[Cu+7]=Eu[0]}Zs.writeDoubleLE=Iu?Au:$u,Zs.writeDoubleBE=Iu?$u:Au;function vu(Ru,Pu){return Eu[0]=Ru[Pu],Eu[1]=Ru[Pu+1],Eu[2]=Ru[Pu+2],Eu[3]=Ru[Pu+3],Eu[4]=Ru[Pu+4],Eu[5]=Ru[Pu+5],Eu[6]=Ru[Pu+6],Eu[7]=Ru[Pu+7],_u[0]}function Su(Ru,Pu){return Eu[7]=Ru[Pu],Eu[6]=Ru[Pu+1],Eu[5]=Ru[Pu+2],Eu[4]=Ru[Pu+3],Eu[3]=Ru[Pu+4],Eu[2]=Ru[Pu+5],Eu[1]=Ru[Pu+6],Eu[0]=Ru[Pu+7],_u[0]}Zs.readDoubleLE=Iu?vu:Su,Zs.readDoubleBE=Iu?Su:vu}():function(){function _u(Iu,Au,$u,vu,Su,Ru){var Pu=vu<0?1:0;if(Pu&&(vu=-vu),vu===0)Iu(0,Su,Ru+Au),Iu(1/vu>0?0:2147483648,Su,Ru+$u);else if(isNaN(vu))Iu(0,Su,Ru+Au),Iu(2146959360,Su,Ru+$u);else if(vu>17976931348623157e292)Iu(0,Su,Ru+Au),Iu((Pu<<31|2146435072)>>>0,Su,Ru+$u);else{var Cu;if(vu<22250738585072014e-324)Cu=vu/5e-324,Iu(Cu>>>0,Su,Ru+Au),Iu((Pu<<31|Cu/4294967296)>>>0,Su,Ru+$u);else{var Bu=Math.floor(Math.log(vu)/Math.LN2);Bu===1024&&(Bu=1023),Cu=vu*Math.pow(2,-Bu),Iu(Cu*4503599627370496>>>0,Su,Ru+Au),Iu((Pu<<31|Bu+1023<<20|Cu*1048576&1048575)>>>0,Su,Ru+$u)}}}Zs.writeDoubleLE=_u.bind(null,t,0,4),Zs.writeDoubleBE=_u.bind(null,Hs,4,0);function Eu(Iu,Au,$u,vu,Su){var Ru=Iu(vu,Su+Au),Pu=Iu(vu,Su+$u),Cu=(Pu>>31)*2+1,Bu=Pu>>>20&2047,Fu=4294967296*(Pu&1048575)+Ru;return Bu===2047?Fu?NaN:Cu*(1/0):Bu===0?Cu*5e-324*Fu:Cu*Math.pow(2,Bu-1075)*(Fu+4503599627370496)}Zs.readDoubleLE=Eu.bind(null,zs,0,4),Zs.readDoubleBE=Eu.bind(null,Ys,4,0)}(),Zs}function t(Zs,_u,Eu){_u[Eu]=Zs&255,_u[Eu+1]=Zs>>>8&255,_u[Eu+2]=Zs>>>16&255,_u[Eu+3]=Zs>>>24}function Hs(Zs,_u,Eu){_u[Eu]=Zs>>>24,_u[Eu+1]=Zs>>>16&255,_u[Eu+2]=Zs>>>8&255,_u[Eu+3]=Zs&255}function zs(Zs,_u){return(Zs[_u]|Zs[_u+1]<<8|Zs[_u+2]<<16|Zs[_u+3]<<24)>>>0}function Ys(Zs,_u){return(Zs[_u]<<24|Zs[_u+1]<<16|Zs[_u+2]<<8|Zs[_u+3])>>>0}return float}var inquire_1,hasRequiredInquire;function requireInquire(){if(hasRequiredInquire)return inquire_1;hasRequiredInquire=1,inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(Z){}return null}return inquire_1}var utf8={},hasRequiredUtf8;function requireUtf8(){return hasRequiredUtf8||(hasRequiredUtf8=1,function(Z){var t=Z;t.length=function(zs){for(var Ys=0,Zs=0,_u=0;_u<zs.length;++_u)Zs=zs.charCodeAt(_u),Zs<128?Ys+=1:Zs<2048?Ys+=2:(Zs&64512)===55296&&(zs.charCodeAt(_u+1)&64512)===56320?(++_u,Ys+=4):Ys+=3;return Ys},t.read=function(zs,Ys,Zs){var _u=Zs-Ys;if(_u<1)return"";for(var Eu=null,Iu=[],Au=0,$u;Ys<Zs;)$u=zs[Ys++],$u<128?Iu[Au++]=$u:$u>191&&$u<224?Iu[Au++]=($u&31)<<6|zs[Ys++]&63:$u>239&&$u<365?($u=(($u&7)<<18|(zs[Ys++]&63)<<12|(zs[Ys++]&63)<<6|zs[Ys++]&63)-65536,Iu[Au++]=55296+($u>>10),Iu[Au++]=56320+($u&1023)):Iu[Au++]=($u&15)<<12|(zs[Ys++]&63)<<6|zs[Ys++]&63,Au>8191&&((Eu||(Eu=[])).push(String.fromCharCode.apply(String,Iu)),Au=0);return Eu?(Au&&Eu.push(String.fromCharCode.apply(String,Iu.slice(0,Au))),Eu.join("")):String.fromCharCode.apply(String,Iu.slice(0,Au))},t.write=function(zs,Ys,Zs){for(var _u=Zs,Eu,Iu,Au=0;Au<zs.length;++Au)Eu=zs.charCodeAt(Au),Eu<128?Ys[Zs++]=Eu:Eu<2048?(Ys[Zs++]=Eu>>6|192,Ys[Zs++]=Eu&63|128):(Eu&64512)===55296&&((Iu=zs.charCodeAt(Au+1))&64512)===56320?(Eu=65536+((Eu&1023)<<10)+(Iu&1023),++Au,Ys[Zs++]=Eu>>18|240,Ys[Zs++]=Eu>>12&63|128,Ys[Zs++]=Eu>>6&63|128,Ys[Zs++]=Eu&63|128):(Ys[Zs++]=Eu>>12|224,Ys[Zs++]=Eu>>6&63|128,Ys[Zs++]=Eu&63|128);return Zs-_u}}(utf8)),utf8}var pool_1,hasRequiredPool;function requirePool(){if(hasRequiredPool)return pool_1;hasRequiredPool=1,pool_1=Z;function Z(t,Hs,zs){var Ys=zs||8192,Zs=Ys>>>1,_u=null,Eu=Ys;return function(Au){if(Au<1||Au>Zs)return t(Au);Eu+Au>Ys&&(_u=t(Ys),Eu=0);var $u=Hs.call(_u,Eu,Eu+=Au);return Eu&7&&(Eu=(Eu|7)+1),$u}}return pool_1}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=t;var Z=requireMinimal$1();function t(Zs,_u){this.lo=Zs>>>0,this.hi=_u>>>0}var Hs=t.zero=new t(0,0);Hs.toNumber=function(){return 0},Hs.zzEncode=Hs.zzDecode=function(){return this},Hs.length=function(){return 1};var zs=t.zeroHash="\0\0\0\0\0\0\0\0";t.fromNumber=function(_u){if(_u===0)return Hs;var Eu=_u<0;Eu&&(_u=-_u);var Iu=_u>>>0,Au=(_u-Iu)/4294967296>>>0;return Eu&&(Au=~Au>>>0,Iu=~Iu>>>0,++Iu>4294967295&&(Iu=0,++Au>4294967295&&(Au=0))),new t(Iu,Au)},t.from=function(_u){if(typeof _u=="number")return t.fromNumber(_u);if(Z.isString(_u))if(Z.Long)_u=Z.Long.fromString(_u);else return t.fromNumber(parseInt(_u,10));return _u.low||_u.high?new t(_u.low>>>0,_u.high>>>0):Hs},t.prototype.toNumber=function(_u){if(!_u&&this.hi>>>31){var Eu=~this.lo+1>>>0,Iu=~this.hi>>>0;return Eu||(Iu=Iu+1>>>0),-(Eu+Iu*4294967296)}return this.lo+this.hi*4294967296},t.prototype.toLong=function(_u){return Z.Long?new Z.Long(this.lo|0,this.hi|0,!!_u):{low:this.lo|0,high:this.hi|0,unsigned:!!_u}};var Ys=String.prototype.charCodeAt;return t.fromHash=function(_u){return _u===zs?Hs:new t((Ys.call(_u,0)|Ys.call(_u,1)<<8|Ys.call(_u,2)<<16|Ys.call(_u,3)<<24)>>>0,(Ys.call(_u,4)|Ys.call(_u,5)<<8|Ys.call(_u,6)<<16|Ys.call(_u,7)<<24)>>>0)},t.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},t.prototype.zzEncode=function(){var _u=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^_u)>>>0,this.lo=(this.lo<<1^_u)>>>0,this},t.prototype.zzDecode=function(){var _u=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^_u)>>>0,this.hi=(this.hi>>>1^_u)>>>0,this},t.prototype.length=function(){var _u=this.lo,Eu=(this.lo>>>28|this.hi<<4)>>>0,Iu=this.hi>>>24;return Iu===0?Eu===0?_u<16384?_u<128?1:2:_u<2097152?3:4:Eu<16384?Eu<128?5:6:Eu<2097152?7:8:Iu<128?9:10},longbits}var hasRequiredMinimal$1;function requireMinimal$1(){return hasRequiredMinimal$1||(hasRequiredMinimal$1=1,function(Z){var t=Z;t.asPromise=requireAspromise(),t.base64=requireBase64(),t.EventEmitter=requireEventemitter(),t.float=requireFloat(),t.inquire=requireInquire(),t.utf8=requireUtf8(),t.pool=requirePool(),t.LongBits=requireLongbits(),t.isNode=!!(typeof globalThis<"u"&&globalThis&&globalThis.process&&globalThis.process.versions&&globalThis.process.versions.node),t.global=t.isNode&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal$2,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(Zs){return typeof Zs=="number"&&isFinite(Zs)&&Math.floor(Zs)===Zs},t.isString=function(Zs){return typeof Zs=="string"||Zs instanceof String},t.isObject=function(Zs){return Zs&&typeof Zs=="object"},t.isset=t.isSet=function(Zs,_u){var Eu=Zs[_u];return Eu!=null&&Zs.hasOwnProperty(_u)?typeof Eu!="object"||(Array.isArray(Eu)?Eu.length:Object.keys(Eu).length)>0:!1},t.Buffer=function(){try{var Ys=t.inquire("buffer").Buffer;return Ys.prototype.utf8Write?Ys:null}catch{return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(Zs){return typeof Zs=="number"?t.Buffer?t._Buffer_allocUnsafe(Zs):new t.Array(Zs):t.Buffer?t._Buffer_from(Zs):typeof Uint8Array>"u"?Zs:new Uint8Array(Zs)},t.Array=typeof Uint8Array<"u"?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(Zs){return Zs?t.LongBits.from(Zs).toHash():t.LongBits.zeroHash},t.longFromHash=function(Zs,_u){var Eu=t.LongBits.fromHash(Zs);return t.Long?t.Long.fromBits(Eu.lo,Eu.hi,_u):Eu.toNumber(!!_u)};function Hs(Ys,Zs,_u){for(var Eu=Object.keys(Zs),Iu=0;Iu<Eu.length;++Iu)(Ys[Eu[Iu]]===void 0||!_u)&&(Ys[Eu[Iu]]=Zs[Eu[Iu]]);return Ys}t.merge=Hs,t.lcFirst=function(Zs){return Zs.charAt(0).toLowerCase()+Zs.substring(1)};function zs(Ys){function Zs(_u,Eu){if(!(this instanceof Zs))return new Zs(_u,Eu);Object.defineProperty(this,"message",{get:function(){return _u}}),Error.captureStackTrace?Error.captureStackTrace(this,Zs):Object.defineProperty(this,"stack",{value:new Error().stack||""}),Eu&&Hs(this,Eu)}return Zs.prototype=Object.create(Error.prototype,{constructor:{value:Zs,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return Ys},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),Zs}t.newError=zs,t.ProtocolError=zs("ProtocolError"),t.oneOfGetter=function(Zs){for(var _u={},Eu=0;Eu<Zs.length;++Eu)_u[Zs[Eu]]=1;return function(){for(var Iu=Object.keys(this),Au=Iu.length-1;Au>-1;--Au)if(_u[Iu[Au]]===1&&this[Iu[Au]]!==void 0&&this[Iu[Au]]!==null)return Iu[Au]}},t.oneOfSetter=function(Zs){return function(_u){for(var Eu=0;Eu<Zs.length;++Eu)Zs[Eu]!==_u&&delete this[Zs[Eu]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var Ys=t.Buffer;if(!Ys){t._Buffer_from=t._Buffer_allocUnsafe=null;return}t._Buffer_from=Ys.from!==Uint8Array.from&&Ys.from||function(_u,Eu){return new Ys(_u,Eu)},t._Buffer_allocUnsafe=Ys.allocUnsafe||function(_u){return new Ys(_u)}}}(minimal$1)),minimal$1}var writer,hasRequiredWriter;function requireWriter(){if(hasRequiredWriter)return writer;hasRequiredWriter=1,writer=Iu;var Z=requireMinimal$1(),t,Hs=Z.LongBits,zs=Z.base64,Ys=Z.utf8;function Zs(Bu,Fu,zu){this.fn=Bu,this.len=Fu,this.next=void 0,this.val=zu}function _u(){}function Eu(Bu){this.head=Bu.head,this.tail=Bu.tail,this.len=Bu.len,this.next=Bu.states}function Iu(){this.len=0,this.head=new Zs(_u,0,0),this.tail=this.head,this.states=null}var Au=function(){return Z.Buffer?function(){return(Iu.create=function(){return new t})()}:function(){return new Iu}};Iu.create=Au(),Iu.alloc=function(Fu){return new Z.Array(Fu)},Z.Array!==Array&&(Iu.alloc=Z.pool(Iu.alloc,Z.Array.prototype.subarray)),Iu.prototype._push=function(Fu,zu,Hu){return this.tail=this.tail.next=new Zs(Fu,zu,Hu),this.len+=zu,this};function $u(Bu,Fu,zu){Fu[zu]=Bu&255}function vu(Bu,Fu,zu){for(;Bu>127;)Fu[zu++]=Bu&127|128,Bu>>>=7;Fu[zu]=Bu}function Su(Bu,Fu){this.len=Bu,this.next=void 0,this.val=Fu}Su.prototype=Object.create(Zs.prototype),Su.prototype.fn=vu,Iu.prototype.uint32=function(Fu){return this.len+=(this.tail=this.tail.next=new Su((Fu=Fu>>>0)<128?1:Fu<16384?2:Fu<2097152?3:Fu<268435456?4:5,Fu)).len,this},Iu.prototype.int32=function(Fu){return Fu<0?this._push(Ru,10,Hs.fromNumber(Fu)):this.uint32(Fu)},Iu.prototype.sint32=function(Fu){return this.uint32((Fu<<1^Fu>>31)>>>0)};function Ru(Bu,Fu,zu){for(;Bu.hi;)Fu[zu++]=Bu.lo&127|128,Bu.lo=(Bu.lo>>>7|Bu.hi<<25)>>>0,Bu.hi>>>=7;for(;Bu.lo>127;)Fu[zu++]=Bu.lo&127|128,Bu.lo=Bu.lo>>>7;Fu[zu++]=Bu.lo}Iu.prototype.uint64=function(Fu){var zu=Hs.from(Fu);return this._push(Ru,zu.length(),zu)},Iu.prototype.int64=Iu.prototype.uint64,Iu.prototype.sint64=function(Fu){var zu=Hs.from(Fu).zzEncode();return this._push(Ru,zu.length(),zu)},Iu.prototype.bool=function(Fu){return this._push($u,1,Fu?1:0)};function Pu(Bu,Fu,zu){Fu[zu]=Bu&255,Fu[zu+1]=Bu>>>8&255,Fu[zu+2]=Bu>>>16&255,Fu[zu+3]=Bu>>>24}Iu.prototype.fixed32=function(Fu){return this._push(Pu,4,Fu>>>0)},Iu.prototype.sfixed32=Iu.prototype.fixed32,Iu.prototype.fixed64=function(Fu){var zu=Hs.from(Fu);return this._push(Pu,4,zu.lo)._push(Pu,4,zu.hi)},Iu.prototype.sfixed64=Iu.prototype.fixed64,Iu.prototype.float=function(Fu){return this._push(Z.float.writeFloatLE,4,Fu)},Iu.prototype.double=function(Fu){return this._push(Z.float.writeDoubleLE,8,Fu)};var Cu=Z.Array.prototype.set?function(Fu,zu,Hu){zu.set(Fu,Hu)}:function(Fu,zu,Hu){for(var Wu=0;Wu<Fu.length;++Wu)zu[Hu+Wu]=Fu[Wu]};return Iu.prototype.bytes=function(Fu){var zu=Fu.length>>>0;if(!zu)return this._push($u,1,0);if(Z.isString(Fu)){var Hu=Iu.alloc(zu=zs.length(Fu));zs.decode(Fu,Hu,0),Fu=Hu}return this.uint32(zu)._push(Cu,zu,Fu)},Iu.prototype.string=function(Fu){var zu=Ys.length(Fu);return zu?this.uint32(zu)._push(Ys.write,zu,Fu):this._push($u,1,0)},Iu.prototype.fork=function(){return this.states=new Eu(this),this.head=this.tail=new Zs(_u,0,0),this.len=0,this},Iu.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Zs(_u,0,0),this.len=0),this},Iu.prototype.ldelim=function(){var Fu=this.head,zu=this.tail,Hu=this.len;return this.reset().uint32(Hu),Hu&&(this.tail.next=Fu.next,this.tail=zu,this.len+=Hu),this},Iu.prototype.finish=function(){for(var Fu=this.head.next,zu=this.constructor.alloc(this.len),Hu=0;Fu;)Fu.fn(Fu.val,zu,Hu),Hu+=Fu.len,Fu=Fu.next;return zu},Iu._configure=function(Bu){t=Bu,Iu.create=Au(),t._configure()},writer}var writer_buffer,hasRequiredWriter_buffer;function requireWriter_buffer(){if(hasRequiredWriter_buffer)return writer_buffer;hasRequiredWriter_buffer=1,writer_buffer=Hs;var Z=requireWriter();(Hs.prototype=Object.create(Z.prototype)).constructor=Hs;var t=requireMinimal$1();function Hs(){Z.call(this)}Hs._configure=function(){Hs.alloc=t._Buffer_allocUnsafe,Hs.writeBytesBuffer=t.Buffer&&t.Buffer.prototype instanceof Uint8Array&&t.Buffer.prototype.set.name==="set"?function(Zs,_u,Eu){_u.set(Zs,Eu)}:function(Zs,_u,Eu){if(Zs.copy)Zs.copy(_u,Eu,0,Zs.length);else for(var Iu=0;Iu<Zs.length;)_u[Eu++]=Zs[Iu++]}},Hs.prototype.bytes=function(Zs){t.isString(Zs)&&(Zs=t._Buffer_from(Zs,"base64"));var _u=Zs.length>>>0;return this.uint32(_u),_u&&this._push(Hs.writeBytesBuffer,_u,Zs),this};function zs(Ys,Zs,_u){Ys.length<40?t.utf8.write(Ys,Zs,_u):Zs.utf8Write?Zs.utf8Write(Ys,_u):Zs.write(Ys,_u)}return Hs.prototype.string=function(Zs){var _u=t.Buffer.byteLength(Zs);return this.uint32(_u),_u&&this._push(zs,_u,Zs),this},Hs._configure(),writer_buffer}var reader,hasRequiredReader;function requireReader(){if(hasRequiredReader)return reader;hasRequiredReader=1,reader=Zs;var Z=requireMinimal$1(),t,Hs=Z.LongBits,zs=Z.utf8;function Ys(vu,Su){return RangeError("index out of range: "+vu.pos+" + "+(Su||1)+" > "+vu.len)}function Zs(vu){this.buf=vu,this.pos=0,this.len=vu.length}var _u=typeof Uint8Array<"u"?function(Su){if(Su instanceof Uint8Array||Array.isArray(Su))return new Zs(Su);throw Error("illegal buffer")}:function(Su){if(Array.isArray(Su))return new Zs(Su);throw Error("illegal buffer")},Eu=function(){return Z.Buffer?function(Ru){return(Zs.create=function(Cu){return Z.Buffer.isBuffer(Cu)?new t(Cu):_u(Cu)})(Ru)}:_u};Zs.create=Eu(),Zs.prototype._slice=Z.Array.prototype.subarray||Z.Array.prototype.slice,Zs.prototype.uint32=function(){var Su=4294967295;return function(){if(Su=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(Su=(Su|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(Su=(Su|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(Su=(Su|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(Su=(Su|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return Su;if((this.pos+=5)>this.len)throw this.pos=this.len,Ys(this,10);return Su}}(),Zs.prototype.int32=function(){return this.uint32()|0},Zs.prototype.sint32=function(){var Su=this.uint32();return Su>>>1^-(Su&1)|0};function Iu(){var vu=new Hs(0,0),Su=0;if(this.len-this.pos>4){for(;Su<4;++Su)if(vu.lo=(vu.lo|(this.buf[this.pos]&127)<<Su*7)>>>0,this.buf[this.pos++]<128)return vu;if(vu.lo=(vu.lo|(this.buf[this.pos]&127)<<28)>>>0,vu.hi=(vu.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return vu;Su=0}else{for(;Su<3;++Su){if(this.pos>=this.len)throw Ys(this);if(vu.lo=(vu.lo|(this.buf[this.pos]&127)<<Su*7)>>>0,this.buf[this.pos++]<128)return vu}return vu.lo=(vu.lo|(this.buf[this.pos++]&127)<<Su*7)>>>0,vu}if(this.len-this.pos>4){for(;Su<5;++Su)if(vu.hi=(vu.hi|(this.buf[this.pos]&127)<<Su*7+3)>>>0,this.buf[this.pos++]<128)return vu}else for(;Su<5;++Su){if(this.pos>=this.len)throw Ys(this);if(vu.hi=(vu.hi|(this.buf[this.pos]&127)<<Su*7+3)>>>0,this.buf[this.pos++]<128)return vu}throw Error("invalid varint encoding")}Zs.prototype.bool=function(){return this.uint32()!==0};function Au(vu,Su){return(vu[Su-4]|vu[Su-3]<<8|vu[Su-2]<<16|vu[Su-1]<<24)>>>0}Zs.prototype.fixed32=function(){if(this.pos+4>this.len)throw Ys(this,4);return Au(this.buf,this.pos+=4)},Zs.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Ys(this,4);return Au(this.buf,this.pos+=4)|0};function $u(){if(this.pos+8>this.len)throw Ys(this,8);return new Hs(Au(this.buf,this.pos+=4),Au(this.buf,this.pos+=4))}return Zs.prototype.float=function(){if(this.pos+4>this.len)throw Ys(this,4);var Su=Z.float.readFloatLE(this.buf,this.pos);return this.pos+=4,Su},Zs.prototype.double=function(){if(this.pos+8>this.len)throw Ys(this,4);var Su=Z.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,Su},Zs.prototype.bytes=function(){var Su=this.uint32(),Ru=this.pos,Pu=this.pos+Su;if(Pu>this.len)throw Ys(this,Su);if(this.pos+=Su,Array.isArray(this.buf))return this.buf.slice(Ru,Pu);if(Ru===Pu){var Cu=Z.Buffer;return Cu?Cu.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,Ru,Pu)},Zs.prototype.string=function(){var Su=this.bytes();return zs.read(Su,0,Su.length)},Zs.prototype.skip=function(Su){if(typeof Su=="number"){if(this.pos+Su>this.len)throw Ys(this,Su);this.pos+=Su}else do if(this.pos>=this.len)throw Ys(this);while(this.buf[this.pos++]&128);return this},Zs.prototype.skipType=function(vu){switch(vu){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(vu=this.uint32()&7)!==4;)this.skipType(vu);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+vu+" at offset "+this.pos)}return this},Zs._configure=function(vu){t=vu,Zs.create=Eu(),t._configure();var Su=Z.Long?"toLong":"toNumber";Z.merge(Zs.prototype,{int64:function(){return Iu.call(this)[Su](!1)},uint64:function(){return Iu.call(this)[Su](!0)},sint64:function(){return Iu.call(this).zzDecode()[Su](!1)},fixed64:function(){return $u.call(this)[Su](!0)},sfixed64:function(){return $u.call(this)[Su](!1)}})},reader}var reader_buffer,hasRequiredReader_buffer;function requireReader_buffer(){if(hasRequiredReader_buffer)return reader_buffer;hasRequiredReader_buffer=1,reader_buffer=Hs;var Z=requireReader();(Hs.prototype=Object.create(Z.prototype)).constructor=Hs;var t=requireMinimal$1();function Hs(zs){Z.call(this,zs)}return Hs._configure=function(){t.Buffer&&(Hs.prototype._slice=t.Buffer.prototype.slice)},Hs.prototype.string=function(){var Ys=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+Ys,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+Ys,this.len))},Hs._configure(),reader_buffer}var rpc={},service,hasRequiredService;function requireService(){if(hasRequiredService)return service;hasRequiredService=1,service=t;var Z=requireMinimal$1();(t.prototype=Object.create(Z.EventEmitter.prototype)).constructor=t;function t(Hs,zs,Ys){if(typeof Hs!="function")throw TypeError("rpcImpl must be a function");Z.EventEmitter.call(this),this.rpcImpl=Hs,this.requestDelimited=!!zs,this.responseDelimited=!!Ys}return t.prototype.rpcCall=function Hs(zs,Ys,Zs,_u,Eu){if(!_u)throw TypeError("request must be specified");var Iu=this;if(!Eu)return Z.asPromise(Hs,Iu,zs,Ys,Zs,_u);if(!Iu.rpcImpl){setTimeout(function(){Eu(Error("already ended"))},0);return}try{return Iu.rpcImpl(zs,Ys[Iu.requestDelimited?"encodeDelimited":"encode"](_u).finish(),function($u,vu){if($u)return Iu.emit("error",$u,zs),Eu($u);if(vu===null){Iu.end(!0);return}if(!(vu instanceof Zs))try{vu=Zs[Iu.responseDelimited?"decodeDelimited":"decode"](vu)}catch(Su){return Iu.emit("error",Su,zs),Eu(Su)}return Iu.emit("data",vu,zs),Eu(null,vu)})}catch(Au){Iu.emit("error",Au,zs),setTimeout(function(){Eu(Au)},0);return}},t.prototype.end=function(zs){return this.rpcImpl&&(zs||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},service}var hasRequiredRpc;function requireRpc(){return hasRequiredRpc||(hasRequiredRpc=1,function(Z){var t=Z;t.Service=requireService()}(rpc)),rpc}var roots,hasRequiredRoots;function requireRoots(){return hasRequiredRoots||(hasRequiredRoots=1,roots={}),roots}var hasRequiredIndexMinimal;function requireIndexMinimal(){return hasRequiredIndexMinimal||(hasRequiredIndexMinimal=1,function(Z){var t=Z;t.build="minimal",t.Writer=requireWriter(),t.BufferWriter=requireWriter_buffer(),t.Reader=requireReader(),t.BufferReader=requireReader_buffer(),t.util=requireMinimal$1(),t.rpc=requireRpc(),t.roots=requireRoots(),t.configure=Hs;function Hs(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}Hs()}(indexMinimal)),indexMinimal}var minimal,hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,minimal=requireIndexMinimal()),minimal}var hasRequiredCompiled;function requireCompiled(){return hasRequiredCompiled||(hasRequiredCompiled=1,function(Z){(function(t,Hs){typeof commonjsRequire=="function"&&Z&&Z.exports&&(Z.exports=Hs(requireMinimal()))})(commonjsGlobal$2,function(t){var Hs=t.Reader,zs=t.Writer,Ys=t.util,Zs=t.roots.default||(t.roots.default={});return Zs.proto=function(){var _u={};return _u.Transaction=function(){function Eu(Iu){if(Iu)for(var Au=Object.keys(Iu),$u=0;$u<Au.length;++$u)Iu[Au[$u]]!=null&&(this[Au[$u]]=Iu[Au[$u]])}return Eu.prototype.Nonce=Ys.Long?Ys.Long.fromBits(0,0,!0):0,Eu.prototype.Value=Ys.newBuffer([]),Eu.prototype.RcvAddr=Ys.newBuffer([]),Eu.prototype.RcvUserName=Ys.newBuffer([]),Eu.prototype.SndAddr=Ys.newBuffer([]),Eu.prototype.SndUserName=Ys.newBuffer([]),Eu.prototype.GasPrice=Ys.Long?Ys.Long.fromBits(0,0,!0):0,Eu.prototype.GasLimit=Ys.Long?Ys.Long.fromBits(0,0,!0):0,Eu.prototype.Data=Ys.newBuffer([]),Eu.prototype.ChainID=Ys.newBuffer([]),Eu.prototype.Version=0,Eu.prototype.Signature=Ys.newBuffer([]),Eu.prototype.Options=0,Eu.prototype.GuardianAddr=Ys.newBuffer([]),Eu.prototype.GuardianSignature=Ys.newBuffer([]),Eu.prototype.Relayer=Ys.newBuffer([]),Eu.prototype.RelayerSignature=Ys.newBuffer([]),Eu.create=function(Au){return new Eu(Au)},Eu.encode=function(Au,$u){return $u||($u=zs.create()),Au.Nonce!=null&&Object.hasOwnProperty.call(Au,"Nonce")&&$u.uint32(8).uint64(Au.Nonce),Au.Value!=null&&Object.hasOwnProperty.call(Au,"Value")&&$u.uint32(18).bytes(Au.Value),Au.RcvAddr!=null&&Object.hasOwnProperty.call(Au,"RcvAddr")&&$u.uint32(26).bytes(Au.RcvAddr),Au.RcvUserName!=null&&Object.hasOwnProperty.call(Au,"RcvUserName")&&$u.uint32(34).bytes(Au.RcvUserName),Au.SndAddr!=null&&Object.hasOwnProperty.call(Au,"SndAddr")&&$u.uint32(42).bytes(Au.SndAddr),Au.SndUserName!=null&&Object.hasOwnProperty.call(Au,"SndUserName")&&$u.uint32(50).bytes(Au.SndUserName),Au.GasPrice!=null&&Object.hasOwnProperty.call(Au,"GasPrice")&&$u.uint32(56).uint64(Au.GasPrice),Au.GasLimit!=null&&Object.hasOwnProperty.call(Au,"GasLimit")&&$u.uint32(64).uint64(Au.GasLimit),Au.Data!=null&&Object.hasOwnProperty.call(Au,"Data")&&$u.uint32(74).bytes(Au.Data),Au.ChainID!=null&&Object.hasOwnProperty.call(Au,"ChainID")&&$u.uint32(82).bytes(Au.ChainID),Au.Version!=null&&Object.hasOwnProperty.call(Au,"Version")&&$u.uint32(88).uint32(Au.Version),Au.Signature!=null&&Object.hasOwnProperty.call(Au,"Signature")&&$u.uint32(98).bytes(Au.Signature),Au.Options!=null&&Object.hasOwnProperty.call(Au,"Options")&&$u.uint32(104).uint32(Au.Options),Au.GuardianAddr!=null&&Object.hasOwnProperty.call(Au,"GuardianAddr")&&$u.uint32(114).bytes(Au.GuardianAddr),Au.GuardianSignature!=null&&Object.hasOwnProperty.call(Au,"GuardianSignature")&&$u.uint32(122).bytes(Au.GuardianSignature),Au.Relayer!=null&&Object.hasOwnProperty.call(Au,"Relayer")&&$u.uint32(130).bytes(Au.Relayer),Au.RelayerSignature!=null&&Object.hasOwnProperty.call(Au,"RelayerSignature")&&$u.uint32(138).bytes(Au.RelayerSignature),$u},Eu.encodeDelimited=function(Au,$u){return this.encode(Au,$u).ldelim()},Eu.decode=function(Au,$u){Au instanceof Hs||(Au=Hs.create(Au));for(var vu=$u===void 0?Au.len:Au.pos+$u,Su=new Zs.proto.Transaction;Au.pos<vu;){var Ru=Au.uint32();switch(Ru>>>3){case 1:{Su.Nonce=Au.uint64();break}case 2:{Su.Value=Au.bytes();break}case 3:{Su.RcvAddr=Au.bytes();break}case 4:{Su.RcvUserName=Au.bytes();break}case 5:{Su.SndAddr=Au.bytes();break}case 6:{Su.SndUserName=Au.bytes();break}case 7:{Su.GasPrice=Au.uint64();break}case 8:{Su.GasLimit=Au.uint64();break}case 9:{Su.Data=Au.bytes();break}case 10:{Su.ChainID=Au.bytes();break}case 11:{Su.Version=Au.uint32();break}case 12:{Su.Signature=Au.bytes();break}case 13:{Su.Options=Au.uint32();break}case 14:{Su.GuardianAddr=Au.bytes();break}case 15:{Su.GuardianSignature=Au.bytes();break}case 16:{Su.Relayer=Au.bytes();break}case 17:{Su.RelayerSignature=Au.bytes();break}default:Au.skipType(Ru&7);break}}return Su},Eu.decodeDelimited=function(Au){return Au instanceof Hs||(Au=new Hs(Au)),this.decode(Au,Au.uint32())},Eu.verify=function(Au){return typeof Au!="object"||Au===null?"object expected":Au.Nonce!=null&&Au.hasOwnProperty("Nonce")&&!Ys.isInteger(Au.Nonce)&&!(Au.Nonce&&Ys.isInteger(Au.Nonce.low)&&Ys.isInteger(Au.Nonce.high))?"Nonce: integer|Long expected":Au.Value!=null&&Au.hasOwnProperty("Value")&&!(Au.Value&&typeof Au.Value.length=="number"||Ys.isString(Au.Value))?"Value: buffer expected":Au.RcvAddr!=null&&Au.hasOwnProperty("RcvAddr")&&!(Au.RcvAddr&&typeof Au.RcvAddr.length=="number"||Ys.isString(Au.RcvAddr))?"RcvAddr: buffer expected":Au.RcvUserName!=null&&Au.hasOwnProperty("RcvUserName")&&!(Au.RcvUserName&&typeof Au.RcvUserName.length=="number"||Ys.isString(Au.RcvUserName))?"RcvUserName: buffer expected":Au.SndAddr!=null&&Au.hasOwnProperty("SndAddr")&&!(Au.SndAddr&&typeof Au.SndAddr.length=="number"||Ys.isString(Au.SndAddr))?"SndAddr: buffer expected":Au.SndUserName!=null&&Au.hasOwnProperty("SndUserName")&&!(Au.SndUserName&&typeof Au.SndUserName.length=="number"||Ys.isString(Au.SndUserName))?"SndUserName: buffer expected":Au.GasPrice!=null&&Au.hasOwnProperty("GasPrice")&&!Ys.isInteger(Au.GasPrice)&&!(Au.GasPrice&&Ys.isInteger(Au.GasPrice.low)&&Ys.isInteger(Au.GasPrice.high))?"GasPrice: integer|Long expected":Au.GasLimit!=null&&Au.hasOwnProperty("GasLimit")&&!Ys.isInteger(Au.GasLimit)&&!(Au.GasLimit&&Ys.isInteger(Au.GasLimit.low)&&Ys.isInteger(Au.GasLimit.high))?"GasLimit: integer|Long expected":Au.Data!=null&&Au.hasOwnProperty("Data")&&!(Au.Data&&typeof Au.Data.length=="number"||Ys.isString(Au.Data))?"Data: buffer expected":Au.ChainID!=null&&Au.hasOwnProperty("ChainID")&&!(Au.ChainID&&typeof Au.ChainID.length=="number"||Ys.isString(Au.ChainID))?"ChainID: buffer expected":Au.Version!=null&&Au.hasOwnProperty("Version")&&!Ys.isInteger(Au.Version)?"Version: integer expected":Au.Signature!=null&&Au.hasOwnProperty("Signature")&&!(Au.Signature&&typeof Au.Signature.length=="number"||Ys.isString(Au.Signature))?"Signature: buffer expected":Au.Options!=null&&Au.hasOwnProperty("Options")&&!Ys.isInteger(Au.Options)?"Options: integer expected":Au.GuardianAddr!=null&&Au.hasOwnProperty("GuardianAddr")&&!(Au.GuardianAddr&&typeof Au.GuardianAddr.length=="number"||Ys.isString(Au.GuardianAddr))?"GuardianAddr: buffer expected":Au.GuardianSignature!=null&&Au.hasOwnProperty("GuardianSignature")&&!(Au.GuardianSignature&&typeof Au.GuardianSignature.length=="number"||Ys.isString(Au.GuardianSignature))?"GuardianSignature: buffer expected":Au.Relayer!=null&&Au.hasOwnProperty("Relayer")&&!(Au.Relayer&&typeof Au.Relayer.length=="number"||Ys.isString(Au.Relayer))?"Relayer: buffer expected":Au.RelayerSignature!=null&&Au.hasOwnProperty("RelayerSignature")&&!(Au.RelayerSignature&&typeof Au.RelayerSignature.length=="number"||Ys.isString(Au.RelayerSignature))?"RelayerSignature: buffer expected":null},Eu.fromObject=function(Au){if(Au instanceof Zs.proto.Transaction)return Au;var $u=new Zs.proto.Transaction;return Au.Nonce!=null&&(Ys.Long?($u.Nonce=Ys.Long.fromValue(Au.Nonce)).unsigned=!0:typeof Au.Nonce=="string"?$u.Nonce=parseInt(Au.Nonce,10):typeof Au.Nonce=="number"?$u.Nonce=Au.Nonce:typeof Au.Nonce=="object"&&($u.Nonce=new Ys.LongBits(Au.Nonce.low>>>0,Au.Nonce.high>>>0).toNumber(!0))),Au.Value!=null&&(typeof Au.Value=="string"?Ys.base64.decode(Au.Value,$u.Value=Ys.newBuffer(Ys.base64.length(Au.Value)),0):Au.Value.length>=0&&($u.Value=Au.Value)),Au.RcvAddr!=null&&(typeof Au.RcvAddr=="string"?Ys.base64.decode(Au.RcvAddr,$u.RcvAddr=Ys.newBuffer(Ys.base64.length(Au.RcvAddr)),0):Au.RcvAddr.length>=0&&($u.RcvAddr=Au.RcvAddr)),Au.RcvUserName!=null&&(typeof Au.RcvUserName=="string"?Ys.base64.decode(Au.RcvUserName,$u.RcvUserName=Ys.newBuffer(Ys.base64.length(Au.RcvUserName)),0):Au.RcvUserName.length>=0&&($u.RcvUserName=Au.RcvUserName)),Au.SndAddr!=null&&(typeof Au.SndAddr=="string"?Ys.base64.decode(Au.SndAddr,$u.SndAddr=Ys.newBuffer(Ys.base64.length(Au.SndAddr)),0):Au.SndAddr.length>=0&&($u.SndAddr=Au.SndAddr)),Au.SndUserName!=null&&(typeof Au.SndUserName=="string"?Ys.base64.decode(Au.SndUserName,$u.SndUserName=Ys.newBuffer(Ys.base64.length(Au.SndUserName)),0):Au.SndUserName.length>=0&&($u.SndUserName=Au.SndUserName)),Au.GasPrice!=null&&(Ys.Long?($u.GasPrice=Ys.Long.fromValue(Au.GasPrice)).unsigned=!0:typeof Au.GasPrice=="string"?$u.GasPrice=parseInt(Au.GasPrice,10):typeof Au.GasPrice=="number"?$u.GasPrice=Au.GasPrice:typeof Au.GasPrice=="object"&&($u.GasPrice=new Ys.LongBits(Au.GasPrice.low>>>0,Au.GasPrice.high>>>0).toNumber(!0))),Au.GasLimit!=null&&(Ys.Long?($u.GasLimit=Ys.Long.fromValue(Au.GasLimit)).unsigned=!0:typeof Au.GasLimit=="string"?$u.GasLimit=parseInt(Au.GasLimit,10):typeof Au.GasLimit=="number"?$u.GasLimit=Au.GasLimit:typeof Au.GasLimit=="object"&&($u.GasLimit=new Ys.LongBits(Au.GasLimit.low>>>0,Au.GasLimit.high>>>0).toNumber(!0))),Au.Data!=null&&(typeof Au.Data=="string"?Ys.base64.decode(Au.Data,$u.Data=Ys.newBuffer(Ys.base64.length(Au.Data)),0):Au.Data.length>=0&&($u.Data=Au.Data)),Au.ChainID!=null&&(typeof Au.ChainID=="string"?Ys.base64.decode(Au.ChainID,$u.ChainID=Ys.newBuffer(Ys.base64.length(Au.ChainID)),0):Au.ChainID.length>=0&&($u.ChainID=Au.ChainID)),Au.Version!=null&&($u.Version=Au.Version>>>0),Au.Signature!=null&&(typeof Au.Signature=="string"?Ys.base64.decode(Au.Signature,$u.Signature=Ys.newBuffer(Ys.base64.length(Au.Signature)),0):Au.Signature.length>=0&&($u.Signature=Au.Signature)),Au.Options!=null&&($u.Options=Au.Options>>>0),Au.GuardianAddr!=null&&(typeof Au.GuardianAddr=="string"?Ys.base64.decode(Au.GuardianAddr,$u.GuardianAddr=Ys.newBuffer(Ys.base64.length(Au.GuardianAddr)),0):Au.GuardianAddr.length>=0&&($u.GuardianAddr=Au.GuardianAddr)),Au.GuardianSignature!=null&&(typeof Au.GuardianSignature=="string"?Ys.base64.decode(Au.GuardianSignature,$u.GuardianSignature=Ys.newBuffer(Ys.base64.length(Au.GuardianSignature)),0):Au.GuardianSignature.length>=0&&($u.GuardianSignature=Au.GuardianSignature)),Au.Relayer!=null&&(typeof Au.Relayer=="string"?Ys.base64.decode(Au.Relayer,$u.Relayer=Ys.newBuffer(Ys.base64.length(Au.Relayer)),0):Au.Relayer.length>=0&&($u.Relayer=Au.Relayer)),Au.RelayerSignature!=null&&(typeof Au.RelayerSignature=="string"?Ys.base64.decode(Au.RelayerSignature,$u.RelayerSignature=Ys.newBuffer(Ys.base64.length(Au.RelayerSignature)),0):Au.RelayerSignature.length>=0&&($u.RelayerSignature=Au.RelayerSignature)),$u},Eu.toObject=function(Au,$u){$u||($u={});var vu={};if($u.defaults){if(Ys.Long){var Su=new Ys.Long(0,0,!0);vu.Nonce=$u.longs===String?Su.toString():$u.longs===Number?Su.toNumber():Su}else vu.Nonce=$u.longs===String?"0":0;if($u.bytes===String?vu.Value="":(vu.Value=[],$u.bytes!==Array&&(vu.Value=Ys.newBuffer(vu.Value))),$u.bytes===String?vu.RcvAddr="":(vu.RcvAddr=[],$u.bytes!==Array&&(vu.RcvAddr=Ys.newBuffer(vu.RcvAddr))),$u.bytes===String?vu.RcvUserName="":(vu.RcvUserName=[],$u.bytes!==Array&&(vu.RcvUserName=Ys.newBuffer(vu.RcvUserName))),$u.bytes===String?vu.SndAddr="":(vu.SndAddr=[],$u.bytes!==Array&&(vu.SndAddr=Ys.newBuffer(vu.SndAddr))),$u.bytes===String?vu.SndUserName="":(vu.SndUserName=[],$u.bytes!==Array&&(vu.SndUserName=Ys.newBuffer(vu.SndUserName))),Ys.Long){var Su=new Ys.Long(0,0,!0);vu.GasPrice=$u.longs===String?Su.toString():$u.longs===Number?Su.toNumber():Su}else vu.GasPrice=$u.longs===String?"0":0;if(Ys.Long){var Su=new Ys.Long(0,0,!0);vu.GasLimit=$u.longs===String?Su.toString():$u.longs===Number?Su.toNumber():Su}else vu.GasLimit=$u.longs===String?"0":0;$u.bytes===String?vu.Data="":(vu.Data=[],$u.bytes!==Array&&(vu.Data=Ys.newBuffer(vu.Data))),$u.bytes===String?vu.ChainID="":(vu.ChainID=[],$u.bytes!==Array&&(vu.ChainID=Ys.newBuffer(vu.ChainID))),vu.Version=0,$u.bytes===String?vu.Signature="":(vu.Signature=[],$u.bytes!==Array&&(vu.Signature=Ys.newBuffer(vu.Signature))),vu.Options=0,$u.bytes===String?vu.GuardianAddr="":(vu.GuardianAddr=[],$u.bytes!==Array&&(vu.GuardianAddr=Ys.newBuffer(vu.GuardianAddr))),$u.bytes===String?vu.GuardianSignature="":(vu.GuardianSignature=[],$u.bytes!==Array&&(vu.GuardianSignature=Ys.newBuffer(vu.GuardianSignature))),$u.bytes===String?vu.Relayer="":(vu.Relayer=[],$u.bytes!==Array&&(vu.Relayer=Ys.newBuffer(vu.Relayer))),$u.bytes===String?vu.RelayerSignature="":(vu.RelayerSignature=[],$u.bytes!==Array&&(vu.RelayerSignature=Ys.newBuffer(vu.RelayerSignature)))}return Au.Nonce!=null&&Au.hasOwnProperty("Nonce")&&(typeof Au.Nonce=="number"?vu.Nonce=$u.longs===String?String(Au.Nonce):Au.Nonce:vu.Nonce=$u.longs===String?Ys.Long.prototype.toString.call(Au.Nonce):$u.longs===Number?new Ys.LongBits(Au.Nonce.low>>>0,Au.Nonce.high>>>0).toNumber(!0):Au.Nonce),Au.Value!=null&&Au.hasOwnProperty("Value")&&(vu.Value=$u.bytes===String?Ys.base64.encode(Au.Value,0,Au.Value.length):$u.bytes===Array?Array.prototype.slice.call(Au.Value):Au.Value),Au.RcvAddr!=null&&Au.hasOwnProperty("RcvAddr")&&(vu.RcvAddr=$u.bytes===String?Ys.base64.encode(Au.RcvAddr,0,Au.RcvAddr.length):$u.bytes===Array?Array.prototype.slice.call(Au.RcvAddr):Au.RcvAddr),Au.RcvUserName!=null&&Au.hasOwnProperty("RcvUserName")&&(vu.RcvUserName=$u.bytes===String?Ys.base64.encode(Au.RcvUserName,0,Au.RcvUserName.length):$u.bytes===Array?Array.prototype.slice.call(Au.RcvUserName):Au.RcvUserName),Au.SndAddr!=null&&Au.hasOwnProperty("SndAddr")&&(vu.SndAddr=$u.bytes===String?Ys.base64.encode(Au.SndAddr,0,Au.SndAddr.length):$u.bytes===Array?Array.prototype.slice.call(Au.SndAddr):Au.SndAddr),Au.SndUserName!=null&&Au.hasOwnProperty("SndUserName")&&(vu.SndUserName=$u.bytes===String?Ys.base64.encode(Au.SndUserName,0,Au.SndUserName.length):$u.bytes===Array?Array.prototype.slice.call(Au.SndUserName):Au.SndUserName),Au.GasPrice!=null&&Au.hasOwnProperty("GasPrice")&&(typeof Au.GasPrice=="number"?vu.GasPrice=$u.longs===String?String(Au.GasPrice):Au.GasPrice:vu.GasPrice=$u.longs===String?Ys.Long.prototype.toString.call(Au.GasPrice):$u.longs===Number?new Ys.LongBits(Au.GasPrice.low>>>0,Au.GasPrice.high>>>0).toNumber(!0):Au.GasPrice),Au.GasLimit!=null&&Au.hasOwnProperty("GasLimit")&&(typeof Au.GasLimit=="number"?vu.GasLimit=$u.longs===String?String(Au.GasLimit):Au.GasLimit:vu.GasLimit=$u.longs===String?Ys.Long.prototype.toString.call(Au.GasLimit):$u.longs===Number?new Ys.LongBits(Au.GasLimit.low>>>0,Au.GasLimit.high>>>0).toNumber(!0):Au.GasLimit),Au.Data!=null&&Au.hasOwnProperty("Data")&&(vu.Data=$u.bytes===String?Ys.base64.encode(Au.Data,0,Au.Data.length):$u.bytes===Array?Array.prototype.slice.call(Au.Data):Au.Data),Au.ChainID!=null&&Au.hasOwnProperty("ChainID")&&(vu.ChainID=$u.bytes===String?Ys.base64.encode(Au.ChainID,0,Au.ChainID.length):$u.bytes===Array?Array.prototype.slice.call(Au.ChainID):Au.ChainID),Au.Version!=null&&Au.hasOwnProperty("Version")&&(vu.Version=Au.Version),Au.Signature!=null&&Au.hasOwnProperty("Signature")&&(vu.Signature=$u.bytes===String?Ys.base64.encode(Au.Signature,0,Au.Signature.length):$u.bytes===Array?Array.prototype.slice.call(Au.Signature):Au.Signature),Au.Options!=null&&Au.hasOwnProperty("Options")&&(vu.Options=Au.Options),Au.GuardianAddr!=null&&Au.hasOwnProperty("GuardianAddr")&&(vu.GuardianAddr=$u.bytes===String?Ys.base64.encode(Au.GuardianAddr,0,Au.GuardianAddr.length):$u.bytes===Array?Array.prototype.slice.call(Au.GuardianAddr):Au.GuardianAddr),Au.GuardianSignature!=null&&Au.hasOwnProperty("GuardianSignature")&&(vu.GuardianSignature=$u.bytes===String?Ys.base64.encode(Au.GuardianSignature,0,Au.GuardianSignature.length):$u.bytes===Array?Array.prototype.slice.call(Au.GuardianSignature):Au.GuardianSignature),Au.Relayer!=null&&Au.hasOwnProperty("Relayer")&&(vu.Relayer=$u.bytes===String?Ys.base64.encode(Au.Relayer,0,Au.Relayer.length):$u.bytes===Array?Array.prototype.slice.call(Au.Relayer):Au.Relayer),Au.RelayerSignature!=null&&Au.hasOwnProperty("RelayerSignature")&&(vu.RelayerSignature=$u.bytes===String?Ys.base64.encode(Au.RelayerSignature,0,Au.RelayerSignature.length):$u.bytes===Array?Array.prototype.slice.call(Au.RelayerSignature):Au.RelayerSignature),vu},Eu.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},Eu.getTypeUrl=function(Au){return Au===void 0&&(Au="type.googleapis.com"),Au+"/proto.Transaction"},Eu}(),_u}(),Zs})}(compiled)),compiled.exports}var __createBinding$1=commonjsGlobal$2&&commonjsGlobal$2.__createBinding||(Object.create?function(Z,t,Hs,zs){zs===void 0&&(zs=Hs),Object.defineProperty(Z,zs,{enumerable:!0,get:function(){return t[Hs]}})}:function(Z,t,Hs,zs){zs===void 0&&(zs=Hs),Z[zs]=t[Hs]}),__setModuleDefault$1=commonjsGlobal$2&&commonjsGlobal$2.__setModuleDefault||(Object.create?function(Z,t){Object.defineProperty(Z,"default",{enumerable:!0,value:t})}:function(Z,t){Z.default=t}),__importStar$1=commonjsGlobal$2&&commonjsGlobal$2.__importStar||function(Z){if(Z&&Z.__esModule)return Z;var t={};if(Z!=null)for(var Hs in Z)Hs!=="default"&&Object.prototype.hasOwnProperty.call(Z,Hs)&&__createBinding$1(t,Z,Hs);return __setModuleDefault$1(t,Z),t},__importDefault$1=commonjsGlobal$2&&commonjsGlobal$2.__importDefault||function(Z){return Z&&Z.__esModule?Z:{default:Z}};Object.defineProperty(serializer,"__esModule",{value:!0});serializer.ProtoSerializer=void 0;const bignumber_js_1$1=__importDefault$1(bignumberExports),utils_1=requireUtils$1(),address_1$2=address,constants_1$2=constants$2,errors$2=__importStar$1(errors$5);class ProtoSerializer{serializeTransaction(t){const Hs=requireCompiled().proto,zs=this.convertToProtoMessage(t),Ys=Hs.Transaction.encode(zs).finish();return Buffer$1.from(Ys)}convertToProtoMessage(t){var _u;const Hs=requireCompiled().proto,zs=t.receiver.getPublicKey(),Ys=t.sender.getPublicKey();let Zs=new Hs.Transaction({Nonce:Number(t.nonce)?Number(t.nonce):void 0,Value:this.serializeTransactionValue(t.value),RcvAddr:zs,RcvUserName:t.receiverUsername?Buffer$1.from(t.receiverUsername).toString("base64"):void 0,SndAddr:Ys,SndUserName:t.senderUsername?Buffer$1.from(t.senderUsername).toString("base64"):void 0,GasPrice:Number(t.gasPrice),GasLimit:Number(t.gasLimit),Data:t.data.length==0?null:t.data,ChainID:Buffer$1.from(t.chainID),Version:t.version,Signature:t.signature});return t.options!==constants_1$2.TRANSACTION_OPTIONS_DEFAULT&&(Zs.Options=t.options),this.isGuardedTransaction(t)&&(Zs.GuardianAddr=new address_1$2.Address(t.guardian).getPublicKey(),Zs.GuardianSignature=t.guardianSignature),this.isRelayedTransaction(t)&&(Zs.Relayer=(_u=t.relayer)==null?void 0:_u.getPublicKey(),Zs.RelayerSignature=t.relayerSignature),Zs}isRelayedTransaction(t){return!t.relayer.isEmpty()}serializeTransactionValue(t){let Hs=new bignumber_js_1$1.default(t.toString());if(Hs.isZero())return Buffer$1.from([0,0]);let zs=utils_1.bigIntToBuffer(Hs);return zs=Buffer$1.concat([Buffer$1.from([0]),zs]),zs}isGuardedTransaction(t){const Hs=!t.guardian.isEmpty(),zs=t.guardianSignature.length>0;return this.isWithGuardian(t)&&Hs&&zs}isWithGuardian(t){return(t.options&constants_1$2.TRANSACTION_OPTIONS_TX_GUARDED)==constants_1$2.TRANSACTION_OPTIONS_TX_GUARDED}deserializeTransaction(t){throw new errors$2.ErrUnsupportedOperation("deserializeTransaction")}}serializer.ProtoSerializer=ProtoSerializer;(function(Z){var t=commonjsGlobal$2&&commonjsGlobal$2.__createBinding||(Object.create?function(zs,Ys,Zs,_u){_u===void 0&&(_u=Zs),Object.defineProperty(zs,_u,{enumerable:!0,get:function(){return Ys[Zs]}})}:function(zs,Ys,Zs,_u){_u===void 0&&(_u=Zs),zs[_u]=Ys[Zs]}),Hs=commonjsGlobal$2&&commonjsGlobal$2.__exportStar||function(zs,Ys){for(var Zs in zs)Zs!=="default"&&!Object.prototype.hasOwnProperty.call(Ys,Zs)&&t(Ys,zs,Zs)};Object.defineProperty(Z,"__esModule",{value:!0}),Hs(serializer,Z)})(proto);var blake2b$1={exports:{}};assert$2.notEqual=notEqual;assert$2.notOk=notOk;assert$2.equal=equal;assert$2.ok=assert$2;var nanoassert=assert$2;function equal(Z,t,Hs){assert$2(Z==t,Hs)}function notEqual(Z,t,Hs){assert$2(Z!=t,Hs)}function notOk(Z,t){assert$2(!Z,t)}function assert$2(Z,t){if(!Z)throw new Error(t||"AssertionError")}var blake2bWasm={exports:{}},blake2b=loadWebAssembly;loadWebAssembly.supported=typeof WebAssembly<"u";function loadWebAssembly(Z){if(!loadWebAssembly.supported)return null;var t=Z&&Z.imports,Hs=toUint8Array("AGFzbQEAAAABEANgAn9/AGADf39/AGABfwADBQQAAQICBQUBAQroBwdNBQZtZW1vcnkCAAxibGFrZTJiX2luaXQAAA5ibGFrZTJiX3VwZGF0ZQABDWJsYWtlMmJfZmluYWwAAhBibGFrZTJiX2NvbXByZXNzAAMK00AElgMAIABCADcDACAAQQhqQgA3AwAgAEEQakIANwMAIABBGGpCADcDACAAQSBqQgA3AwAgAEEoakIANwMAIABBMGpCADcDACAAQThqQgA3AwAgAEHAAGpCADcDACAAQcgAakIANwMAIABB0ABqQgA3AwAgAEHYAGpCADcDACAAQeAAakIANwMAIABB6ABqQgA3AwAgAEHwAGpCADcDACAAQfgAakIANwMAIABBgAFqQoiS853/zPmE6gBBACkDAIU3AwAgAEGIAWpCu86qptjQ67O7f0EIKQMAhTcDACAAQZABakKr8NP0r+68tzxBECkDAIU3AwAgAEGYAWpC8e30+KWn/aelf0EYKQMAhTcDACAAQaABakLRhZrv+s+Uh9EAQSApAwCFNwMAIABBqAFqQp/Y+dnCkdqCm39BKCkDAIU3AwAgAEGwAWpC6/qG2r+19sEfQTApAwCFNwMAIABBuAFqQvnC+JuRo7Pw2wBBOCkDAIU3AwAgAEHAAWpCADcDACAAQcgBakIANwMAIABB0AFqQgA3AwALbQEDfyAAQcABaiEDIABByAFqIQQgBCkDAKchBQJAA0AgASACRg0BIAVBgAFGBEAgAyADKQMAIAWtfDcDAEEAIQUgABADCyAAIAVqIAEtAAA6AAAgBUEBaiEFIAFBAWohAQwACwsgBCAFrTcDAAtkAQN/IABBwAFqIQEgAEHIAWohAiABIAEpAwAgAikDAHw3AwAgAEHQAWpCfzcDACACKQMApyEDAkADQCADQYABRg0BIAAgA2pBADoAACADQQFqIQMMAAsLIAIgA603AwAgABADC+U7AiB+CX8gAEGAAWohISAAQYgBaiEiIABBkAFqISMgAEGYAWohJCAAQaABaiElIABBqAFqISYgAEGwAWohJyAAQbgBaiEoICEpAwAhASAiKQMAIQIgIykDACEDICQpAwAhBCAlKQMAIQUgJikDACEGICcpAwAhByAoKQMAIQhCiJLznf/M+YTqACEJQrvOqqbY0Ouzu38hCkKr8NP0r+68tzwhC0Lx7fT4paf9p6V/IQxC0YWa7/rPlIfRACENQp/Y+dnCkdqCm38hDkLr+obav7X2wR8hD0L5wvibkaOz8NsAIRAgACkDACERIABBCGopAwAhEiAAQRBqKQMAIRMgAEEYaikDACEUIABBIGopAwAhFSAAQShqKQMAIRYgAEEwaikDACEXIABBOGopAwAhGCAAQcAAaikDACEZIABByABqKQMAIRogAEHQAGopAwAhGyAAQdgAaikDACEcIABB4ABqKQMAIR0gAEHoAGopAwAhHiAAQfAAaikDACEfIABB+ABqKQMAISAgDSAAQcABaikDAIUhDSAPIABB0AFqKQMAhSEPIAEgBSARfHwhASANIAGFQiCKIQ0gCSANfCEJIAUgCYVCGIohBSABIAUgEnx8IQEgDSABhUIQiiENIAkgDXwhCSAFIAmFQj+KIQUgAiAGIBN8fCECIA4gAoVCIIohDiAKIA58IQogBiAKhUIYiiEGIAIgBiAUfHwhAiAOIAKFQhCKIQ4gCiAOfCEKIAYgCoVCP4ohBiADIAcgFXx8IQMgDyADhUIgiiEPIAsgD3whCyAHIAuFQhiKIQcgAyAHIBZ8fCEDIA8gA4VCEIohDyALIA98IQsgByALhUI/iiEHIAQgCCAXfHwhBCAQIASFQiCKIRAgDCAQfCEMIAggDIVCGIohCCAEIAggGHx8IQQgECAEhUIQiiEQIAwgEHwhDCAIIAyFQj+KIQggASAGIBl8fCEBIBAgAYVCIIohECALIBB8IQsgBiALhUIYiiEGIAEgBiAafHwhASAQIAGFQhCKIRAgCyAQfCELIAYgC4VCP4ohBiACIAcgG3x8IQIgDSAChUIgiiENIAwgDXwhDCAHIAyFQhiKIQcgAiAHIBx8fCECIA0gAoVCEIohDSAMIA18IQwgByAMhUI/iiEHIAMgCCAdfHwhAyAOIAOFQiCKIQ4gCSAOfCEJIAggCYVCGIohCCADIAggHnx8IQMgDiADhUIQiiEOIAkgDnwhCSAIIAmFQj+KIQggBCAFIB98fCEEIA8gBIVCIIohDyAKIA98IQogBSAKhUIYiiEFIAQgBSAgfHwhBCAPIASFQhCKIQ8gCiAPfCEKIAUgCoVCP4ohBSABIAUgH3x8IQEgDSABhUIgiiENIAkgDXwhCSAFIAmFQhiKIQUgASAFIBt8fCEBIA0gAYVCEIohDSAJIA18IQkgBSAJhUI/iiEFIAIgBiAVfHwhAiAOIAKFQiCKIQ4gCiAOfCEKIAYgCoVCGIohBiACIAYgGXx8IQIgDiAChUIQiiEOIAogDnwhCiAGIAqFQj+KIQYgAyAHIBp8fCEDIA8gA4VCIIohDyALIA98IQsgByALhUIYiiEHIAMgByAgfHwhAyAPIAOFQhCKIQ8gCyAPfCELIAcgC4VCP4ohByAEIAggHnx8IQQgECAEhUIgiiEQIAwgEHwhDCAIIAyFQhiKIQggBCAIIBd8fCEEIBAgBIVCEIohECAMIBB8IQwgCCAMhUI/iiEIIAEgBiASfHwhASAQIAGFQiCKIRAgCyAQfCELIAYgC4VCGIohBiABIAYgHXx8IQEgECABhUIQiiEQIAsgEHwhCyAGIAuFQj+KIQYgAiAHIBF8fCECIA0gAoVCIIohDSAMIA18IQwgByAMhUIYiiEHIAIgByATfHwhAiANIAKFQhCKIQ0gDCANfCEMIAcgDIVCP4ohByADIAggHHx8IQMgDiADhUIgiiEOIAkgDnwhCSAIIAmFQhiKIQggAyAIIBh8fCEDIA4gA4VCEIohDiAJIA58IQkgCCAJhUI/iiEIIAQgBSAWfHwhBCAPIASFQiCKIQ8gCiAPfCEKIAUgCoVCGIohBSAEIAUgFHx8IQQgDyAEhUIQiiEPIAogD3whCiAFIAqFQj+KIQUgASAFIBx8fCEBIA0gAYVCIIohDSAJIA18IQkgBSAJhUIYiiEFIAEgBSAZfHwhASANIAGFQhCKIQ0gCSANfCEJIAUgCYVCP4ohBSACIAYgHXx8IQIgDiAChUIgiiEOIAogDnwhCiAGIAqFQhiKIQYgAiAGIBF8fCECIA4gAoVCEIohDiAKIA58IQogBiAKhUI/iiEGIAMgByAWfHwhAyAPIAOFQiCKIQ8gCyAPfCELIAcgC4VCGIohByADIAcgE3x8IQMgDyADhUIQiiEPIAsgD3whCyAHIAuFQj+KIQcgBCAIICB8fCEEIBAgBIVCIIohECAMIBB8IQwgCCAMhUIYiiEIIAQgCCAefHwhBCAQIASFQhCKIRAgDCAQfCEMIAggDIVCP4ohCCABIAYgG3x8IQEgECABhUIgiiEQIAsgEHwhCyAGIAuFQhiKIQYgASAGIB98fCEBIBAgAYVCEIohECALIBB8IQsgBiALhUI/iiEGIAIgByAUfHwhAiANIAKFQiCKIQ0gDCANfCEMIAcgDIVCGIohByACIAcgF3x8IQIgDSAChUIQiiENIAwgDXwhDCAHIAyFQj+KIQcgAyAIIBh8fCEDIA4gA4VCIIohDiAJIA58IQkgCCAJhUIYiiEIIAMgCCASfHwhAyAOIAOFQhCKIQ4gCSAOfCEJIAggCYVCP4ohCCAEIAUgGnx8IQQgDyAEhUIgiiEPIAogD3whCiAFIAqFQhiKIQUgBCAFIBV8fCEEIA8gBIVCEIohDyAKIA98IQogBSAKhUI/iiEFIAEgBSAYfHwhASANIAGFQiCKIQ0gCSANfCEJIAUgCYVCGIohBSABIAUgGnx8IQEgDSABhUIQiiENIAkgDXwhCSAFIAmFQj+KIQUgAiAGIBR8fCECIA4gAoVCIIohDiAKIA58IQogBiAKhUIYiiEGIAIgBiASfHwhAiAOIAKFQhCKIQ4gCiAOfCEKIAYgCoVCP4ohBiADIAcgHnx8IQMgDyADhUIgiiEPIAsgD3whCyAHIAuFQhiKIQcgAyAHIB18fCEDIA8gA4VCEIohDyALIA98IQsgByALhUI/iiEHIAQgCCAcfHwhBCAQIASFQiCKIRAgDCAQfCEMIAggDIVCGIohCCAEIAggH3x8IQQgECAEhUIQiiEQIAwgEHwhDCAIIAyFQj+KIQggASAGIBN8fCEBIBAgAYVCIIohECALIBB8IQsgBiALhUIYiiEGIAEgBiAXfHwhASAQIAGFQhCKIRAgCyAQfCELIAYgC4VCP4ohBiACIAcgFnx8IQIgDSAChUIgiiENIAwgDXwhDCAHIAyFQhiKIQcgAiAHIBt8fCECIA0gAoVCEIohDSAMIA18IQwgByAMhUI/iiEHIAMgCCAVfHwhAyAOIAOFQiCKIQ4gCSAOfCEJIAggCYVCGIohCCADIAggEXx8IQMgDiADhUIQiiEOIAkgDnwhCSAIIAmFQj+KIQggBCAFICB8fCEEIA8gBIVCIIohDyAKIA98IQogBSAKhUIYiiEFIAQgBSAZfHwhBCAPIASFQhCKIQ8gCiAPfCEKIAUgCoVCP4ohBSABIAUgGnx8IQEgDSABhUIgiiENIAkgDXwhCSAFIAmFQhiKIQUgASAFIBF8fCEBIA0gAYVCEIohDSAJIA18IQkgBSAJhUI/iiEFIAIgBiAWfHwhAiAOIAKFQiCKIQ4gCiAOfCEKIAYgCoVCGIohBiACIAYgGHx8IQIgDiAChUIQiiEOIAogDnwhCiAGIAqFQj+KIQYgAyAHIBN8fCEDIA8gA4VCIIohDyALIA98IQsgByALhUIYiiEHIAMgByAVfHwhAyAPIAOFQhCKIQ8gCyAPfCELIAcgC4VCP4ohByAEIAggG3x8IQQgECAEhUIgiiEQIAwgEHwhDCAIIAyFQhiKIQggBCAIICB8fCEEIBAgBIVCEIohECAMIBB8IQwgCCAMhUI/iiEIIAEgBiAffHwhASAQIAGFQiCKIRAgCyAQfCELIAYgC4VCGIohBiABIAYgEnx8IQEgECABhUIQiiEQIAsgEHwhCyAGIAuFQj+KIQYgAiAHIBx8fCECIA0gAoVCIIohDSAMIA18IQwgByAMhUIYiiEHIAIgByAdfHwhAiANIAKFQhCKIQ0gDCANfCEMIAcgDIVCP4ohByADIAggF3x8IQMgDiADhUIgiiEOIAkgDnwhCSAIIAmFQhiKIQggAyAIIBl8fCEDIA4gA4VCEIohDiAJIA58IQkgCCAJhUI/iiEIIAQgBSAUfHwhBCAPIASFQiCKIQ8gCiAPfCEKIAUgCoVCGIohBSAEIAUgHnx8IQQgDyAEhUIQiiEPIAogD3whCiAFIAqFQj+KIQUgASAFIBN8fCEBIA0gAYVCIIohDSAJIA18IQkgBSAJhUIYiiEFIAEgBSAdfHwhASANIAGFQhCKIQ0gCSANfCEJIAUgCYVCP4ohBSACIAYgF3x8IQIgDiAChUIgiiEOIAogDnwhCiAGIAqFQhiKIQYgAiAGIBt8fCECIA4gAoVCEIohDiAKIA58IQogBiAKhUI/iiEGIAMgByARfHwhAyAPIAOFQiCKIQ8gCyAPfCELIAcgC4VCGIohByADIAcgHHx8IQMgDyADhUIQiiEPIAsgD3whCyAHIAuFQj+KIQcgBCAIIBl8fCEEIBAgBIVCIIohECAMIBB8IQwgCCAMhUIYiiEIIAQgCCAUfHwhBCAQIASFQhCKIRAgDCAQfCEMIAggDIVCP4ohCCABIAYgFXx8IQEgECABhUIgiiEQIAsgEHwhCyAGIAuFQhiKIQYgASAGIB58fCEBIBAgAYVCEIohECALIBB8IQsgBiALhUI/iiEGIAIgByAYfHwhAiANIAKFQiCKIQ0gDCANfCEMIAcgDIVCGIohByACIAcgFnx8IQIgDSAChUIQiiENIAwgDXwhDCAHIAyFQj+KIQcgAyAIICB8fCEDIA4gA4VCIIohDiAJIA58IQkgCCAJhUIYiiEIIAMgCCAffHwhAyAOIAOFQhCKIQ4gCSAOfCEJIAggCYVCP4ohCCAEIAUgEnx8IQQgDyAEhUIgiiEPIAogD3whCiAFIAqFQhiKIQUgBCAFIBp8fCEEIA8gBIVCEIohDyAKIA98IQogBSAKhUI/iiEFIAEgBSAdfHwhASANIAGFQiCKIQ0gCSANfCEJIAUgCYVCGIohBSABIAUgFnx8IQEgDSABhUIQiiENIAkgDXwhCSAFIAmFQj+KIQUgAiAGIBJ8fCECIA4gAoVCIIohDiAKIA58IQogBiAKhUIYiiEGIAIgBiAgfHwhAiAOIAKFQhCKIQ4gCiAOfCEKIAYgCoVCP4ohBiADIAcgH3x8IQMgDyADhUIgiiEPIAsgD3whCyAHIAuFQhiKIQcgAyAHIB58fCEDIA8gA4VCEIohDyALIA98IQsgByALhUI/iiEHIAQgCCAVfHwhBCAQIASFQiCKIRAgDCAQfCEMIAggDIVCGIohCCAEIAggG3x8IQQgECAEhUIQiiEQIAwgEHwhDCAIIAyFQj+KIQggASAGIBF8fCEBIBAgAYVCIIohECALIBB8IQsgBiALhUIYiiEGIAEgBiAYfHwhASAQIAGFQhCKIRAgCyAQfCELIAYgC4VCP4ohBiACIAcgF3x8IQIgDSAChUIgiiENIAwgDXwhDCAHIAyFQhiKIQcgAiAHIBR8fCECIA0gAoVCEIohDSAMIA18IQwgByAMhUI/iiEHIAMgCCAafHwhAyAOIAOFQiCKIQ4gCSAOfCEJIAggCYVCGIohCCADIAggE3x8IQMgDiADhUIQiiEOIAkgDnwhCSAIIAmFQj+KIQggBCAFIBl8fCEEIA8gBIVCIIohDyAKIA98IQogBSAKhUIYiiEFIAQgBSAcfHwhBCAPIASFQhCKIQ8gCiAPfCEKIAUgCoVCP4ohBSABIAUgHnx8IQEgDSABhUIgiiENIAkgDXwhCSAFIAmFQhiKIQUgASAFIBx8fCEBIA0gAYVCEIohDSAJIA18IQkgBSAJhUI/iiEFIAIgBiAYfHwhAiAOIAKFQiCKIQ4gCiAOfCEKIAYgCoVCGIohBiACIAYgH3x8IQIgDiAChUIQiiEOIAogDnwhCiAGIAqFQj+KIQYgAyAHIB18fCEDIA8gA4VCIIohDyALIA98IQsgByALhUIYiiEHIAMgByASfHwhAyAPIAOFQhCKIQ8gCyAPfCELIAcgC4VCP4ohByAEIAggFHx8IQQgECAEhUIgiiEQIAwgEHwhDCAIIAyFQhiKIQggBCAIIBp8fCEEIBAgBIVCEIohECAMIBB8IQwgCCAMhUI/iiEIIAEgBiAWfHwhASAQIAGFQiCKIRAgCyAQfCELIAYgC4VCGIohBiABIAYgEXx8IQEgECABhUIQiiEQIAsgEHwhCyAGIAuFQj+KIQYgAiAHICB8fCECIA0gAoVCIIohDSAMIA18IQwgByAMhUIYiiEHIAIgByAVfHwhAiANIAKFQhCKIQ0gDCANfCEMIAcgDIVCP4ohByADIAggGXx8IQMgDiADhUIgiiEOIAkgDnwhCSAIIAmFQhiKIQggAyAIIBd8fCEDIA4gA4VCEIohDiAJIA58IQkgCCAJhUI/iiEIIAQgBSATfHwhBCAPIASFQiCKIQ8gCiAPfCEKIAUgCoVCGIohBSAEIAUgG3x8IQQgDyAEhUIQiiEPIAogD3whCiAFIAqFQj+KIQUgASAFIBd8fCEBIA0gAYVCIIohDSAJIA18IQkgBSAJhUIYiiEFIAEgBSAgfHwhASANIAGFQhCKIQ0gCSANfCEJIAUgCYVCP4ohBSACIAYgH3x8IQIgDiAChUIgiiEOIAogDnwhCiAGIAqFQhiKIQYgAiAGIBp8fCECIA4gAoVCEIohDiAKIA58IQogBiAKhUI/iiEGIAMgByAcfHwhAyAPIAOFQiCKIQ8gCyAPfCELIAcgC4VCGIohByADIAcgFHx8IQMgDyADhUIQiiEPIAsgD3whCyAHIAuFQj+KIQcgBCAIIBF8fCEEIBAgBIVCIIohECAMIBB8IQwgCCAMhUIYiiEIIAQgCCAZfHwhBCAQIASFQhCKIRAgDCAQfCEMIAggDIVCP4ohCCABIAYgHXx8IQEgECABhUIgiiEQIAsgEHwhCyAGIAuFQhiKIQYgASAGIBN8fCEBIBAgAYVCEIohECALIBB8IQsgBiALhUI/iiEGIAIgByAefHwhAiANIAKFQiCKIQ0gDCANfCEMIAcgDIVCGIohByACIAcgGHx8IQIgDSAChUIQiiENIAwgDXwhDCAHIAyFQj+KIQcgAyAIIBJ8fCEDIA4gA4VCIIohDiAJIA58IQkgCCAJhUIYiiEIIAMgCCAVfHwhAyAOIAOFQhCKIQ4gCSAOfCEJIAggCYVCP4ohCCAEIAUgG3x8IQQgDyAEhUIgiiEPIAogD3whCiAFIAqFQhiKIQUgBCAFIBZ8fCEEIA8gBIVCEIohDyAKIA98IQogBSAKhUI/iiEFIAEgBSAbfHwhASANIAGFQiCKIQ0gCSANfCEJIAUgCYVCGIohBSABIAUgE3x8IQEgDSABhUIQiiENIAkgDXwhCSAFIAmFQj+KIQUgAiAGIBl8fCECIA4gAoVCIIohDiAKIA58IQogBiAKhUIYiiEGIAIgBiAVfHwhAiAOIAKFQhCKIQ4gCiAOfCEKIAYgCoVCP4ohBiADIAcgGHx8IQMgDyADhUIgiiEPIAsgD3whCyAHIAuFQhiKIQcgAyAHIBd8fCEDIA8gA4VCEIohDyALIA98IQsgByALhUI/iiEHIAQgCCASfHwhBCAQIASFQiCKIRAgDCAQfCEMIAggDIVCGIohCCAEIAggFnx8IQQgECAEhUIQiiEQIAwgEHwhDCAIIAyFQj+KIQggASAGICB8fCEBIBAgAYVCIIohECALIBB8IQsgBiALhUIYiiEGIAEgBiAcfHwhASAQIAGFQhCKIRAgCyAQfCELIAYgC4VCP4ohBiACIAcgGnx8IQIgDSAChUIgiiENIAwgDXwhDCAHIAyFQhiKIQcgAiAHIB98fCECIA0gAoVCEIohDSAMIA18IQwgByAMhUI/iiEHIAMgCCAUfHwhAyAOIAOFQiCKIQ4gCSAOfCEJIAggCYVCGIohCCADIAggHXx8IQMgDiADhUIQiiEOIAkgDnwhCSAIIAmFQj+KIQggBCAFIB58fCEEIA8gBIVCIIohDyAKIA98IQogBSAKhUIYiiEFIAQgBSARfHwhBCAPIASFQhCKIQ8gCiAPfCEKIAUgCoVCP4ohBSABIAUgEXx8IQEgDSABhUIgiiENIAkgDXwhCSAFIAmFQhiKIQUgASAFIBJ8fCEBIA0gAYVCEIohDSAJIA18IQkgBSAJhUI/iiEFIAIgBiATfHwhAiAOIAKFQiCKIQ4gCiAOfCEKIAYgCoVCGIohBiACIAYgFHx8IQIgDiAChUIQiiEOIAogDnwhCiAGIAqFQj+KIQYgAyAHIBV8fCEDIA8gA4VCIIohDyALIA98IQsgByALhUIYiiEHIAMgByAWfHwhAyAPIAOFQhCKIQ8gCyAPfCELIAcgC4VCP4ohByAEIAggF3x8IQQgECAEhUIgiiEQIAwgEHwhDCAIIAyFQhiKIQggBCAIIBh8fCEEIBAgBIVCEIohECAMIBB8IQwgCCAMhUI/iiEIIAEgBiAZfHwhASAQIAGFQiCKIRAgCyAQfCELIAYgC4VCGIohBiABIAYgGnx8IQEgECABhUIQiiEQIAsgEHwhCyAGIAuFQj+KIQYgAiAHIBt8fCECIA0gAoVCIIohDSAMIA18IQwgByAMhUIYiiEHIAIgByAcfHwhAiANIAKFQhCKIQ0gDCANfCEMIAcgDIVCP4ohByADIAggHXx8IQMgDiADhUIgiiEOIAkgDnwhCSAIIAmFQhiKIQggAyAIIB58fCEDIA4gA4VCEIohDiAJIA58IQkgCCAJhUI/iiEIIAQgBSAffHwhBCAPIASFQiCKIQ8gCiAPfCEKIAUgCoVCGIohBSAEIAUgIHx8IQQgDyAEhUIQiiEPIAogD3whCiAFIAqFQj+KIQUgASAFIB98fCEBIA0gAYVCIIohDSAJIA18IQkgBSAJhUIYiiEFIAEgBSAbfHwhASANIAGFQhCKIQ0gCSANfCEJIAUgCYVCP4ohBSACIAYgFXx8IQIgDiAChUIgiiEOIAogDnwhCiAGIAqFQhiKIQYgAiAGIBl8fCECIA4gAoVCEIohDiAKIA58IQogBiAKhUI/iiEGIAMgByAafHwhAyAPIAOFQiCKIQ8gCyAPfCELIAcgC4VCGIohByADIAcgIHx8IQMgDyADhUIQiiEPIAsgD3whCyAHIAuFQj+KIQcgBCAIIB58fCEEIBAgBIVCIIohECAMIBB8IQwgCCAMhUIYiiEIIAQgCCAXfHwhBCAQIASFQhCKIRAgDCAQfCEMIAggDIVCP4ohCCABIAYgEnx8IQEgECABhUIgiiEQIAsgEHwhCyAGIAuFQhiKIQYgASAGIB18fCEBIBAgAYVCEIohECALIBB8IQsgBiALhUI/iiEGIAIgByARfHwhAiANIAKFQiCKIQ0gDCANfCEMIAcgDIVCGIohByACIAcgE3x8IQIgDSAChUIQiiENIAwgDXwhDCAHIAyFQj+KIQcgAyAIIBx8fCEDIA4gA4VCIIohDiAJIA58IQkgCCAJhUIYiiEIIAMgCCAYfHwhAyAOIAOFQhCKIQ4gCSAOfCEJIAggCYVCP4ohCCAEIAUgFnx8IQQgDyAEhUIgiiEPIAogD3whCiAFIAqFQhiKIQUgBCAFIBR8fCEEIA8gBIVCEIohDyAKIA98IQogBSAKhUI/iiEFICEgISkDACABIAmFhTcDACAiICIpAwAgAiAKhYU3AwAgIyAjKQMAIAMgC4WFNwMAICQgJCkDACAEIAyFhTcDACAlICUpAwAgBSANhYU3AwAgJiAmKQMAIAYgDoWFNwMAICcgJykDACAHIA+FhTcDACAoICgpAwAgCCAQhYU3AwAL"),zs=null,Ys={buffer:Hs,memory:null,exports:null,realloc:Zs,onload:_u};return _u(function(){}),Ys;function Zs(Iu){Ys.exports.memory.grow(Math.ceil(Math.abs(Iu-Ys.memory.length)/65536)),Ys.memory=new Uint8Array(Ys.exports.memory.buffer)}function _u(Iu){if(Ys.exports)return Iu();if(zs){zs.then(Iu.bind(null,null)).catch(Iu);return}try{if(Z&&Z.async)throw new Error("async");Eu({instance:new WebAssembly.Instance(new WebAssembly.Module(Hs),t)})}catch{zs=WebAssembly.instantiate(Hs,t).then(Eu)}_u(Iu)}function Eu(Iu){Ys.exports=Iu.instance.exports,Ys.memory=Ys.exports.memory&&Ys.exports.memory.buffer&&new Uint8Array(Ys.exports.memory.buffer)}}function toUint8Array(Z){return typeof atob=="function"?new Uint8Array(atob(Z).split("").map(charCodeAt)):new(commonjsRequire("buffer")).Buffer(Z,"base64")}function charCodeAt(Z){return Z.charCodeAt(0)}var assert$1=nanoassert,wasm=blake2b(),head=64,freeList=[];blake2bWasm.exports=Blake2b$1;var BYTES_MIN$1=blake2bWasm.exports.BYTES_MIN=16,BYTES_MAX$1=blake2bWasm.exports.BYTES_MAX=64;blake2bWasm.exports.BYTES=32;var KEYBYTES_MIN$1=blake2bWasm.exports.KEYBYTES_MIN=16,KEYBYTES_MAX$1=blake2bWasm.exports.KEYBYTES_MAX=64;blake2bWasm.exports.KEYBYTES=32;var SALTBYTES$1=blake2bWasm.exports.SALTBYTES=16,PERSONALBYTES$1=blake2bWasm.exports.PERSONALBYTES=16;function Blake2b$1(Z,t,Hs,zs,Ys){if(!(this instanceof Blake2b$1))return new Blake2b$1(Z,t,Hs,zs,Ys);if(!(wasm&&wasm.exports))throw new Error("WASM not loaded. Wait for Blake2b.ready(cb)");Z||(Z=32),Ys!==!0&&(assert$1(Z>=BYTES_MIN$1,"digestLength must be at least "+BYTES_MIN$1+", was given "+Z),assert$1(Z<=BYTES_MAX$1,"digestLength must be at most "+BYTES_MAX$1+", was given "+Z),t!=null&&assert$1(t.length>=KEYBYTES_MIN$1,"key must be at least "+KEYBYTES_MIN$1+", was given "+t.length),t!=null&&assert$1(t.length<=KEYBYTES_MAX$1,"key must be at least "+KEYBYTES_MAX$1+", was given "+t.length),Hs!=null&&assert$1(Hs.length===SALTBYTES$1,"salt must be exactly "+SALTBYTES$1+", was given "+Hs.length),zs!=null&&assert$1(zs.length===PERSONALBYTES$1,"personal must be exactly "+PERSONALBYTES$1+", was given "+zs.length)),freeList.length||(freeList.push(head),head+=216),this.digestLength=Z,this.finalized=!1,this.pointer=freeList.pop(),wasm.memory.fill(0,0,64),wasm.memory[0]=this.digestLength,wasm.memory[1]=t?t.length:0,wasm.memory[2]=1,wasm.memory[3]=1,Hs&&wasm.memory.set(Hs,32),zs&&wasm.memory.set(zs,48),this.pointer+216>wasm.memory.length&&wasm.realloc(this.pointer+216),wasm.exports.blake2b_init(this.pointer,this.digestLength),t&&(this.update(t),wasm.memory.fill(0,head,head+t.length),wasm.memory[this.pointer+200]=128)}Blake2b$1.prototype.update=function(Z){return assert$1(this.finalized===!1,"Hash instance finalized"),assert$1(Z,"input must be TypedArray or Buffer"),head+Z.length>wasm.memory.length&&wasm.realloc(head+Z.length),wasm.memory.set(Z,head),wasm.exports.blake2b_update(this.pointer,head,head+Z.length),this};Blake2b$1.prototype.digest=function(Z){if(assert$1(this.finalized===!1,"Hash instance finalized"),this.finalized=!0,freeList.push(this.pointer),wasm.exports.blake2b_final(this.pointer),!Z||Z==="binary")return wasm.memory.slice(this.pointer+128,this.pointer+128+this.digestLength);if(Z==="hex")return hexSlice$1(wasm.memory,this.pointer+128,this.digestLength);assert$1(Z.length>=this.digestLength,"input must be TypedArray or Buffer");for(var t=0;t<this.digestLength;t++)Z[t]=wasm.memory[this.pointer+128+t];return Z};Blake2b$1.prototype.final=Blake2b$1.prototype.digest;Blake2b$1.WASM=wasm&&wasm.buffer;Blake2b$1.SUPPORTED=typeof WebAssembly<"u";Blake2b$1.ready=function(Z){if(Z||(Z=noop),!wasm)return Z(new Error("WebAssembly not supported"));var t=new Promise(function(Hs,zs){wasm.onload(function(Ys){Ys?zs():Hs(),Z(Ys)})});return t};Blake2b$1.prototype.ready=Blake2b$1.ready;function noop(){}function hexSlice$1(Z,t,Hs){for(var zs="",Ys=0;Ys<Hs;Ys++)zs+=toHex$1(Z[t+Ys]);return zs}function toHex$1(Z){return Z<16?"0"+Z.toString(16):Z.toString(16)}var blake2bWasmExports=blake2bWasm.exports,assert=nanoassert,b2wasm=blake2bWasmExports;function ADD64AA(Z,t,Hs){var zs=Z[t]+Z[Hs],Ys=Z[t+1]+Z[Hs+1];zs>=4294967296&&Ys++,Z[t]=zs,Z[t+1]=Ys}function ADD64AC(Z,t,Hs,zs){var Ys=Z[t]+Hs;Hs<0&&(Ys+=4294967296);var Zs=Z[t+1]+zs;Ys>=4294967296&&Zs++,Z[t]=Ys,Z[t+1]=Zs}function B2B_GET32(Z,t){return Z[t]^Z[t+1]<<8^Z[t+2]<<16^Z[t+3]<<24}function B2B_G(Z,t,Hs,zs,Ys,Zs){var _u=m[Ys],Eu=m[Ys+1],Iu=m[Zs],Au=m[Zs+1];ADD64AA(v$1,Z,t),ADD64AC(v$1,Z,_u,Eu);var $u=v$1[zs]^v$1[Z],vu=v$1[zs+1]^v$1[Z+1];v$1[zs]=vu,v$1[zs+1]=$u,ADD64AA(v$1,Hs,zs),$u=v$1[t]^v$1[Hs],vu=v$1[t+1]^v$1[Hs+1],v$1[t]=$u>>>24^vu<<8,v$1[t+1]=vu>>>24^$u<<8,ADD64AA(v$1,Z,t),ADD64AC(v$1,Z,Iu,Au),$u=v$1[zs]^v$1[Z],vu=v$1[zs+1]^v$1[Z+1],v$1[zs]=$u>>>16^vu<<16,v$1[zs+1]=vu>>>16^$u<<16,ADD64AA(v$1,Hs,zs),$u=v$1[t]^v$1[Hs],vu=v$1[t+1]^v$1[Hs+1],v$1[t]=vu>>>31^$u<<1,v$1[t+1]=$u>>>31^vu<<1}var BLAKE2B_IV32=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),SIGMA8=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],SIGMA82=new Uint8Array(SIGMA8.map(function(Z){return Z*2})),v$1=new Uint32Array(32),m=new Uint32Array(32);function blake2bCompress(Z,t){var Hs=0;for(Hs=0;Hs<16;Hs++)v$1[Hs]=Z.h[Hs],v$1[Hs+16]=BLAKE2B_IV32[Hs];for(v$1[24]=v$1[24]^Z.t,v$1[25]=v$1[25]^Z.t/4294967296,t&&(v$1[28]=~v$1[28],v$1[29]=~v$1[29]),Hs=0;Hs<32;Hs++)m[Hs]=B2B_GET32(Z.b,4*Hs);for(Hs=0;Hs<12;Hs++)B2B_G(0,8,16,24,SIGMA82[Hs*16+0],SIGMA82[Hs*16+1]),B2B_G(2,10,18,26,SIGMA82[Hs*16+2],SIGMA82[Hs*16+3]),B2B_G(4,12,20,28,SIGMA82[Hs*16+4],SIGMA82[Hs*16+5]),B2B_G(6,14,22,30,SIGMA82[Hs*16+6],SIGMA82[Hs*16+7]),B2B_G(0,10,20,30,SIGMA82[Hs*16+8],SIGMA82[Hs*16+9]),B2B_G(2,12,22,24,SIGMA82[Hs*16+10],SIGMA82[Hs*16+11]),B2B_G(4,14,16,26,SIGMA82[Hs*16+12],SIGMA82[Hs*16+13]),B2B_G(6,8,18,28,SIGMA82[Hs*16+14],SIGMA82[Hs*16+15]);for(Hs=0;Hs<16;Hs++)Z.h[Hs]=Z.h[Hs]^v$1[Hs]^v$1[Hs+16]}var parameter_block=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function Blake2b(Z,t,Hs,zs){parameter_block.fill(0),this.b=new Uint8Array(128),this.h=new Uint32Array(16),this.t=0,this.c=0,this.outlen=Z,parameter_block[0]=Z,t&&(parameter_block[1]=t.length),parameter_block[2]=1,parameter_block[3]=1,Hs&&parameter_block.set(Hs,32),zs&&parameter_block.set(zs,48);for(var Ys=0;Ys<16;Ys++)this.h[Ys]=BLAKE2B_IV32[Ys]^B2B_GET32(parameter_block,Ys*4);t&&(blake2bUpdate(this,t),this.c=128)}Blake2b.prototype.update=function(Z){return assert(Z!=null,"input must be Uint8Array or Buffer"),blake2bUpdate(this,Z),this};Blake2b.prototype.digest=function(Z){var t=!Z||Z==="binary"||Z==="hex"?new Uint8Array(this.outlen):Z;return assert(t.length>=this.outlen,"out must have at least outlen bytes of space"),blake2bFinal(this,t),Z==="hex"?hexSlice(t):t};Blake2b.prototype.final=Blake2b.prototype.digest;Blake2b.ready=function(Z){b2wasm.ready(function(){Z()})};function blake2bUpdate(Z,t){for(var Hs=0;Hs<t.length;Hs++)Z.c===128&&(Z.t+=Z.c,blake2bCompress(Z,!1),Z.c=0),Z.b[Z.c++]=t[Hs]}function blake2bFinal(Z,t){for(Z.t+=Z.c;Z.c<128;)Z.b[Z.c++]=0;blake2bCompress(Z,!0);for(var Hs=0;Hs<Z.outlen;Hs++)t[Hs]=Z.h[Hs>>2]>>8*(Hs&3);return t}function hexSlice(Z){for(var t="",Hs=0;Hs<Z.length;Hs++)t+=toHex(Z[Hs]);return t}function toHex(Z){return Z<16?"0"+Z.toString(16):Z.toString(16)}var Proto=Blake2b;blake2b$1.exports=function Z(t,Hs,zs,Ys,Zs){return Zs!==!0&&(assert(t>=BYTES_MIN,"outlen must be at least "+BYTES_MIN+", was given "+t),assert(t<=BYTES_MAX,"outlen must be at most "+BYTES_MAX+", was given "+t),Hs!=null&&assert(Hs.length>=KEYBYTES_MIN,"key must be at least "+KEYBYTES_MIN+", was given "+Hs.length),Hs!=null&&assert(Hs.length<=KEYBYTES_MAX,"key must be at most "+KEYBYTES_MAX+", was given "+Hs.length),zs!=null&&assert(zs.length===SALTBYTES,"salt must be exactly "+SALTBYTES+", was given "+zs.length),Ys!=null&&assert(Ys.length===PERSONALBYTES,"personal must be exactly "+PERSONALBYTES+", was given "+Ys.length)),new Proto(t,Hs,zs,Ys)};blake2b$1.exports.ready=function(Z){b2wasm.ready(function(){Z()})};blake2b$1.exports.WASM_SUPPORTED=b2wasm.SUPPORTED;blake2b$1.exports.WASM_LOADED=!1;var BYTES_MIN=blake2b$1.exports.BYTES_MIN=16,BYTES_MAX=blake2b$1.exports.BYTES_MAX=64;blake2b$1.exports.BYTES=32;var KEYBYTES_MIN=blake2b$1.exports.KEYBYTES_MIN=16,KEYBYTES_MAX=blake2b$1.exports.KEYBYTES_MAX=64;blake2b$1.exports.KEYBYTES=32;var SALTBYTES=blake2b$1.exports.SALTBYTES=16,PERSONALBYTES=blake2b$1.exports.PERSONALBYTES=16;b2wasm.ready(function(Z){Z||(blake2b$1.exports.WASM_LOADED=!0,Proto=b2wasm)});var blake2bExports=blake2b$1.exports,__createBinding=commonjsGlobal$2&&commonjsGlobal$2.__createBinding||(Object.create?function(Z,t,Hs,zs){zs===void 0&&(zs=Hs),Object.defineProperty(Z,zs,{enumerable:!0,get:function(){return t[Hs]}})}:function(Z,t,Hs,zs){zs===void 0&&(zs=Hs),Z[zs]=t[Hs]}),__setModuleDefault=commonjsGlobal$2&&commonjsGlobal$2.__setModuleDefault||(Object.create?function(Z,t){Object.defineProperty(Z,"default",{enumerable:!0,value:t})}:function(Z,t){Z.default=t}),__importStar=commonjsGlobal$2&&commonjsGlobal$2.__importStar||function(Z){if(Z&&Z.__esModule)return Z;var t={};if(Z!=null)for(var Hs in Z)Hs!=="default"&&Object.prototype.hasOwnProperty.call(Z,Hs)&&__createBinding(t,Z,Hs);return __setModuleDefault(t,Z),t},__importDefault=commonjsGlobal$2&&commonjsGlobal$2.__importDefault||function(Z){return Z&&Z.__esModule?Z:{default:Z}};Object.defineProperty(transactionComputer,"__esModule",{value:!0});transactionComputer.TransactionComputer=void 0;const bignumber_js_1=__importDefault(bignumberExports),proto_1=proto,constants_1$1=constants$2,errors$1=__importStar(errors$5),createTransactionHasher=blake2bExports,createKeccakHash=js$2,TRANSACTION_HASH_LENGTH=32;class TransactionComputer{constructor(){}computeTransactionFee(t,Hs){const zs=BigInt(Hs.minGasLimit+BigInt(t.data.length)*Hs.gasPerDataByte);if(zs>t.gasLimit)throw new errors$1.ErrNotEnoughGas(parseInt(t.gasLimit.toString(),10));const Ys=t.gasPrice,Zs=zs*Ys;if(zs===t.gasLimit)return Zs;const _u=t.gasLimit-zs,Eu=BigInt(new bignumber_js_1.default(Ys.toString()).multipliedBy(new bignumber_js_1.default(Hs.gasPriceModifier)).toFixed(0)),Iu=_u*Eu;return Zs+Iu}computeBytesForSigning(t){this.ensureValidTransactionFields(t);const Hs=this.toPlainObject(t),zs=JSON.stringify(Hs);return new Uint8Array(Buffer$1.from(zs))}computeBytesForVerifying(t){return this.hasOptionsSetForHashSigning(t)?this.computeHashForSigning(t):this.computeBytesForSigning(t)}computeHashForSigning(t){const Hs=this.toPlainObject(t),zs=Buffer$1.from(JSON.stringify(Hs));return createKeccakHash("keccak256").update(zs).digest()}computeTransactionHash(t){const zs=new proto_1.ProtoSerializer().serializeTransaction(t),Ys=createTransactionHasher(TRANSACTION_HASH_LENGTH).update(zs).digest("hex");return Buffer$1.from(Ys,"hex").toString("hex")}hasOptionsSetForGuardedTransaction(t){return(t.options&constants_1$1.TRANSACTION_OPTIONS_TX_GUARDED)==constants_1$1.TRANSACTION_OPTIONS_TX_GUARDED}hasOptionsSetForHashSigning(t){return(t.options&constants_1$1.TRANSACTION_OPTIONS_TX_HASH_SIGN)==constants_1$1.TRANSACTION_OPTIONS_TX_HASH_SIGN}applyGuardian(t,Hs){t.version<constants_1$1.MIN_TRANSACTION_VERSION_THAT_SUPPORTS_OPTIONS&&(t.version=constants_1$1.MIN_TRANSACTION_VERSION_THAT_SUPPORTS_OPTIONS),t.options=t.options|constants_1$1.TRANSACTION_OPTIONS_TX_GUARDED,t.guardian=Hs}isRelayedV3Transaction(t){return!t.relayer.isEmpty()}applyOptionsForHashSigning(t){t.version<constants_1$1.MIN_TRANSACTION_VERSION_THAT_SUPPORTS_OPTIONS&&(t.version=constants_1$1.MIN_TRANSACTION_VERSION_THAT_SUPPORTS_OPTIONS),t.options=t.options|constants_1$1.TRANSACTION_OPTIONS_TX_HASH_SIGN}toPlainObject(t,Hs){var Ys,Zs;let zs={nonce:Number(t.nonce),value:t.value.toString(),receiver:t.receiver.toBech32(),sender:t.sender.toBech32(),senderUsername:this.toBase64OrUndefined(t.senderUsername),receiverUsername:this.toBase64OrUndefined(t.receiverUsername),gasPrice:Number(t.gasPrice),gasLimit:Number(t.gasLimit),data:this.toBase64OrUndefined(t.data)};return Hs&&(zs.signature=this.toHexOrUndefined(t.signature)),zs.chainID=t.chainID,zs.version=t.version,zs.options=t.options?t.options:void 0,zs.guardian=t.guardian.isEmpty()?void 0:t.guardian.toBech32(),zs.relayer=(Ys=t.relayer)!=null&&Ys.isEmpty()||(Zs=t.relayer)==null?void 0:Zs.toBech32(),zs}toHexOrUndefined(t){return t&&t.length?Buffer$1.from(t).toString("hex"):void 0}toBase64OrUndefined(t){return t&&t.length?Buffer$1.from(t).toString("base64"):void 0}ensureValidTransactionFields(t){if(!t.chainID.length)throw new errors$1.ErrBadUsage("The `chainID` field is not set");if(t.version<constants_1$1.MIN_TRANSACTION_VERSION_THAT_SUPPORTS_OPTIONS&&(this.hasOptionsSetForGuardedTransaction(t)||this.hasOptionsSetForHashSigning(t)))throw new errors$1.ErrBadUsage(`Non-empty transaction options requires transaction version >= ${constants_1$1.MIN_TRANSACTION_VERSION_THAT_SUPPORTS_OPTIONS}`)}}transactionComputer.TransactionComputer=TransactionComputer;Object.defineProperty(transaction,"__esModule",{value:!0});transaction.Transaction=void 0;const address_1$1=address,constants_1=constants$2,transactionComputer_1=transactionComputer;class Transaction{constructor(t){this.nonce=t.nonce??0n,this.value=t.value??0n,this.sender=t.sender,this.receiver=t.receiver,this.senderUsername=t.senderUsername||"",this.receiverUsername=t.receiverUsername||"",this.gasPrice=t.gasPrice??BigInt(constants_1.TRANSACTION_MIN_GAS_PRICE),this.gasLimit=t.gasLimit,this.data=t.data??new Uint8Array,this.chainID=t.chainID.valueOf(),this.version=t.version??constants_1.TRANSACTION_VERSION_DEFAULT,this.options=t.options??constants_1.TRANSACTION_OPTIONS_DEFAULT,this.guardian=t.guardian??address_1$1.Address.empty(),this.relayer=t.relayer?t.relayer:address_1$1.Address.empty(),this.signature=t.signature||Buffer$1.from([]),this.guardianSignature=t.guardianSignature||Buffer$1.from([]),this.relayerSignature=t.relayerSignature||Buffer$1.from([])}isGuardedTransaction(){const t=new transactionComputer_1.TransactionComputer,Hs=!this.guardian.isEmpty(),zs=this.guardianSignature.length>0;return t.hasOptionsSetForGuardedTransaction(this)&&Hs&&zs}toPlainObject(){return{nonce:Number(this.nonce),value:this.value.toString(),receiver:this.receiver.toBech32(),sender:this.sender.toBech32(),senderUsername:this.toBase64OrUndefined(this.senderUsername),receiverUsername:this.toBase64OrUndefined(this.receiverUsername),gasPrice:Number(this.gasPrice),gasLimit:Number(this.gasLimit),data:this.toBase64OrUndefined(this.data),chainID:this.chainID.valueOf(),version:this.version,options:this.options==0?void 0:this.options,guardian:this.guardian.isEmpty()?void 0:this.guardian.toBech32(),relayer:this.relayer.isEmpty()?void 0:this.relayer.toBech32(),signature:this.toHexOrUndefined(this.signature),guardianSignature:this.toHexOrUndefined(this.guardianSignature),relayerSignature:this.toHexOrUndefined(this.relayerSignature)}}static newFromPlainObject(t){return new Transaction({nonce:BigInt(t.nonce),value:BigInt(t.value||""),receiver:address_1$1.Address.newFromBech32(t.receiver),receiverUsername:Buffer$1.from(t.receiverUsername||"","base64").toString(),sender:address_1$1.Address.newFromBech32(t.sender),senderUsername:Buffer$1.from(t.senderUsername||"","base64").toString(),guardian:t.guardian?address_1$1.Address.newFromBech32(t.guardian):address_1$1.Address.empty(),relayer:t.relayer?address_1$1.Address.newFromBech32(t.relayer):address_1$1.Address.empty(),gasPrice:BigInt(t.gasPrice),gasLimit:BigInt(t.gasLimit),data:Buffer$1.from(t.data||"","base64"),chainID:String(t.chainID),version:Number(t.version),options:t.options?Number(t.options):void 0,signature:Buffer$1.from(t.signature||"","hex"),guardianSignature:Buffer$1.from(t.guardianSignature||"","hex"),relayerSignature:Buffer$1.from(t.relayerSignature||"","hex")})}toSendable(){return this.toPlainObject()}toBase64OrUndefined(t){return t&&t.length?Buffer$1.from(t).toString("base64"):void 0}toHexOrUndefined(t){return t&&t.length?Buffer$1.from(t).toString("hex"):void 0}}transaction.Transaction=Transaction;var errors={};Object.defineProperty(errors,"__esModule",{value:!0});errors.ErrAccountNotConnected=errors.ErrCannotSignSingleTransaction=errors.Err=void 0;class Err extends Error{constructor(t,Hs){super(t),this.inner=void 0,this.inner=Hs}}errors.Err=Err;class ErrCannotSignSingleTransaction extends Err{constructor(){super("Cannot sign single transaction.")}}errors.ErrCannotSignSingleTransaction=ErrCannotSignSingleTransaction;class ErrAccountNotConnected extends Err{constructor(){super("Account is not connected.")}}errors.ErrAccountNotConnected=ErrAccountNotConnected;var operation={};Object.defineProperty(operation,"__esModule",{value:!0});operation.Operation=void 0;var Operation;(function(Z){Z.Connect="connect",Z.Logout="logout",Z.SignTransactions="signTransactions",Z.SignMessage="signMessage",Z.CancelAction="cancelAction"})(Operation||(operation.Operation=Operation={}));var __awaiter=commonjsGlobal$2&&commonjsGlobal$2.__awaiter||function(Z,t,Hs,zs){function Ys(Zs){return Zs instanceof Hs?Zs:new Hs(function(_u){_u(Zs)})}return new(Hs||(Hs=Promise))(function(Zs,_u){function Eu($u){try{Au(zs.next($u))}catch(vu){_u(vu)}}function Iu($u){try{Au(zs.throw($u))}catch(vu){_u(vu)}}function Au($u){$u.done?Zs($u.value):Ys($u.value).then(Eu,Iu)}Au((zs=zs.apply(Z,t||[])).next())})};Object.defineProperty(extensionProvider,"__esModule",{value:!0});extensionProvider.ExtensionProvider=void 0;const transaction_1=transaction,address_1=address,message_1=message,errors_1=errors,operation_1=operation;class ExtensionProvider{constructor(){if(this.account={address:""},this.initialized=!1,ExtensionProvider._instance)throw new Error("Error: Instantiation failed: Use ExtensionProvider.getInstance() instead of new.");ExtensionProvider._instance=this}static getInstance(){return ExtensionProvider._instance}setAddress(t){return this.account.address=t,ExtensionProvider._instance}init(){return __awaiter(this,void 0,void 0,function*(){return window&&(window.elrondWallet||window.multiversxWallet)&&(this.initialized=!0),this.initialized})}login(){return __awaiter(this,arguments,void 0,function*(t={}){if(!this.initialized)throw new Error("Extension provider is not initialised, call init() first");const{token:Hs}=t,zs=Hs||"";return yield this.startBgrMsgChannel(operation_1.Operation.Connect,zs),this.account})}logout(){return __awaiter(this,void 0,void 0,function*(){if(!this.initialized)throw new Error("Extension provider is not initialised, call init() first");try{yield this.startBgrMsgChannel(operation_1.Operation.Logout,this.account.address),this.disconnect()}catch(t){console.warn("Extension origin url is already cleared!",t)}return!0})}disconnect(){this.account={address:""}}getAddress(){return __awaiter(this,void 0,void 0,function*(){if(!this.initialized)throw new Error("Extension provider is not initialised, call init() first");return this.account?this.account.address:""})}isInitialized(){return this.initialized}isConnected(){return!!this.account.address}getAccount(){return this.account}setAccount(t){this.account=t}signTransaction(t){return __awaiter(this,void 0,void 0,function*(){this.ensureConnected();const Hs=yield this.signTransactions([t]);if(Hs.length!=1)throw new errors_1.ErrCannotSignSingleTransaction;return Hs[0]})}ensureConnected(){if(!this.account.address)throw new errors_1.ErrAccountNotConnected}signTransactions(t){return __awaiter(this,void 0,void 0,function*(){this.ensureConnected();const Hs=yield this.startBgrMsgChannel(operation_1.Operation.SignTransactions,{from:this.account.address,transactions:t.map(zs=>zs.toPlainObject())});try{return Hs.map(Ys=>transaction_1.Transaction.newFromPlainObject(Ys))}catch(zs){throw new Error(`Transaction canceled: ${zs.message}.`)}})}signMessage(t){return __awaiter(this,void 0,void 0,function*(){var Hs;this.ensureConnected();const zs={account:this.account.address,message:Buffer$1.from(t.data).toString()},Zs=(yield this.startBgrMsgChannel(operation_1.Operation.SignMessage,zs)).signature,_u=Buffer$1.from(Zs,"hex");return new message_1.Message({data:Buffer$1.from(t.data),address:(Hs=t.address)!==null&&Hs!==void 0?Hs:address_1.Address.newFromBech32(this.account.address),signer:"extension",version:t.version,signature:_u})})}cancelAction(){return this.startBgrMsgChannel(operation_1.Operation.CancelAction,{})}startBgrMsgChannel(t,Hs){return new Promise(zs=>{window.postMessage({target:"erdw-inpage",type:t,data:Hs},window.origin);const Ys=Zs=>{Zs.isTrusted&&Zs.data.target==="erdw-contentScript"&&(Zs.data.type==="connectResponse"?(Zs.data.data&&Zs.data.data.address&&(this.account=Zs.data.data),window.removeEventListener("message",Ys),zs(Zs.data.data)):(window.removeEventListener("message",Ys),zs(Zs.data.data)))};window.addEventListener("message",Ys,!1)})}}extensionProvider.ExtensionProvider=ExtensionProvider;ExtensionProvider._instance=new ExtensionProvider;(function(Z){var t=commonjsGlobal$2&&commonjsGlobal$2.__createBinding||(Object.create?function(zs,Ys,Zs,_u){_u===void 0&&(_u=Zs);var Eu=Object.getOwnPropertyDescriptor(Ys,Zs);(!Eu||("get"in Eu?!Ys.__esModule:Eu.writable||Eu.configurable))&&(Eu={enumerable:!0,get:function(){return Ys[Zs]}}),Object.defineProperty(zs,_u,Eu)}:function(zs,Ys,Zs,_u){_u===void 0&&(_u=Zs),zs[_u]=Ys[Zs]}),Hs=commonjsGlobal$2&&commonjsGlobal$2.__exportStar||function(zs,Ys){for(var Zs in zs)Zs!=="default"&&!Object.prototype.hasOwnProperty.call(Ys,Zs)&&t(Ys,zs,Zs)};Object.defineProperty(Z,"__esModule",{value:!0}),Hs(extensionProvider,Z)})(out);const getDefaultsFromPostinstall=()=>{};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const stringToByteArray$1=function(Z){const t=[];let Hs=0;for(let zs=0;zs<Z.length;zs++){let Ys=Z.charCodeAt(zs);Ys<128?t[Hs++]=Ys:Ys<2048?(t[Hs++]=Ys>>6|192,t[Hs++]=Ys&63|128):(Ys&64512)===55296&&zs+1<Z.length&&(Z.charCodeAt(zs+1)&64512)===56320?(Ys=65536+((Ys&1023)<<10)+(Z.charCodeAt(++zs)&1023),t[Hs++]=Ys>>18|240,t[Hs++]=Ys>>12&63|128,t[Hs++]=Ys>>6&63|128,t[Hs++]=Ys&63|128):(t[Hs++]=Ys>>12|224,t[Hs++]=Ys>>6&63|128,t[Hs++]=Ys&63|128)}return t},byteArrayToString=function(Z){const t=[];let Hs=0,zs=0;for(;Hs<Z.length;){const Ys=Z[Hs++];if(Ys<128)t[zs++]=String.fromCharCode(Ys);else if(Ys>191&&Ys<224){const Zs=Z[Hs++];t[zs++]=String.fromCharCode((Ys&31)<<6|Zs&63)}else if(Ys>239&&Ys<365){const Zs=Z[Hs++],_u=Z[Hs++],Eu=Z[Hs++],Iu=((Ys&7)<<18|(Zs&63)<<12|(_u&63)<<6|Eu&63)-65536;t[zs++]=String.fromCharCode(55296+(Iu>>10)),t[zs++]=String.fromCharCode(56320+(Iu&1023))}else{const Zs=Z[Hs++],_u=Z[Hs++];t[zs++]=String.fromCharCode((Ys&15)<<12|(Zs&63)<<6|_u&63)}}return t.join("")},base64={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(Z,t){if(!Array.isArray(Z))throw Error("encodeByteArray takes an array as a parameter");this.init_();const Hs=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,zs=[];for(let Ys=0;Ys<Z.length;Ys+=3){const Zs=Z[Ys],_u=Ys+1<Z.length,Eu=_u?Z[Ys+1]:0,Iu=Ys+2<Z.length,Au=Iu?Z[Ys+2]:0,$u=Zs>>2,vu=(Zs&3)<<4|Eu>>4;let Su=(Eu&15)<<2|Au>>6,Ru=Au&63;Iu||(Ru=64,_u||(Su=64)),zs.push(Hs[$u],Hs[vu],Hs[Su],Hs[Ru])}return zs.join("")},encodeString(Z,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(Z):this.encodeByteArray(stringToByteArray$1(Z),t)},decodeString(Z,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(Z):byteArrayToString(this.decodeStringToByteArray(Z,t))},decodeStringToByteArray(Z,t){this.init_();const Hs=t?this.charToByteMapWebSafe_:this.charToByteMap_,zs=[];for(let Ys=0;Ys<Z.length;){const Zs=Hs[Z.charAt(Ys++)],Eu=Ys<Z.length?Hs[Z.charAt(Ys)]:0;++Ys;const Au=Ys<Z.length?Hs[Z.charAt(Ys)]:64;++Ys;const vu=Ys<Z.length?Hs[Z.charAt(Ys)]:64;if(++Ys,Zs==null||Eu==null||Au==null||vu==null)throw new DecodeBase64StringError;const Su=Zs<<2|Eu>>4;if(zs.push(Su),Au!==64){const Ru=Eu<<4&240|Au>>2;if(zs.push(Ru),vu!==64){const Pu=Au<<6&192|vu;zs.push(Pu)}}}return zs},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let Z=0;Z<this.ENCODED_VALS.length;Z++)this.byteToCharMap_[Z]=this.ENCODED_VALS.charAt(Z),this.charToByteMap_[this.byteToCharMap_[Z]]=Z,this.byteToCharMapWebSafe_[Z]=this.ENCODED_VALS_WEBSAFE.charAt(Z),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[Z]]=Z,Z>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(Z)]=Z,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(Z)]=Z)}}};class DecodeBase64StringError extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const base64Encode=function(Z){const t=stringToByteArray$1(Z);return base64.encodeByteArray(t,!0)},base64urlEncodeWithoutPadding=function(Z){return base64Encode(Z).replace(/\./g,"")},base64Decode=function(Z){try{return base64.decodeString(Z,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getGlobal(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof globalThis<"u")return globalThis;throw new Error("Unable to locate globalThis object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const getDefaultsFromGlobal=()=>getGlobal().__FIREBASE_DEFAULTS__,getDefaultsFromEnvVariable=()=>{if(typeof process$1>"u"||typeof process$1.env>"u")return;const Z={}.__FIREBASE_DEFAULTS__;if(Z)return JSON.parse(Z)},getDefaultsFromCookie=()=>{if(typeof document>"u")return;let Z;try{Z=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=Z&&base64Decode(Z[1]);return t&&JSON.parse(t)},getDefaults=()=>{try{return getDefaultsFromPostinstall()||getDefaultsFromGlobal()||getDefaultsFromEnvVariable()||getDefaultsFromCookie()}catch(Z){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${Z}`);return}},getDefaultEmulatorHost=Z=>{var t,Hs;return(Hs=(t=getDefaults())==null?void 0:t.emulatorHosts)==null?void 0:Hs[Z]},getDefaultEmulatorHostnameAndPort=Z=>{const t=getDefaultEmulatorHost(Z);if(!t)return;const Hs=t.lastIndexOf(":");if(Hs<=0||Hs+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const zs=parseInt(t.substring(Hs+1),10);return t[0]==="["?[t.substring(1,Hs-1),zs]:[t.substring(0,Hs),zs]},getDefaultAppConfig=()=>{var Z;return(Z=getDefaults())==null?void 0:Z.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Deferred{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,Hs)=>{this.resolve=t,this.reject=Hs})}wrapCallback(t){return(Hs,zs)=>{Hs?this.reject(Hs):this.resolve(zs),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(Hs):t(Hs,zs))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function isCloudWorkstation(Z){try{return(Z.startsWith("http://")||Z.startsWith("https://")?new URL(Z).hostname:Z).endsWith(".cloudworkstations.dev")}catch{return!1}}async function pingServer(Z){return(await fetch(Z,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function createMockUserToken(Z,t){if(Z.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const Hs={alg:"none",type:"JWT"},zs=t||"demo-project",Ys=Z.iat||0,Zs=Z.sub||Z.user_id;if(!Zs)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const _u={iss:`https://securetoken.google.com/${zs}`,aud:zs,iat:Ys,exp:Ys+3600,auth_time:Ys,sub:Zs,user_id:Zs,firebase:{sign_in_provider:"custom",identities:{}},...Z},Eu="";return[base64urlEncodeWithoutPadding(JSON.stringify(Hs)),base64urlEncodeWithoutPadding(JSON.stringify(_u)),Eu].join(".")}const emulatorStatus={};function getEmulatorSummary(){const Z={prod:[],emulator:[]};for(const t of Object.keys(emulatorStatus))emulatorStatus[t]?Z.emulator.push(t):Z.prod.push(t);return Z}function getOrCreateEl(Z){let t=document.getElementById(Z),Hs=!1;return t||(t=document.createElement("div"),t.setAttribute("id",Z),Hs=!0),{created:Hs,element:t}}let previouslyDismissed=!1;function updateEmulatorBanner(Z,t){if(typeof window>"u"||typeof document>"u"||!isCloudWorkstation(window.location.host)||emulatorStatus[Z]===t||emulatorStatus[Z]||previouslyDismissed)return;emulatorStatus[Z]=t;function Hs(Su){return`__firebase__banner__${Su}`}const zs="__firebase__banner",Zs=getEmulatorSummary().prod.length>0;function _u(){const Su=document.getElementById(zs);Su&&Su.remove()}function Eu(Su){Su.style.display="flex",Su.style.background="#7faaf0",Su.style.position="fixed",Su.style.bottom="5px",Su.style.left="5px",Su.style.padding=".5em",Su.style.borderRadius="5px",Su.style.alignItems="center"}function Iu(Su,Ru){Su.setAttribute("width","24"),Su.setAttribute("id",Ru),Su.setAttribute("height","24"),Su.setAttribute("viewBox","0 0 24 24"),Su.setAttribute("fill","none"),Su.style.marginLeft="-6px"}function Au(){const Su=document.createElement("span");return Su.style.cursor="pointer",Su.style.marginLeft="16px",Su.style.fontSize="24px",Su.innerHTML=" &times;",Su.onclick=()=>{previouslyDismissed=!0,_u()},Su}function $u(Su,Ru){Su.setAttribute("id",Ru),Su.innerText="Learn more",Su.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",Su.setAttribute("target","__blank"),Su.style.paddingLeft="5px",Su.style.textDecoration="underline"}function vu(){const Su=getOrCreateEl(zs),Ru=Hs("text"),Pu=document.getElementById(Ru)||document.createElement("span"),Cu=Hs("learnmore"),Bu=document.getElementById(Cu)||document.createElement("a"),Fu=Hs("preprendIcon"),zu=document.getElementById(Fu)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(Su.created){const Hu=Su.element;Eu(Hu),$u(Bu,Cu);const Wu=Au();Iu(zu,Fu),Hu.append(zu,Pu,Bu,Wu),document.body.appendChild(Hu)}Zs?(Pu.innerText="Preview backend disconnected.",zu.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(zu.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,Pu.innerText="Preview backend running in this workspace."),Pu.setAttribute("id",Ru)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",vu):vu()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getUA(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function isNode(){var t;const Z=(t=getDefaults())==null?void 0:t.forceEnvironment;if(Z==="node")return!0;if(Z==="browser")return!1;try{return Object.prototype.toString.call(globalThis.process)==="[object process]"}catch{return!1}}function isSafari(){return!isNode()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function isIndexedDBAvailable(){try{return typeof indexedDB=="object"}catch{return!1}}function validateIndexedDBOpenable(){return new Promise((Z,t)=>{try{let Hs=!0;const zs="validate-browser-context-for-indexeddb-analytics-module",Ys=self.indexedDB.open(zs);Ys.onsuccess=()=>{Ys.result.close(),Hs||self.indexedDB.deleteDatabase(zs),Z(!0)},Ys.onupgradeneeded=()=>{Hs=!1},Ys.onerror=()=>{var Zs;t(((Zs=Ys.error)==null?void 0:Zs.message)||"")}}catch(Hs){t(Hs)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ERROR_NAME="FirebaseError";class FirebaseError extends Error{constructor(t,Hs,zs){super(Hs),this.code=t,this.customData=zs,this.name=ERROR_NAME,Object.setPrototypeOf(this,FirebaseError.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ErrorFactory.prototype.create)}}class ErrorFactory{constructor(t,Hs,zs){this.service=t,this.serviceName=Hs,this.errors=zs}create(t,...Hs){const zs=Hs[0]||{},Ys=`${this.service}/${t}`,Zs=this.errors[t],_u=Zs?replaceTemplate(Zs,zs):"Error",Eu=`${this.serviceName}: ${_u} (${Ys}).`;return new FirebaseError(Ys,Eu,zs)}}function replaceTemplate(Z,t){return Z.replace(PATTERN,(Hs,zs)=>{const Ys=t[zs];return Ys!=null?String(Ys):`<${zs}?>`})}const PATTERN=/\{\$([^}]+)}/g;function deepEqual(Z,t){if(Z===t)return!0;const Hs=Object.keys(Z),zs=Object.keys(t);for(const Ys of Hs){if(!zs.includes(Ys))return!1;const Zs=Z[Ys],_u=t[Ys];if(isObject(Zs)&&isObject(_u)){if(!deepEqual(Zs,_u))return!1}else if(Zs!==_u)return!1}for(const Ys of zs)if(!Hs.includes(Ys))return!1;return!0}function isObject(Z){return Z!==null&&typeof Z=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getModularInstance(Z){return Z&&Z._delegate?Z._delegate:Z}class Component{constructor(t,Hs,zs){this.name=t,this.instanceFactory=Hs,this.type=zs,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_ENTRY_NAME$1="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Provider{constructor(t,Hs){this.name=t,this.container=Hs,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const Hs=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(Hs)){const zs=new Deferred;if(this.instancesDeferred.set(Hs,zs),this.isInitialized(Hs)||this.shouldAutoInitialize())try{const Ys=this.getOrInitializeService({instanceIdentifier:Hs});Ys&&zs.resolve(Ys)}catch{}}return this.instancesDeferred.get(Hs).promise}getImmediate(t){const Hs=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),zs=(t==null?void 0:t.optional)??!1;if(this.isInitialized(Hs)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:Hs})}catch(Ys){if(zs)return null;throw Ys}else{if(zs)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(isComponentEager(t))try{this.getOrInitializeService({instanceIdentifier:DEFAULT_ENTRY_NAME$1})}catch{}for(const[Hs,zs]of this.instancesDeferred.entries()){const Ys=this.normalizeInstanceIdentifier(Hs);try{const Zs=this.getOrInitializeService({instanceIdentifier:Ys});zs.resolve(Zs)}catch{}}}}clearInstance(t=DEFAULT_ENTRY_NAME$1){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(Hs=>"INTERNAL"in Hs).map(Hs=>Hs.INTERNAL.delete()),...t.filter(Hs=>"_delete"in Hs).map(Hs=>Hs._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=DEFAULT_ENTRY_NAME$1){return this.instances.has(t)}getOptions(t=DEFAULT_ENTRY_NAME$1){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:Hs={}}=t,zs=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(zs))throw Error(`${this.name}(${zs}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const Ys=this.getOrInitializeService({instanceIdentifier:zs,options:Hs});for(const[Zs,_u]of this.instancesDeferred.entries()){const Eu=this.normalizeInstanceIdentifier(Zs);zs===Eu&&_u.resolve(Ys)}return Ys}onInit(t,Hs){const zs=this.normalizeInstanceIdentifier(Hs),Ys=this.onInitCallbacks.get(zs)??new Set;Ys.add(t),this.onInitCallbacks.set(zs,Ys);const Zs=this.instances.get(zs);return Zs&&t(Zs,zs),()=>{Ys.delete(t)}}invokeOnInitCallbacks(t,Hs){const zs=this.onInitCallbacks.get(Hs);if(zs)for(const Ys of zs)try{Ys(t,Hs)}catch{}}getOrInitializeService({instanceIdentifier:t,options:Hs={}}){let zs=this.instances.get(t);if(!zs&&this.component&&(zs=this.component.instanceFactory(this.container,{instanceIdentifier:normalizeIdentifierForFactory(t),options:Hs}),this.instances.set(t,zs),this.instancesOptions.set(t,Hs),this.invokeOnInitCallbacks(zs,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,zs)}catch{}return zs||null}normalizeInstanceIdentifier(t=DEFAULT_ENTRY_NAME$1){return this.component?this.component.multipleInstances?t:DEFAULT_ENTRY_NAME$1:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function normalizeIdentifierForFactory(Z){return Z===DEFAULT_ENTRY_NAME$1?void 0:Z}function isComponentEager(Z){return Z.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ComponentContainer{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const Hs=this.getProvider(t.name);if(Hs.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);Hs.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const Hs=new Provider(t,this);return this.providers.set(t,Hs),Hs}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var LogLevel;(function(Z){Z[Z.DEBUG=0]="DEBUG",Z[Z.VERBOSE=1]="VERBOSE",Z[Z.INFO=2]="INFO",Z[Z.WARN=3]="WARN",Z[Z.ERROR=4]="ERROR",Z[Z.SILENT=5]="SILENT"})(LogLevel||(LogLevel={}));const levelStringToEnum={debug:LogLevel.DEBUG,verbose:LogLevel.VERBOSE,info:LogLevel.INFO,warn:LogLevel.WARN,error:LogLevel.ERROR,silent:LogLevel.SILENT},defaultLogLevel=LogLevel.INFO,ConsoleMethod={[LogLevel.DEBUG]:"log",[LogLevel.VERBOSE]:"log",[LogLevel.INFO]:"info",[LogLevel.WARN]:"warn",[LogLevel.ERROR]:"error"},defaultLogHandler=(Z,t,...Hs)=>{if(t<Z.logLevel)return;const zs=new Date().toISOString(),Ys=ConsoleMethod[t];if(Ys)console[Ys](`[${zs}]  ${Z.name}:`,...Hs);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Logger{constructor(t){this.name=t,this._logLevel=defaultLogLevel,this._logHandler=defaultLogHandler,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in LogLevel))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?levelStringToEnum[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,LogLevel.DEBUG,...t),this._logHandler(this,LogLevel.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,LogLevel.VERBOSE,...t),this._logHandler(this,LogLevel.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,LogLevel.INFO,...t),this._logHandler(this,LogLevel.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,LogLevel.WARN,...t),this._logHandler(this,LogLevel.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,LogLevel.ERROR,...t),this._logHandler(this,LogLevel.ERROR,...t)}}const instanceOfAny=(Z,t)=>t.some(Hs=>Z instanceof Hs);let idbProxyableTypes,cursorAdvanceMethods;function getIdbProxyableTypes(){return idbProxyableTypes||(idbProxyableTypes=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function getCursorAdvanceMethods(){return cursorAdvanceMethods||(cursorAdvanceMethods=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const cursorRequestMap=new WeakMap,transactionDoneMap=new WeakMap,transactionStoreNamesMap=new WeakMap,transformCache=new WeakMap,reverseTransformCache=new WeakMap;function promisifyRequest(Z){const t=new Promise((Hs,zs)=>{const Ys=()=>{Z.removeEventListener("success",Zs),Z.removeEventListener("error",_u)},Zs=()=>{Hs(wrap(Z.result)),Ys()},_u=()=>{zs(Z.error),Ys()};Z.addEventListener("success",Zs),Z.addEventListener("error",_u)});return t.then(Hs=>{Hs instanceof IDBCursor&&cursorRequestMap.set(Hs,Z)}).catch(()=>{}),reverseTransformCache.set(t,Z),t}function cacheDonePromiseForTransaction(Z){if(transactionDoneMap.has(Z))return;const t=new Promise((Hs,zs)=>{const Ys=()=>{Z.removeEventListener("complete",Zs),Z.removeEventListener("error",_u),Z.removeEventListener("abort",_u)},Zs=()=>{Hs(),Ys()},_u=()=>{zs(Z.error||new DOMException("AbortError","AbortError")),Ys()};Z.addEventListener("complete",Zs),Z.addEventListener("error",_u),Z.addEventListener("abort",_u)});transactionDoneMap.set(Z,t)}let idbProxyTraps={get(Z,t,Hs){if(Z instanceof IDBTransaction){if(t==="done")return transactionDoneMap.get(Z);if(t==="objectStoreNames")return Z.objectStoreNames||transactionStoreNamesMap.get(Z);if(t==="store")return Hs.objectStoreNames[1]?void 0:Hs.objectStore(Hs.objectStoreNames[0])}return wrap(Z[t])},set(Z,t,Hs){return Z[t]=Hs,!0},has(Z,t){return Z instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in Z}};function replaceTraps(Z){idbProxyTraps=Z(idbProxyTraps)}function wrapFunction(Z){return Z===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...Hs){const zs=Z.call(unwrap(this),t,...Hs);return transactionStoreNamesMap.set(zs,t.sort?t.sort():[t]),wrap(zs)}:getCursorAdvanceMethods().includes(Z)?function(...t){return Z.apply(unwrap(this),t),wrap(cursorRequestMap.get(this))}:function(...t){return wrap(Z.apply(unwrap(this),t))}}function transformCachableValue(Z){return typeof Z=="function"?wrapFunction(Z):(Z instanceof IDBTransaction&&cacheDonePromiseForTransaction(Z),instanceOfAny(Z,getIdbProxyableTypes())?new Proxy(Z,idbProxyTraps):Z)}function wrap(Z){if(Z instanceof IDBRequest)return promisifyRequest(Z);if(transformCache.has(Z))return transformCache.get(Z);const t=transformCachableValue(Z);return t!==Z&&(transformCache.set(Z,t),reverseTransformCache.set(t,Z)),t}const unwrap=Z=>reverseTransformCache.get(Z);function openDB(Z,t,{blocked:Hs,upgrade:zs,blocking:Ys,terminated:Zs}={}){const _u=indexedDB.open(Z,t),Eu=wrap(_u);return zs&&_u.addEventListener("upgradeneeded",Iu=>{zs(wrap(_u.result),Iu.oldVersion,Iu.newVersion,wrap(_u.transaction),Iu)}),Hs&&_u.addEventListener("blocked",Iu=>Hs(Iu.oldVersion,Iu.newVersion,Iu)),Eu.then(Iu=>{Zs&&Iu.addEventListener("close",()=>Zs()),Ys&&Iu.addEventListener("versionchange",Au=>Ys(Au.oldVersion,Au.newVersion,Au))}).catch(()=>{}),Eu}const readMethods=["get","getKey","getAll","getAllKeys","count"],writeMethods=["put","add","delete","clear"],cachedMethods=new Map;function getMethod(Z,t){if(!(Z instanceof IDBDatabase&&!(t in Z)&&typeof t=="string"))return;if(cachedMethods.get(t))return cachedMethods.get(t);const Hs=t.replace(/FromIndex$/,""),zs=t!==Hs,Ys=writeMethods.includes(Hs);if(!(Hs in(zs?IDBIndex:IDBObjectStore).prototype)||!(Ys||readMethods.includes(Hs)))return;const Zs=async function(_u,...Eu){const Iu=this.transaction(_u,Ys?"readwrite":"readonly");let Au=Iu.store;return zs&&(Au=Au.index(Eu.shift())),(await Promise.all([Au[Hs](...Eu),Ys&&Iu.done]))[0]};return cachedMethods.set(t,Zs),Zs}replaceTraps(Z=>({...Z,get:(t,Hs,zs)=>getMethod(t,Hs)||Z.get(t,Hs,zs),has:(t,Hs)=>!!getMethod(t,Hs)||Z.has(t,Hs)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PlatformLoggerServiceImpl{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(Hs=>{if(isVersionServiceProvider(Hs)){const zs=Hs.getImmediate();return`${zs.library}/${zs.version}`}else return null}).filter(Hs=>Hs).join(" ")}}function isVersionServiceProvider(Z){const t=Z.getComponent();return(t==null?void 0:t.type)==="VERSION"}const name$q="@firebase/app",version$1="0.14.7";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const logger=new Logger("@firebase/app"),name$p="@firebase/app-compat",name$o="@firebase/analytics-compat",name$n="@firebase/analytics",name$m="@firebase/app-check-compat",name$l="@firebase/app-check",name$k="@firebase/auth",name$j="@firebase/auth-compat",name$i="@firebase/database",name$h="@firebase/data-connect",name$g="@firebase/database-compat",name$f="@firebase/functions",name$e="@firebase/functions-compat",name$d="@firebase/installations",name$c="@firebase/installations-compat",name$b="@firebase/messaging",name$a="@firebase/messaging-compat",name$9="@firebase/performance",name$8="@firebase/performance-compat",name$7="@firebase/remote-config",name$6="@firebase/remote-config-compat",name$5="@firebase/storage",name$4="@firebase/storage-compat",name$3="@firebase/firestore",name$2="@firebase/ai",name$1="@firebase/firestore-compat",name$r="firebase",version$2="12.8.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_ENTRY_NAME="[DEFAULT]",PLATFORM_LOG_STRING={[name$q]:"fire-core",[name$p]:"fire-core-compat",[name$n]:"fire-analytics",[name$o]:"fire-analytics-compat",[name$l]:"fire-app-check",[name$m]:"fire-app-check-compat",[name$k]:"fire-auth",[name$j]:"fire-auth-compat",[name$i]:"fire-rtdb",[name$h]:"fire-data-connect",[name$g]:"fire-rtdb-compat",[name$f]:"fire-fn",[name$e]:"fire-fn-compat",[name$d]:"fire-iid",[name$c]:"fire-iid-compat",[name$b]:"fire-fcm",[name$a]:"fire-fcm-compat",[name$9]:"fire-perf",[name$8]:"fire-perf-compat",[name$7]:"fire-rc",[name$6]:"fire-rc-compat",[name$5]:"fire-gcs",[name$4]:"fire-gcs-compat",[name$3]:"fire-fst",[name$1]:"fire-fst-compat",[name$2]:"fire-vertex","fire-js":"fire-js",[name$r]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _apps=new Map,_serverApps=new Map,_components=new Map;function _addComponent(Z,t){try{Z.container.addComponent(t)}catch(Hs){logger.debug(`Component ${t.name} failed to register with FirebaseApp ${Z.name}`,Hs)}}function _registerComponent(Z){const t=Z.name;if(_components.has(t))return logger.debug(`There were multiple attempts to register component ${t}.`),!1;_components.set(t,Z);for(const Hs of _apps.values())_addComponent(Hs,Z);for(const Hs of _serverApps.values())_addComponent(Hs,Z);return!0}function _getProvider(Z,t){const Hs=Z.container.getProvider("heartbeat").getImmediate({optional:!0});return Hs&&Hs.triggerHeartbeat(),Z.container.getProvider(t)}function _isFirebaseServerApp(Z){return Z==null?!1:Z.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ERRORS={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ERROR_FACTORY=new ErrorFactory("app","Firebase",ERRORS);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FirebaseAppImpl{constructor(t,Hs,zs){this._isDeleted=!1,this._options={...t},this._config={...Hs},this._name=Hs.name,this._automaticDataCollectionEnabled=Hs.automaticDataCollectionEnabled,this._container=zs,this.container.addComponent(new Component("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ERROR_FACTORY.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SDK_VERSION=version$2;function initializeApp(Z,t={}){let Hs=Z;typeof t!="object"&&(t={name:t});const zs={name:DEFAULT_ENTRY_NAME,automaticDataCollectionEnabled:!0,...t},Ys=zs.name;if(typeof Ys!="string"||!Ys)throw ERROR_FACTORY.create("bad-app-name",{appName:String(Ys)});if(Hs||(Hs=getDefaultAppConfig()),!Hs)throw ERROR_FACTORY.create("no-options");const Zs=_apps.get(Ys);if(Zs){if(deepEqual(Hs,Zs.options)&&deepEqual(zs,Zs.config))return Zs;throw ERROR_FACTORY.create("duplicate-app",{appName:Ys})}const _u=new ComponentContainer(Ys);for(const Iu of _components.values())_u.addComponent(Iu);const Eu=new FirebaseAppImpl(Hs,zs,_u);return _apps.set(Ys,Eu),Eu}function getApp(Z=DEFAULT_ENTRY_NAME){const t=_apps.get(Z);if(!t&&Z===DEFAULT_ENTRY_NAME&&getDefaultAppConfig())return initializeApp();if(!t)throw ERROR_FACTORY.create("no-app",{appName:Z});return t}function registerVersion(Z,t,Hs){let zs=PLATFORM_LOG_STRING[Z]??Z;Hs&&(zs+=`-${Hs}`);const Ys=zs.match(/\s|\//),Zs=t.match(/\s|\//);if(Ys||Zs){const _u=[`Unable to register library "${zs}" with version "${t}":`];Ys&&_u.push(`library name "${zs}" contains illegal characters (whitespace or "/")`),Ys&&Zs&&_u.push("and"),Zs&&_u.push(`version name "${t}" contains illegal characters (whitespace or "/")`),logger.warn(_u.join(" "));return}_registerComponent(new Component(`${zs}-version`,()=>({library:zs,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DB_NAME="firebase-heartbeat-database",DB_VERSION=1,STORE_NAME="firebase-heartbeat-store";let dbPromise=null;function getDbPromise(){return dbPromise||(dbPromise=openDB(DB_NAME,DB_VERSION,{upgrade:(Z,t)=>{switch(t){case 0:try{Z.createObjectStore(STORE_NAME)}catch(Hs){console.warn(Hs)}}}}).catch(Z=>{throw ERROR_FACTORY.create("idb-open",{originalErrorMessage:Z.message})})),dbPromise}async function readHeartbeatsFromIndexedDB(Z){try{const Hs=(await getDbPromise()).transaction(STORE_NAME),zs=await Hs.objectStore(STORE_NAME).get(computeKey(Z));return await Hs.done,zs}catch(t){if(t instanceof FirebaseError)logger.warn(t.message);else{const Hs=ERROR_FACTORY.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});logger.warn(Hs.message)}}}async function writeHeartbeatsToIndexedDB(Z,t){try{const zs=(await getDbPromise()).transaction(STORE_NAME,"readwrite");await zs.objectStore(STORE_NAME).put(t,computeKey(Z)),await zs.done}catch(Hs){if(Hs instanceof FirebaseError)logger.warn(Hs.message);else{const zs=ERROR_FACTORY.create("idb-set",{originalErrorMessage:Hs==null?void 0:Hs.message});logger.warn(zs.message)}}}function computeKey(Z){return`${Z.name}!${Z.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MAX_HEADER_BYTES=1024,MAX_NUM_STORED_HEARTBEATS=30;class HeartbeatServiceImpl{constructor(t){this.container=t,this._heartbeatsCache=null;const Hs=this.container.getProvider("app").getImmediate();this._storage=new HeartbeatStorageImpl(Hs),this._heartbeatsCachePromise=this._storage.read().then(zs=>(this._heartbeatsCache=zs,zs))}async triggerHeartbeat(){var t,Hs;try{const Ys=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),Zs=getUTCDateString();if(((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((Hs=this._heartbeatsCache)==null?void 0:Hs.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===Zs||this._heartbeatsCache.heartbeats.some(_u=>_u.date===Zs))return;if(this._heartbeatsCache.heartbeats.push({date:Zs,agent:Ys}),this._heartbeatsCache.heartbeats.length>MAX_NUM_STORED_HEARTBEATS){const _u=getEarliestHeartbeatIdx(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(_u,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(zs){logger.warn(zs)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const Hs=getUTCDateString(),{heartbeatsToSend:zs,unsentEntries:Ys}=extractHeartbeatsForHeader(this._heartbeatsCache.heartbeats),Zs=base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:zs}));return this._heartbeatsCache.lastSentHeartbeatDate=Hs,Ys.length>0?(this._heartbeatsCache.heartbeats=Ys,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),Zs}catch(Hs){return logger.warn(Hs),""}}}function getUTCDateString(){return new Date().toISOString().substring(0,10)}function extractHeartbeatsForHeader(Z,t=MAX_HEADER_BYTES){const Hs=[];let zs=Z.slice();for(const Ys of Z){const Zs=Hs.find(_u=>_u.agent===Ys.agent);if(Zs){if(Zs.dates.push(Ys.date),countBytes(Hs)>t){Zs.dates.pop();break}}else if(Hs.push({agent:Ys.agent,dates:[Ys.date]}),countBytes(Hs)>t){Hs.pop();break}zs=zs.slice(1)}return{heartbeatsToSend:Hs,unsentEntries:zs}}class HeartbeatStorageImpl{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return isIndexedDBAvailable()?validateIndexedDBOpenable().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const Hs=await readHeartbeatsFromIndexedDB(this.app);return Hs!=null&&Hs.heartbeats?Hs:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const zs=await this.read();return writeHeartbeatsToIndexedDB(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??zs.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const zs=await this.read();return writeHeartbeatsToIndexedDB(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??zs.lastSentHeartbeatDate,heartbeats:[...zs.heartbeats,...t.heartbeats]})}else return}}function countBytes(Z){return base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:Z})).length}function getEarliestHeartbeatIdx(Z){if(Z.length===0)return-1;let t=0,Hs=Z[0].date;for(let zs=1;zs<Z.length;zs++)Z[zs].date<Hs&&(Hs=Z[zs].date,t=zs);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function registerCoreComponents(Z){_registerComponent(new Component("platform-logger",t=>new PlatformLoggerServiceImpl(t),"PRIVATE")),_registerComponent(new Component("heartbeat",t=>new HeartbeatServiceImpl(t),"PRIVATE")),registerVersion(name$q,version$1,Z),registerVersion(name$q,version$1,"esm2020"),registerVersion("fire-js","")}registerCoreComponents("");var name="firebase",version="12.8.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */registerVersion(name,version,"app");var commonjsGlobal$1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Integer,Md5;(function(){var Z;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(ju,ku){function Uu(){}Uu.prototype=ku.prototype,ju.F=ku.prototype,ju.prototype=new Uu,ju.prototype.constructor=ju,ju.D=function(Gu,Yu,Qu){for(var Lu=Array(arguments.length-2),cl=2;cl<arguments.length;cl++)Lu[cl-2]=arguments[cl];return ku.prototype[Yu].apply(Gu,Lu)}}function Hs(){this.blockSize=-1}function zs(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}t(zs,Hs),zs.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function Ys(ju,ku,Uu){Uu||(Uu=0);const Gu=Array(16);if(typeof ku=="string")for(var Yu=0;Yu<16;++Yu)Gu[Yu]=ku.charCodeAt(Uu++)|ku.charCodeAt(Uu++)<<8|ku.charCodeAt(Uu++)<<16|ku.charCodeAt(Uu++)<<24;else for(Yu=0;Yu<16;++Yu)Gu[Yu]=ku[Uu++]|ku[Uu++]<<8|ku[Uu++]<<16|ku[Uu++]<<24;ku=ju.g[0],Uu=ju.g[1],Yu=ju.g[2];let Qu=ju.g[3],Lu;Lu=ku+(Qu^Uu&(Yu^Qu))+Gu[0]+3614090360&4294967295,ku=Uu+(Lu<<7&4294967295|Lu>>>25),Lu=Qu+(Yu^ku&(Uu^Yu))+Gu[1]+3905402710&4294967295,Qu=ku+(Lu<<12&4294967295|Lu>>>20),Lu=Yu+(Uu^Qu&(ku^Uu))+Gu[2]+606105819&4294967295,Yu=Qu+(Lu<<17&4294967295|Lu>>>15),Lu=Uu+(ku^Yu&(Qu^ku))+Gu[3]+3250441966&4294967295,Uu=Yu+(Lu<<22&4294967295|Lu>>>10),Lu=ku+(Qu^Uu&(Yu^Qu))+Gu[4]+4118548399&4294967295,ku=Uu+(Lu<<7&4294967295|Lu>>>25),Lu=Qu+(Yu^ku&(Uu^Yu))+Gu[5]+1200080426&4294967295,Qu=ku+(Lu<<12&4294967295|Lu>>>20),Lu=Yu+(Uu^Qu&(ku^Uu))+Gu[6]+2821735955&4294967295,Yu=Qu+(Lu<<17&4294967295|Lu>>>15),Lu=Uu+(ku^Yu&(Qu^ku))+Gu[7]+4249261313&4294967295,Uu=Yu+(Lu<<22&4294967295|Lu>>>10),Lu=ku+(Qu^Uu&(Yu^Qu))+Gu[8]+1770035416&4294967295,ku=Uu+(Lu<<7&4294967295|Lu>>>25),Lu=Qu+(Yu^ku&(Uu^Yu))+Gu[9]+2336552879&4294967295,Qu=ku+(Lu<<12&4294967295|Lu>>>20),Lu=Yu+(Uu^Qu&(ku^Uu))+Gu[10]+4294925233&4294967295,Yu=Qu+(Lu<<17&4294967295|Lu>>>15),Lu=Uu+(ku^Yu&(Qu^ku))+Gu[11]+2304563134&4294967295,Uu=Yu+(Lu<<22&4294967295|Lu>>>10),Lu=ku+(Qu^Uu&(Yu^Qu))+Gu[12]+1804603682&4294967295,ku=Uu+(Lu<<7&4294967295|Lu>>>25),Lu=Qu+(Yu^ku&(Uu^Yu))+Gu[13]+4254626195&4294967295,Qu=ku+(Lu<<12&4294967295|Lu>>>20),Lu=Yu+(Uu^Qu&(ku^Uu))+Gu[14]+2792965006&4294967295,Yu=Qu+(Lu<<17&4294967295|Lu>>>15),Lu=Uu+(ku^Yu&(Qu^ku))+Gu[15]+1236535329&4294967295,Uu=Yu+(Lu<<22&4294967295|Lu>>>10),Lu=ku+(Yu^Qu&(Uu^Yu))+Gu[1]+4129170786&4294967295,ku=Uu+(Lu<<5&4294967295|Lu>>>27),Lu=Qu+(Uu^Yu&(ku^Uu))+Gu[6]+3225465664&4294967295,Qu=ku+(Lu<<9&4294967295|Lu>>>23),Lu=Yu+(ku^Uu&(Qu^ku))+Gu[11]+643717713&4294967295,Yu=Qu+(Lu<<14&4294967295|Lu>>>18),Lu=Uu+(Qu^ku&(Yu^Qu))+Gu[0]+3921069994&4294967295,Uu=Yu+(Lu<<20&4294967295|Lu>>>12),Lu=ku+(Yu^Qu&(Uu^Yu))+Gu[5]+3593408605&4294967295,ku=Uu+(Lu<<5&4294967295|Lu>>>27),Lu=Qu+(Uu^Yu&(ku^Uu))+Gu[10]+38016083&4294967295,Qu=ku+(Lu<<9&4294967295|Lu>>>23),Lu=Yu+(ku^Uu&(Qu^ku))+Gu[15]+3634488961&4294967295,Yu=Qu+(Lu<<14&4294967295|Lu>>>18),Lu=Uu+(Qu^ku&(Yu^Qu))+Gu[4]+3889429448&4294967295,Uu=Yu+(Lu<<20&4294967295|Lu>>>12),Lu=ku+(Yu^Qu&(Uu^Yu))+Gu[9]+568446438&4294967295,ku=Uu+(Lu<<5&4294967295|Lu>>>27),Lu=Qu+(Uu^Yu&(ku^Uu))+Gu[14]+3275163606&4294967295,Qu=ku+(Lu<<9&4294967295|Lu>>>23),Lu=Yu+(ku^Uu&(Qu^ku))+Gu[3]+4107603335&4294967295,Yu=Qu+(Lu<<14&4294967295|Lu>>>18),Lu=Uu+(Qu^ku&(Yu^Qu))+Gu[8]+1163531501&4294967295,Uu=Yu+(Lu<<20&4294967295|Lu>>>12),Lu=ku+(Yu^Qu&(Uu^Yu))+Gu[13]+2850285829&4294967295,ku=Uu+(Lu<<5&4294967295|Lu>>>27),Lu=Qu+(Uu^Yu&(ku^Uu))+Gu[2]+4243563512&4294967295,Qu=ku+(Lu<<9&4294967295|Lu>>>23),Lu=Yu+(ku^Uu&(Qu^ku))+Gu[7]+1735328473&4294967295,Yu=Qu+(Lu<<14&4294967295|Lu>>>18),Lu=Uu+(Qu^ku&(Yu^Qu))+Gu[12]+2368359562&4294967295,Uu=Yu+(Lu<<20&4294967295|Lu>>>12),Lu=ku+(Uu^Yu^Qu)+Gu[5]+4294588738&4294967295,ku=Uu+(Lu<<4&4294967295|Lu>>>28),Lu=Qu+(ku^Uu^Yu)+Gu[8]+2272392833&4294967295,Qu=ku+(Lu<<11&4294967295|Lu>>>21),Lu=Yu+(Qu^ku^Uu)+Gu[11]+1839030562&4294967295,Yu=Qu+(Lu<<16&4294967295|Lu>>>16),Lu=Uu+(Yu^Qu^ku)+Gu[14]+4259657740&4294967295,Uu=Yu+(Lu<<23&4294967295|Lu>>>9),Lu=ku+(Uu^Yu^Qu)+Gu[1]+2763975236&4294967295,ku=Uu+(Lu<<4&4294967295|Lu>>>28),Lu=Qu+(ku^Uu^Yu)+Gu[4]+1272893353&4294967295,Qu=ku+(Lu<<11&4294967295|Lu>>>21),Lu=Yu+(Qu^ku^Uu)+Gu[7]+4139469664&4294967295,Yu=Qu+(Lu<<16&4294967295|Lu>>>16),Lu=Uu+(Yu^Qu^ku)+Gu[10]+3200236656&4294967295,Uu=Yu+(Lu<<23&4294967295|Lu>>>9),Lu=ku+(Uu^Yu^Qu)+Gu[13]+681279174&4294967295,ku=Uu+(Lu<<4&4294967295|Lu>>>28),Lu=Qu+(ku^Uu^Yu)+Gu[0]+3936430074&4294967295,Qu=ku+(Lu<<11&4294967295|Lu>>>21),Lu=Yu+(Qu^ku^Uu)+Gu[3]+3572445317&4294967295,Yu=Qu+(Lu<<16&4294967295|Lu>>>16),Lu=Uu+(Yu^Qu^ku)+Gu[6]+76029189&4294967295,Uu=Yu+(Lu<<23&4294967295|Lu>>>9),Lu=ku+(Uu^Yu^Qu)+Gu[9]+3654602809&4294967295,ku=Uu+(Lu<<4&4294967295|Lu>>>28),Lu=Qu+(ku^Uu^Yu)+Gu[12]+3873151461&4294967295,Qu=ku+(Lu<<11&4294967295|Lu>>>21),Lu=Yu+(Qu^ku^Uu)+Gu[15]+530742520&4294967295,Yu=Qu+(Lu<<16&4294967295|Lu>>>16),Lu=Uu+(Yu^Qu^ku)+Gu[2]+3299628645&4294967295,Uu=Yu+(Lu<<23&4294967295|Lu>>>9),Lu=ku+(Yu^(Uu|~Qu))+Gu[0]+4096336452&4294967295,ku=Uu+(Lu<<6&4294967295|Lu>>>26),Lu=Qu+(Uu^(ku|~Yu))+Gu[7]+1126891415&4294967295,Qu=ku+(Lu<<10&4294967295|Lu>>>22),Lu=Yu+(ku^(Qu|~Uu))+Gu[14]+2878612391&4294967295,Yu=Qu+(Lu<<15&4294967295|Lu>>>17),Lu=Uu+(Qu^(Yu|~ku))+Gu[5]+4237533241&4294967295,Uu=Yu+(Lu<<21&4294967295|Lu>>>11),Lu=ku+(Yu^(Uu|~Qu))+Gu[12]+1700485571&4294967295,ku=Uu+(Lu<<6&4294967295|Lu>>>26),Lu=Qu+(Uu^(ku|~Yu))+Gu[3]+2399980690&4294967295,Qu=ku+(Lu<<10&4294967295|Lu>>>22),Lu=Yu+(ku^(Qu|~Uu))+Gu[10]+4293915773&4294967295,Yu=Qu+(Lu<<15&4294967295|Lu>>>17),Lu=Uu+(Qu^(Yu|~ku))+Gu[1]+2240044497&4294967295,Uu=Yu+(Lu<<21&4294967295|Lu>>>11),Lu=ku+(Yu^(Uu|~Qu))+Gu[8]+1873313359&4294967295,ku=Uu+(Lu<<6&4294967295|Lu>>>26),Lu=Qu+(Uu^(ku|~Yu))+Gu[15]+4264355552&4294967295,Qu=ku+(Lu<<10&4294967295|Lu>>>22),Lu=Yu+(ku^(Qu|~Uu))+Gu[6]+2734768916&4294967295,Yu=Qu+(Lu<<15&4294967295|Lu>>>17),Lu=Uu+(Qu^(Yu|~ku))+Gu[13]+1309151649&4294967295,Uu=Yu+(Lu<<21&4294967295|Lu>>>11),Lu=ku+(Yu^(Uu|~Qu))+Gu[4]+4149444226&4294967295,ku=Uu+(Lu<<6&4294967295|Lu>>>26),Lu=Qu+(Uu^(ku|~Yu))+Gu[11]+3174756917&4294967295,Qu=ku+(Lu<<10&4294967295|Lu>>>22),Lu=Yu+(ku^(Qu|~Uu))+Gu[2]+718787259&4294967295,Yu=Qu+(Lu<<15&4294967295|Lu>>>17),Lu=Uu+(Qu^(Yu|~ku))+Gu[9]+3951481745&4294967295,ju.g[0]=ju.g[0]+ku&4294967295,ju.g[1]=ju.g[1]+(Yu+(Lu<<21&4294967295|Lu>>>11))&4294967295,ju.g[2]=ju.g[2]+Yu&4294967295,ju.g[3]=ju.g[3]+Qu&4294967295}zs.prototype.v=function(ju,ku){ku===void 0&&(ku=ju.length);const Uu=ku-this.blockSize,Gu=this.C;let Yu=this.h,Qu=0;for(;Qu<ku;){if(Yu==0)for(;Qu<=Uu;)Ys(this,ju,Qu),Qu+=this.blockSize;if(typeof ju=="string"){for(;Qu<ku;)if(Gu[Yu++]=ju.charCodeAt(Qu++),Yu==this.blockSize){Ys(this,Gu),Yu=0;break}}else for(;Qu<ku;)if(Gu[Yu++]=ju[Qu++],Yu==this.blockSize){Ys(this,Gu),Yu=0;break}}this.h=Yu,this.o+=ku},zs.prototype.A=function(){var ju=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);ju[0]=128;for(var ku=1;ku<ju.length-8;++ku)ju[ku]=0;ku=this.o*8;for(var Uu=ju.length-8;Uu<ju.length;++Uu)ju[Uu]=ku&255,ku/=256;for(this.v(ju),ju=Array(16),ku=0,Uu=0;Uu<4;++Uu)for(let Gu=0;Gu<32;Gu+=8)ju[ku++]=this.g[Uu]>>>Gu&255;return ju};function Zs(ju,ku){var Uu=Eu;return Object.prototype.hasOwnProperty.call(Uu,ju)?Uu[ju]:Uu[ju]=ku(ju)}function _u(ju,ku){this.h=ku;const Uu=[];let Gu=!0;for(let Yu=ju.length-1;Yu>=0;Yu--){const Qu=ju[Yu]|0;Gu&&Qu==ku||(Uu[Yu]=Qu,Gu=!1)}this.g=Uu}var Eu={};function Iu(ju){return-128<=ju&&ju<128?Zs(ju,function(ku){return new _u([ku|0],ku<0?-1:0)}):new _u([ju|0],ju<0?-1:0)}function Au(ju){if(isNaN(ju)||!isFinite(ju))return vu;if(ju<0)return Bu(Au(-ju));const ku=[];let Uu=1;for(let Gu=0;ju>=Uu;Gu++)ku[Gu]=ju/Uu|0,Uu*=4294967296;return new _u(ku,0)}function $u(ju,ku){if(ju.length==0)throw Error("number format error: empty string");if(ku=ku||10,ku<2||36<ku)throw Error("radix out of range: "+ku);if(ju.charAt(0)=="-")return Bu($u(ju.substring(1),ku));if(ju.indexOf("-")>=0)throw Error('number format error: interior "-" character');const Uu=Au(Math.pow(ku,8));let Gu=vu;for(let Qu=0;Qu<ju.length;Qu+=8){var Yu=Math.min(8,ju.length-Qu);const Lu=parseInt(ju.substring(Qu,Qu+Yu),ku);Yu<8?(Yu=Au(Math.pow(ku,Yu)),Gu=Gu.j(Yu).add(Au(Lu))):(Gu=Gu.j(Uu),Gu=Gu.add(Au(Lu)))}return Gu}var vu=Iu(0),Su=Iu(1),Ru=Iu(16777216);Z=_u.prototype,Z.m=function(){if(Cu(this))return-Bu(this).m();let ju=0,ku=1;for(let Uu=0;Uu<this.g.length;Uu++){const Gu=this.i(Uu);ju+=(Gu>=0?Gu:4294967296+Gu)*ku,ku*=4294967296}return ju},Z.toString=function(ju){if(ju=ju||10,ju<2||36<ju)throw Error("radix out of range: "+ju);if(Pu(this))return"0";if(Cu(this))return"-"+Bu(this).toString(ju);const ku=Au(Math.pow(ju,6));var Uu=this;let Gu="";for(;;){const Yu=Wu(Uu,ku).g;Uu=Fu(Uu,Yu.j(ku));let Qu=((Uu.g.length>0?Uu.g[0]:Uu.h)>>>0).toString(ju);if(Uu=Yu,Pu(Uu))return Qu+Gu;for(;Qu.length<6;)Qu="0"+Qu;Gu=Qu+Gu}},Z.i=function(ju){return ju<0?0:ju<this.g.length?this.g[ju]:this.h};function Pu(ju){if(ju.h!=0)return!1;for(let ku=0;ku<ju.g.length;ku++)if(ju.g[ku]!=0)return!1;return!0}function Cu(ju){return ju.h==-1}Z.l=function(ju){return ju=Fu(this,ju),Cu(ju)?-1:Pu(ju)?0:1};function Bu(ju){const ku=ju.g.length,Uu=[];for(let Gu=0;Gu<ku;Gu++)Uu[Gu]=~ju.g[Gu];return new _u(Uu,~ju.h).add(Su)}Z.abs=function(){return Cu(this)?Bu(this):this},Z.add=function(ju){const ku=Math.max(this.g.length,ju.g.length),Uu=[];let Gu=0;for(let Yu=0;Yu<=ku;Yu++){let Qu=Gu+(this.i(Yu)&65535)+(ju.i(Yu)&65535),Lu=(Qu>>>16)+(this.i(Yu)>>>16)+(ju.i(Yu)>>>16);Gu=Lu>>>16,Qu&=65535,Lu&=65535,Uu[Yu]=Lu<<16|Qu}return new _u(Uu,Uu[Uu.length-1]&-2147483648?-1:0)};function Fu(ju,ku){return ju.add(Bu(ku))}Z.j=function(ju){if(Pu(this)||Pu(ju))return vu;if(Cu(this))return Cu(ju)?Bu(this).j(Bu(ju)):Bu(Bu(this).j(ju));if(Cu(ju))return Bu(this.j(Bu(ju)));if(this.l(Ru)<0&&ju.l(Ru)<0)return Au(this.m()*ju.m());const ku=this.g.length+ju.g.length,Uu=[];for(var Gu=0;Gu<2*ku;Gu++)Uu[Gu]=0;for(Gu=0;Gu<this.g.length;Gu++)for(let Yu=0;Yu<ju.g.length;Yu++){const Qu=this.i(Gu)>>>16,Lu=this.i(Gu)&65535,cl=ju.i(Yu)>>>16,el=ju.i(Yu)&65535;Uu[2*Gu+2*Yu]+=Lu*el,zu(Uu,2*Gu+2*Yu),Uu[2*Gu+2*Yu+1]+=Qu*el,zu(Uu,2*Gu+2*Yu+1),Uu[2*Gu+2*Yu+1]+=Lu*cl,zu(Uu,2*Gu+2*Yu+1),Uu[2*Gu+2*Yu+2]+=Qu*cl,zu(Uu,2*Gu+2*Yu+2)}for(ju=0;ju<ku;ju++)Uu[ju]=Uu[2*ju+1]<<16|Uu[2*ju];for(ju=ku;ju<2*ku;ju++)Uu[ju]=0;return new _u(Uu,0)};function zu(ju,ku){for(;(ju[ku]&65535)!=ju[ku];)ju[ku+1]+=ju[ku]>>>16,ju[ku]&=65535,ku++}function Hu(ju,ku){this.g=ju,this.h=ku}function Wu(ju,ku){if(Pu(ku))throw Error("division by zero");if(Pu(ju))return new Hu(vu,vu);if(Cu(ju))return ku=Wu(Bu(ju),ku),new Hu(Bu(ku.g),Bu(ku.h));if(Cu(ku))return ku=Wu(ju,Bu(ku)),new Hu(Bu(ku.g),ku.h);if(ju.g.length>30){if(Cu(ju)||Cu(ku))throw Error("slowDivide_ only works with positive integers.");for(var Uu=Su,Gu=ku;Gu.l(ju)<=0;)Uu=tl(Uu),Gu=tl(Gu);var Yu=Xu(Uu,1),Qu=Xu(Gu,1);for(Gu=Xu(Gu,2),Uu=Xu(Uu,2);!Pu(Gu);){var Lu=Qu.add(Gu);Lu.l(ju)<=0&&(Yu=Yu.add(Uu),Qu=Lu),Gu=Xu(Gu,1),Uu=Xu(Uu,1)}return ku=Fu(ju,Yu.j(ku)),new Hu(Yu,ku)}for(Yu=vu;ju.l(ku)>=0;){for(Uu=Math.max(1,Math.floor(ju.m()/ku.m())),Gu=Math.ceil(Math.log(Uu)/Math.LN2),Gu=Gu<=48?1:Math.pow(2,Gu-48),Qu=Au(Uu),Lu=Qu.j(ku);Cu(Lu)||Lu.l(ju)>0;)Uu-=Gu,Qu=Au(Uu),Lu=Qu.j(ku);Pu(Qu)&&(Qu=Su),Yu=Yu.add(Qu),ju=Fu(ju,Lu)}return new Hu(Yu,ju)}Z.B=function(ju){return Wu(this,ju).h},Z.and=function(ju){const ku=Math.max(this.g.length,ju.g.length),Uu=[];for(let Gu=0;Gu<ku;Gu++)Uu[Gu]=this.i(Gu)&ju.i(Gu);return new _u(Uu,this.h&ju.h)},Z.or=function(ju){const ku=Math.max(this.g.length,ju.g.length),Uu=[];for(let Gu=0;Gu<ku;Gu++)Uu[Gu]=this.i(Gu)|ju.i(Gu);return new _u(Uu,this.h|ju.h)},Z.xor=function(ju){const ku=Math.max(this.g.length,ju.g.length),Uu=[];for(let Gu=0;Gu<ku;Gu++)Uu[Gu]=this.i(Gu)^ju.i(Gu);return new _u(Uu,this.h^ju.h)};function tl(ju){const ku=ju.g.length+1,Uu=[];for(let Gu=0;Gu<ku;Gu++)Uu[Gu]=ju.i(Gu)<<1|ju.i(Gu-1)>>>31;return new _u(Uu,ju.h)}function Xu(ju,ku){const Uu=ku>>5;ku%=32;const Gu=ju.g.length-Uu,Yu=[];for(let Qu=0;Qu<Gu;Qu++)Yu[Qu]=ku>0?ju.i(Qu+Uu)>>>ku|ju.i(Qu+Uu+1)<<32-ku:ju.i(Qu+Uu);return new _u(Yu,ju.h)}zs.prototype.digest=zs.prototype.A,zs.prototype.reset=zs.prototype.u,zs.prototype.update=zs.prototype.v,Md5=zs,_u.prototype.add=_u.prototype.add,_u.prototype.multiply=_u.prototype.j,_u.prototype.modulo=_u.prototype.B,_u.prototype.compare=_u.prototype.l,_u.prototype.toNumber=_u.prototype.m,_u.prototype.toString=_u.prototype.toString,_u.prototype.getBits=_u.prototype.i,_u.fromNumber=Au,_u.fromString=$u,Integer=_u}).apply(typeof commonjsGlobal$1<"u"?commonjsGlobal$1:typeof self<"u"?self:typeof window<"u"?window:{});var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var XhrIo,WebChannel,EventType,ErrorCode,Stat,Event$1,getStatEventTarget,createWebChannelTransport;(function(){var Z,t=Object.defineProperty;function Hs(Tu){Tu=[typeof globalThis=="object"&&globalThis,Tu,typeof window=="object"&&window,typeof self=="object"&&self,typeof commonjsGlobal=="object"&&commonjsGlobal];for(var Du=0;Du<Tu.length;++Du){var Mu=Tu[Du];if(Mu&&Mu.Math==Math)return Mu}throw Error("Cannot find globalThis object")}var zs=Hs(this);function Ys(Tu,Du){if(Du)e:{var Mu=zs;Tu=Tu.split(".");for(var Ju=0;Ju<Tu.length-1;Ju++){var vl=Tu[Ju];if(!(vl in Mu))break e;Mu=Mu[vl]}Tu=Tu[Tu.length-1],Ju=Mu[Tu],Du=Du(Ju),Du!=Ju&&Du!=null&&t(Mu,Tu,{configurable:!0,writable:!0,value:Du})}}Ys("Symbol.dispose",function(Tu){return Tu||Symbol("Symbol.dispose")}),Ys("Array.prototype.values",function(Tu){return Tu||function(){return this[Symbol.iterator]()}}),Ys("Object.entries",function(Tu){return Tu||function(Du){var Mu=[],Ju;for(Ju in Du)Object.prototype.hasOwnProperty.call(Du,Ju)&&Mu.push([Ju,Du[Ju]]);return Mu}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var Zs=Zs||{},_u=this||self;function Eu(Tu){var Du=typeof Tu;return Du=="object"&&Tu!=null||Du=="function"}function Iu(Tu,Du,Mu){return Tu.call.apply(Tu.bind,arguments)}function Au(Tu,Du,Mu){return Au=Iu,Au.apply(null,arguments)}function $u(Tu,Du){var Mu=Array.prototype.slice.call(arguments,1);return function(){var Ju=Mu.slice();return Ju.push.apply(Ju,arguments),Tu.apply(this,Ju)}}function vu(Tu,Du){function Mu(){}Mu.prototype=Du.prototype,Tu.Z=Du.prototype,Tu.prototype=new Mu,Tu.prototype.constructor=Tu,Tu.Ob=function(Ju,vl,Pl){for(var Vl=Array(arguments.length-2),Jl=2;Jl<arguments.length;Jl++)Vl[Jl-2]=arguments[Jl];return Du.prototype[vl].apply(Ju,Vl)}}var Su=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?Tu=>Tu&&AsyncContext.Snapshot.wrap(Tu):Tu=>Tu;function Ru(Tu){const Du=Tu.length;if(Du>0){const Mu=Array(Du);for(let Ju=0;Ju<Du;Ju++)Mu[Ju]=Tu[Ju];return Mu}return[]}function Pu(Tu,Du){for(let Ju=1;Ju<arguments.length;Ju++){const vl=arguments[Ju];var Mu=typeof vl;if(Mu=Mu!="object"?Mu:vl?Array.isArray(vl)?"array":Mu:"null",Mu=="array"||Mu=="object"&&typeof vl.length=="number"){Mu=Tu.length||0;const Pl=vl.length||0;Tu.length=Mu+Pl;for(let Vl=0;Vl<Pl;Vl++)Tu[Mu+Vl]=vl[Vl]}else Tu.push(vl)}}class Cu{constructor(Du,Mu){this.i=Du,this.j=Mu,this.h=0,this.g=null}get(){let Du;return this.h>0?(this.h--,Du=this.g,this.g=Du.next,Du.next=null):Du=this.i(),Du}}function Bu(Tu){_u.setTimeout(()=>{throw Tu},0)}function Fu(){var Tu=ju;let Du=null;return Tu.g&&(Du=Tu.g,Tu.g=Tu.g.next,Tu.g||(Tu.h=null),Du.next=null),Du}class zu{constructor(){this.h=this.g=null}add(Du,Mu){const Ju=Hu.get();Ju.set(Du,Mu),this.h?this.h.next=Ju:this.g=Ju,this.h=Ju}}var Hu=new Cu(()=>new Wu,Tu=>Tu.reset());class Wu{constructor(){this.next=this.g=this.h=null}set(Du,Mu){this.h=Du,this.g=Mu,this.next=null}reset(){this.next=this.g=this.h=null}}let tl,Xu=!1,ju=new zu,ku=()=>{const Tu=Promise.resolve(void 0);tl=()=>{Tu.then(Uu)}};function Uu(){for(var Tu;Tu=Fu();){try{Tu.h.call(Tu.g)}catch(Mu){Bu(Mu)}var Du=Hu;Du.j(Tu),Du.h<100&&(Du.h++,Tu.next=Du.g,Du.g=Tu)}Xu=!1}function Gu(){this.u=this.u,this.C=this.C}Gu.prototype.u=!1,Gu.prototype.dispose=function(){this.u||(this.u=!0,this.N())},Gu.prototype[Symbol.dispose]=function(){this.dispose()},Gu.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Yu(Tu,Du){this.type=Tu,this.g=this.target=Du,this.defaultPrevented=!1}Yu.prototype.h=function(){this.defaultPrevented=!0};var Qu=function(){if(!_u.addEventListener||!Object.defineProperty)return!1;var Tu=!1,Du=Object.defineProperty({},"passive",{get:function(){Tu=!0}});try{const Mu=()=>{};_u.addEventListener("test",Mu,Du),_u.removeEventListener("test",Mu,Du)}catch{}return Tu}();function Lu(Tu){return/^[\s\xa0]*$/.test(Tu)}function cl(Tu,Du){Yu.call(this,Tu?Tu.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,Tu&&this.init(Tu,Du)}vu(cl,Yu),cl.prototype.init=function(Tu,Du){const Mu=this.type=Tu.type,Ju=Tu.changedTouches&&Tu.changedTouches.length?Tu.changedTouches[0]:null;this.target=Tu.target||Tu.srcElement,this.g=Du,Du=Tu.relatedTarget,Du||(Mu=="mouseover"?Du=Tu.fromElement:Mu=="mouseout"&&(Du=Tu.toElement)),this.relatedTarget=Du,Ju?(this.clientX=Ju.clientX!==void 0?Ju.clientX:Ju.pageX,this.clientY=Ju.clientY!==void 0?Ju.clientY:Ju.pageY,this.screenX=Ju.screenX||0,this.screenY=Ju.screenY||0):(this.clientX=Tu.clientX!==void 0?Tu.clientX:Tu.pageX,this.clientY=Tu.clientY!==void 0?Tu.clientY:Tu.pageY,this.screenX=Tu.screenX||0,this.screenY=Tu.screenY||0),this.button=Tu.button,this.key=Tu.key||"",this.ctrlKey=Tu.ctrlKey,this.altKey=Tu.altKey,this.shiftKey=Tu.shiftKey,this.metaKey=Tu.metaKey,this.pointerId=Tu.pointerId||0,this.pointerType=Tu.pointerType,this.state=Tu.state,this.i=Tu,Tu.defaultPrevented&&cl.Z.h.call(this)},cl.prototype.h=function(){cl.Z.h.call(this);const Tu=this.i;Tu.preventDefault?Tu.preventDefault():Tu.returnValue=!1};var el="closure_listenable_"+(Math.random()*1e6|0),Zu=0;function dl(Tu,Du,Mu,Ju,vl){this.listener=Tu,this.proxy=null,this.src=Du,this.type=Mu,this.capture=!!Ju,this.ha=vl,this.key=++Zu,this.da=this.fa=!1}function El(Tu){Tu.da=!0,Tu.listener=null,Tu.proxy=null,Tu.src=null,Tu.ha=null}function hl(Tu,Du,Mu){for(const Ju in Tu)Du.call(Mu,Tu[Ju],Ju,Tu)}function _l(Tu,Du){for(const Mu in Tu)Du.call(void 0,Tu[Mu],Mu,Tu)}function Rl(Tu){const Du={};for(const Mu in Tu)Du[Mu]=Tu[Mu];return Du}const ol="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function gl(Tu,Du){let Mu,Ju;for(let vl=1;vl<arguments.length;vl++){Ju=arguments[vl];for(Mu in Ju)Tu[Mu]=Ju[Mu];for(let Pl=0;Pl<ol.length;Pl++)Mu=ol[Pl],Object.prototype.hasOwnProperty.call(Ju,Mu)&&(Tu[Mu]=Ju[Mu])}}function nl(Tu){this.src=Tu,this.g={},this.h=0}nl.prototype.add=function(Tu,Du,Mu,Ju,vl){const Pl=Tu.toString();Tu=this.g[Pl],Tu||(Tu=this.g[Pl]=[],this.h++);const Vl=ll(Tu,Du,Ju,vl);return Vl>-1?(Du=Tu[Vl],Mu||(Du.fa=!1)):(Du=new dl(Du,this.src,Pl,!!Ju,vl),Du.fa=Mu,Tu.push(Du)),Du};function Sl(Tu,Du){const Mu=Du.type;if(Mu in Tu.g){var Ju=Tu.g[Mu],vl=Array.prototype.indexOf.call(Ju,Du,void 0),Pl;(Pl=vl>=0)&&Array.prototype.splice.call(Ju,vl,1),Pl&&(El(Du),Tu.g[Mu].length==0&&(delete Tu.g[Mu],Tu.h--))}}function ll(Tu,Du,Mu,Ju){for(let vl=0;vl<Tu.length;++vl){const Pl=Tu[vl];if(!Pl.da&&Pl.listener==Du&&Pl.capture==!!Mu&&Pl.ha==Ju)return vl}return-1}var ul="closure_lm_"+(Math.random()*1e6|0),Al={};function Tl(Tu,Du,Mu,Ju,vl){if(Ju&&Ju.once)return Vu(Tu,Du,Mu,Ju,vl);if(Array.isArray(Du)){for(let Pl=0;Pl<Du.length;Pl++)Tl(Tu,Du[Pl],Mu,Ju,vl);return null}return Mu=al(Mu),Tu&&Tu[el]?Tu.J(Du,Mu,Eu(Ju)?!!Ju.capture:!!Ju,vl):qu(Tu,Du,Mu,!1,Ju,vl)}function qu(Tu,Du,Mu,Ju,vl,Pl){if(!Du)throw Error("Invalid event type");const Vl=Eu(vl)?!!vl.capture:!!vl;let Jl=fl(Tu);if(Jl||(Tu[ul]=Jl=new nl(Tu)),Mu=Jl.add(Du,Mu,Ju,Vl,Pl),Mu.proxy)return Mu;if(Ju=Ou(),Mu.proxy=Ju,Ju.src=Tu,Ju.listener=Mu,Tu.addEventListener)Qu||(vl=Vl),vl===void 0&&(vl=!1),Tu.addEventListener(Du.toString(),Ju,vl);else if(Tu.attachEvent)Tu.attachEvent(pl(Du.toString()),Ju);else if(Tu.addListener&&Tu.removeListener)Tu.addListener(Ju);else throw Error("addEventListener and attachEvent are unavailable.");return Mu}function Ou(){function Tu(Mu){return Du.call(Tu.src,Tu.listener,Mu)}const Du=yl;return Tu}function Vu(Tu,Du,Mu,Ju,vl){if(Array.isArray(Du)){for(let Pl=0;Pl<Du.length;Pl++)Vu(Tu,Du[Pl],Mu,Ju,vl);return null}return Mu=al(Mu),Tu&&Tu[el]?Tu.K(Du,Mu,Eu(Ju)?!!Ju.capture:!!Ju,vl):qu(Tu,Du,Mu,!0,Ju,vl)}function il(Tu,Du,Mu,Ju,vl){if(Array.isArray(Du))for(var Pl=0;Pl<Du.length;Pl++)il(Tu,Du[Pl],Mu,Ju,vl);else Ju=Eu(Ju)?!!Ju.capture:!!Ju,Mu=al(Mu),Tu&&Tu[el]?(Tu=Tu.i,Pl=String(Du).toString(),Pl in Tu.g&&(Du=Tu.g[Pl],Mu=ll(Du,Mu,Ju,vl),Mu>-1&&(El(Du[Mu]),Array.prototype.splice.call(Du,Mu,1),Du.length==0&&(delete Tu.g[Pl],Tu.h--)))):Tu&&(Tu=fl(Tu))&&(Du=Tu.g[Du.toString()],Tu=-1,Du&&(Tu=ll(Du,Mu,Ju,vl)),(Mu=Tu>-1?Du[Tu]:null)&&sl(Mu))}function sl(Tu){if(typeof Tu!="number"&&Tu&&!Tu.da){var Du=Tu.src;if(Du&&Du[el])Sl(Du.i,Tu);else{var Mu=Tu.type,Ju=Tu.proxy;Du.removeEventListener?Du.removeEventListener(Mu,Ju,Tu.capture):Du.detachEvent?Du.detachEvent(pl(Mu),Ju):Du.addListener&&Du.removeListener&&Du.removeListener(Ju),(Mu=fl(Du))?(Sl(Mu,Tu),Mu.h==0&&(Mu.src=null,Du[ul]=null)):El(Tu)}}}function pl(Tu){return Tu in Al?Al[Tu]:Al[Tu]="on"+Tu}function yl(Tu,Du){if(Tu.da)Tu=!0;else{Du=new cl(Du,this);const Mu=Tu.listener,Ju=Tu.ha||Tu.src;Tu.fa&&sl(Tu),Tu=Mu.call(Ju,Du)}return Tu}function fl(Tu){return Tu=Tu[ul],Tu instanceof nl?Tu:null}var bl="__closure_events_fn_"+(Math.random()*1e9>>>0);function al(Tu){return typeof Tu=="function"?Tu:(Tu[bl]||(Tu[bl]=function(Du){return Tu.handleEvent(Du)}),Tu[bl])}function wl(){Gu.call(this),this.i=new nl(this),this.M=this,this.G=null}vu(wl,Gu),wl.prototype[el]=!0,wl.prototype.removeEventListener=function(Tu,Du,Mu,Ju){il(this,Tu,Du,Mu,Ju)};function Dl(Tu,Du){var Mu,Ju=Tu.G;if(Ju)for(Mu=[];Ju;Ju=Ju.G)Mu.push(Ju);if(Tu=Tu.M,Ju=Du.type||Du,typeof Du=="string")Du=new Yu(Du,Tu);else if(Du instanceof Yu)Du.target=Du.target||Tu;else{var vl=Du;Du=new Yu(Ju,Tu),gl(Du,vl)}vl=!0;let Pl,Vl;if(Mu)for(Vl=Mu.length-1;Vl>=0;Vl--)Pl=Du.g=Mu[Vl],vl=Ll(Pl,Ju,!0,Du)&&vl;if(Pl=Du.g=Tu,vl=Ll(Pl,Ju,!0,Du)&&vl,vl=Ll(Pl,Ju,!1,Du)&&vl,Mu)for(Vl=0;Vl<Mu.length;Vl++)Pl=Du.g=Mu[Vl],vl=Ll(Pl,Ju,!1,Du)&&vl}wl.prototype.N=function(){if(wl.Z.N.call(this),this.i){var Tu=this.i;for(const Du in Tu.g){const Mu=Tu.g[Du];for(let Ju=0;Ju<Mu.length;Ju++)El(Mu[Ju]);delete Tu.g[Du],Tu.h--}}this.G=null},wl.prototype.J=function(Tu,Du,Mu,Ju){return this.i.add(String(Tu),Du,!1,Mu,Ju)},wl.prototype.K=function(Tu,Du,Mu,Ju){return this.i.add(String(Tu),Du,!0,Mu,Ju)};function Ll(Tu,Du,Mu,Ju){if(Du=Tu.i.g[String(Du)],!Du)return!0;Du=Du.concat();let vl=!0;for(let Pl=0;Pl<Du.length;++Pl){const Vl=Du[Pl];if(Vl&&!Vl.da&&Vl.capture==Mu){const Jl=Vl.listener,fh=Vl.ha||Vl.src;Vl.fa&&Sl(Tu.i,Vl),vl=Jl.call(fh,Ju)!==!1&&vl}}return vl&&!Ju.defaultPrevented}function Fl(Tu,Du){if(typeof Tu!="function")if(Tu&&typeof Tu.handleEvent=="function")Tu=Au(Tu.handleEvent,Tu);else throw Error("Invalid listener argument");return Number(Du)>2147483647?-1:_u.setTimeout(Tu,Du||0)}function ql(Tu){Tu.g=Fl(()=>{Tu.g=null,Tu.i&&(Tu.i=!1,ql(Tu))},Tu.l);const Du=Tu.h;Tu.h=null,Tu.m.apply(null,Du)}class Gl extends Gu{constructor(Du,Mu){super(),this.m=Du,this.l=Mu,this.h=null,this.i=!1,this.g=null}j(Du){this.h=arguments,this.g?this.i=!0:ql(this)}N(){super.N(),this.g&&(_u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ql(Tu){Gu.call(this),this.h=Tu,this.g={}}vu(Ql,Gu);var Hl=[];function jl(Tu){hl(Tu.g,function(Du,Mu){this.g.hasOwnProperty(Mu)&&sl(Du)},Tu),Tu.g={}}Ql.prototype.N=function(){Ql.Z.N.call(this),jl(this)},Ql.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var rh=_u.JSON.stringify,Ku=_u.JSON.parse,xu=class{stringify(Tu){return _u.JSON.stringify(Tu,void 0)}parse(Tu){return _u.JSON.parse(Tu,void 0)}};function Nu(){}function rl(){}var ml={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Il(){Yu.call(this,"d")}vu(Il,Yu);function Cl(){Yu.call(this,"c")}vu(Cl,Yu);var Ml={},eh=null;function Xl(){return eh=eh||new wl}Ml.Ia="serverreachability";function th(Tu){Yu.call(this,Ml.Ia,Tu)}vu(th,Yu);function Yl(Tu){const Du=Xl();Dl(Du,new th(Du))}Ml.STAT_EVENT="statevent";function Rh(Tu,Du){Yu.call(this,Ml.STAT_EVENT,Tu),this.stat=Du}vu(Rh,Yu);function hh(Tu){const Du=Xl();Dl(Du,new Rh(Du,Tu))}Ml.Ja="timingevent";function vh(Tu,Du){Yu.call(this,Ml.Ja,Tu),this.size=Du}vu(vh,Yu);function _h(Tu,Du){if(typeof Tu!="function")throw Error("Fn must not be null and must be a function");return _u.setTimeout(function(){Tu()},Du)}function $l(){this.g=!0}$l.prototype.ua=function(){this.g=!1};function Bl(Tu,Du,Mu,Ju,vl,Pl){Tu.info(function(){if(Tu.g)if(Pl){var Vl="",Jl=Pl.split("&");for(let sh=0;sh<Jl.length;sh++){var fh=Jl[sh].split("=");if(fh.length>1){const ph=fh[0];fh=fh[1];const $h=ph.split("_");Vl=$h.length>=2&&$h[1]=="type"?Vl+(ph+"="+fh+"&"):Vl+(ph+"=redacted&")}}}else Vl=null;else Vl=Pl;return"XMLHTTP REQ ("+Ju+") [attempt "+vl+"]: "+Du+`
`+Mu+`
`+Vl})}function xl(Tu,Du,Mu,Ju,vl,Pl,Vl){Tu.info(function(){return"XMLHTTP RESP ("+Ju+") [ attempt "+vl+"]: "+Du+`
`+Mu+`
`+Pl+" "+Vl})}function Ol(Tu,Du,Mu,Ju){Tu.info(function(){return"XMLHTTP TEXT ("+Du+"): "+kl(Tu,Mu)+(Ju?" "+Ju:"")})}function Nl(Tu,Du){Tu.info(function(){return"TIMEOUT: "+Du})}$l.prototype.info=function(){};function kl(Tu,Du){if(!Tu.g)return Du;if(!Du)return null;try{const Pl=JSON.parse(Du);if(Pl){for(Tu=0;Tu<Pl.length;Tu++)if(Array.isArray(Pl[Tu])){var Mu=Pl[Tu];if(!(Mu.length<2)){var Ju=Mu[1];if(Array.isArray(Ju)&&!(Ju.length<1)){var vl=Ju[0];if(vl!="noop"&&vl!="stop"&&vl!="close")for(let Vl=1;Vl<Ju.length;Vl++)Ju[Vl]=""}}}}return rh(Pl)}catch{return Du}}var Ul={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},zl={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},ih;function Kl(){}vu(Kl,Nu),Kl.prototype.g=function(){return new XMLHttpRequest},ih=new Kl;function nh(Tu){return encodeURIComponent(String(Tu))}function ch(Tu){var Du=1;Tu=Tu.split(":");const Mu=[];for(;Du>0&&Tu.length;)Mu.push(Tu.shift()),Du--;return Tu.length&&Mu.push(Tu.join(":")),Mu}function uh(Tu,Du,Mu,Ju){this.j=Tu,this.i=Du,this.l=Mu,this.S=Ju||1,this.V=new Ql(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new dh}function dh(){this.i=null,this.g="",this.h=!1}var ah={},Wl={};function gh(Tu,Du,Mu){Tu.M=1,Tu.A=td(Ih(Du)),Tu.u=Mu,Tu.R=!0,mh(Tu,null)}function mh(Tu,Du){Tu.F=Date.now(),Eh(Tu),Tu.B=Ih(Tu.A);var Mu=Tu.B,Ju=Tu.S;Array.isArray(Ju)||(Ju=[String(Ju)]),$d(Mu.i,"t",Ju),Tu.C=0,Mu=Tu.j.L,Tu.h=new dh,Tu.g=jd(Tu.j,Mu?Du:null,!Tu.u),Tu.P>0&&(Tu.O=new Gl(Au(Tu.Y,Tu,Tu.g),Tu.P)),Du=Tu.V,Mu=Tu.g,Ju=Tu.ba;var vl="readystatechange";Array.isArray(vl)||(vl&&(Hl[0]=vl.toString()),vl=Hl);for(let Pl=0;Pl<vl.length;Pl++){const Vl=Tl(Mu,vl[Pl],Ju||Du.handleEvent,!1,Du.h||Du);if(!Vl)break;Du.g[Vl.key]=Vl}Du=Tu.J?Rl(Tu.J):{},Tu.u?(Tu.v||(Tu.v="POST"),Du["Content-Type"]="application/x-www-form-urlencoded",Tu.g.ea(Tu.B,Tu.v,Tu.u,Du)):(Tu.v="GET",Tu.g.ea(Tu.B,Tu.v,null,Du)),Yl(),Bl(Tu.i,Tu.v,Tu.B,Tu.l,Tu.S,Tu.u)}uh.prototype.ba=function(Tu){Tu=Tu.target;const Du=this.O;Du&&Dh(Tu)==3?Du.j():this.Y(Tu)},uh.prototype.Y=function(Tu){try{if(Tu==this.g)e:{const Jl=Dh(this.g),fh=this.g.ya(),sh=this.g.ca();if(!(Jl<3)&&(Jl!=3||this.g&&(this.h.h||this.g.la()||Dd(this.g)))){this.K||Jl!=4||fh==7||(fh==8||sh<=0?Yl(3):Yl(2)),Oh(this);var Du=this.g.ca();this.X=Du;var Mu=Zl(this);if(this.o=Du==200,xl(this.i,this.v,this.B,this.l,this.S,Jl,Du),this.o){if(this.U&&!this.L){t:{if(this.g){var Ju,vl=this.g;if((Ju=vl.g?vl.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Lu(Ju)){var Pl=Ju;break t}}Pl=null}if(Tu=Pl)Ol(this.i,this.l,Tu,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Nh(this,Tu);else{this.o=!1,this.m=3,hh(12),bh(this),Sh(this);break e}}if(this.R){Tu=!0;let ph;for(;!this.K&&this.C<Mu.length;)if(ph=Ah(this,Mu),ph==Wl){Jl==4&&(this.m=4,hh(14),Tu=!1),Ol(this.i,this.l,null,"[Incomplete Response]");break}else if(ph==ah){this.m=4,hh(15),Ol(this.i,this.l,Mu,"[Invalid Chunk]"),Tu=!1;break}else Ol(this.i,this.l,ph,null),Nh(this,ph);if(yh(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Jl!=4||Mu.length!=0||this.h.h||(this.m=1,hh(16),Tu=!1),this.o=this.o&&Tu,!Tu)Ol(this.i,this.l,Mu,"[Invalid Chunked Response]"),bh(this),Sh(this);else if(Mu.length>0&&!this.W){this.W=!0;var Vl=this.j;Vl.g==this&&Vl.aa&&!Vl.P&&(Vl.j.info("Great, no buffering proxy detected. Bytes received: "+Mu.length),gd(Vl),Vl.P=!0,hh(11))}}else Ol(this.i,this.l,Mu,null),Nh(this,Mu);Jl==4&&bh(this),this.o&&!this.K&&(Jl==4?Md(this.j,this):(this.o=!1,Eh(this)))}else lp(this.g),Du==400&&Mu.indexOf("Unknown SID")>0?(this.m=3,hh(12)):(this.m=0,hh(13)),bh(this),Sh(this)}}}catch{}finally{}};function Zl(Tu){if(!yh(Tu))return Tu.g.la();const Du=Dd(Tu.g);if(Du==="")return"";let Mu="";const Ju=Du.length,vl=Dh(Tu.g)==4;if(!Tu.h.i){if(typeof TextDecoder>"u")return bh(Tu),Sh(Tu),"";Tu.h.i=new _u.TextDecoder}for(let Pl=0;Pl<Ju;Pl++)Tu.h.h=!0,Mu+=Tu.h.i.decode(Du[Pl],{stream:!(vl&&Pl==Ju-1)});return Du.length=0,Tu.h.g+=Mu,Tu.C=0,Tu.h.g}function yh(Tu){return Tu.g?Tu.v=="GET"&&Tu.M!=2&&Tu.j.Aa:!1}function Ah(Tu,Du){var Mu=Tu.C,Ju=Du.indexOf(`
`,Mu);return Ju==-1?Wl:(Mu=Number(Du.substring(Mu,Ju)),isNaN(Mu)?ah:(Ju+=1,Ju+Mu>Du.length?Wl:(Du=Du.slice(Ju,Ju+Mu),Tu.C=Ju+Mu,Du)))}uh.prototype.cancel=function(){this.K=!0,bh(this)};function Eh(Tu){Tu.T=Date.now()+Tu.H,Th(Tu,Tu.H)}function Th(Tu,Du){if(Tu.D!=null)throw Error("WatchDog timer not null");Tu.D=_h(Au(Tu.aa,Tu),Du)}function Oh(Tu){Tu.D&&(_u.clearTimeout(Tu.D),Tu.D=null)}uh.prototype.aa=function(){this.D=null;const Tu=Date.now();Tu-this.T>=0?(Nl(this.i,this.B),this.M!=2&&(Yl(),hh(17)),bh(this),this.m=2,Sh(this)):Th(this,this.T-Tu)};function Sh(Tu){Tu.j.I==0||Tu.K||Md(Tu.j,Tu)}function bh(Tu){Oh(Tu);var Du=Tu.O;Du&&typeof Du.dispose=="function"&&Du.dispose(),Tu.O=null,jl(Tu.V),Tu.g&&(Du=Tu.g,Tu.g=null,Du.abort(),Du.dispose())}function Nh(Tu,Du){try{var Mu=Tu.j;if(Mu.I!=0&&(Mu.g==Tu||Vh(Mu.h,Tu))){if(!Tu.L&&Vh(Mu.h,Tu)&&Mu.I==3){try{var Ju=Mu.Ba.g.parse(Du)}catch{Ju=null}if(Array.isArray(Ju)&&Ju.length==3){var vl=Ju;if(vl[0]==0){e:if(!Mu.v){if(Mu.g)if(Mu.g.F+3e3<Tu.F)od(Mu),id(Mu);else break e;pd(Mu),hh(18)}}else Mu.xa=vl[1],0<Mu.xa-Mu.K&&vl[2]<37500&&Mu.F&&Mu.A==0&&!Mu.C&&(Mu.C=_h(Au(Mu.Va,Mu),6e3));jh(Mu.h)<=1&&Mu.ta&&(Mu.ta=void 0)}else Mh(Mu,11)}else if((Tu.L||Mu.g==Tu)&&od(Mu),!Lu(Du))for(vl=Mu.Ba.g.parse(Du),Du=0;Du<vl.length;Du++){let sh=vl[Du];const ph=sh[0];if(!(ph<=Mu.K))if(Mu.K=ph,sh=sh[1],Mu.I==2)if(sh[0]=="c"){Mu.M=sh[1],Mu.ba=sh[2];const $h=sh[3];$h!=null&&(Mu.ka=$h,Mu.j.info("VER="+Mu.ka));const Lh=sh[4];Lh!=null&&(Mu.za=Lh,Mu.j.info("SVER="+Mu.za));const xh=sh[5];xh!=null&&typeof xh=="number"&&xh>0&&(Ju=1.5*xh,Mu.O=Ju,Mu.j.info("backChannelRequestTimeoutMs_="+Ju)),Ju=Mu;const Bh=Tu.g;if(Bh){const cd=Bh.g?Bh.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(cd){var Pl=Ju.h;Pl.g||cd.indexOf("spdy")==-1&&cd.indexOf("quic")==-1&&cd.indexOf("h2")==-1||(Pl.j=Pl.l,Pl.g=new Set,Pl.h&&(ud(Pl,Pl.h),Pl.h=null))}if(Ju.G){const md=Bh.g?Bh.g.getResponseHeader("X-HTTP-Session-Id"):null;md&&(Ju.wa=md,oh(Ju.J,Ju.G,md))}}Mu.I=3,Mu.l&&Mu.l.ra(),Mu.aa&&(Mu.T=Date.now()-Tu.F,Mu.j.info("Handshake RTT: "+Mu.T+"ms")),Ju=Mu;var Vl=Tu;if(Ju.na=kd(Ju,Ju.L?Ju.ba:null,Ju.W),Vl.L){yd(Ju.h,Vl);var Jl=Vl,fh=Ju.O;fh&&(Jl.H=fh),Jl.D&&(Oh(Jl),Eh(Jl)),Ju.g=Vl}else Vd(Ju);Mu.i.length>0&&sd(Mu)}else sh[0]!="stop"&&sh[0]!="close"||Mh(Mu,7);else Mu.I==3&&(sh[0]=="stop"||sh[0]=="close"?sh[0]=="stop"?Mh(Mu,7):dd(Mu):sh[0]!="noop"&&Mu.l&&Mu.l.qa(sh),Mu.A=0)}}Yl(4)}catch{}}var zh=class{constructor(Tu,Du){this.g=Tu,this.map=Du}};function Uh(Tu){this.l=Tu||10,_u.PerformanceNavigationTiming?(Tu=_u.performance.getEntriesByType("navigation"),Tu=Tu.length>0&&(Tu[0].nextHopProtocol=="hq"||Tu[0].nextHopProtocol=="h2")):Tu=!!(_u.chrome&&_u.chrome.loadTimes&&_u.chrome.loadTimes()&&_u.chrome.loadTimes().wasFetchedViaSpdy),this.j=Tu?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function kh(Tu){return Tu.h?!0:Tu.g?Tu.g.size>=Tu.j:!1}function jh(Tu){return Tu.h?1:Tu.g?Tu.g.size:0}function Vh(Tu,Du){return Tu.h?Tu.h==Du:Tu.g?Tu.g.has(Du):!1}function ud(Tu,Du){Tu.g?Tu.g.add(Du):Tu.h=Du}function yd(Tu,Du){Tu.h&&Tu.h==Du?Tu.h=null:Tu.g&&Tu.g.has(Du)&&Tu.g.delete(Du)}Uh.prototype.cancel=function(){if(this.i=_d(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const Tu of this.g.values())Tu.cancel();this.g.clear()}};function _d(Tu){if(Tu.h!=null)return Tu.i.concat(Tu.h.G);if(Tu.g!=null&&Tu.g.size!==0){let Du=Tu.i;for(const Mu of Tu.g.values())Du=Du.concat(Mu.G);return Du}return Ru(Tu.i)}var Ed=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Xd(Tu,Du){if(Tu){Tu=Tu.split("&");for(let Mu=0;Mu<Tu.length;Mu++){const Ju=Tu[Mu].indexOf("=");let vl,Pl=null;Ju>=0?(vl=Tu[Mu].substring(0,Ju),Pl=Tu[Mu].substring(Ju+1)):vl=Tu[Mu],Du(vl,Pl?decodeURIComponent(Pl.replace(/\+/g," ")):"")}}}function Ph(Tu){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let Du;Tu instanceof Ph?(this.l=Tu.l,Gh(this,Tu.j),this.o=Tu.o,this.g=Tu.g,Kh(this,Tu.u),this.h=Tu.h,ld(this,vd(Tu.i)),this.m=Tu.m):Tu&&(Du=String(Tu).match(Ed))?(this.l=!1,Gh(this,Du[1]||"",!0),this.o=Wh(Du[2]||""),this.g=Wh(Du[3]||"",!0),Kh(this,Du[4]),this.h=Wh(Du[5]||"",!0),ld(this,Du[6]||"",!0),this.m=Wh(Du[7]||"")):(this.l=!1,this.i=new Yh(null,this.l))}Ph.prototype.toString=function(){const Tu=[];var Du=this.j;Du&&Tu.push(Qh(Du,wd,!0),":");var Mu=this.g;return(Mu||Du=="file")&&(Tu.push("//"),(Du=this.o)&&Tu.push(Qh(Du,wd,!0),"@"),Tu.push(nh(Mu).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),Mu=this.u,Mu!=null&&Tu.push(":",String(Mu))),(Mu=this.h)&&(this.g&&Mu.charAt(0)!="/"&&Tu.push("/"),Tu.push(Qh(Mu,Mu.charAt(0)=="/"?tp:ep,!0))),(Mu=this.i.toString())&&Tu.push("?",Mu),(Mu=this.m)&&Tu.push("#",Qh(Mu,np)),Tu.join("")},Ph.prototype.resolve=function(Tu){const Du=Ih(this);let Mu=!!Tu.j;Mu?Gh(Du,Tu.j):Mu=!!Tu.o,Mu?Du.o=Tu.o:Mu=!!Tu.g,Mu?Du.g=Tu.g:Mu=Tu.u!=null;var Ju=Tu.h;if(Mu)Kh(Du,Tu.u);else if(Mu=!!Tu.h){if(Ju.charAt(0)!="/")if(this.g&&!this.h)Ju="/"+Ju;else{var vl=Du.h.lastIndexOf("/");vl!=-1&&(Ju=Du.h.slice(0,vl+1)+Ju)}if(vl=Ju,vl==".."||vl==".")Ju="";else if(vl.indexOf("./")!=-1||vl.indexOf("/.")!=-1){Ju=vl.lastIndexOf("/",0)==0,vl=vl.split("/");const Pl=[];for(let Vl=0;Vl<vl.length;){const Jl=vl[Vl++];Jl=="."?Ju&&Vl==vl.length&&Pl.push(""):Jl==".."?((Pl.length>1||Pl.length==1&&Pl[0]!="")&&Pl.pop(),Ju&&Vl==vl.length&&Pl.push("")):(Pl.push(Jl),Ju=!0)}Ju=Pl.join("/")}else Ju=vl}return Mu?Du.h=Ju:Mu=Tu.i.toString()!=="",Mu?ld(Du,vd(Tu.i)):Mu=!!Tu.m,Mu&&(Du.m=Tu.m),Du};function Ih(Tu){return new Ph(Tu)}function Gh(Tu,Du,Mu){Tu.j=Mu?Wh(Du,!0):Du,Tu.j&&(Tu.j=Tu.j.replace(/:$/,""))}function Kh(Tu,Du){if(Du){if(Du=Number(Du),isNaN(Du)||Du<0)throw Error("Bad port number "+Du);Tu.u=Du}else Tu.u=null}function ld(Tu,Du,Mu){Du instanceof Yh?(Tu.i=Du,ip(Tu.i,Tu.l)):(Mu||(Du=Qh(Du,rp)),Tu.i=new Yh(Du,Tu.l))}function oh(Tu,Du,Mu){Tu.i.set(Du,Mu)}function td(Tu){return oh(Tu,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),Tu}function Wh(Tu,Du){return Tu?Du?decodeURI(Tu.replace(/%25/g,"%2525")):decodeURIComponent(Tu):""}function Qh(Tu,Du,Mu){return typeof Tu=="string"?(Tu=encodeURI(Tu).replace(Du,Zd),Mu&&(Tu=Tu.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),Tu):null}function Zd(Tu){return Tu=Tu.charCodeAt(0),"%"+(Tu>>4&15).toString(16)+(Tu&15).toString(16)}var wd=/[#\/\?@]/g,ep=/[#\?:]/g,tp=/[#\?]/g,rp=/[#\?@]/g,np=/#/g;function Yh(Tu,Du){this.h=this.g=null,this.i=Tu||null,this.j=!!Du}function Fh(Tu){Tu.g||(Tu.g=new Map,Tu.h=0,Tu.i&&Xd(Tu.i,function(Du,Mu){Tu.add(decodeURIComponent(Du.replace(/\+/g," ")),Mu)}))}Z=Yh.prototype,Z.add=function(Tu,Du){Fh(this),this.i=null,Tu=qh(this,Tu);let Mu=this.g.get(Tu);return Mu||this.g.set(Tu,Mu=[]),Mu.push(Du),this.h+=1,this};function Ad(Tu,Du){Fh(Tu),Du=qh(Tu,Du),Tu.g.has(Du)&&(Tu.i=null,Tu.h-=Tu.g.get(Du).length,Tu.g.delete(Du))}function bd(Tu,Du){return Fh(Tu),Du=qh(Tu,Du),Tu.g.has(Du)}Z.forEach=function(Tu,Du){Fh(this),this.g.forEach(function(Mu,Ju){Mu.forEach(function(vl){Tu.call(Du,vl,Ju,this)},this)},this)};function Id(Tu,Du){Fh(Tu);let Mu=[];if(typeof Du=="string")bd(Tu,Du)&&(Mu=Mu.concat(Tu.g.get(qh(Tu,Du))));else for(Tu=Array.from(Tu.g.values()),Du=0;Du<Tu.length;Du++)Mu=Mu.concat(Tu[Du]);return Mu}Z.set=function(Tu,Du){return Fh(this),this.i=null,Tu=qh(this,Tu),bd(this,Tu)&&(this.h-=this.g.get(Tu).length),this.g.set(Tu,[Du]),this.h+=1,this},Z.get=function(Tu,Du){return Tu?(Tu=Id(this,Tu),Tu.length>0?String(Tu[0]):Du):Du};function $d(Tu,Du,Mu){Ad(Tu,Du),Mu.length>0&&(Tu.i=null,Tu.g.set(qh(Tu,Du),Ru(Mu)),Tu.h+=Mu.length)}Z.toString=function(){if(this.i)return this.i;if(!this.g)return"";const Tu=[],Du=Array.from(this.g.keys());for(let Ju=0;Ju<Du.length;Ju++){var Mu=Du[Ju];const vl=nh(Mu);Mu=Id(this,Mu);for(let Pl=0;Pl<Mu.length;Pl++){let Vl=vl;Mu[Pl]!==""&&(Vl+="="+nh(Mu[Pl])),Tu.push(Vl)}}return this.i=Tu.join("&")};function vd(Tu){const Du=new Yh;return Du.i=Tu.i,Tu.g&&(Du.g=new Map(Tu.g),Du.h=Tu.h),Du}function qh(Tu,Du){return Du=String(Du),Tu.j&&(Du=Du.toLowerCase()),Du}function ip(Tu,Du){Du&&!Tu.j&&(Fh(Tu),Tu.i=null,Tu.g.forEach(function(Mu,Ju){const vl=Ju.toLowerCase();Ju!=vl&&(Ad(this,Ju),$d(this,vl,Mu))},Tu)),Tu.j=Du}function sp(Tu,Du){const Mu=new $l;if(_u.Image){const Ju=new Image;Ju.onload=$u(Ch,Mu,"TestLoadImage: loaded",!0,Du,Ju),Ju.onerror=$u(Ch,Mu,"TestLoadImage: error",!1,Du,Ju),Ju.onabort=$u(Ch,Mu,"TestLoadImage: abort",!1,Du,Ju),Ju.ontimeout=$u(Ch,Mu,"TestLoadImage: timeout",!1,Du,Ju),_u.setTimeout(function(){Ju.ontimeout&&Ju.ontimeout()},1e4),Ju.src=Tu}else Du(!1)}function op(Tu,Du){const Mu=new $l,Ju=new AbortController,vl=setTimeout(()=>{Ju.abort(),Ch(Mu,"TestPingServer: timeout",!1,Du)},1e4);fetch(Tu,{signal:Ju.signal}).then(Pl=>{clearTimeout(vl),Pl.ok?Ch(Mu,"TestPingServer: ok",!0,Du):Ch(Mu,"TestPingServer: server error",!1,Du)}).catch(()=>{clearTimeout(vl),Ch(Mu,"TestPingServer: error",!1,Du)})}function Ch(Tu,Du,Mu,Ju,vl){try{vl&&(vl.onload=null,vl.onerror=null,vl.onabort=null,vl.ontimeout=null),Ju(Mu)}catch{}}function ap(){this.g=new xu}function hd(Tu){this.i=Tu.Sb||null,this.h=Tu.ab||!1}vu(hd,Nu),hd.prototype.g=function(){return new rd(this.i,this.h)};function rd(Tu,Du){wl.call(this),this.H=Tu,this.o=Du,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}vu(rd,wl),Z=rd.prototype,Z.open=function(Tu,Du){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=Tu,this.D=Du,this.readyState=1,Xh(this)},Z.send=function(Tu){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const Du={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};Tu&&(Du.body=Tu),(this.H||_u).fetch(new Request(this.D,Du)).then(this.Pa.bind(this),this.ga.bind(this))},Z.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Jh(this)),this.readyState=0},Z.Pa=function(Tu){if(this.g&&(this.l=Tu,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=Tu.headers,this.readyState=2,Xh(this)),this.g&&(this.readyState=3,Xh(this),this.g)))if(this.responseType==="arraybuffer")Tu.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof _u.ReadableStream<"u"&&"body"in Tu){if(this.j=Tu.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Td(this)}else Tu.text().then(this.Oa.bind(this),this.ga.bind(this))};function Td(Tu){Tu.j.read().then(Tu.Ma.bind(Tu)).catch(Tu.ga.bind(Tu))}Z.Ma=function(Tu){if(this.g){if(this.o&&Tu.value)this.response.push(Tu.value);else if(!this.o){var Du=Tu.value?Tu.value:new Uint8Array(0);(Du=this.B.decode(Du,{stream:!Tu.done}))&&(this.response=this.responseText+=Du)}Tu.done?Jh(this):Xh(this),this.readyState==3&&Td(this)}},Z.Oa=function(Tu){this.g&&(this.response=this.responseText=Tu,Jh(this))},Z.Na=function(Tu){this.g&&(this.response=Tu,Jh(this))},Z.ga=function(){this.g&&Jh(this)};function Jh(Tu){Tu.readyState=4,Tu.l=null,Tu.j=null,Tu.B=null,Xh(Tu)}Z.setRequestHeader=function(Tu,Du){this.A.append(Tu,Du)},Z.getResponseHeader=function(Tu){return this.h&&this.h.get(Tu.toLowerCase())||""},Z.getAllResponseHeaders=function(){if(!this.h)return"";const Tu=[],Du=this.h.entries();for(var Mu=Du.next();!Mu.done;)Mu=Mu.value,Tu.push(Mu[0]+": "+Mu[1]),Mu=Du.next();return Tu.join(`\r
`)};function Xh(Tu){Tu.onreadystatechange&&Tu.onreadystatechange.call(Tu)}Object.defineProperty(rd.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(Tu){this.m=Tu?"include":"same-origin"}});function Sd(Tu){let Du="";return hl(Tu,function(Mu,Ju){Du+=Ju,Du+=":",Du+=Mu,Du+=`\r
`}),Du}function fd(Tu,Du,Mu){e:{for(Ju in Mu){var Ju=!1;break e}Ju=!0}Ju||(Mu=Sd(Mu),typeof Tu=="string"?Mu!=null&&nh(Mu):oh(Tu,Du,Mu))}function lh(Tu){wl.call(this),this.headers=new Map,this.L=Tu||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}vu(lh,wl);var cp=/^https?$/i,up=["POST","PUT"];Z=lh.prototype,Z.Fa=function(Tu){this.H=Tu},Z.ea=function(Tu,Du,Mu,Ju){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+Tu);Du=Du?Du.toUpperCase():"GET",this.D=Tu,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():ih.g(),this.g.onreadystatechange=Su(Au(this.Ca,this));try{this.B=!0,this.g.open(Du,String(Tu),!0),this.B=!1}catch(Pl){Rd(this,Pl);return}if(Tu=Mu||"",Mu=new Map(this.headers),Ju)if(Object.getPrototypeOf(Ju)===Object.prototype)for(var vl in Ju)Mu.set(vl,Ju[vl]);else if(typeof Ju.keys=="function"&&typeof Ju.get=="function")for(const Pl of Ju.keys())Mu.set(Pl,Ju.get(Pl));else throw Error("Unknown input type for opt_headers: "+String(Ju));Ju=Array.from(Mu.keys()).find(Pl=>Pl.toLowerCase()=="content-type"),vl=_u.FormData&&Tu instanceof _u.FormData,!(Array.prototype.indexOf.call(up,Du,void 0)>=0)||Ju||vl||Mu.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Pl,Vl]of Mu)this.g.setRequestHeader(Pl,Vl);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(Tu),this.v=!1}catch(Pl){Rd(this,Pl)}};function Rd(Tu,Du){Tu.h=!1,Tu.g&&(Tu.j=!0,Tu.g.abort(),Tu.j=!1),Tu.l=Du,Tu.o=5,Pd(Tu),nd(Tu)}function Pd(Tu){Tu.A||(Tu.A=!0,Dl(Tu,"complete"),Dl(Tu,"error"))}Z.abort=function(Tu){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=Tu||7,Dl(this,"complete"),Dl(this,"abort"),nd(this))},Z.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),nd(this,!0)),lh.Z.N.call(this)},Z.Ca=function(){this.u||(this.B||this.v||this.j?Cd(this):this.Xa())},Z.Xa=function(){Cd(this)};function Cd(Tu){if(Tu.h&&typeof Zs<"u"){if(Tu.v&&Dh(Tu)==4)setTimeout(Tu.Ca.bind(Tu),0);else if(Dl(Tu,"readystatechange"),Dh(Tu)==4){Tu.h=!1;try{const Pl=Tu.ca();e:switch(Pl){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var Du=!0;break e;default:Du=!1}var Mu;if(!(Mu=Du)){var Ju;if(Ju=Pl===0){let Vl=String(Tu.D).match(Ed)[1]||null;!Vl&&_u.self&&_u.self.location&&(Vl=_u.self.location.protocol.slice(0,-1)),Ju=!cp.test(Vl?Vl.toLowerCase():"")}Mu=Ju}if(Mu)Dl(Tu,"complete"),Dl(Tu,"success");else{Tu.o=6;try{var vl=Dh(Tu)>2?Tu.g.statusText:""}catch{vl=""}Tu.l=vl+" ["+Tu.ca()+"]",Pd(Tu)}}finally{nd(Tu)}}}}function nd(Tu,Du){if(Tu.g){Tu.m&&(clearTimeout(Tu.m),Tu.m=null);const Mu=Tu.g;Tu.g=null,Du||Dl(Tu,"ready");try{Mu.onreadystatechange=null}catch{}}}Z.isActive=function(){return!!this.g};function Dh(Tu){return Tu.g?Tu.g.readyState:0}Z.ca=function(){try{return Dh(this)>2?this.g.status:-1}catch{return-1}},Z.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},Z.La=function(Tu){if(this.g){var Du=this.g.responseText;return Tu&&Du.indexOf(Tu)==0&&(Du=Du.substring(Tu.length)),Ku(Du)}};function Dd(Tu){try{if(!Tu.g)return null;if("response"in Tu.g)return Tu.g.response;switch(Tu.F){case"":case"text":return Tu.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in Tu.g)return Tu.g.mozResponseArrayBuffer}return null}catch{return null}}function lp(Tu){const Du={};Tu=(Tu.g&&Dh(Tu)>=2&&Tu.g.getAllResponseHeaders()||"").split(`\r
`);for(let Ju=0;Ju<Tu.length;Ju++){if(Lu(Tu[Ju]))continue;var Mu=ch(Tu[Ju]);const vl=Mu[0];if(Mu=Mu[1],typeof Mu!="string")continue;Mu=Mu.trim();const Pl=Du[vl]||[];Du[vl]=Pl,Pl.push(Mu)}_l(Du,function(Ju){return Ju.join(", ")})}Z.ya=function(){return this.o},Z.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Zh(Tu,Du,Mu){return Mu&&Mu.internalChannelParams&&Mu.internalChannelParams[Tu]||Du}function xd(Tu){this.za=0,this.i=[],this.j=new $l,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Zh("failFast",!1,Tu),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Zh("baseRetryDelayMs",5e3,Tu),this.Za=Zh("retryDelaySeedMs",1e4,Tu),this.Ta=Zh("forwardChannelMaxRetries",2,Tu),this.va=Zh("forwardChannelRequestTimeoutMs",2e4,Tu),this.ma=Tu&&Tu.xmlHttpFactory||void 0,this.Ua=Tu&&Tu.Rb||void 0,this.Aa=Tu&&Tu.useFetchStreams||!1,this.O=void 0,this.L=Tu&&Tu.supportsCrossDomainXhr||!1,this.M="",this.h=new Uh(Tu&&Tu.concurrentRequestLimit),this.Ba=new ap,this.S=Tu&&Tu.fastHandshake||!1,this.R=Tu&&Tu.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=Tu&&Tu.Pb||!1,Tu&&Tu.ua&&this.j.ua(),Tu&&Tu.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&Tu&&Tu.detectBufferingProxy||!1,this.ia=void 0,Tu&&Tu.longPollingTimeout&&Tu.longPollingTimeout>0&&(this.ia=Tu.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}Z=xd.prototype,Z.ka=8,Z.I=1,Z.connect=function(Tu,Du,Mu,Ju){hh(0),this.W=Tu,this.H=Du||{},Mu&&Ju!==void 0&&(this.H.OSID=Mu,this.H.OAID=Ju),this.F=this.X,this.J=kd(this,null,this.W),sd(this)};function dd(Tu){if(Bd(Tu),Tu.I==3){var Du=Tu.V++,Mu=Ih(Tu.J);if(oh(Mu,"SID",Tu.M),oh(Mu,"RID",Du),oh(Mu,"TYPE","terminate"),ed(Tu,Mu),Du=new uh(Tu,Tu.j,Du),Du.M=2,Du.A=td(Ih(Mu)),Mu=!1,_u.navigator&&_u.navigator.sendBeacon)try{Mu=_u.navigator.sendBeacon(Du.A.toString(),"")}catch{}!Mu&&_u.Image&&(new Image().src=Du.A,Mu=!0),Mu||(Du.g=jd(Du.j,null),Du.g.ea(Du.A)),Du.F=Date.now(),Eh(Du)}Ud(Tu)}function id(Tu){Tu.g&&(gd(Tu),Tu.g.cancel(),Tu.g=null)}function Bd(Tu){id(Tu),Tu.v&&(_u.clearTimeout(Tu.v),Tu.v=null),od(Tu),Tu.h.cancel(),Tu.m&&(typeof Tu.m=="number"&&_u.clearTimeout(Tu.m),Tu.m=null)}function sd(Tu){if(!kh(Tu.h)&&!Tu.m){Tu.m=!0;var Du=Tu.Ea;tl||ku(),Xu||(tl(),Xu=!0),ju.add(Du,Tu),Tu.D=0}}function hp(Tu,Du){return jh(Tu.h)>=Tu.h.j-(Tu.m?1:0)?!1:Tu.m?(Tu.i=Du.G.concat(Tu.i),!0):Tu.I==1||Tu.I==2||Tu.D>=(Tu.Sa?0:Tu.Ta)?!1:(Tu.m=_h(Au(Tu.Ea,Tu,Du),Ld(Tu,Tu.D)),Tu.D++,!0)}Z.Ea=function(Tu){if(this.m)if(this.m=null,this.I==1){if(!Tu){this.V=Math.floor(Math.random()*1e5),Tu=this.V++;const vl=new uh(this,this.j,Tu);let Pl=this.o;if(this.U&&(Pl?(Pl=Rl(Pl),gl(Pl,this.U)):Pl=this.U),this.u!==null||this.R||(vl.J=Pl,Pl=null),this.S)e:{for(var Du=0,Mu=0;Mu<this.i.length;Mu++){t:{var Ju=this.i[Mu];if("__data__"in Ju.map&&(Ju=Ju.map.__data__,typeof Ju=="string")){Ju=Ju.length;break t}Ju=void 0}if(Ju===void 0)break;if(Du+=Ju,Du>4096){Du=Mu;break e}if(Du===4096||Mu===this.i.length-1){Du=Mu+1;break e}}Du=1e3}else Du=1e3;Du=Nd(this,vl,Du),Mu=Ih(this.J),oh(Mu,"RID",Tu),oh(Mu,"CVER",22),this.G&&oh(Mu,"X-HTTP-Session-Id",this.G),ed(this,Mu),Pl&&(this.R?Du="headers="+nh(Sd(Pl))+"&"+Du:this.u&&fd(Mu,this.u,Pl)),ud(this.h,vl),this.Ra&&oh(Mu,"TYPE","init"),this.S?(oh(Mu,"$req",Du),oh(Mu,"SID","null"),vl.U=!0,gh(vl,Mu,null)):gh(vl,Mu,Du),this.I=2}}else this.I==3&&(Tu?Od(this,Tu):this.i.length==0||kh(this.h)||Od(this))};function Od(Tu,Du){var Mu;Du?Mu=Du.l:Mu=Tu.V++;const Ju=Ih(Tu.J);oh(Ju,"SID",Tu.M),oh(Ju,"RID",Mu),oh(Ju,"AID",Tu.K),ed(Tu,Ju),Tu.u&&Tu.o&&fd(Ju,Tu.u,Tu.o),Mu=new uh(Tu,Tu.j,Mu,Tu.D+1),Tu.u===null&&(Mu.J=Tu.o),Du&&(Tu.i=Du.G.concat(Tu.i)),Du=Nd(Tu,Mu,1e3),Mu.H=Math.round(Tu.va*.5)+Math.round(Tu.va*.5*Math.random()),ud(Tu.h,Mu),gh(Mu,Ju,Du)}function ed(Tu,Du){Tu.H&&hl(Tu.H,function(Mu,Ju){oh(Du,Ju,Mu)}),Tu.l&&hl({},function(Mu,Ju){oh(Du,Ju,Mu)})}function Nd(Tu,Du,Mu){Mu=Math.min(Tu.i.length,Mu);const Ju=Tu.l?Au(Tu.l.Ka,Tu.l,Tu):null;e:{var vl=Tu.i;let Jl=-1;for(;;){const fh=["count="+Mu];Jl==-1?Mu>0?(Jl=vl[0].g,fh.push("ofs="+Jl)):Jl=0:fh.push("ofs="+Jl);let sh=!0;for(let ph=0;ph<Mu;ph++){var Pl=vl[ph].g;const $h=vl[ph].map;if(Pl-=Jl,Pl<0)Jl=Math.max(0,vl[ph].g-100),sh=!1;else try{Pl="req"+Pl+"_"||"";try{var Vl=$h instanceof Map?$h:Object.entries($h);for(const[Lh,xh]of Vl){let Bh=xh;Eu(xh)&&(Bh=rh(xh)),fh.push(Pl+Lh+"="+encodeURIComponent(Bh))}}catch(Lh){throw fh.push(Pl+"type="+encodeURIComponent("_badmap")),Lh}}catch{Ju&&Ju($h)}}if(sh){Vl=fh.join("&");break e}}Vl=void 0}return Tu=Tu.i.splice(0,Mu),Du.G=Tu,Vl}function Vd(Tu){if(!Tu.g&&!Tu.v){Tu.Y=1;var Du=Tu.Da;tl||ku(),Xu||(tl(),Xu=!0),ju.add(Du,Tu),Tu.A=0}}function pd(Tu){return Tu.g||Tu.v||Tu.A>=3?!1:(Tu.Y++,Tu.v=_h(Au(Tu.Da,Tu),Ld(Tu,Tu.A)),Tu.A++,!0)}Z.Da=function(){if(this.v=null,Fd(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var Tu=4*this.T;this.j.info("BP detection timer enabled: "+Tu),this.B=_h(Au(this.Wa,this),Tu)}},Z.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,hh(10),id(this),Fd(this))};function gd(Tu){Tu.B!=null&&(_u.clearTimeout(Tu.B),Tu.B=null)}function Fd(Tu){Tu.g=new uh(Tu,Tu.j,"rpc",Tu.Y),Tu.u===null&&(Tu.g.J=Tu.o),Tu.g.P=0;var Du=Ih(Tu.na);oh(Du,"RID","rpc"),oh(Du,"SID",Tu.M),oh(Du,"AID",Tu.K),oh(Du,"CI",Tu.F?"0":"1"),!Tu.F&&Tu.ia&&oh(Du,"TO",Tu.ia),oh(Du,"TYPE","xmlhttp"),ed(Tu,Du),Tu.u&&Tu.o&&fd(Du,Tu.u,Tu.o),Tu.O&&(Tu.g.H=Tu.O);var Mu=Tu.g;Tu=Tu.ba,Mu.M=1,Mu.A=td(Ih(Du)),Mu.u=null,Mu.R=!0,mh(Mu,Tu)}Z.Va=function(){this.C!=null&&(this.C=null,id(this),pd(this),hh(19))};function od(Tu){Tu.C!=null&&(_u.clearTimeout(Tu.C),Tu.C=null)}function Md(Tu,Du){var Mu=null;if(Tu.g==Du){od(Tu),gd(Tu),Tu.g=null;var Ju=2}else if(Vh(Tu.h,Du))Mu=Du.G,yd(Tu.h,Du),Ju=1;else return;if(Tu.I!=0){if(Du.o)if(Ju==1){Mu=Du.u?Du.u.length:0,Du=Date.now()-Du.F;var vl=Tu.D;Ju=Xl(),Dl(Ju,new vh(Ju,Mu)),sd(Tu)}else Vd(Tu);else if(vl=Du.m,vl==3||vl==0&&Du.X>0||!(Ju==1&&hp(Tu,Du)||Ju==2&&pd(Tu)))switch(Mu&&Mu.length>0&&(Du=Tu.h,Du.i=Du.i.concat(Mu)),vl){case 1:Mh(Tu,5);break;case 4:Mh(Tu,10);break;case 3:Mh(Tu,6);break;default:Mh(Tu,2)}}}function Ld(Tu,Du){let Mu=Tu.Qa+Math.floor(Math.random()*Tu.Za);return Tu.isActive()||(Mu*=2),Mu*Du}function Mh(Tu,Du){if(Tu.j.info("Error code "+Du),Du==2){var Mu=Au(Tu.bb,Tu),Ju=Tu.Ua;const vl=!Ju;Ju=new Ph(Ju||"//www.google.com/images/cleardot.gif"),_u.location&&_u.location.protocol=="http"||Gh(Ju,"https"),td(Ju),vl?sp(Ju.toString(),Mu):op(Ju.toString(),Mu)}else hh(2);Tu.I=0,Tu.l&&Tu.l.pa(Du),Ud(Tu),Bd(Tu)}Z.bb=function(Tu){Tu?(this.j.info("Successfully pinged google.com"),hh(2)):(this.j.info("Failed to ping google.com"),hh(1))};function Ud(Tu){if(Tu.I=0,Tu.ja=[],Tu.l){const Du=_d(Tu.h);(Du.length!=0||Tu.i.length!=0)&&(Pu(Tu.ja,Du),Pu(Tu.ja,Tu.i),Tu.h.i.length=0,Ru(Tu.i),Tu.i.length=0),Tu.l.oa()}}function kd(Tu,Du,Mu){var Ju=Mu instanceof Ph?Ih(Mu):new Ph(Mu);if(Ju.g!="")Du&&(Ju.g=Du+"."+Ju.g),Kh(Ju,Ju.u);else{var vl=_u.location;Ju=vl.protocol,Du=Du?Du+"."+vl.hostname:vl.hostname,vl=+vl.port;const Pl=new Ph(null);Ju&&Gh(Pl,Ju),Du&&(Pl.g=Du),vl&&Kh(Pl,vl),Mu&&(Pl.h=Mu),Ju=Pl}return Mu=Tu.G,Du=Tu.wa,Mu&&Du&&oh(Ju,Mu,Du),oh(Ju,"VER",Tu.ka),ed(Tu,Ju),Ju}function jd(Tu,Du,Mu){if(Du&&!Tu.L)throw Error("Can't create secondary domain capable XhrIo object.");return Du=Tu.Aa&&!Tu.ma?new lh(new hd({ab:Mu})):new lh(Tu.ma),Du.Fa(Tu.L),Du}Z.isActive=function(){return!!this.l&&this.l.isActive(this)};function qd(){}Z=qd.prototype,Z.ra=function(){},Z.qa=function(){},Z.pa=function(){},Z.oa=function(){},Z.isActive=function(){return!0},Z.Ka=function(){};function ad(){}ad.prototype.g=function(Tu,Du){return new wh(Tu,Du)};function wh(Tu,Du){wl.call(this),this.g=new xd(Du),this.l=Tu,this.h=Du&&Du.messageUrlParams||null,Tu=Du&&Du.messageHeaders||null,Du&&Du.clientProtocolHeaderRequired&&(Tu?Tu["X-Client-Protocol"]="webchannel":Tu={"X-Client-Protocol":"webchannel"}),this.g.o=Tu,Tu=Du&&Du.initMessageHeaders||null,Du&&Du.messageContentType&&(Tu?Tu["X-WebChannel-Content-Type"]=Du.messageContentType:Tu={"X-WebChannel-Content-Type":Du.messageContentType}),Du&&Du.sa&&(Tu?Tu["X-WebChannel-Client-Profile"]=Du.sa:Tu={"X-WebChannel-Client-Profile":Du.sa}),this.g.U=Tu,(Tu=Du&&Du.Qb)&&!Lu(Tu)&&(this.g.u=Tu),this.A=Du&&Du.supportsCrossDomainXhr||!1,this.v=Du&&Du.sendRawJson||!1,(Du=Du&&Du.httpSessionIdParam)&&!Lu(Du)&&(this.g.G=Du,Tu=this.h,Tu!==null&&Du in Tu&&(Tu=this.h,Du in Tu&&delete Tu[Du])),this.j=new Hh(this)}vu(wh,wl),wh.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},wh.prototype.close=function(){dd(this.g)},wh.prototype.o=function(Tu){var Du=this.g;if(typeof Tu=="string"){var Mu={};Mu.__data__=Tu,Tu=Mu}else this.v&&(Mu={},Mu.__data__=rh(Tu),Tu=Mu);Du.i.push(new zh(Du.Ya++,Tu)),Du.I==3&&sd(Du)},wh.prototype.N=function(){this.g.l=null,delete this.j,dd(this.g),delete this.g,wh.Z.N.call(this)};function Hd(Tu){Il.call(this),Tu.__headers__&&(this.headers=Tu.__headers__,this.statusCode=Tu.__status__,delete Tu.__headers__,delete Tu.__status__);var Du=Tu.__sm__;if(Du){e:{for(const Mu in Du){Tu=Mu;break e}Tu=void 0}(this.i=Tu)&&(Tu=this.i,Du=Du!==null&&Tu in Du?Du[Tu]:void 0),this.data=Du}else this.data=Tu}vu(Hd,Il);function zd(){Cl.call(this),this.status=1}vu(zd,Cl);function Hh(Tu){this.g=Tu}vu(Hh,qd),Hh.prototype.ra=function(){Dl(this.g,"a")},Hh.prototype.qa=function(Tu){Dl(this.g,new Hd(Tu))},Hh.prototype.pa=function(Tu){Dl(this.g,new zd)},Hh.prototype.oa=function(){Dl(this.g,"b")},ad.prototype.createWebChannel=ad.prototype.g,wh.prototype.send=wh.prototype.o,wh.prototype.open=wh.prototype.m,wh.prototype.close=wh.prototype.close,createWebChannelTransport=function(){return new ad},getStatEventTarget=function(){return Xl()},Event$1=Ml,Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Ul.NO_ERROR=0,Ul.TIMEOUT=8,Ul.HTTP_ERROR=6,ErrorCode=Ul,zl.COMPLETE="complete",EventType=zl,rl.EventType=ml,ml.OPEN="a",ml.CLOSE="b",ml.ERROR="c",ml.MESSAGE="d",wl.prototype.listen=wl.prototype.J,WebChannel=rl,lh.prototype.listenOnce=lh.prototype.K,lh.prototype.getLastError=lh.prototype.Ha,lh.prototype.getLastErrorCode=lh.prototype.ya,lh.prototype.getStatus=lh.prototype.ca,lh.prototype.getResponseJson=lh.prototype.La,lh.prototype.getResponseText=lh.prototype.la,lh.prototype.send=lh.prototype.ea,lh.prototype.setWithCredentials=lh.prototype.Fa,XhrIo=lh}).apply(typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class User{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}User.UNAUTHENTICATED=new User(null),User.GOOGLE_CREDENTIALS=new User("google-credentials-uid"),User.FIRST_PARTY=new User("first-party-uid"),User.MOCK_USER=new User("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let S="12.8.0";function __PRIVATE_setSDKVersion(Z){S=Z}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D=new Logger("@firebase/firestore");function __PRIVATE_getLogLevel(){return D.logLevel}function __PRIVATE_logDebug(Z,...t){if(D.logLevel<=LogLevel.DEBUG){const Hs=t.map(__PRIVATE_argToString);D.debug(`Firestore (${S}): ${Z}`,...Hs)}}function __PRIVATE_logError(Z,...t){if(D.logLevel<=LogLevel.ERROR){const Hs=t.map(__PRIVATE_argToString);D.error(`Firestore (${S}): ${Z}`,...Hs)}}function __PRIVATE_logWarn(Z,...t){if(D.logLevel<=LogLevel.WARN){const Hs=t.map(__PRIVATE_argToString);D.warn(`Firestore (${S}): ${Z}`,...Hs)}}function __PRIVATE_argToString(Z){if(typeof Z=="string")return Z;try{return function(Hs){return JSON.stringify(Hs)}(Z)}catch{return Z}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fail(Z,t,Hs){let zs="Unexpected state";typeof t=="string"?zs=t:Hs=t,__PRIVATE__fail(Z,zs,Hs)}function __PRIVATE__fail(Z,t,Hs){let zs=`FIRESTORE (${S}) INTERNAL ASSERTION FAILED: ${t} (ID: ${Z.toString(16)})`;if(Hs!==void 0)try{zs+=" CONTEXT: "+JSON.stringify(Hs)}catch{zs+=" CONTEXT: "+Hs}throw __PRIVATE_logError(zs),new Error(zs)}function __PRIVATE_hardAssert(Z,t,Hs,zs){let Ys="Unexpected state";typeof Hs=="string"?Ys=Hs:zs=Hs,Z||__PRIVATE__fail(t,Ys,zs)}function __PRIVATE_debugCast(Z,t){return Z}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class FirestoreError extends FirebaseError{constructor(t,Hs){super(t,Hs),this.code=t,this.message=Hs,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_Deferred{constructor(){this.promise=new Promise((t,Hs)=>{this.resolve=t,this.reject=Hs})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_OAuthToken{constructor(t,Hs){this.user=Hs,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class __PRIVATE_EmptyAuthCredentialsProvider{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,Hs){t.enqueueRetryable(()=>Hs(User.UNAUTHENTICATED))}shutdown(){}}class __PRIVATE_EmulatorAuthCredentialsProvider{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,Hs){this.changeListener=Hs,t.enqueueRetryable(()=>Hs(this.token.user))}shutdown(){this.changeListener=null}}class __PRIVATE_FirebaseAuthCredentialsProvider{constructor(t){this.t=t,this.currentUser=User.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,Hs){__PRIVATE_hardAssert(this.o===void 0,42304);let zs=this.i;const Ys=Iu=>this.i!==zs?(zs=this.i,Hs(Iu)):Promise.resolve();let Zs=new __PRIVATE_Deferred;this.o=()=>{this.i++,this.currentUser=this.u(),Zs.resolve(),Zs=new __PRIVATE_Deferred,t.enqueueRetryable(()=>Ys(this.currentUser))};const _u=()=>{const Iu=Zs;t.enqueueRetryable(async()=>{await Iu.promise,await Ys(this.currentUser)})},Eu=Iu=>{__PRIVATE_logDebug("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=Iu,this.o&&(this.auth.addAuthTokenListener(this.o),_u())};this.t.onInit(Iu=>Eu(Iu)),setTimeout(()=>{if(!this.auth){const Iu=this.t.getImmediate({optional:!0});Iu?Eu(Iu):(__PRIVATE_logDebug("FirebaseAuthCredentialsProvider","Auth not yet detected"),Zs.resolve(),Zs=new __PRIVATE_Deferred)}},0),_u()}getToken(){const t=this.i,Hs=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(Hs).then(zs=>this.i!==t?(__PRIVATE_logDebug("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):zs?(__PRIVATE_hardAssert(typeof zs.accessToken=="string",31837,{l:zs}),new __PRIVATE_OAuthToken(zs.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return __PRIVATE_hardAssert(t===null||typeof t=="string",2055,{h:t}),new User(t)}}class __PRIVATE_FirstPartyToken{constructor(t,Hs,zs){this.P=t,this.T=Hs,this.I=zs,this.type="FirstParty",this.user=User.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const t=this.A();return t&&this.R.set("Authorization",t),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class __PRIVATE_FirstPartyAuthCredentialsProvider{constructor(t,Hs,zs){this.P=t,this.T=Hs,this.I=zs}getToken(){return Promise.resolve(new __PRIVATE_FirstPartyToken(this.P,this.T,this.I))}start(t,Hs){t.enqueueRetryable(()=>Hs(User.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class AppCheckToken{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class __PRIVATE_FirebaseAppCheckTokenProvider{constructor(t,Hs){this.V=Hs,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,_isFirebaseServerApp(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,Hs){__PRIVATE_hardAssert(this.o===void 0,3512);const zs=Zs=>{Zs.error!=null&&__PRIVATE_logDebug("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${Zs.error.message}`);const _u=Zs.token!==this.m;return this.m=Zs.token,__PRIVATE_logDebug("FirebaseAppCheckTokenProvider",`Received ${_u?"new":"existing"} token.`),_u?Hs(Zs.token):Promise.resolve()};this.o=Zs=>{t.enqueueRetryable(()=>zs(Zs))};const Ys=Zs=>{__PRIVATE_logDebug("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=Zs,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(Zs=>Ys(Zs)),setTimeout(()=>{if(!this.appCheck){const Zs=this.V.getImmediate({optional:!0});Zs?Ys(Zs):__PRIVATE_logDebug("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new AppCheckToken(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(Hs=>Hs?(__PRIVATE_hardAssert(typeof Hs.token=="string",44558,{tokenResult:Hs}),this.m=Hs.token,new AppCheckToken(Hs.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_randomBytes(Z){const t=typeof self<"u"&&(self.crypto||self.msCrypto),Hs=new Uint8Array(Z);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(Hs);else for(let zs=0;zs<Z;zs++)Hs[zs]=Math.floor(256*Math.random());return Hs}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_AutoId{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",Hs=62*Math.floor(4.129032258064516);let zs="";for(;zs.length<20;){const Ys=__PRIVATE_randomBytes(40);for(let Zs=0;Zs<Ys.length;++Zs)zs.length<20&&Ys[Zs]<Hs&&(zs+=t.charAt(Ys[Zs]%62))}return zs}}function __PRIVATE_primitiveComparator(Z,t){return Z<t?-1:Z>t?1:0}function __PRIVATE_compareUtf8Strings(Z,t){const Hs=Math.min(Z.length,t.length);for(let zs=0;zs<Hs;zs++){const Ys=Z.charAt(zs),Zs=t.charAt(zs);if(Ys!==Zs)return __PRIVATE_isSurrogate(Ys)===__PRIVATE_isSurrogate(Zs)?__PRIVATE_primitiveComparator(Ys,Zs):__PRIVATE_isSurrogate(Ys)?1:-1}return __PRIVATE_primitiveComparator(Z.length,t.length)}const v=55296,F=57343;function __PRIVATE_isSurrogate(Z){const t=Z.charCodeAt(0);return t>=v&&t<=F}function __PRIVATE_arrayEquals(Z,t,Hs){return Z.length===t.length&&Z.every((zs,Ys)=>Hs(zs,t[Ys]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M="__name__";class BasePath{constructor(t,Hs,zs){Hs===void 0?Hs=0:Hs>t.length&&fail(637,{offset:Hs,range:t.length}),zs===void 0?zs=t.length-Hs:zs>t.length-Hs&&fail(1746,{length:zs,range:t.length-Hs}),this.segments=t,this.offset=Hs,this.len=zs}get length(){return this.len}isEqual(t){return BasePath.comparator(this,t)===0}child(t){const Hs=this.segments.slice(this.offset,this.limit());return t instanceof BasePath?t.forEach(zs=>{Hs.push(zs)}):Hs.push(t),this.construct(Hs)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let Hs=0;Hs<this.length;Hs++)if(this.get(Hs)!==t.get(Hs))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let Hs=0;Hs<this.length;Hs++)if(this.get(Hs)!==t.get(Hs))return!1;return!0}forEach(t){for(let Hs=this.offset,zs=this.limit();Hs<zs;Hs++)t(this.segments[Hs])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,Hs){const zs=Math.min(t.length,Hs.length);for(let Ys=0;Ys<zs;Ys++){const Zs=BasePath.compareSegments(t.get(Ys),Hs.get(Ys));if(Zs!==0)return Zs}return __PRIVATE_primitiveComparator(t.length,Hs.length)}static compareSegments(t,Hs){const zs=BasePath.isNumericId(t),Ys=BasePath.isNumericId(Hs);return zs&&!Ys?-1:!zs&&Ys?1:zs&&Ys?BasePath.extractNumericId(t).compare(BasePath.extractNumericId(Hs)):__PRIVATE_compareUtf8Strings(t,Hs)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return Integer.fromString(t.substring(4,t.length-2))}}class ResourcePath extends BasePath{construct(t,Hs,zs){return new ResourcePath(t,Hs,zs)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const Hs=[];for(const zs of t){if(zs.indexOf("//")>=0)throw new FirestoreError(C.INVALID_ARGUMENT,`Invalid segment (${zs}). Paths must not contain // in them.`);Hs.push(...zs.split("/").filter(Ys=>Ys.length>0))}return new ResourcePath(Hs)}static emptyPath(){return new ResourcePath([])}}const x=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class FieldPath$1 extends BasePath{construct(t,Hs,zs){return new FieldPath$1(t,Hs,zs)}static isValidIdentifier(t){return x.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),FieldPath$1.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===M}static keyField(){return new FieldPath$1([M])}static fromServerFormat(t){const Hs=[];let zs="",Ys=0;const Zs=()=>{if(zs.length===0)throw new FirestoreError(C.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);Hs.push(zs),zs=""};let _u=!1;for(;Ys<t.length;){const Eu=t[Ys];if(Eu==="\\"){if(Ys+1===t.length)throw new FirestoreError(C.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const Iu=t[Ys+1];if(Iu!=="\\"&&Iu!=="."&&Iu!=="`")throw new FirestoreError(C.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);zs+=Iu,Ys+=2}else Eu==="`"?(_u=!_u,Ys++):Eu!=="."||_u?(zs+=Eu,Ys++):(Zs(),Ys++)}if(Zs(),_u)throw new FirestoreError(C.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new FieldPath$1(Hs)}static emptyPath(){return new FieldPath$1([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DocumentKey{constructor(t){this.path=t}static fromPath(t){return new DocumentKey(ResourcePath.fromString(t))}static fromName(t){return new DocumentKey(ResourcePath.fromString(t).popFirst(5))}static empty(){return new DocumentKey(ResourcePath.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&ResourcePath.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,Hs){return ResourcePath.comparator(t.path,Hs.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new DocumentKey(new ResourcePath(t.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_validateNonEmptyArgument(Z,t,Hs){if(!Hs)throw new FirestoreError(C.INVALID_ARGUMENT,`Function ${Z}() cannot be called with an empty ${t}.`)}function __PRIVATE_validateIsNotUsedTogether(Z,t,Hs,zs){if(t===!0&&zs===!0)throw new FirestoreError(C.INVALID_ARGUMENT,`${Z} and ${Hs} cannot be used together.`)}function __PRIVATE_validateDocumentPath(Z){if(!DocumentKey.isDocumentKey(Z))throw new FirestoreError(C.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${Z} has ${Z.length}.`)}function __PRIVATE_validateCollectionPath(Z){if(DocumentKey.isDocumentKey(Z))throw new FirestoreError(C.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${Z} has ${Z.length}.`)}function __PRIVATE_isPlainObject(Z){return typeof Z=="object"&&Z!==null&&(Object.getPrototypeOf(Z)===Object.prototype||Object.getPrototypeOf(Z)===null)}function __PRIVATE_valueDescription(Z){if(Z===void 0)return"undefined";if(Z===null)return"null";if(typeof Z=="string")return Z.length>20&&(Z=`${Z.substring(0,20)}...`),JSON.stringify(Z);if(typeof Z=="number"||typeof Z=="boolean")return""+Z;if(typeof Z=="object"){if(Z instanceof Array)return"an array";{const t=function(zs){return zs.constructor?zs.constructor.name:null}(Z);return t?`a custom ${t} object`:"an object"}}return typeof Z=="function"?"a function":fail(12329,{type:typeof Z})}function __PRIVATE_cast(Z,t){if("_delegate"in Z&&(Z=Z._delegate),!(Z instanceof t)){if(t.name===Z.constructor.name)throw new FirestoreError(C.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const Hs=__PRIVATE_valueDescription(Z);throw new FirestoreError(C.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${Hs}`)}}return Z}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function property(Z,t){const Hs={typeString:Z};return t&&(Hs.value=t),Hs}function __PRIVATE_validateJSON(Z,t){if(!__PRIVATE_isPlainObject(Z))throw new FirestoreError(C.INVALID_ARGUMENT,"JSON must be an object");let Hs;for(const zs in t)if(t[zs]){const Ys=t[zs].typeString,Zs="value"in t[zs]?{value:t[zs].value}:void 0;if(!(zs in Z)){Hs=`JSON missing required field: '${zs}'`;break}const _u=Z[zs];if(Ys&&typeof _u!==Ys){Hs=`JSON field '${zs}' must be a ${Ys}.`;break}if(Zs!==void 0&&_u!==Zs.value){Hs=`Expected '${zs}' field to equal '${Zs.value}'`;break}}if(Hs)throw new FirestoreError(C.INVALID_ARGUMENT,Hs);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O=-62135596800,N=1e6;class Timestamp{static now(){return Timestamp.fromMillis(Date.now())}static fromDate(t){return Timestamp.fromMillis(t.getTime())}static fromMillis(t){const Hs=Math.floor(t/1e3),zs=Math.floor((t-1e3*Hs)*N);return new Timestamp(Hs,zs)}constructor(t,Hs){if(this.seconds=t,this.nanoseconds=Hs,Hs<0)throw new FirestoreError(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+Hs);if(Hs>=1e9)throw new FirestoreError(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+Hs);if(t<O)throw new FirestoreError(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new FirestoreError(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/N}_compareTo(t){return this.seconds===t.seconds?__PRIVATE_primitiveComparator(this.nanoseconds,t.nanoseconds):__PRIVATE_primitiveComparator(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Timestamp._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(__PRIVATE_validateJSON(t,Timestamp._jsonSchema))return new Timestamp(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-O;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Timestamp._jsonSchemaVersion="firestore/timestamp/1.0",Timestamp._jsonSchema={type:property("string",Timestamp._jsonSchemaVersion),seconds:property("number"),nanoseconds:property("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SnapshotVersion{static fromTimestamp(t){return new SnapshotVersion(t)}static min(){return new SnapshotVersion(new Timestamp(0,0))}static max(){return new SnapshotVersion(new Timestamp(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B=-1;function __PRIVATE_newIndexOffsetSuccessorFromReadTime(Z,t){const Hs=Z.toTimestamp().seconds,zs=Z.toTimestamp().nanoseconds+1,Ys=SnapshotVersion.fromTimestamp(zs===1e9?new Timestamp(Hs+1,0):new Timestamp(Hs,zs));return new IndexOffset(Ys,DocumentKey.empty(),t)}function __PRIVATE_newIndexOffsetFromDocument(Z){return new IndexOffset(Z.readTime,Z.key,B)}class IndexOffset{constructor(t,Hs,zs){this.readTime=t,this.documentKey=Hs,this.largestBatchId=zs}static min(){return new IndexOffset(SnapshotVersion.min(),DocumentKey.empty(),B)}static max(){return new IndexOffset(SnapshotVersion.max(),DocumentKey.empty(),B)}}function __PRIVATE_indexOffsetComparator(Z,t){let Hs=Z.readTime.compareTo(t.readTime);return Hs!==0?Hs:(Hs=DocumentKey.comparator(Z.documentKey,t.documentKey),Hs!==0?Hs:__PRIVATE_primitiveComparator(Z.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class PersistenceTransaction{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function __PRIVATE_ignoreIfPrimaryLeaseLoss(Z){if(Z.code!==C.FAILED_PRECONDITION||Z.message!==L)throw Z;__PRIVATE_logDebug("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PersistencePromise{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(Hs=>{this.isDone=!0,this.result=Hs,this.nextCallback&&this.nextCallback(Hs)},Hs=>{this.isDone=!0,this.error=Hs,this.catchCallback&&this.catchCallback(Hs)})}catch(t){return this.next(void 0,t)}next(t,Hs){return this.callbackAttached&&fail(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(Hs,this.error):this.wrapSuccess(t,this.result):new PersistencePromise((zs,Ys)=>{this.nextCallback=Zs=>{this.wrapSuccess(t,Zs).next(zs,Ys)},this.catchCallback=Zs=>{this.wrapFailure(Hs,Zs).next(zs,Ys)}})}toPromise(){return new Promise((t,Hs)=>{this.next(t,Hs)})}wrapUserFunction(t){try{const Hs=t();return Hs instanceof PersistencePromise?Hs:PersistencePromise.resolve(Hs)}catch(Hs){return PersistencePromise.reject(Hs)}}wrapSuccess(t,Hs){return t?this.wrapUserFunction(()=>t(Hs)):PersistencePromise.resolve(Hs)}wrapFailure(t,Hs){return t?this.wrapUserFunction(()=>t(Hs)):PersistencePromise.reject(Hs)}static resolve(t){return new PersistencePromise((Hs,zs)=>{Hs(t)})}static reject(t){return new PersistencePromise((Hs,zs)=>{zs(t)})}static waitFor(t){return new PersistencePromise((Hs,zs)=>{let Ys=0,Zs=0,_u=!1;t.forEach(Eu=>{++Ys,Eu.next(()=>{++Zs,_u&&Zs===Ys&&Hs()},Iu=>zs(Iu))}),_u=!0,Zs===Ys&&Hs()})}static or(t){let Hs=PersistencePromise.resolve(!1);for(const zs of t)Hs=Hs.next(Ys=>Ys?PersistencePromise.resolve(Ys):zs());return Hs}static forEach(t,Hs){const zs=[];return t.forEach((Ys,Zs)=>{zs.push(Hs.call(this,Ys,Zs))}),this.waitFor(zs)}static mapArray(t,Hs){return new PersistencePromise((zs,Ys)=>{const Zs=t.length,_u=new Array(Zs);let Eu=0;for(let Iu=0;Iu<Zs;Iu++){const Au=Iu;Hs(t[Au]).next($u=>{_u[Au]=$u,++Eu,Eu===Zs&&zs(_u)},$u=>Ys($u))}})}static doWhile(t,Hs){return new PersistencePromise((zs,Ys)=>{const Zs=()=>{t()===!0?Hs().next(()=>{Zs()},Ys):zs()};Zs()})}}function __PRIVATE_getAndroidVersion(Z){const t=Z.match(/Android ([\d.]+)/i),Hs=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(Hs)}function __PRIVATE_isIndexedDbTransactionError(Z){return Z.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_ListenSequence{constructor(t,Hs){this.previousValue=t,Hs&&(Hs.sequenceNumberHandler=zs=>this.ae(zs),this.ue=zs=>Hs.writeSequenceNumber(zs))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}__PRIVATE_ListenSequence.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U=-1;function __PRIVATE_isNullOrUndefined(Z){return Z==null}function __PRIVATE_isNegativeZero(Z){return Z===0&&1/Z==-1/0}function isSafeInteger(Z){return typeof Z=="number"&&Number.isInteger(Z)&&!__PRIVATE_isNegativeZero(Z)&&Z<=Number.MAX_SAFE_INTEGER&&Z>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $="";function __PRIVATE_encodeResourcePath(Z){let t="";for(let Hs=0;Hs<Z.length;Hs++)t.length>0&&(t=__PRIVATE_encodeSeparator(t)),t=__PRIVATE_encodeSegment(Z.get(Hs),t);return __PRIVATE_encodeSeparator(t)}function __PRIVATE_encodeSegment(Z,t){let Hs=t;const zs=Z.length;for(let Ys=0;Ys<zs;Ys++){const Zs=Z.charAt(Ys);switch(Zs){case"\0":Hs+="";break;case $:Hs+="";break;default:Hs+=Zs}}return Hs}function __PRIVATE_encodeSeparator(Z){return Z+$+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_objectSize(Z){let t=0;for(const Hs in Z)Object.prototype.hasOwnProperty.call(Z,Hs)&&t++;return t}function forEach(Z,t){for(const Hs in Z)Object.prototype.hasOwnProperty.call(Z,Hs)&&t(Hs,Z[Hs])}function isEmpty(Z){for(const t in Z)if(Object.prototype.hasOwnProperty.call(Z,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SortedMap{constructor(t,Hs){this.comparator=t,this.root=Hs||LLRBNode.EMPTY}insert(t,Hs){return new SortedMap(this.comparator,this.root.insert(t,Hs,this.comparator).copy(null,null,LLRBNode.BLACK,null,null))}remove(t){return new SortedMap(this.comparator,this.root.remove(t,this.comparator).copy(null,null,LLRBNode.BLACK,null,null))}get(t){let Hs=this.root;for(;!Hs.isEmpty();){const zs=this.comparator(t,Hs.key);if(zs===0)return Hs.value;zs<0?Hs=Hs.left:zs>0&&(Hs=Hs.right)}return null}indexOf(t){let Hs=0,zs=this.root;for(;!zs.isEmpty();){const Ys=this.comparator(t,zs.key);if(Ys===0)return Hs+zs.left.size;Ys<0?zs=zs.left:(Hs+=zs.left.size+1,zs=zs.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((Hs,zs)=>(t(Hs,zs),!1))}toString(){const t=[];return this.inorderTraversal((Hs,zs)=>(t.push(`${Hs}:${zs}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new SortedMapIterator(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new SortedMapIterator(this.root,t,this.comparator,!1)}getReverseIterator(){return new SortedMapIterator(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new SortedMapIterator(this.root,t,this.comparator,!0)}}class SortedMapIterator{constructor(t,Hs,zs,Ys){this.isReverse=Ys,this.nodeStack=[];let Zs=1;for(;!t.isEmpty();)if(Zs=Hs?zs(t.key,Hs):1,Hs&&Ys&&(Zs*=-1),Zs<0)t=this.isReverse?t.left:t.right;else{if(Zs===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const Hs={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return Hs}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class LLRBNode{constructor(t,Hs,zs,Ys,Zs){this.key=t,this.value=Hs,this.color=zs??LLRBNode.RED,this.left=Ys??LLRBNode.EMPTY,this.right=Zs??LLRBNode.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,Hs,zs,Ys,Zs){return new LLRBNode(t??this.key,Hs??this.value,zs??this.color,Ys??this.left,Zs??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,Hs,zs){let Ys=this;const Zs=zs(t,Ys.key);return Ys=Zs<0?Ys.copy(null,null,null,Ys.left.insert(t,Hs,zs),null):Zs===0?Ys.copy(null,Hs,null,null,null):Ys.copy(null,null,null,null,Ys.right.insert(t,Hs,zs)),Ys.fixUp()}removeMin(){if(this.left.isEmpty())return LLRBNode.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,Hs){let zs,Ys=this;if(Hs(t,Ys.key)<0)Ys.left.isEmpty()||Ys.left.isRed()||Ys.left.left.isRed()||(Ys=Ys.moveRedLeft()),Ys=Ys.copy(null,null,null,Ys.left.remove(t,Hs),null);else{if(Ys.left.isRed()&&(Ys=Ys.rotateRight()),Ys.right.isEmpty()||Ys.right.isRed()||Ys.right.left.isRed()||(Ys=Ys.moveRedRight()),Hs(t,Ys.key)===0){if(Ys.right.isEmpty())return LLRBNode.EMPTY;zs=Ys.right.min(),Ys=Ys.copy(zs.key,zs.value,null,null,Ys.right.removeMin())}Ys=Ys.copy(null,null,null,null,Ys.right.remove(t,Hs))}return Ys.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,LLRBNode.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,LLRBNode.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),Hs=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,Hs)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw fail(43730,{key:this.key,value:this.value});if(this.right.isRed())throw fail(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw fail(27949);return t+(this.isRed()?0:1)}}LLRBNode.EMPTY=null,LLRBNode.RED=!0,LLRBNode.BLACK=!1;LLRBNode.EMPTY=new class{constructor(){this.size=0}get key(){throw fail(57766)}get value(){throw fail(16141)}get color(){throw fail(16727)}get left(){throw fail(29726)}get right(){throw fail(36894)}copy(t,Hs,zs,Ys,Zs){return this}insert(t,Hs,zs){return new LLRBNode(t,Hs)}remove(t,Hs){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SortedSet{constructor(t){this.comparator=t,this.data=new SortedMap(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((Hs,zs)=>(t(Hs),!1))}forEachInRange(t,Hs){const zs=this.data.getIteratorFrom(t[0]);for(;zs.hasNext();){const Ys=zs.getNext();if(this.comparator(Ys.key,t[1])>=0)return;Hs(Ys.key)}}forEachWhile(t,Hs){let zs;for(zs=Hs!==void 0?this.data.getIteratorFrom(Hs):this.data.getIterator();zs.hasNext();)if(!t(zs.getNext().key))return}firstAfterOrEqual(t){const Hs=this.data.getIteratorFrom(t);return Hs.hasNext()?Hs.getNext().key:null}getIterator(){return new SortedSetIterator(this.data.getIterator())}getIteratorFrom(t){return new SortedSetIterator(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let Hs=this;return Hs.size<t.size&&(Hs=t,t=this),t.forEach(zs=>{Hs=Hs.add(zs)}),Hs}isEqual(t){if(!(t instanceof SortedSet)||this.size!==t.size)return!1;const Hs=this.data.getIterator(),zs=t.data.getIterator();for(;Hs.hasNext();){const Ys=Hs.getNext().key,Zs=zs.getNext().key;if(this.comparator(Ys,Zs)!==0)return!1}return!0}toArray(){const t=[];return this.forEach(Hs=>{t.push(Hs)}),t}toString(){const t=[];return this.forEach(Hs=>t.push(Hs)),"SortedSet("+t.toString()+")"}copy(t){const Hs=new SortedSet(this.comparator);return Hs.data=t,Hs}}class SortedSetIterator{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FieldMask{constructor(t){this.fields=t,t.sort(FieldPath$1.comparator)}static empty(){return new FieldMask([])}unionWith(t){let Hs=new SortedSet(FieldPath$1.comparator);for(const zs of this.fields)Hs=Hs.add(zs);for(const zs of t)Hs=Hs.add(zs);return new FieldMask(Hs.toArray())}covers(t){for(const Hs of this.fields)if(Hs.isPrefixOf(t))return!0;return!1}isEqual(t){return __PRIVATE_arrayEquals(this.fields,t.fields,(Hs,zs)=>Hs.isEqual(zs))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_Base64DecodeError extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ByteString{constructor(t){this.binaryString=t}static fromBase64String(t){const Hs=function(Ys){try{return atob(Ys)}catch(Zs){throw typeof DOMException<"u"&&Zs instanceof DOMException?new __PRIVATE_Base64DecodeError("Invalid base64 string: "+Zs):Zs}}(t);return new ByteString(Hs)}static fromUint8Array(t){const Hs=function(Ys){let Zs="";for(let _u=0;_u<Ys.length;++_u)Zs+=String.fromCharCode(Ys[_u]);return Zs}(t);return new ByteString(Hs)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(Hs){return btoa(Hs)}(this.binaryString)}toUint8Array(){return function(Hs){const zs=new Uint8Array(Hs.length);for(let Ys=0;Ys<Hs.length;Ys++)zs[Ys]=Hs.charCodeAt(Ys);return zs}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return __PRIVATE_primitiveComparator(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}ByteString.EMPTY_BYTE_STRING=new ByteString("");const et=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function __PRIVATE_normalizeTimestamp(Z){if(__PRIVATE_hardAssert(!!Z,39018),typeof Z=="string"){let t=0;const Hs=et.exec(Z);if(__PRIVATE_hardAssert(!!Hs,46558,{timestamp:Z}),Hs[1]){let Ys=Hs[1];Ys=(Ys+"000000000").substr(0,9),t=Number(Ys)}const zs=new Date(Z);return{seconds:Math.floor(zs.getTime()/1e3),nanos:t}}return{seconds:__PRIVATE_normalizeNumber(Z.seconds),nanos:__PRIVATE_normalizeNumber(Z.nanos)}}function __PRIVATE_normalizeNumber(Z){return typeof Z=="number"?Z:typeof Z=="string"?Number(Z):0}function __PRIVATE_normalizeByteString(Z){return typeof Z=="string"?ByteString.fromBase64String(Z):ByteString.fromUint8Array(Z)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tt="server_timestamp",nt="__type__",rt="__previous_value__",it="__local_write_time__";function __PRIVATE_isServerTimestamp(Z){var Hs,zs;return((zs=(((Hs=Z==null?void 0:Z.mapValue)==null?void 0:Hs.fields)||{})[nt])==null?void 0:zs.stringValue)===tt}function __PRIVATE_getPreviousValue(Z){const t=Z.mapValue.fields[rt];return __PRIVATE_isServerTimestamp(t)?__PRIVATE_getPreviousValue(t):t}function __PRIVATE_getLocalWriteTime(Z){const t=__PRIVATE_normalizeTimestamp(Z.mapValue.fields[it].timestampValue);return new Timestamp(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DatabaseInfo{constructor(t,Hs,zs,Ys,Zs,_u,Eu,Iu,Au,$u,vu){this.databaseId=t,this.appId=Hs,this.persistenceKey=zs,this.host=Ys,this.ssl=Zs,this.forceLongPolling=_u,this.autoDetectLongPolling=Eu,this.longPollingOptions=Iu,this.useFetchStreams=Au,this.isUsingEmulator=$u,this.apiKey=vu}}const st="(default)";class DatabaseId{constructor(t,Hs){this.projectId=t,this.database=Hs||st}static empty(){return new DatabaseId("","")}get isDefaultDatabase(){return this.database===st}isEqual(t){return t instanceof DatabaseId&&t.projectId===this.projectId&&t.database===this.database}}function __PRIVATE_databaseIdFromApp(Z,t){if(!Object.prototype.hasOwnProperty.apply(Z.options,["projectId"]))throw new FirestoreError(C.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new DatabaseId(Z.options.projectId,t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ot="__type__",_t="__max__",at={mapValue:{fields:{__type__:{stringValue:_t}}}},ut="__vector__",ct="value";function __PRIVATE_typeOrder(Z){return"nullValue"in Z?0:"booleanValue"in Z?1:"integerValue"in Z||"doubleValue"in Z?2:"timestampValue"in Z?3:"stringValue"in Z?5:"bytesValue"in Z?6:"referenceValue"in Z?7:"geoPointValue"in Z?8:"arrayValue"in Z?9:"mapValue"in Z?__PRIVATE_isServerTimestamp(Z)?4:__PRIVATE_isMaxValue(Z)?9007199254740991:__PRIVATE_isVectorValue(Z)?10:11:fail(28295,{value:Z})}function __PRIVATE_valueEquals(Z,t){if(Z===t)return!0;const Hs=__PRIVATE_typeOrder(Z);if(Hs!==__PRIVATE_typeOrder(t))return!1;switch(Hs){case 0:case 9007199254740991:return!0;case 1:return Z.booleanValue===t.booleanValue;case 4:return __PRIVATE_getLocalWriteTime(Z).isEqual(__PRIVATE_getLocalWriteTime(t));case 3:return function(Ys,Zs){if(typeof Ys.timestampValue=="string"&&typeof Zs.timestampValue=="string"&&Ys.timestampValue.length===Zs.timestampValue.length)return Ys.timestampValue===Zs.timestampValue;const _u=__PRIVATE_normalizeTimestamp(Ys.timestampValue),Eu=__PRIVATE_normalizeTimestamp(Zs.timestampValue);return _u.seconds===Eu.seconds&&_u.nanos===Eu.nanos}(Z,t);case 5:return Z.stringValue===t.stringValue;case 6:return function(Ys,Zs){return __PRIVATE_normalizeByteString(Ys.bytesValue).isEqual(__PRIVATE_normalizeByteString(Zs.bytesValue))}(Z,t);case 7:return Z.referenceValue===t.referenceValue;case 8:return function(Ys,Zs){return __PRIVATE_normalizeNumber(Ys.geoPointValue.latitude)===__PRIVATE_normalizeNumber(Zs.geoPointValue.latitude)&&__PRIVATE_normalizeNumber(Ys.geoPointValue.longitude)===__PRIVATE_normalizeNumber(Zs.geoPointValue.longitude)}(Z,t);case 2:return function(Ys,Zs){if("integerValue"in Ys&&"integerValue"in Zs)return __PRIVATE_normalizeNumber(Ys.integerValue)===__PRIVATE_normalizeNumber(Zs.integerValue);if("doubleValue"in Ys&&"doubleValue"in Zs){const _u=__PRIVATE_normalizeNumber(Ys.doubleValue),Eu=__PRIVATE_normalizeNumber(Zs.doubleValue);return _u===Eu?__PRIVATE_isNegativeZero(_u)===__PRIVATE_isNegativeZero(Eu):isNaN(_u)&&isNaN(Eu)}return!1}(Z,t);case 9:return __PRIVATE_arrayEquals(Z.arrayValue.values||[],t.arrayValue.values||[],__PRIVATE_valueEquals);case 10:case 11:return function(Ys,Zs){const _u=Ys.mapValue.fields||{},Eu=Zs.mapValue.fields||{};if(__PRIVATE_objectSize(_u)!==__PRIVATE_objectSize(Eu))return!1;for(const Iu in _u)if(_u.hasOwnProperty(Iu)&&(Eu[Iu]===void 0||!__PRIVATE_valueEquals(_u[Iu],Eu[Iu])))return!1;return!0}(Z,t);default:return fail(52216,{left:Z})}}function __PRIVATE_arrayValueContains(Z,t){return(Z.values||[]).find(Hs=>__PRIVATE_valueEquals(Hs,t))!==void 0}function __PRIVATE_valueCompare(Z,t){if(Z===t)return 0;const Hs=__PRIVATE_typeOrder(Z),zs=__PRIVATE_typeOrder(t);if(Hs!==zs)return __PRIVATE_primitiveComparator(Hs,zs);switch(Hs){case 0:case 9007199254740991:return 0;case 1:return __PRIVATE_primitiveComparator(Z.booleanValue,t.booleanValue);case 2:return function(Zs,_u){const Eu=__PRIVATE_normalizeNumber(Zs.integerValue||Zs.doubleValue),Iu=__PRIVATE_normalizeNumber(_u.integerValue||_u.doubleValue);return Eu<Iu?-1:Eu>Iu?1:Eu===Iu?0:isNaN(Eu)?isNaN(Iu)?0:-1:1}(Z,t);case 3:return __PRIVATE_compareTimestamps(Z.timestampValue,t.timestampValue);case 4:return __PRIVATE_compareTimestamps(__PRIVATE_getLocalWriteTime(Z),__PRIVATE_getLocalWriteTime(t));case 5:return __PRIVATE_compareUtf8Strings(Z.stringValue,t.stringValue);case 6:return function(Zs,_u){const Eu=__PRIVATE_normalizeByteString(Zs),Iu=__PRIVATE_normalizeByteString(_u);return Eu.compareTo(Iu)}(Z.bytesValue,t.bytesValue);case 7:return function(Zs,_u){const Eu=Zs.split("/"),Iu=_u.split("/");for(let Au=0;Au<Eu.length&&Au<Iu.length;Au++){const $u=__PRIVATE_primitiveComparator(Eu[Au],Iu[Au]);if($u!==0)return $u}return __PRIVATE_primitiveComparator(Eu.length,Iu.length)}(Z.referenceValue,t.referenceValue);case 8:return function(Zs,_u){const Eu=__PRIVATE_primitiveComparator(__PRIVATE_normalizeNumber(Zs.latitude),__PRIVATE_normalizeNumber(_u.latitude));return Eu!==0?Eu:__PRIVATE_primitiveComparator(__PRIVATE_normalizeNumber(Zs.longitude),__PRIVATE_normalizeNumber(_u.longitude))}(Z.geoPointValue,t.geoPointValue);case 9:return __PRIVATE_compareArrays(Z.arrayValue,t.arrayValue);case 10:return function(Zs,_u){var Su,Ru,Pu,Cu;const Eu=Zs.fields||{},Iu=_u.fields||{},Au=(Su=Eu[ct])==null?void 0:Su.arrayValue,$u=(Ru=Iu[ct])==null?void 0:Ru.arrayValue,vu=__PRIVATE_primitiveComparator(((Pu=Au==null?void 0:Au.values)==null?void 0:Pu.length)||0,((Cu=$u==null?void 0:$u.values)==null?void 0:Cu.length)||0);return vu!==0?vu:__PRIVATE_compareArrays(Au,$u)}(Z.mapValue,t.mapValue);case 11:return function(Zs,_u){if(Zs===at.mapValue&&_u===at.mapValue)return 0;if(Zs===at.mapValue)return 1;if(_u===at.mapValue)return-1;const Eu=Zs.fields||{},Iu=Object.keys(Eu),Au=_u.fields||{},$u=Object.keys(Au);Iu.sort(),$u.sort();for(let vu=0;vu<Iu.length&&vu<$u.length;++vu){const Su=__PRIVATE_compareUtf8Strings(Iu[vu],$u[vu]);if(Su!==0)return Su;const Ru=__PRIVATE_valueCompare(Eu[Iu[vu]],Au[$u[vu]]);if(Ru!==0)return Ru}return __PRIVATE_primitiveComparator(Iu.length,$u.length)}(Z.mapValue,t.mapValue);default:throw fail(23264,{he:Hs})}}function __PRIVATE_compareTimestamps(Z,t){if(typeof Z=="string"&&typeof t=="string"&&Z.length===t.length)return __PRIVATE_primitiveComparator(Z,t);const Hs=__PRIVATE_normalizeTimestamp(Z),zs=__PRIVATE_normalizeTimestamp(t),Ys=__PRIVATE_primitiveComparator(Hs.seconds,zs.seconds);return Ys!==0?Ys:__PRIVATE_primitiveComparator(Hs.nanos,zs.nanos)}function __PRIVATE_compareArrays(Z,t){const Hs=Z.values||[],zs=t.values||[];for(let Ys=0;Ys<Hs.length&&Ys<zs.length;++Ys){const Zs=__PRIVATE_valueCompare(Hs[Ys],zs[Ys]);if(Zs)return Zs}return __PRIVATE_primitiveComparator(Hs.length,zs.length)}function canonicalId(Z){return __PRIVATE_canonifyValue(Z)}function __PRIVATE_canonifyValue(Z){return"nullValue"in Z?"null":"booleanValue"in Z?""+Z.booleanValue:"integerValue"in Z?""+Z.integerValue:"doubleValue"in Z?""+Z.doubleValue:"timestampValue"in Z?function(Hs){const zs=__PRIVATE_normalizeTimestamp(Hs);return`time(${zs.seconds},${zs.nanos})`}(Z.timestampValue):"stringValue"in Z?Z.stringValue:"bytesValue"in Z?function(Hs){return __PRIVATE_normalizeByteString(Hs).toBase64()}(Z.bytesValue):"referenceValue"in Z?function(Hs){return DocumentKey.fromName(Hs).toString()}(Z.referenceValue):"geoPointValue"in Z?function(Hs){return`geo(${Hs.latitude},${Hs.longitude})`}(Z.geoPointValue):"arrayValue"in Z?function(Hs){let zs="[",Ys=!0;for(const Zs of Hs.values||[])Ys?Ys=!1:zs+=",",zs+=__PRIVATE_canonifyValue(Zs);return zs+"]"}(Z.arrayValue):"mapValue"in Z?function(Hs){const zs=Object.keys(Hs.fields||{}).sort();let Ys="{",Zs=!0;for(const _u of zs)Zs?Zs=!1:Ys+=",",Ys+=`${_u}:${__PRIVATE_canonifyValue(Hs.fields[_u])}`;return Ys+"}"}(Z.mapValue):fail(61005,{value:Z})}function __PRIVATE_estimateByteSize(Z){switch(__PRIVATE_typeOrder(Z)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=__PRIVATE_getPreviousValue(Z);return t?16+__PRIVATE_estimateByteSize(t):16;case 5:return 2*Z.stringValue.length;case 6:return __PRIVATE_normalizeByteString(Z.bytesValue).approximateByteSize();case 7:return Z.referenceValue.length;case 9:return function(zs){return(zs.values||[]).reduce((Ys,Zs)=>Ys+__PRIVATE_estimateByteSize(Zs),0)}(Z.arrayValue);case 10:case 11:return function(zs){let Ys=0;return forEach(zs.fields,(Zs,_u)=>{Ys+=Zs.length+__PRIVATE_estimateByteSize(_u)}),Ys}(Z.mapValue);default:throw fail(13486,{value:Z})}}function isInteger(Z){return!!Z&&"integerValue"in Z}function isArray(Z){return!!Z&&"arrayValue"in Z}function __PRIVATE_isNullValue(Z){return!!Z&&"nullValue"in Z}function __PRIVATE_isNanValue(Z){return!!Z&&"doubleValue"in Z&&isNaN(Number(Z.doubleValue))}function __PRIVATE_isMapValue(Z){return!!Z&&"mapValue"in Z}function __PRIVATE_isVectorValue(Z){var Hs,zs;return((zs=(((Hs=Z==null?void 0:Z.mapValue)==null?void 0:Hs.fields)||{})[ot])==null?void 0:zs.stringValue)===ut}function __PRIVATE_deepClone(Z){if(Z.geoPointValue)return{geoPointValue:{...Z.geoPointValue}};if(Z.timestampValue&&typeof Z.timestampValue=="object")return{timestampValue:{...Z.timestampValue}};if(Z.mapValue){const t={mapValue:{fields:{}}};return forEach(Z.mapValue.fields,(Hs,zs)=>t.mapValue.fields[Hs]=__PRIVATE_deepClone(zs)),t}if(Z.arrayValue){const t={arrayValue:{values:[]}};for(let Hs=0;Hs<(Z.arrayValue.values||[]).length;++Hs)t.arrayValue.values[Hs]=__PRIVATE_deepClone(Z.arrayValue.values[Hs]);return t}return{...Z}}function __PRIVATE_isMaxValue(Z){return(((Z.mapValue||{}).fields||{}).__type__||{}).stringValue===_t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ObjectValue{constructor(t){this.value=t}static empty(){return new ObjectValue({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let Hs=this.value;for(let zs=0;zs<t.length-1;++zs)if(Hs=(Hs.mapValue.fields||{})[t.get(zs)],!__PRIVATE_isMapValue(Hs))return null;return Hs=(Hs.mapValue.fields||{})[t.lastSegment()],Hs||null}}set(t,Hs){this.getFieldsMap(t.popLast())[t.lastSegment()]=__PRIVATE_deepClone(Hs)}setAll(t){let Hs=FieldPath$1.emptyPath(),zs={},Ys=[];t.forEach((_u,Eu)=>{if(!Hs.isImmediateParentOf(Eu)){const Iu=this.getFieldsMap(Hs);this.applyChanges(Iu,zs,Ys),zs={},Ys=[],Hs=Eu.popLast()}_u?zs[Eu.lastSegment()]=__PRIVATE_deepClone(_u):Ys.push(Eu.lastSegment())});const Zs=this.getFieldsMap(Hs);this.applyChanges(Zs,zs,Ys)}delete(t){const Hs=this.field(t.popLast());__PRIVATE_isMapValue(Hs)&&Hs.mapValue.fields&&delete Hs.mapValue.fields[t.lastSegment()]}isEqual(t){return __PRIVATE_valueEquals(this.value,t.value)}getFieldsMap(t){let Hs=this.value;Hs.mapValue.fields||(Hs.mapValue={fields:{}});for(let zs=0;zs<t.length;++zs){let Ys=Hs.mapValue.fields[t.get(zs)];__PRIVATE_isMapValue(Ys)&&Ys.mapValue.fields||(Ys={mapValue:{fields:{}}},Hs.mapValue.fields[t.get(zs)]=Ys),Hs=Ys}return Hs.mapValue.fields}applyChanges(t,Hs,zs){forEach(Hs,(Ys,Zs)=>t[Ys]=Zs);for(const Ys of zs)delete t[Ys]}clone(){return new ObjectValue(__PRIVATE_deepClone(this.value))}}function __PRIVATE_extractFieldMask(Z){const t=[];return forEach(Z.fields,(Hs,zs)=>{const Ys=new FieldPath$1([Hs]);if(__PRIVATE_isMapValue(zs)){const Zs=__PRIVATE_extractFieldMask(zs.mapValue).fields;if(Zs.length===0)t.push(Ys);else for(const _u of Zs)t.push(Ys.child(_u))}else t.push(Ys)}),new FieldMask(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MutableDocument{constructor(t,Hs,zs,Ys,Zs,_u,Eu){this.key=t,this.documentType=Hs,this.version=zs,this.readTime=Ys,this.createTime=Zs,this.data=_u,this.documentState=Eu}static newInvalidDocument(t){return new MutableDocument(t,0,SnapshotVersion.min(),SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),0)}static newFoundDocument(t,Hs,zs,Ys){return new MutableDocument(t,1,Hs,SnapshotVersion.min(),zs,Ys,0)}static newNoDocument(t,Hs){return new MutableDocument(t,2,Hs,SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),0)}static newUnknownDocument(t,Hs){return new MutableDocument(t,3,Hs,SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),2)}convertToFoundDocument(t,Hs){return!this.createTime.isEqual(SnapshotVersion.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=Hs,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=ObjectValue.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=ObjectValue.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=SnapshotVersion.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof MutableDocument&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new MutableDocument(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bound{constructor(t,Hs){this.position=t,this.inclusive=Hs}}function __PRIVATE_boundCompareToDocument(Z,t,Hs){let zs=0;for(let Ys=0;Ys<Z.position.length;Ys++){const Zs=t[Ys],_u=Z.position[Ys];if(Zs.field.isKeyField()?zs=DocumentKey.comparator(DocumentKey.fromName(_u.referenceValue),Hs.key):zs=__PRIVATE_valueCompare(_u,Hs.data.field(Zs.field)),Zs.dir==="desc"&&(zs*=-1),zs!==0)break}return zs}function __PRIVATE_boundEquals(Z,t){if(Z===null)return t===null;if(t===null||Z.inclusive!==t.inclusive||Z.position.length!==t.position.length)return!1;for(let Hs=0;Hs<Z.position.length;Hs++)if(!__PRIVATE_valueEquals(Z.position[Hs],t.position[Hs]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OrderBy{constructor(t,Hs="asc"){this.field=t,this.dir=Hs}}function __PRIVATE_orderByEquals(Z,t){return Z.dir===t.dir&&Z.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Filter{}class FieldFilter extends Filter{constructor(t,Hs,zs){super(),this.field=t,this.op=Hs,this.value=zs}static create(t,Hs,zs){return t.isKeyField()?Hs==="in"||Hs==="not-in"?this.createKeyFieldInFilter(t,Hs,zs):new __PRIVATE_KeyFieldFilter(t,Hs,zs):Hs==="array-contains"?new __PRIVATE_ArrayContainsFilter(t,zs):Hs==="in"?new __PRIVATE_InFilter(t,zs):Hs==="not-in"?new __PRIVATE_NotInFilter(t,zs):Hs==="array-contains-any"?new __PRIVATE_ArrayContainsAnyFilter(t,zs):new FieldFilter(t,Hs,zs)}static createKeyFieldInFilter(t,Hs,zs){return Hs==="in"?new __PRIVATE_KeyFieldInFilter(t,zs):new __PRIVATE_KeyFieldNotInFilter(t,zs)}matches(t){const Hs=t.data.field(this.field);return this.op==="!="?Hs!==null&&Hs.nullValue===void 0&&this.matchesComparison(__PRIVATE_valueCompare(Hs,this.value)):Hs!==null&&__PRIVATE_typeOrder(this.value)===__PRIVATE_typeOrder(Hs)&&this.matchesComparison(__PRIVATE_valueCompare(Hs,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return fail(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class CompositeFilter extends Filter{constructor(t,Hs){super(),this.filters=t,this.op=Hs,this.Pe=null}static create(t,Hs){return new CompositeFilter(t,Hs)}matches(t){return __PRIVATE_compositeFilterIsConjunction(this)?this.filters.find(Hs=>!Hs.matches(t))===void 0:this.filters.find(Hs=>Hs.matches(t))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((t,Hs)=>t.concat(Hs.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function __PRIVATE_compositeFilterIsConjunction(Z){return Z.op==="and"}function __PRIVATE_compositeFilterIsFlatConjunction(Z){return __PRIVATE_compositeFilterIsFlat(Z)&&__PRIVATE_compositeFilterIsConjunction(Z)}function __PRIVATE_compositeFilterIsFlat(Z){for(const t of Z.filters)if(t instanceof CompositeFilter)return!1;return!0}function __PRIVATE_canonifyFilter(Z){if(Z instanceof FieldFilter)return Z.field.canonicalString()+Z.op.toString()+canonicalId(Z.value);if(__PRIVATE_compositeFilterIsFlatConjunction(Z))return Z.filters.map(t=>__PRIVATE_canonifyFilter(t)).join(",");{const t=Z.filters.map(Hs=>__PRIVATE_canonifyFilter(Hs)).join(",");return`${Z.op}(${t})`}}function __PRIVATE_filterEquals(Z,t){return Z instanceof FieldFilter?function(zs,Ys){return Ys instanceof FieldFilter&&zs.op===Ys.op&&zs.field.isEqual(Ys.field)&&__PRIVATE_valueEquals(zs.value,Ys.value)}(Z,t):Z instanceof CompositeFilter?function(zs,Ys){return Ys instanceof CompositeFilter&&zs.op===Ys.op&&zs.filters.length===Ys.filters.length?zs.filters.reduce((Zs,_u,Eu)=>Zs&&__PRIVATE_filterEquals(_u,Ys.filters[Eu]),!0):!1}(Z,t):void fail(19439)}function __PRIVATE_stringifyFilter(Z){return Z instanceof FieldFilter?function(Hs){return`${Hs.field.canonicalString()} ${Hs.op} ${canonicalId(Hs.value)}`}(Z):Z instanceof CompositeFilter?function(Hs){return Hs.op.toString()+" {"+Hs.getFilters().map(__PRIVATE_stringifyFilter).join(" ,")+"}"}(Z):"Filter"}class __PRIVATE_KeyFieldFilter extends FieldFilter{constructor(t,Hs,zs){super(t,Hs,zs),this.key=DocumentKey.fromName(zs.referenceValue)}matches(t){const Hs=DocumentKey.comparator(t.key,this.key);return this.matchesComparison(Hs)}}class __PRIVATE_KeyFieldInFilter extends FieldFilter{constructor(t,Hs){super(t,"in",Hs),this.keys=__PRIVATE_extractDocumentKeysFromArrayValue("in",Hs)}matches(t){return this.keys.some(Hs=>Hs.isEqual(t.key))}}class __PRIVATE_KeyFieldNotInFilter extends FieldFilter{constructor(t,Hs){super(t,"not-in",Hs),this.keys=__PRIVATE_extractDocumentKeysFromArrayValue("not-in",Hs)}matches(t){return!this.keys.some(Hs=>Hs.isEqual(t.key))}}function __PRIVATE_extractDocumentKeysFromArrayValue(Z,t){var Hs;return(((Hs=t.arrayValue)==null?void 0:Hs.values)||[]).map(zs=>DocumentKey.fromName(zs.referenceValue))}class __PRIVATE_ArrayContainsFilter extends FieldFilter{constructor(t,Hs){super(t,"array-contains",Hs)}matches(t){const Hs=t.data.field(this.field);return isArray(Hs)&&__PRIVATE_arrayValueContains(Hs.arrayValue,this.value)}}class __PRIVATE_InFilter extends FieldFilter{constructor(t,Hs){super(t,"in",Hs)}matches(t){const Hs=t.data.field(this.field);return Hs!==null&&__PRIVATE_arrayValueContains(this.value.arrayValue,Hs)}}class __PRIVATE_NotInFilter extends FieldFilter{constructor(t,Hs){super(t,"not-in",Hs)}matches(t){if(__PRIVATE_arrayValueContains(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const Hs=t.data.field(this.field);return Hs!==null&&Hs.nullValue===void 0&&!__PRIVATE_arrayValueContains(this.value.arrayValue,Hs)}}class __PRIVATE_ArrayContainsAnyFilter extends FieldFilter{constructor(t,Hs){super(t,"array-contains-any",Hs)}matches(t){const Hs=t.data.field(this.field);return!(!isArray(Hs)||!Hs.arrayValue.values)&&Hs.arrayValue.values.some(zs=>__PRIVATE_arrayValueContains(this.value.arrayValue,zs))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_TargetImpl{constructor(t,Hs=null,zs=[],Ys=[],Zs=null,_u=null,Eu=null){this.path=t,this.collectionGroup=Hs,this.orderBy=zs,this.filters=Ys,this.limit=Zs,this.startAt=_u,this.endAt=Eu,this.Te=null}}function __PRIVATE_newTarget(Z,t=null,Hs=[],zs=[],Ys=null,Zs=null,_u=null){return new __PRIVATE_TargetImpl(Z,t,Hs,zs,Ys,Zs,_u)}function __PRIVATE_canonifyTarget(Z){const t=__PRIVATE_debugCast(Z);if(t.Te===null){let Hs=t.path.canonicalString();t.collectionGroup!==null&&(Hs+="|cg:"+t.collectionGroup),Hs+="|f:",Hs+=t.filters.map(zs=>__PRIVATE_canonifyFilter(zs)).join(","),Hs+="|ob:",Hs+=t.orderBy.map(zs=>function(Zs){return Zs.field.canonicalString()+Zs.dir}(zs)).join(","),__PRIVATE_isNullOrUndefined(t.limit)||(Hs+="|l:",Hs+=t.limit),t.startAt&&(Hs+="|lb:",Hs+=t.startAt.inclusive?"b:":"a:",Hs+=t.startAt.position.map(zs=>canonicalId(zs)).join(",")),t.endAt&&(Hs+="|ub:",Hs+=t.endAt.inclusive?"a:":"b:",Hs+=t.endAt.position.map(zs=>canonicalId(zs)).join(",")),t.Te=Hs}return t.Te}function __PRIVATE_targetEquals(Z,t){if(Z.limit!==t.limit||Z.orderBy.length!==t.orderBy.length)return!1;for(let Hs=0;Hs<Z.orderBy.length;Hs++)if(!__PRIVATE_orderByEquals(Z.orderBy[Hs],t.orderBy[Hs]))return!1;if(Z.filters.length!==t.filters.length)return!1;for(let Hs=0;Hs<Z.filters.length;Hs++)if(!__PRIVATE_filterEquals(Z.filters[Hs],t.filters[Hs]))return!1;return Z.collectionGroup===t.collectionGroup&&!!Z.path.isEqual(t.path)&&!!__PRIVATE_boundEquals(Z.startAt,t.startAt)&&__PRIVATE_boundEquals(Z.endAt,t.endAt)}function __PRIVATE_targetIsDocumentTarget(Z){return DocumentKey.isDocumentKey(Z.path)&&Z.collectionGroup===null&&Z.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_QueryImpl{constructor(t,Hs=null,zs=[],Ys=[],Zs=null,_u="F",Eu=null,Iu=null){this.path=t,this.collectionGroup=Hs,this.explicitOrderBy=zs,this.filters=Ys,this.limit=Zs,this.limitType=_u,this.startAt=Eu,this.endAt=Iu,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function __PRIVATE_newQuery(Z,t,Hs,zs,Ys,Zs,_u,Eu){return new __PRIVATE_QueryImpl(Z,t,Hs,zs,Ys,Zs,_u,Eu)}function __PRIVATE_newQueryForPath(Z){return new __PRIVATE_QueryImpl(Z)}function __PRIVATE_queryMatchesAllDocuments(Z){return Z.filters.length===0&&Z.limit===null&&Z.startAt==null&&Z.endAt==null&&(Z.explicitOrderBy.length===0||Z.explicitOrderBy.length===1&&Z.explicitOrderBy[0].field.isKeyField())}function __PRIVATE_isDocumentQuery$1(Z){return DocumentKey.isDocumentKey(Z.path)&&Z.collectionGroup===null&&Z.filters.length===0}function __PRIVATE_isCollectionGroupQuery(Z){return Z.collectionGroup!==null}function __PRIVATE_queryNormalizedOrderBy(Z){const t=__PRIVATE_debugCast(Z);if(t.Ie===null){t.Ie=[];const Hs=new Set;for(const Zs of t.explicitOrderBy)t.Ie.push(Zs),Hs.add(Zs.field.canonicalString());const zs=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(_u){let Eu=new SortedSet(FieldPath$1.comparator);return _u.filters.forEach(Iu=>{Iu.getFlattenedFilters().forEach(Au=>{Au.isInequality()&&(Eu=Eu.add(Au.field))})}),Eu})(t).forEach(Zs=>{Hs.has(Zs.canonicalString())||Zs.isKeyField()||t.Ie.push(new OrderBy(Zs,zs))}),Hs.has(FieldPath$1.keyField().canonicalString())||t.Ie.push(new OrderBy(FieldPath$1.keyField(),zs))}return t.Ie}function __PRIVATE_queryToTarget(Z){const t=__PRIVATE_debugCast(Z);return t.Ee||(t.Ee=__PRIVATE__queryToTarget(t,__PRIVATE_queryNormalizedOrderBy(Z))),t.Ee}function __PRIVATE__queryToTarget(Z,t){if(Z.limitType==="F")return __PRIVATE_newTarget(Z.path,Z.collectionGroup,t,Z.filters,Z.limit,Z.startAt,Z.endAt);{t=t.map(Ys=>{const Zs=Ys.dir==="desc"?"asc":"desc";return new OrderBy(Ys.field,Zs)});const Hs=Z.endAt?new Bound(Z.endAt.position,Z.endAt.inclusive):null,zs=Z.startAt?new Bound(Z.startAt.position,Z.startAt.inclusive):null;return __PRIVATE_newTarget(Z.path,Z.collectionGroup,t,Z.filters,Z.limit,Hs,zs)}}function __PRIVATE_queryWithLimit(Z,t,Hs){return new __PRIVATE_QueryImpl(Z.path,Z.collectionGroup,Z.explicitOrderBy.slice(),Z.filters.slice(),t,Hs,Z.startAt,Z.endAt)}function __PRIVATE_queryEquals(Z,t){return __PRIVATE_targetEquals(__PRIVATE_queryToTarget(Z),__PRIVATE_queryToTarget(t))&&Z.limitType===t.limitType}function __PRIVATE_canonifyQuery(Z){return`${__PRIVATE_canonifyTarget(__PRIVATE_queryToTarget(Z))}|lt:${Z.limitType}`}function __PRIVATE_stringifyQuery(Z){return`Query(target=${function(Hs){let zs=Hs.path.canonicalString();return Hs.collectionGroup!==null&&(zs+=" collectionGroup="+Hs.collectionGroup),Hs.filters.length>0&&(zs+=`, filters: [${Hs.filters.map(Ys=>__PRIVATE_stringifyFilter(Ys)).join(", ")}]`),__PRIVATE_isNullOrUndefined(Hs.limit)||(zs+=", limit: "+Hs.limit),Hs.orderBy.length>0&&(zs+=`, orderBy: [${Hs.orderBy.map(Ys=>function(_u){return`${_u.field.canonicalString()} (${_u.dir})`}(Ys)).join(", ")}]`),Hs.startAt&&(zs+=", startAt: ",zs+=Hs.startAt.inclusive?"b:":"a:",zs+=Hs.startAt.position.map(Ys=>canonicalId(Ys)).join(",")),Hs.endAt&&(zs+=", endAt: ",zs+=Hs.endAt.inclusive?"a:":"b:",zs+=Hs.endAt.position.map(Ys=>canonicalId(Ys)).join(",")),`Target(${zs})`}(__PRIVATE_queryToTarget(Z))}; limitType=${Z.limitType})`}function __PRIVATE_queryMatches(Z,t){return t.isFoundDocument()&&function(zs,Ys){const Zs=Ys.key.path;return zs.collectionGroup!==null?Ys.key.hasCollectionId(zs.collectionGroup)&&zs.path.isPrefixOf(Zs):DocumentKey.isDocumentKey(zs.path)?zs.path.isEqual(Zs):zs.path.isImmediateParentOf(Zs)}(Z,t)&&function(zs,Ys){for(const Zs of __PRIVATE_queryNormalizedOrderBy(zs))if(!Zs.field.isKeyField()&&Ys.data.field(Zs.field)===null)return!1;return!0}(Z,t)&&function(zs,Ys){for(const Zs of zs.filters)if(!Zs.matches(Ys))return!1;return!0}(Z,t)&&function(zs,Ys){return!(zs.startAt&&!function(_u,Eu,Iu){const Au=__PRIVATE_boundCompareToDocument(_u,Eu,Iu);return _u.inclusive?Au<=0:Au<0}(zs.startAt,__PRIVATE_queryNormalizedOrderBy(zs),Ys)||zs.endAt&&!function(_u,Eu,Iu){const Au=__PRIVATE_boundCompareToDocument(_u,Eu,Iu);return _u.inclusive?Au>=0:Au>0}(zs.endAt,__PRIVATE_queryNormalizedOrderBy(zs),Ys))}(Z,t)}function __PRIVATE_queryCollectionGroup(Z){return Z.collectionGroup||(Z.path.length%2==1?Z.path.lastSegment():Z.path.get(Z.path.length-2))}function __PRIVATE_newQueryComparator(Z){return(t,Hs)=>{let zs=!1;for(const Ys of __PRIVATE_queryNormalizedOrderBy(Z)){const Zs=__PRIVATE_compareDocs(Ys,t,Hs);if(Zs!==0)return Zs;zs=zs||Ys.field.isKeyField()}return 0}}function __PRIVATE_compareDocs(Z,t,Hs){const zs=Z.field.isKeyField()?DocumentKey.comparator(t.key,Hs.key):function(Zs,_u,Eu){const Iu=_u.data.field(Zs),Au=Eu.data.field(Zs);return Iu!==null&&Au!==null?__PRIVATE_valueCompare(Iu,Au):fail(42886)}(Z.field,t,Hs);switch(Z.dir){case"asc":return zs;case"desc":return-1*zs;default:return fail(19790,{direction:Z.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ObjectMap{constructor(t,Hs){this.mapKeyFn=t,this.equalsFn=Hs,this.inner={},this.innerSize=0}get(t){const Hs=this.mapKeyFn(t),zs=this.inner[Hs];if(zs!==void 0){for(const[Ys,Zs]of zs)if(this.equalsFn(Ys,t))return Zs}}has(t){return this.get(t)!==void 0}set(t,Hs){const zs=this.mapKeyFn(t),Ys=this.inner[zs];if(Ys===void 0)return this.inner[zs]=[[t,Hs]],void this.innerSize++;for(let Zs=0;Zs<Ys.length;Zs++)if(this.equalsFn(Ys[Zs][0],t))return void(Ys[Zs]=[t,Hs]);Ys.push([t,Hs]),this.innerSize++}delete(t){const Hs=this.mapKeyFn(t),zs=this.inner[Hs];if(zs===void 0)return!1;for(let Ys=0;Ys<zs.length;Ys++)if(this.equalsFn(zs[Ys][0],t))return zs.length===1?delete this.inner[Hs]:zs.splice(Ys,1),this.innerSize--,!0;return!1}forEach(t){forEach(this.inner,(Hs,zs)=>{for(const[Ys,Zs]of zs)t(Ys,Zs)})}isEmpty(){return isEmpty(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pt=new SortedMap(DocumentKey.comparator);function __PRIVATE_mutableDocumentMap(){return Pt}const Tt=new SortedMap(DocumentKey.comparator);function documentMap(...Z){let t=Tt;for(const Hs of Z)t=t.insert(Hs.key,Hs);return t}function __PRIVATE_convertOverlayedDocumentMapToDocumentMap(Z){let t=Tt;return Z.forEach((Hs,zs)=>t=t.insert(Hs,zs.overlayedDocument)),t}function __PRIVATE_newOverlayMap(){return __PRIVATE_newDocumentKeyMap()}function __PRIVATE_newMutationMap(){return __PRIVATE_newDocumentKeyMap()}function __PRIVATE_newDocumentKeyMap(){return new ObjectMap(Z=>Z.toString(),(Z,t)=>Z.isEqual(t))}const It=new SortedMap(DocumentKey.comparator),Et=new SortedSet(DocumentKey.comparator);function __PRIVATE_documentKeySet(...Z){let t=Et;for(const Hs of Z)t=t.add(Hs);return t}const Rt=new SortedSet(__PRIVATE_primitiveComparator);function __PRIVATE_targetIdSet(){return Rt}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_toDouble(Z,t){if(Z.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:__PRIVATE_isNegativeZero(t)?"-0":t}}function __PRIVATE_toInteger(Z){return{integerValue:""+Z}}function toNumber(Z,t){return isSafeInteger(t)?__PRIVATE_toInteger(t):__PRIVATE_toDouble(Z,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TransformOperation{constructor(){this._=void 0}}function __PRIVATE_applyTransformOperationToLocalView(Z,t,Hs){return Z instanceof __PRIVATE_ServerTimestampTransform?function(Ys,Zs){const _u={fields:{[nt]:{stringValue:tt},[it]:{timestampValue:{seconds:Ys.seconds,nanos:Ys.nanoseconds}}}};return Zs&&__PRIVATE_isServerTimestamp(Zs)&&(Zs=__PRIVATE_getPreviousValue(Zs)),Zs&&(_u.fields[rt]=Zs),{mapValue:_u}}(Hs,t):Z instanceof __PRIVATE_ArrayUnionTransformOperation?__PRIVATE_applyArrayUnionTransformOperation(Z,t):Z instanceof __PRIVATE_ArrayRemoveTransformOperation?__PRIVATE_applyArrayRemoveTransformOperation(Z,t):function(Ys,Zs){const _u=__PRIVATE_computeTransformOperationBaseValue(Ys,Zs),Eu=asNumber(_u)+asNumber(Ys.Ae);return isInteger(_u)&&isInteger(Ys.Ae)?__PRIVATE_toInteger(Eu):__PRIVATE_toDouble(Ys.serializer,Eu)}(Z,t)}function __PRIVATE_applyTransformOperationToRemoteDocument(Z,t,Hs){return Z instanceof __PRIVATE_ArrayUnionTransformOperation?__PRIVATE_applyArrayUnionTransformOperation(Z,t):Z instanceof __PRIVATE_ArrayRemoveTransformOperation?__PRIVATE_applyArrayRemoveTransformOperation(Z,t):Hs}function __PRIVATE_computeTransformOperationBaseValue(Z,t){return Z instanceof __PRIVATE_NumericIncrementTransformOperation?function(zs){return isInteger(zs)||function(Zs){return!!Zs&&"doubleValue"in Zs}(zs)}(t)?t:{integerValue:0}:null}class __PRIVATE_ServerTimestampTransform extends TransformOperation{}class __PRIVATE_ArrayUnionTransformOperation extends TransformOperation{constructor(t){super(),this.elements=t}}function __PRIVATE_applyArrayUnionTransformOperation(Z,t){const Hs=__PRIVATE_coercedFieldValuesArray(t);for(const zs of Z.elements)Hs.some(Ys=>__PRIVATE_valueEquals(Ys,zs))||Hs.push(zs);return{arrayValue:{values:Hs}}}class __PRIVATE_ArrayRemoveTransformOperation extends TransformOperation{constructor(t){super(),this.elements=t}}function __PRIVATE_applyArrayRemoveTransformOperation(Z,t){let Hs=__PRIVATE_coercedFieldValuesArray(t);for(const zs of Z.elements)Hs=Hs.filter(Ys=>!__PRIVATE_valueEquals(Ys,zs));return{arrayValue:{values:Hs}}}class __PRIVATE_NumericIncrementTransformOperation extends TransformOperation{constructor(t,Hs){super(),this.serializer=t,this.Ae=Hs}}function asNumber(Z){return __PRIVATE_normalizeNumber(Z.integerValue||Z.doubleValue)}function __PRIVATE_coercedFieldValuesArray(Z){return isArray(Z)&&Z.arrayValue.values?Z.arrayValue.values.slice():[]}function __PRIVATE_fieldTransformEquals(Z,t){return Z.field.isEqual(t.field)&&function(zs,Ys){return zs instanceof __PRIVATE_ArrayUnionTransformOperation&&Ys instanceof __PRIVATE_ArrayUnionTransformOperation||zs instanceof __PRIVATE_ArrayRemoveTransformOperation&&Ys instanceof __PRIVATE_ArrayRemoveTransformOperation?__PRIVATE_arrayEquals(zs.elements,Ys.elements,__PRIVATE_valueEquals):zs instanceof __PRIVATE_NumericIncrementTransformOperation&&Ys instanceof __PRIVATE_NumericIncrementTransformOperation?__PRIVATE_valueEquals(zs.Ae,Ys.Ae):zs instanceof __PRIVATE_ServerTimestampTransform&&Ys instanceof __PRIVATE_ServerTimestampTransform}(Z.transform,t.transform)}class MutationResult{constructor(t,Hs){this.version=t,this.transformResults=Hs}}class Precondition{constructor(t,Hs){this.updateTime=t,this.exists=Hs}static none(){return new Precondition}static exists(t){return new Precondition(void 0,t)}static updateTime(t){return new Precondition(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function __PRIVATE_preconditionIsValidForDocument(Z,t){return Z.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(Z.updateTime):Z.exists===void 0||Z.exists===t.isFoundDocument()}class Mutation{}function __PRIVATE_calculateOverlayMutation(Z,t){if(!Z.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return Z.isNoDocument()?new __PRIVATE_DeleteMutation(Z.key,Precondition.none()):new __PRIVATE_SetMutation(Z.key,Z.data,Precondition.none());{const Hs=Z.data,zs=ObjectValue.empty();let Ys=new SortedSet(FieldPath$1.comparator);for(let Zs of t.fields)if(!Ys.has(Zs)){let _u=Hs.field(Zs);_u===null&&Zs.length>1&&(Zs=Zs.popLast(),_u=Hs.field(Zs)),_u===null?zs.delete(Zs):zs.set(Zs,_u),Ys=Ys.add(Zs)}return new __PRIVATE_PatchMutation(Z.key,zs,new FieldMask(Ys.toArray()),Precondition.none())}}function __PRIVATE_mutationApplyToRemoteDocument(Z,t,Hs){Z instanceof __PRIVATE_SetMutation?function(Ys,Zs,_u){const Eu=Ys.value.clone(),Iu=__PRIVATE_serverTransformResults(Ys.fieldTransforms,Zs,_u.transformResults);Eu.setAll(Iu),Zs.convertToFoundDocument(_u.version,Eu).setHasCommittedMutations()}(Z,t,Hs):Z instanceof __PRIVATE_PatchMutation?function(Ys,Zs,_u){if(!__PRIVATE_preconditionIsValidForDocument(Ys.precondition,Zs))return void Zs.convertToUnknownDocument(_u.version);const Eu=__PRIVATE_serverTransformResults(Ys.fieldTransforms,Zs,_u.transformResults),Iu=Zs.data;Iu.setAll(__PRIVATE_getPatch(Ys)),Iu.setAll(Eu),Zs.convertToFoundDocument(_u.version,Iu).setHasCommittedMutations()}(Z,t,Hs):function(Ys,Zs,_u){Zs.convertToNoDocument(_u.version).setHasCommittedMutations()}(0,t,Hs)}function __PRIVATE_mutationApplyToLocalView(Z,t,Hs,zs){return Z instanceof __PRIVATE_SetMutation?function(Zs,_u,Eu,Iu){if(!__PRIVATE_preconditionIsValidForDocument(Zs.precondition,_u))return Eu;const Au=Zs.value.clone(),$u=__PRIVATE_localTransformResults(Zs.fieldTransforms,Iu,_u);return Au.setAll($u),_u.convertToFoundDocument(_u.version,Au).setHasLocalMutations(),null}(Z,t,Hs,zs):Z instanceof __PRIVATE_PatchMutation?function(Zs,_u,Eu,Iu){if(!__PRIVATE_preconditionIsValidForDocument(Zs.precondition,_u))return Eu;const Au=__PRIVATE_localTransformResults(Zs.fieldTransforms,Iu,_u),$u=_u.data;return $u.setAll(__PRIVATE_getPatch(Zs)),$u.setAll(Au),_u.convertToFoundDocument(_u.version,$u).setHasLocalMutations(),Eu===null?null:Eu.unionWith(Zs.fieldMask.fields).unionWith(Zs.fieldTransforms.map(vu=>vu.field))}(Z,t,Hs,zs):function(Zs,_u,Eu){return __PRIVATE_preconditionIsValidForDocument(Zs.precondition,_u)?(_u.convertToNoDocument(_u.version).setHasLocalMutations(),null):Eu}(Z,t,Hs)}function __PRIVATE_mutationExtractBaseValue(Z,t){let Hs=null;for(const zs of Z.fieldTransforms){const Ys=t.data.field(zs.field),Zs=__PRIVATE_computeTransformOperationBaseValue(zs.transform,Ys||null);Zs!=null&&(Hs===null&&(Hs=ObjectValue.empty()),Hs.set(zs.field,Zs))}return Hs||null}function __PRIVATE_mutationEquals(Z,t){return Z.type===t.type&&!!Z.key.isEqual(t.key)&&!!Z.precondition.isEqual(t.precondition)&&!!function(zs,Ys){return zs===void 0&&Ys===void 0||!(!zs||!Ys)&&__PRIVATE_arrayEquals(zs,Ys,(Zs,_u)=>__PRIVATE_fieldTransformEquals(Zs,_u))}(Z.fieldTransforms,t.fieldTransforms)&&(Z.type===0?Z.value.isEqual(t.value):Z.type!==1||Z.data.isEqual(t.data)&&Z.fieldMask.isEqual(t.fieldMask))}class __PRIVATE_SetMutation extends Mutation{constructor(t,Hs,zs,Ys=[]){super(),this.key=t,this.value=Hs,this.precondition=zs,this.fieldTransforms=Ys,this.type=0}getFieldMask(){return null}}class __PRIVATE_PatchMutation extends Mutation{constructor(t,Hs,zs,Ys,Zs=[]){super(),this.key=t,this.data=Hs,this.fieldMask=zs,this.precondition=Ys,this.fieldTransforms=Zs,this.type=1}getFieldMask(){return this.fieldMask}}function __PRIVATE_getPatch(Z){const t=new Map;return Z.fieldMask.fields.forEach(Hs=>{if(!Hs.isEmpty()){const zs=Z.data.field(Hs);t.set(Hs,zs)}}),t}function __PRIVATE_serverTransformResults(Z,t,Hs){const zs=new Map;__PRIVATE_hardAssert(Z.length===Hs.length,32656,{Ve:Hs.length,de:Z.length});for(let Ys=0;Ys<Hs.length;Ys++){const Zs=Z[Ys],_u=Zs.transform,Eu=t.data.field(Zs.field);zs.set(Zs.field,__PRIVATE_applyTransformOperationToRemoteDocument(_u,Eu,Hs[Ys]))}return zs}function __PRIVATE_localTransformResults(Z,t,Hs){const zs=new Map;for(const Ys of Z){const Zs=Ys.transform,_u=Hs.data.field(Ys.field);zs.set(Ys.field,__PRIVATE_applyTransformOperationToLocalView(Zs,_u,t))}return zs}class __PRIVATE_DeleteMutation extends Mutation{constructor(t,Hs){super(),this.key=t,this.precondition=Hs,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class __PRIVATE_VerifyMutation extends Mutation{constructor(t,Hs){super(),this.key=t,this.precondition=Hs,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MutationBatch{constructor(t,Hs,zs,Ys){this.batchId=t,this.localWriteTime=Hs,this.baseMutations=zs,this.mutations=Ys}applyToRemoteDocument(t,Hs){const zs=Hs.mutationResults;for(let Ys=0;Ys<this.mutations.length;Ys++){const Zs=this.mutations[Ys];Zs.key.isEqual(t.key)&&__PRIVATE_mutationApplyToRemoteDocument(Zs,t,zs[Ys])}}applyToLocalView(t,Hs){for(const zs of this.baseMutations)zs.key.isEqual(t.key)&&(Hs=__PRIVATE_mutationApplyToLocalView(zs,t,Hs,this.localWriteTime));for(const zs of this.mutations)zs.key.isEqual(t.key)&&(Hs=__PRIVATE_mutationApplyToLocalView(zs,t,Hs,this.localWriteTime));return Hs}applyToLocalDocumentSet(t,Hs){const zs=__PRIVATE_newMutationMap();return this.mutations.forEach(Ys=>{const Zs=t.get(Ys.key),_u=Zs.overlayedDocument;let Eu=this.applyToLocalView(_u,Zs.mutatedFields);Eu=Hs.has(Ys.key)?null:Eu;const Iu=__PRIVATE_calculateOverlayMutation(_u,Eu);Iu!==null&&zs.set(Ys.key,Iu),_u.isValidDocument()||_u.convertToNoDocument(SnapshotVersion.min())}),zs}keys(){return this.mutations.reduce((t,Hs)=>t.add(Hs.key),__PRIVATE_documentKeySet())}isEqual(t){return this.batchId===t.batchId&&__PRIVATE_arrayEquals(this.mutations,t.mutations,(Hs,zs)=>__PRIVATE_mutationEquals(Hs,zs))&&__PRIVATE_arrayEquals(this.baseMutations,t.baseMutations,(Hs,zs)=>__PRIVATE_mutationEquals(Hs,zs))}}class MutationBatchResult{constructor(t,Hs,zs,Ys){this.batch=t,this.commitVersion=Hs,this.mutationResults=zs,this.docVersions=Ys}static from(t,Hs,zs){__PRIVATE_hardAssert(t.mutations.length===zs.length,58842,{me:t.mutations.length,fe:zs.length});let Ys=function(){return It}();const Zs=t.mutations;for(let _u=0;_u<Zs.length;_u++)Ys=Ys.insert(Zs[_u].key,zs[_u].version);return new MutationBatchResult(t,Hs,zs,Ys)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Overlay{constructor(t,Hs){this.largestBatchId=t,this.mutation=Hs}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ExistenceFilter{constructor(t,Hs){this.count=t,this.unchangedNames=Hs}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var At,Vt;function __PRIVATE_isPermanentError(Z){switch(Z){case C.OK:return fail(64938);case C.CANCELLED:case C.UNKNOWN:case C.DEADLINE_EXCEEDED:case C.RESOURCE_EXHAUSTED:case C.INTERNAL:case C.UNAVAILABLE:case C.UNAUTHENTICATED:return!1;case C.INVALID_ARGUMENT:case C.NOT_FOUND:case C.ALREADY_EXISTS:case C.PERMISSION_DENIED:case C.FAILED_PRECONDITION:case C.ABORTED:case C.OUT_OF_RANGE:case C.UNIMPLEMENTED:case C.DATA_LOSS:return!0;default:return fail(15467,{code:Z})}}function __PRIVATE_mapCodeFromRpcCode(Z){if(Z===void 0)return __PRIVATE_logError("GRPC error has no .code"),C.UNKNOWN;switch(Z){case At.OK:return C.OK;case At.CANCELLED:return C.CANCELLED;case At.UNKNOWN:return C.UNKNOWN;case At.DEADLINE_EXCEEDED:return C.DEADLINE_EXCEEDED;case At.RESOURCE_EXHAUSTED:return C.RESOURCE_EXHAUSTED;case At.INTERNAL:return C.INTERNAL;case At.UNAVAILABLE:return C.UNAVAILABLE;case At.UNAUTHENTICATED:return C.UNAUTHENTICATED;case At.INVALID_ARGUMENT:return C.INVALID_ARGUMENT;case At.NOT_FOUND:return C.NOT_FOUND;case At.ALREADY_EXISTS:return C.ALREADY_EXISTS;case At.PERMISSION_DENIED:return C.PERMISSION_DENIED;case At.FAILED_PRECONDITION:return C.FAILED_PRECONDITION;case At.ABORTED:return C.ABORTED;case At.OUT_OF_RANGE:return C.OUT_OF_RANGE;case At.UNIMPLEMENTED:return C.UNIMPLEMENTED;case At.DATA_LOSS:return C.DATA_LOSS;default:return fail(39323,{code:Z})}}(Vt=At||(At={}))[Vt.OK=0]="OK",Vt[Vt.CANCELLED=1]="CANCELLED",Vt[Vt.UNKNOWN=2]="UNKNOWN",Vt[Vt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Vt[Vt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Vt[Vt.NOT_FOUND=5]="NOT_FOUND",Vt[Vt.ALREADY_EXISTS=6]="ALREADY_EXISTS",Vt[Vt.PERMISSION_DENIED=7]="PERMISSION_DENIED",Vt[Vt.UNAUTHENTICATED=16]="UNAUTHENTICATED",Vt[Vt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Vt[Vt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Vt[Vt.ABORTED=10]="ABORTED",Vt[Vt.OUT_OF_RANGE=11]="OUT_OF_RANGE",Vt[Vt.UNIMPLEMENTED=12]="UNIMPLEMENTED",Vt[Vt.INTERNAL=13]="INTERNAL",Vt[Vt.UNAVAILABLE=14]="UNAVAILABLE",Vt[Vt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_newTextEncoder(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mt=new Integer([4294967295,4294967295],0);function __PRIVATE_getMd5HashValue(Z){const t=__PRIVATE_newTextEncoder().encode(Z),Hs=new Md5;return Hs.update(t),new Uint8Array(Hs.digest())}function __PRIVATE_get64BitUints(Z){const t=new DataView(Z.buffer),Hs=t.getUint32(0,!0),zs=t.getUint32(4,!0),Ys=t.getUint32(8,!0),Zs=t.getUint32(12,!0);return[new Integer([Hs,zs],0),new Integer([Ys,Zs],0)]}class BloomFilter{constructor(t,Hs,zs){if(this.bitmap=t,this.padding=Hs,this.hashCount=zs,Hs<0||Hs>=8)throw new __PRIVATE_BloomFilterError(`Invalid padding: ${Hs}`);if(zs<0)throw new __PRIVATE_BloomFilterError(`Invalid hash count: ${zs}`);if(t.length>0&&this.hashCount===0)throw new __PRIVATE_BloomFilterError(`Invalid hash count: ${zs}`);if(t.length===0&&Hs!==0)throw new __PRIVATE_BloomFilterError(`Invalid padding when bitmap length is 0: ${Hs}`);this.ge=8*t.length-Hs,this.pe=Integer.fromNumber(this.ge)}ye(t,Hs,zs){let Ys=t.add(Hs.multiply(Integer.fromNumber(zs)));return Ys.compare(mt)===1&&(Ys=new Integer([Ys.getBits(0),Ys.getBits(1)],0)),Ys.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.ge===0)return!1;const Hs=__PRIVATE_getMd5HashValue(t),[zs,Ys]=__PRIVATE_get64BitUints(Hs);for(let Zs=0;Zs<this.hashCount;Zs++){const _u=this.ye(zs,Ys,Zs);if(!this.we(_u))return!1}return!0}static create(t,Hs,zs){const Ys=t%8==0?0:8-t%8,Zs=new Uint8Array(Math.ceil(t/8)),_u=new BloomFilter(Zs,Ys,Hs);return zs.forEach(Eu=>_u.insert(Eu)),_u}insert(t){if(this.ge===0)return;const Hs=__PRIVATE_getMd5HashValue(t),[zs,Ys]=__PRIVATE_get64BitUints(Hs);for(let Zs=0;Zs<this.hashCount;Zs++){const _u=this.ye(zs,Ys,Zs);this.be(_u)}}be(t){const Hs=Math.floor(t/8),zs=t%8;this.bitmap[Hs]|=1<<zs}}class __PRIVATE_BloomFilterError extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RemoteEvent{constructor(t,Hs,zs,Ys,Zs){this.snapshotVersion=t,this.targetChanges=Hs,this.targetMismatches=zs,this.documentUpdates=Ys,this.resolvedLimboDocuments=Zs}static createSynthesizedRemoteEventForCurrentChange(t,Hs,zs){const Ys=new Map;return Ys.set(t,TargetChange.createSynthesizedTargetChangeForCurrentChange(t,Hs,zs)),new RemoteEvent(SnapshotVersion.min(),Ys,new SortedMap(__PRIVATE_primitiveComparator),__PRIVATE_mutableDocumentMap(),__PRIVATE_documentKeySet())}}class TargetChange{constructor(t,Hs,zs,Ys,Zs){this.resumeToken=t,this.current=Hs,this.addedDocuments=zs,this.modifiedDocuments=Ys,this.removedDocuments=Zs}static createSynthesizedTargetChangeForCurrentChange(t,Hs,zs){return new TargetChange(zs,Hs,__PRIVATE_documentKeySet(),__PRIVATE_documentKeySet(),__PRIVATE_documentKeySet())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_DocumentWatchChange{constructor(t,Hs,zs,Ys){this.Se=t,this.removedTargetIds=Hs,this.key=zs,this.De=Ys}}class __PRIVATE_ExistenceFilterChange{constructor(t,Hs){this.targetId=t,this.Ce=Hs}}class __PRIVATE_WatchTargetChange{constructor(t,Hs,zs=ByteString.EMPTY_BYTE_STRING,Ys=null){this.state=t,this.targetIds=Hs,this.resumeToken=zs,this.cause=Ys}}class __PRIVATE_TargetState{constructor(){this.ve=0,this.Fe=__PRIVATE_snapshotChangesMap(),this.Me=ByteString.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=__PRIVATE_documentKeySet(),Hs=__PRIVATE_documentKeySet(),zs=__PRIVATE_documentKeySet();return this.Fe.forEach((Ys,Zs)=>{switch(Zs){case 0:t=t.add(Ys);break;case 2:Hs=Hs.add(Ys);break;case 1:zs=zs.add(Ys);break;default:fail(38017,{changeType:Zs})}}),new TargetChange(this.Me,this.xe,t,Hs,zs)}Ke(){this.Oe=!1,this.Fe=__PRIVATE_snapshotChangesMap()}qe(t,Hs){this.Oe=!0,this.Fe=this.Fe.insert(t,Hs)}Ue(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}$e(){this.ve+=1}We(){this.ve-=1,__PRIVATE_hardAssert(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class __PRIVATE_WatchChangeAggregator{constructor(t){this.Ge=t,this.ze=new Map,this.je=__PRIVATE_mutableDocumentMap(),this.He=__PRIVATE_documentTargetMap(),this.Je=__PRIVATE_documentTargetMap(),this.Ze=new SortedMap(__PRIVATE_primitiveComparator)}Xe(t){for(const Hs of t.Se)t.De&&t.De.isFoundDocument()?this.Ye(Hs,t.De):this.et(Hs,t.key,t.De);for(const Hs of t.removedTargetIds)this.et(Hs,t.key,t.De)}tt(t){this.forEachTarget(t,Hs=>{const zs=this.nt(Hs);switch(t.state){case 0:this.rt(Hs)&&zs.Le(t.resumeToken);break;case 1:zs.We(),zs.Ne||zs.Ke(),zs.Le(t.resumeToken);break;case 2:zs.We(),zs.Ne||this.removeTarget(Hs);break;case 3:this.rt(Hs)&&(zs.Qe(),zs.Le(t.resumeToken));break;case 4:this.rt(Hs)&&(this.it(Hs),zs.Le(t.resumeToken));break;default:fail(56790,{state:t.state})}})}forEachTarget(t,Hs){t.targetIds.length>0?t.targetIds.forEach(Hs):this.ze.forEach((zs,Ys)=>{this.rt(Ys)&&Hs(Ys)})}st(t){const Hs=t.targetId,zs=t.Ce.count,Ys=this.ot(Hs);if(Ys){const Zs=Ys.target;if(__PRIVATE_targetIsDocumentTarget(Zs))if(zs===0){const _u=new DocumentKey(Zs.path);this.et(Hs,_u,MutableDocument.newNoDocument(_u,SnapshotVersion.min()))}else __PRIVATE_hardAssert(zs===1,20013,{expectedCount:zs});else{const _u=this._t(Hs);if(_u!==zs){const Eu=this.ut(t),Iu=Eu?this.ct(Eu,t,_u):1;if(Iu!==0){this.it(Hs);const Au=Iu===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(Hs,Au)}}}}}ut(t){const Hs=t.Ce.unchangedNames;if(!Hs||!Hs.bits)return null;const{bits:{bitmap:zs="",padding:Ys=0},hashCount:Zs=0}=Hs;let _u,Eu;try{_u=__PRIVATE_normalizeByteString(zs).toUint8Array()}catch(Iu){if(Iu instanceof __PRIVATE_Base64DecodeError)return __PRIVATE_logWarn("Decoding the base64 bloom filter in existence filter failed ("+Iu.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw Iu}try{Eu=new BloomFilter(_u,Ys,Zs)}catch(Iu){return __PRIVATE_logWarn(Iu instanceof __PRIVATE_BloomFilterError?"BloomFilter error: ":"Applying bloom filter failed: ",Iu),null}return Eu.ge===0?null:Eu}ct(t,Hs,zs){return Hs.Ce.count===zs-this.Pt(t,Hs.targetId)?0:2}Pt(t,Hs){const zs=this.Ge.getRemoteKeysForTarget(Hs);let Ys=0;return zs.forEach(Zs=>{const _u=this.Ge.ht(),Eu=`projects/${_u.projectId}/databases/${_u.database}/documents/${Zs.path.canonicalString()}`;t.mightContain(Eu)||(this.et(Hs,Zs,null),Ys++)}),Ys}Tt(t){const Hs=new Map;this.ze.forEach((Zs,_u)=>{const Eu=this.ot(_u);if(Eu){if(Zs.current&&__PRIVATE_targetIsDocumentTarget(Eu.target)){const Iu=new DocumentKey(Eu.target.path);this.It(Iu).has(_u)||this.Et(_u,Iu)||this.et(_u,Iu,MutableDocument.newNoDocument(Iu,t))}Zs.Be&&(Hs.set(_u,Zs.ke()),Zs.Ke())}});let zs=__PRIVATE_documentKeySet();this.Je.forEach((Zs,_u)=>{let Eu=!0;_u.forEachWhile(Iu=>{const Au=this.ot(Iu);return!Au||Au.purpose==="TargetPurposeLimboResolution"||(Eu=!1,!1)}),Eu&&(zs=zs.add(Zs))}),this.je.forEach((Zs,_u)=>_u.setReadTime(t));const Ys=new RemoteEvent(t,Hs,this.Ze,this.je,zs);return this.je=__PRIVATE_mutableDocumentMap(),this.He=__PRIVATE_documentTargetMap(),this.Je=__PRIVATE_documentTargetMap(),this.Ze=new SortedMap(__PRIVATE_primitiveComparator),Ys}Ye(t,Hs){if(!this.rt(t))return;const zs=this.Et(t,Hs.key)?2:0;this.nt(t).qe(Hs.key,zs),this.je=this.je.insert(Hs.key,Hs),this.He=this.He.insert(Hs.key,this.It(Hs.key).add(t)),this.Je=this.Je.insert(Hs.key,this.Rt(Hs.key).add(t))}et(t,Hs,zs){if(!this.rt(t))return;const Ys=this.nt(t);this.Et(t,Hs)?Ys.qe(Hs,1):Ys.Ue(Hs),this.Je=this.Je.insert(Hs,this.Rt(Hs).delete(t)),this.Je=this.Je.insert(Hs,this.Rt(Hs).add(t)),zs&&(this.je=this.je.insert(Hs,zs))}removeTarget(t){this.ze.delete(t)}_t(t){const Hs=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+Hs.addedDocuments.size-Hs.removedDocuments.size}$e(t){this.nt(t).$e()}nt(t){let Hs=this.ze.get(t);return Hs||(Hs=new __PRIVATE_TargetState,this.ze.set(t,Hs)),Hs}Rt(t){let Hs=this.Je.get(t);return Hs||(Hs=new SortedSet(__PRIVATE_primitiveComparator),this.Je=this.Je.insert(t,Hs)),Hs}It(t){let Hs=this.He.get(t);return Hs||(Hs=new SortedSet(__PRIVATE_primitiveComparator),this.He=this.He.insert(t,Hs)),Hs}rt(t){const Hs=this.ot(t)!==null;return Hs||__PRIVATE_logDebug("WatchChangeAggregator","Detected inactive target",t),Hs}ot(t){const Hs=this.ze.get(t);return Hs&&Hs.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new __PRIVATE_TargetState),this.Ge.getRemoteKeysForTarget(t).forEach(Hs=>{this.et(t,Hs,null)})}Et(t,Hs){return this.Ge.getRemoteKeysForTarget(t).has(Hs)}}function __PRIVATE_documentTargetMap(){return new SortedMap(DocumentKey.comparator)}function __PRIVATE_snapshotChangesMap(){return new SortedMap(DocumentKey.comparator)}const ft=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),gt=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),pt=(()=>({and:"AND",or:"OR"}))();class JsonProtoSerializer{constructor(t,Hs){this.databaseId=t,this.useProto3Json=Hs}}function __PRIVATE_toInt32Proto(Z,t){return Z.useProto3Json||__PRIVATE_isNullOrUndefined(t)?t:{value:t}}function toTimestamp(Z,t){return Z.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function __PRIVATE_toBytes(Z,t){return Z.useProto3Json?t.toBase64():t.toUint8Array()}function __PRIVATE_toVersion(Z,t){return toTimestamp(Z,t.toTimestamp())}function __PRIVATE_fromVersion(Z){return __PRIVATE_hardAssert(!!Z,49232),SnapshotVersion.fromTimestamp(function(Hs){const zs=__PRIVATE_normalizeTimestamp(Hs);return new Timestamp(zs.seconds,zs.nanos)}(Z))}function __PRIVATE_toResourceName(Z,t){return __PRIVATE_toResourcePath(Z,t).canonicalString()}function __PRIVATE_toResourcePath(Z,t){const Hs=function(Ys){return new ResourcePath(["projects",Ys.projectId,"databases",Ys.database])}(Z).child("documents");return t===void 0?Hs:Hs.child(t)}function __PRIVATE_fromResourceName(Z){const t=ResourcePath.fromString(Z);return __PRIVATE_hardAssert(__PRIVATE_isValidResourceName(t),10190,{key:t.toString()}),t}function __PRIVATE_toName(Z,t){return __PRIVATE_toResourceName(Z.databaseId,t.path)}function fromName(Z,t){const Hs=__PRIVATE_fromResourceName(t);if(Hs.get(1)!==Z.databaseId.projectId)throw new FirestoreError(C.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+Hs.get(1)+" vs "+Z.databaseId.projectId);if(Hs.get(3)!==Z.databaseId.database)throw new FirestoreError(C.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+Hs.get(3)+" vs "+Z.databaseId.database);return new DocumentKey(__PRIVATE_extractLocalPathFromResourceName(Hs))}function __PRIVATE_toQueryPath(Z,t){return __PRIVATE_toResourceName(Z.databaseId,t)}function __PRIVATE_fromQueryPath(Z){const t=__PRIVATE_fromResourceName(Z);return t.length===4?ResourcePath.emptyPath():__PRIVATE_extractLocalPathFromResourceName(t)}function __PRIVATE_getEncodedDatabaseId(Z){return new ResourcePath(["projects",Z.databaseId.projectId,"databases",Z.databaseId.database]).canonicalString()}function __PRIVATE_extractLocalPathFromResourceName(Z){return __PRIVATE_hardAssert(Z.length>4&&Z.get(4)==="documents",29091,{key:Z.toString()}),Z.popFirst(5)}function __PRIVATE_toMutationDocument(Z,t,Hs){return{name:__PRIVATE_toName(Z,t),fields:Hs.value.mapValue.fields}}function __PRIVATE_fromWatchChange(Z,t){let Hs;if("targetChange"in t){t.targetChange;const zs=function(Au){return Au==="NO_CHANGE"?0:Au==="ADD"?1:Au==="REMOVE"?2:Au==="CURRENT"?3:Au==="RESET"?4:fail(39313,{state:Au})}(t.targetChange.targetChangeType||"NO_CHANGE"),Ys=t.targetChange.targetIds||[],Zs=function(Au,$u){return Au.useProto3Json?(__PRIVATE_hardAssert($u===void 0||typeof $u=="string",58123),ByteString.fromBase64String($u||"")):(__PRIVATE_hardAssert($u===void 0||$u instanceof Buffer$1||$u instanceof Uint8Array,16193),ByteString.fromUint8Array($u||new Uint8Array))}(Z,t.targetChange.resumeToken),_u=t.targetChange.cause,Eu=_u&&function(Au){const $u=Au.code===void 0?C.UNKNOWN:__PRIVATE_mapCodeFromRpcCode(Au.code);return new FirestoreError($u,Au.message||"")}(_u);Hs=new __PRIVATE_WatchTargetChange(zs,Ys,Zs,Eu||null)}else if("documentChange"in t){t.documentChange;const zs=t.documentChange;zs.document,zs.document.name,zs.document.updateTime;const Ys=fromName(Z,zs.document.name),Zs=__PRIVATE_fromVersion(zs.document.updateTime),_u=zs.document.createTime?__PRIVATE_fromVersion(zs.document.createTime):SnapshotVersion.min(),Eu=new ObjectValue({mapValue:{fields:zs.document.fields}}),Iu=MutableDocument.newFoundDocument(Ys,Zs,_u,Eu),Au=zs.targetIds||[],$u=zs.removedTargetIds||[];Hs=new __PRIVATE_DocumentWatchChange(Au,$u,Iu.key,Iu)}else if("documentDelete"in t){t.documentDelete;const zs=t.documentDelete;zs.document;const Ys=fromName(Z,zs.document),Zs=zs.readTime?__PRIVATE_fromVersion(zs.readTime):SnapshotVersion.min(),_u=MutableDocument.newNoDocument(Ys,Zs),Eu=zs.removedTargetIds||[];Hs=new __PRIVATE_DocumentWatchChange([],Eu,_u.key,_u)}else if("documentRemove"in t){t.documentRemove;const zs=t.documentRemove;zs.document;const Ys=fromName(Z,zs.document),Zs=zs.removedTargetIds||[];Hs=new __PRIVATE_DocumentWatchChange([],Zs,Ys,null)}else{if(!("filter"in t))return fail(11601,{Vt:t});{t.filter;const zs=t.filter;zs.targetId;const{count:Ys=0,unchangedNames:Zs}=zs,_u=new ExistenceFilter(Ys,Zs),Eu=zs.targetId;Hs=new __PRIVATE_ExistenceFilterChange(Eu,_u)}}return Hs}function toMutation(Z,t){let Hs;if(t instanceof __PRIVATE_SetMutation)Hs={update:__PRIVATE_toMutationDocument(Z,t.key,t.value)};else if(t instanceof __PRIVATE_DeleteMutation)Hs={delete:__PRIVATE_toName(Z,t.key)};else if(t instanceof __PRIVATE_PatchMutation)Hs={update:__PRIVATE_toMutationDocument(Z,t.key,t.data),updateMask:__PRIVATE_toDocumentMask(t.fieldMask)};else{if(!(t instanceof __PRIVATE_VerifyMutation))return fail(16599,{dt:t.type});Hs={verify:__PRIVATE_toName(Z,t.key)}}return t.fieldTransforms.length>0&&(Hs.updateTransforms=t.fieldTransforms.map(zs=>function(Zs,_u){const Eu=_u.transform;if(Eu instanceof __PRIVATE_ServerTimestampTransform)return{fieldPath:_u.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(Eu instanceof __PRIVATE_ArrayUnionTransformOperation)return{fieldPath:_u.field.canonicalString(),appendMissingElements:{values:Eu.elements}};if(Eu instanceof __PRIVATE_ArrayRemoveTransformOperation)return{fieldPath:_u.field.canonicalString(),removeAllFromArray:{values:Eu.elements}};if(Eu instanceof __PRIVATE_NumericIncrementTransformOperation)return{fieldPath:_u.field.canonicalString(),increment:Eu.Ae};throw fail(20930,{transform:_u.transform})}(0,zs))),t.precondition.isNone||(Hs.currentDocument=function(Ys,Zs){return Zs.updateTime!==void 0?{updateTime:__PRIVATE_toVersion(Ys,Zs.updateTime)}:Zs.exists!==void 0?{exists:Zs.exists}:fail(27497)}(Z,t.precondition)),Hs}function __PRIVATE_fromWriteResults(Z,t){return Z&&Z.length>0?(__PRIVATE_hardAssert(t!==void 0,14353),Z.map(Hs=>function(Ys,Zs){let _u=Ys.updateTime?__PRIVATE_fromVersion(Ys.updateTime):__PRIVATE_fromVersion(Zs);return _u.isEqual(SnapshotVersion.min())&&(_u=__PRIVATE_fromVersion(Zs)),new MutationResult(_u,Ys.transformResults||[])}(Hs,t))):[]}function __PRIVATE_toDocumentsTarget(Z,t){return{documents:[__PRIVATE_toQueryPath(Z,t.path)]}}function __PRIVATE_toQueryTarget(Z,t){const Hs={structuredQuery:{}},zs=t.path;let Ys;t.collectionGroup!==null?(Ys=zs,Hs.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(Ys=zs.popLast(),Hs.structuredQuery.from=[{collectionId:zs.lastSegment()}]),Hs.parent=__PRIVATE_toQueryPath(Z,Ys);const Zs=function(Au){if(Au.length!==0)return __PRIVATE_toFilter(CompositeFilter.create(Au,"and"))}(t.filters);Zs&&(Hs.structuredQuery.where=Zs);const _u=function(Au){if(Au.length!==0)return Au.map($u=>function(Su){return{field:__PRIVATE_toFieldPathReference(Su.field),direction:__PRIVATE_toDirection(Su.dir)}}($u))}(t.orderBy);_u&&(Hs.structuredQuery.orderBy=_u);const Eu=__PRIVATE_toInt32Proto(Z,t.limit);return Eu!==null&&(Hs.structuredQuery.limit=Eu),t.startAt&&(Hs.structuredQuery.startAt=function(Au){return{before:Au.inclusive,values:Au.position}}(t.startAt)),t.endAt&&(Hs.structuredQuery.endAt=function(Au){return{before:!Au.inclusive,values:Au.position}}(t.endAt)),{ft:Hs,parent:Ys}}function __PRIVATE_convertQueryTargetToQuery(Z){let t=__PRIVATE_fromQueryPath(Z.parent);const Hs=Z.structuredQuery,zs=Hs.from?Hs.from.length:0;let Ys=null;if(zs>0){__PRIVATE_hardAssert(zs===1,65062);const $u=Hs.from[0];$u.allDescendants?Ys=$u.collectionId:t=t.child($u.collectionId)}let Zs=[];Hs.where&&(Zs=function(vu){const Su=__PRIVATE_fromFilter(vu);return Su instanceof CompositeFilter&&__PRIVATE_compositeFilterIsFlatConjunction(Su)?Su.getFilters():[Su]}(Hs.where));let _u=[];Hs.orderBy&&(_u=function(vu){return vu.map(Su=>function(Pu){return new OrderBy(__PRIVATE_fromFieldPathReference(Pu.field),function(Bu){switch(Bu){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(Pu.direction))}(Su))}(Hs.orderBy));let Eu=null;Hs.limit&&(Eu=function(vu){let Su;return Su=typeof vu=="object"?vu.value:vu,__PRIVATE_isNullOrUndefined(Su)?null:Su}(Hs.limit));let Iu=null;Hs.startAt&&(Iu=function(vu){const Su=!!vu.before,Ru=vu.values||[];return new Bound(Ru,Su)}(Hs.startAt));let Au=null;return Hs.endAt&&(Au=function(vu){const Su=!vu.before,Ru=vu.values||[];return new Bound(Ru,Su)}(Hs.endAt)),__PRIVATE_newQuery(t,Ys,_u,Zs,Eu,"F",Iu,Au)}function __PRIVATE_toListenRequestLabels(Z,t){const Hs=function(Ys){switch(Ys){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return fail(28987,{purpose:Ys})}}(t.purpose);return Hs==null?null:{"goog-listen-tags":Hs}}function __PRIVATE_fromFilter(Z){return Z.unaryFilter!==void 0?function(Hs){switch(Hs.unaryFilter.op){case"IS_NAN":const zs=__PRIVATE_fromFieldPathReference(Hs.unaryFilter.field);return FieldFilter.create(zs,"==",{doubleValue:NaN});case"IS_NULL":const Ys=__PRIVATE_fromFieldPathReference(Hs.unaryFilter.field);return FieldFilter.create(Ys,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const Zs=__PRIVATE_fromFieldPathReference(Hs.unaryFilter.field);return FieldFilter.create(Zs,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const _u=__PRIVATE_fromFieldPathReference(Hs.unaryFilter.field);return FieldFilter.create(_u,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return fail(61313);default:return fail(60726)}}(Z):Z.fieldFilter!==void 0?function(Hs){return FieldFilter.create(__PRIVATE_fromFieldPathReference(Hs.fieldFilter.field),function(Ys){switch(Ys){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return fail(58110);default:return fail(50506)}}(Hs.fieldFilter.op),Hs.fieldFilter.value)}(Z):Z.compositeFilter!==void 0?function(Hs){return CompositeFilter.create(Hs.compositeFilter.filters.map(zs=>__PRIVATE_fromFilter(zs)),function(Ys){switch(Ys){case"AND":return"and";case"OR":return"or";default:return fail(1026)}}(Hs.compositeFilter.op))}(Z):fail(30097,{filter:Z})}function __PRIVATE_toDirection(Z){return ft[Z]}function __PRIVATE_toOperatorName(Z){return gt[Z]}function __PRIVATE_toCompositeOperatorName(Z){return pt[Z]}function __PRIVATE_toFieldPathReference(Z){return{fieldPath:Z.canonicalString()}}function __PRIVATE_fromFieldPathReference(Z){return FieldPath$1.fromServerFormat(Z.fieldPath)}function __PRIVATE_toFilter(Z){return Z instanceof FieldFilter?function(Hs){if(Hs.op==="=="){if(__PRIVATE_isNanValue(Hs.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(Hs.field),op:"IS_NAN"}};if(__PRIVATE_isNullValue(Hs.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(Hs.field),op:"IS_NULL"}}}else if(Hs.op==="!="){if(__PRIVATE_isNanValue(Hs.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(Hs.field),op:"IS_NOT_NAN"}};if(__PRIVATE_isNullValue(Hs.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(Hs.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:__PRIVATE_toFieldPathReference(Hs.field),op:__PRIVATE_toOperatorName(Hs.op),value:Hs.value}}}(Z):Z instanceof CompositeFilter?function(Hs){const zs=Hs.getFilters().map(Ys=>__PRIVATE_toFilter(Ys));return zs.length===1?zs[0]:{compositeFilter:{op:__PRIVATE_toCompositeOperatorName(Hs.op),filters:zs}}}(Z):fail(54877,{filter:Z})}function __PRIVATE_toDocumentMask(Z){const t=[];return Z.fields.forEach(Hs=>t.push(Hs.canonicalString())),{fieldPaths:t}}function __PRIVATE_isValidResourceName(Z){return Z.length>=4&&Z.get(0)==="projects"&&Z.get(2)==="databases"}function __PRIVATE_isProtoValueSerializable(Z){return!!Z&&typeof Z._toProto=="function"&&Z._protoValueType==="ProtoValue"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TargetData{constructor(t,Hs,zs,Ys,Zs=SnapshotVersion.min(),_u=SnapshotVersion.min(),Eu=ByteString.EMPTY_BYTE_STRING,Iu=null){this.target=t,this.targetId=Hs,this.purpose=zs,this.sequenceNumber=Ys,this.snapshotVersion=Zs,this.lastLimboFreeSnapshotVersion=_u,this.resumeToken=Eu,this.expectedCount=Iu}withSequenceNumber(t){return new TargetData(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,Hs){return new TargetData(this.target,this.targetId,this.purpose,this.sequenceNumber,Hs,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new TargetData(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new TargetData(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_LocalSerializer{constructor(t){this.yt=t}}function __PRIVATE_fromBundledQuery(Z){const t=__PRIVATE_convertQueryTargetToQuery({parent:Z.parent,structuredQuery:Z.structuredQuery});return Z.limitType==="LAST"?__PRIVATE_queryWithLimit(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_MemoryIndexManager{constructor(){this.Sn=new __PRIVATE_MemoryCollectionParentIndex}addToCollectionParentIndex(t,Hs){return this.Sn.add(Hs),PersistencePromise.resolve()}getCollectionParents(t,Hs){return PersistencePromise.resolve(this.Sn.getEntries(Hs))}addFieldIndex(t,Hs){return PersistencePromise.resolve()}deleteFieldIndex(t,Hs){return PersistencePromise.resolve()}deleteAllFieldIndexes(t){return PersistencePromise.resolve()}createTargetIndexes(t,Hs){return PersistencePromise.resolve()}getDocumentsMatchingTarget(t,Hs){return PersistencePromise.resolve(null)}getIndexType(t,Hs){return PersistencePromise.resolve(0)}getFieldIndexes(t,Hs){return PersistencePromise.resolve([])}getNextCollectionGroupToUpdate(t){return PersistencePromise.resolve(null)}getMinOffset(t,Hs){return PersistencePromise.resolve(IndexOffset.min())}getMinOffsetFromCollectionGroup(t,Hs){return PersistencePromise.resolve(IndexOffset.min())}updateCollectionGroup(t,Hs,zs){return PersistencePromise.resolve()}updateIndexEntries(t,Hs){return PersistencePromise.resolve()}}class __PRIVATE_MemoryCollectionParentIndex{constructor(){this.index={}}add(t){const Hs=t.lastSegment(),zs=t.popLast(),Ys=this.index[Hs]||new SortedSet(ResourcePath.comparator),Zs=!Ys.has(zs);return this.index[Hs]=Ys.add(zs),Zs}has(t){const Hs=t.lastSegment(),zs=t.popLast(),Ys=this.index[Hs];return Ys&&Ys.has(zs)}getEntries(t){return(this.index[t]||new SortedSet(ResourcePath.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const St={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Dt=41943040;class LruParams{static withCacheSize(t){return new LruParams(t,LruParams.DEFAULT_COLLECTION_PERCENTILE,LruParams.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,Hs,zs){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=Hs,this.maximumSequenceNumbersToCollect=zs}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */LruParams.DEFAULT_COLLECTION_PERCENTILE=10,LruParams.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,LruParams.DEFAULT=new LruParams(Dt,LruParams.DEFAULT_COLLECTION_PERCENTILE,LruParams.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),LruParams.DISABLED=new LruParams(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_TargetIdGenerator{constructor(t){this.sr=t}next(){return this.sr+=2,this.sr}static _r(){return new __PRIVATE_TargetIdGenerator(0)}static ar(){return new __PRIVATE_TargetIdGenerator(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ct="LruGarbageCollector",vt=1048576;function __PRIVATE_bufferEntryComparator([Z,t],[Hs,zs]){const Ys=__PRIVATE_primitiveComparator(Z,Hs);return Ys===0?__PRIVATE_primitiveComparator(t,zs):Ys}class __PRIVATE_RollingSequenceNumberBuffer{constructor(t){this.Pr=t,this.buffer=new SortedSet(__PRIVATE_bufferEntryComparator),this.Tr=0}Ir(){return++this.Tr}Er(t){const Hs=[t,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(Hs);else{const zs=this.buffer.last();__PRIVATE_bufferEntryComparator(Hs,zs)<0&&(this.buffer=this.buffer.delete(zs).add(Hs))}}get maxValue(){return this.buffer.last()[0]}}class __PRIVATE_LruScheduler{constructor(t,Hs,zs){this.garbageCollector=t,this.asyncQueue=Hs,this.localStore=zs,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(t){__PRIVATE_logDebug(Ct,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(Hs){__PRIVATE_isIndexedDbTransactionError(Hs)?__PRIVATE_logDebug(Ct,"Ignoring IndexedDB error during garbage collection: ",Hs):await __PRIVATE_ignoreIfPrimaryLeaseLoss(Hs)}await this.Ar(3e5)})}}class __PRIVATE_LruGarbageCollectorImpl{constructor(t,Hs){this.Vr=t,this.params=Hs}calculateTargetCount(t,Hs){return this.Vr.dr(t).next(zs=>Math.floor(Hs/100*zs))}nthSequenceNumber(t,Hs){if(Hs===0)return PersistencePromise.resolve(__PRIVATE_ListenSequence.ce);const zs=new __PRIVATE_RollingSequenceNumberBuffer(Hs);return this.Vr.forEachTarget(t,Ys=>zs.Er(Ys.sequenceNumber)).next(()=>this.Vr.mr(t,Ys=>zs.Er(Ys))).next(()=>zs.maxValue)}removeTargets(t,Hs,zs){return this.Vr.removeTargets(t,Hs,zs)}removeOrphanedDocuments(t,Hs){return this.Vr.removeOrphanedDocuments(t,Hs)}collect(t,Hs){return this.params.cacheSizeCollectionThreshold===-1?(__PRIVATE_logDebug("LruGarbageCollector","Garbage collection skipped; disabled"),PersistencePromise.resolve(St)):this.getCacheSize(t).next(zs=>zs<this.params.cacheSizeCollectionThreshold?(__PRIVATE_logDebug("LruGarbageCollector",`Garbage collection skipped; Cache size ${zs} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),St):this.gr(t,Hs))}getCacheSize(t){return this.Vr.getCacheSize(t)}gr(t,Hs){let zs,Ys,Zs,_u,Eu,Iu,Au;const $u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(vu=>(vu>this.params.maximumSequenceNumbersToCollect?(__PRIVATE_logDebug("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${vu}`),Ys=this.params.maximumSequenceNumbersToCollect):Ys=vu,_u=Date.now(),this.nthSequenceNumber(t,Ys))).next(vu=>(zs=vu,Eu=Date.now(),this.removeTargets(t,zs,Hs))).next(vu=>(Zs=vu,Iu=Date.now(),this.removeOrphanedDocuments(t,zs))).next(vu=>(Au=Date.now(),__PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${_u-$u}ms
	Determined least recently used ${Ys} in `+(Eu-_u)+`ms
	Removed ${Zs} targets in `+(Iu-Eu)+`ms
	Removed ${vu} documents in `+(Au-Iu)+`ms
Total Duration: ${Au-$u}ms`),PersistencePromise.resolve({didRun:!0,sequenceNumbersCollected:Ys,targetsRemoved:Zs,documentsRemoved:vu})))}}function __PRIVATE_newLruGarbageCollector(Z,t){return new __PRIVATE_LruGarbageCollectorImpl(Z,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RemoteDocumentChangeBuffer{constructor(){this.changes=new ObjectMap(t=>t.toString(),(t,Hs)=>t.isEqual(Hs)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,Hs){this.assertNotApplied(),this.changes.set(t,MutableDocument.newInvalidDocument(t).setReadTime(Hs))}getEntry(t,Hs){this.assertNotApplied();const zs=this.changes.get(Hs);return zs!==void 0?PersistencePromise.resolve(zs):this.getFromCache(t,Hs)}getEntries(t,Hs){return this.getAllFromCache(t,Hs)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OverlayedDocument{constructor(t,Hs){this.overlayedDocument=t,this.mutatedFields=Hs}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LocalDocumentsView{constructor(t,Hs,zs,Ys){this.remoteDocumentCache=t,this.mutationQueue=Hs,this.documentOverlayCache=zs,this.indexManager=Ys}getDocument(t,Hs){let zs=null;return this.documentOverlayCache.getOverlay(t,Hs).next(Ys=>(zs=Ys,this.remoteDocumentCache.getEntry(t,Hs))).next(Ys=>(zs!==null&&__PRIVATE_mutationApplyToLocalView(zs.mutation,Ys,FieldMask.empty(),Timestamp.now()),Ys))}getDocuments(t,Hs){return this.remoteDocumentCache.getEntries(t,Hs).next(zs=>this.getLocalViewOfDocuments(t,zs,__PRIVATE_documentKeySet()).next(()=>zs))}getLocalViewOfDocuments(t,Hs,zs=__PRIVATE_documentKeySet()){const Ys=__PRIVATE_newOverlayMap();return this.populateOverlays(t,Ys,Hs).next(()=>this.computeViews(t,Hs,Ys,zs).next(Zs=>{let _u=documentMap();return Zs.forEach((Eu,Iu)=>{_u=_u.insert(Eu,Iu.overlayedDocument)}),_u}))}getOverlayedDocuments(t,Hs){const zs=__PRIVATE_newOverlayMap();return this.populateOverlays(t,zs,Hs).next(()=>this.computeViews(t,Hs,zs,__PRIVATE_documentKeySet()))}populateOverlays(t,Hs,zs){const Ys=[];return zs.forEach(Zs=>{Hs.has(Zs)||Ys.push(Zs)}),this.documentOverlayCache.getOverlays(t,Ys).next(Zs=>{Zs.forEach((_u,Eu)=>{Hs.set(_u,Eu)})})}computeViews(t,Hs,zs,Ys){let Zs=__PRIVATE_mutableDocumentMap();const _u=__PRIVATE_newDocumentKeyMap(),Eu=function(){return __PRIVATE_newDocumentKeyMap()}();return Hs.forEach((Iu,Au)=>{const $u=zs.get(Au.key);Ys.has(Au.key)&&($u===void 0||$u.mutation instanceof __PRIVATE_PatchMutation)?Zs=Zs.insert(Au.key,Au):$u!==void 0?(_u.set(Au.key,$u.mutation.getFieldMask()),__PRIVATE_mutationApplyToLocalView($u.mutation,Au,$u.mutation.getFieldMask(),Timestamp.now())):_u.set(Au.key,FieldMask.empty())}),this.recalculateAndSaveOverlays(t,Zs).next(Iu=>(Iu.forEach((Au,$u)=>_u.set(Au,$u)),Hs.forEach((Au,$u)=>Eu.set(Au,new OverlayedDocument($u,_u.get(Au)??null))),Eu))}recalculateAndSaveOverlays(t,Hs){const zs=__PRIVATE_newDocumentKeyMap();let Ys=new SortedMap((_u,Eu)=>_u-Eu),Zs=__PRIVATE_documentKeySet();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,Hs).next(_u=>{for(const Eu of _u)Eu.keys().forEach(Iu=>{const Au=Hs.get(Iu);if(Au===null)return;let $u=zs.get(Iu)||FieldMask.empty();$u=Eu.applyToLocalView(Au,$u),zs.set(Iu,$u);const vu=(Ys.get(Eu.batchId)||__PRIVATE_documentKeySet()).add(Iu);Ys=Ys.insert(Eu.batchId,vu)})}).next(()=>{const _u=[],Eu=Ys.getReverseIterator();for(;Eu.hasNext();){const Iu=Eu.getNext(),Au=Iu.key,$u=Iu.value,vu=__PRIVATE_newMutationMap();$u.forEach(Su=>{if(!Zs.has(Su)){const Ru=__PRIVATE_calculateOverlayMutation(Hs.get(Su),zs.get(Su));Ru!==null&&vu.set(Su,Ru),Zs=Zs.add(Su)}}),_u.push(this.documentOverlayCache.saveOverlays(t,Au,vu))}return PersistencePromise.waitFor(_u)}).next(()=>zs)}recalculateAndSaveOverlaysForDocumentKeys(t,Hs){return this.remoteDocumentCache.getEntries(t,Hs).next(zs=>this.recalculateAndSaveOverlays(t,zs))}getDocumentsMatchingQuery(t,Hs,zs,Ys){return __PRIVATE_isDocumentQuery$1(Hs)?this.getDocumentsMatchingDocumentQuery(t,Hs.path):__PRIVATE_isCollectionGroupQuery(Hs)?this.getDocumentsMatchingCollectionGroupQuery(t,Hs,zs,Ys):this.getDocumentsMatchingCollectionQuery(t,Hs,zs,Ys)}getNextDocuments(t,Hs,zs,Ys){return this.remoteDocumentCache.getAllFromCollectionGroup(t,Hs,zs,Ys).next(Zs=>{const _u=Ys-Zs.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,Hs,zs.largestBatchId,Ys-Zs.size):PersistencePromise.resolve(__PRIVATE_newOverlayMap());let Eu=B,Iu=Zs;return _u.next(Au=>PersistencePromise.forEach(Au,($u,vu)=>(Eu<vu.largestBatchId&&(Eu=vu.largestBatchId),Zs.get($u)?PersistencePromise.resolve():this.remoteDocumentCache.getEntry(t,$u).next(Su=>{Iu=Iu.insert($u,Su)}))).next(()=>this.populateOverlays(t,Au,Zs)).next(()=>this.computeViews(t,Iu,Au,__PRIVATE_documentKeySet())).next($u=>({batchId:Eu,changes:__PRIVATE_convertOverlayedDocumentMapToDocumentMap($u)})))})}getDocumentsMatchingDocumentQuery(t,Hs){return this.getDocument(t,new DocumentKey(Hs)).next(zs=>{let Ys=documentMap();return zs.isFoundDocument()&&(Ys=Ys.insert(zs.key,zs)),Ys})}getDocumentsMatchingCollectionGroupQuery(t,Hs,zs,Ys){const Zs=Hs.collectionGroup;let _u=documentMap();return this.indexManager.getCollectionParents(t,Zs).next(Eu=>PersistencePromise.forEach(Eu,Iu=>{const Au=function(vu,Su){return new __PRIVATE_QueryImpl(Su,null,vu.explicitOrderBy.slice(),vu.filters.slice(),vu.limit,vu.limitType,vu.startAt,vu.endAt)}(Hs,Iu.child(Zs));return this.getDocumentsMatchingCollectionQuery(t,Au,zs,Ys).next($u=>{$u.forEach((vu,Su)=>{_u=_u.insert(vu,Su)})})}).next(()=>_u))}getDocumentsMatchingCollectionQuery(t,Hs,zs,Ys){let Zs;return this.documentOverlayCache.getOverlaysForCollection(t,Hs.path,zs.largestBatchId).next(_u=>(Zs=_u,this.remoteDocumentCache.getDocumentsMatchingQuery(t,Hs,zs,Zs,Ys))).next(_u=>{Zs.forEach((Iu,Au)=>{const $u=Au.getKey();_u.get($u)===null&&(_u=_u.insert($u,MutableDocument.newInvalidDocument($u)))});let Eu=documentMap();return _u.forEach((Iu,Au)=>{const $u=Zs.get(Iu);$u!==void 0&&__PRIVATE_mutationApplyToLocalView($u.mutation,Au,FieldMask.empty(),Timestamp.now()),__PRIVATE_queryMatches(Hs,Au)&&(Eu=Eu.insert(Iu,Au))}),Eu})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_MemoryBundleCache{constructor(t){this.serializer=t,this.Nr=new Map,this.Br=new Map}getBundleMetadata(t,Hs){return PersistencePromise.resolve(this.Nr.get(Hs))}saveBundleMetadata(t,Hs){return this.Nr.set(Hs.id,function(Ys){return{id:Ys.id,version:Ys.version,createTime:__PRIVATE_fromVersion(Ys.createTime)}}(Hs)),PersistencePromise.resolve()}getNamedQuery(t,Hs){return PersistencePromise.resolve(this.Br.get(Hs))}saveNamedQuery(t,Hs){return this.Br.set(Hs.name,function(Ys){return{name:Ys.name,query:__PRIVATE_fromBundledQuery(Ys.bundledQuery),readTime:__PRIVATE_fromVersion(Ys.readTime)}}(Hs)),PersistencePromise.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_MemoryDocumentOverlayCache{constructor(){this.overlays=new SortedMap(DocumentKey.comparator),this.Lr=new Map}getOverlay(t,Hs){return PersistencePromise.resolve(this.overlays.get(Hs))}getOverlays(t,Hs){const zs=__PRIVATE_newOverlayMap();return PersistencePromise.forEach(Hs,Ys=>this.getOverlay(t,Ys).next(Zs=>{Zs!==null&&zs.set(Ys,Zs)})).next(()=>zs)}saveOverlays(t,Hs,zs){return zs.forEach((Ys,Zs)=>{this.bt(t,Hs,Zs)}),PersistencePromise.resolve()}removeOverlaysForBatchId(t,Hs,zs){const Ys=this.Lr.get(zs);return Ys!==void 0&&(Ys.forEach(Zs=>this.overlays=this.overlays.remove(Zs)),this.Lr.delete(zs)),PersistencePromise.resolve()}getOverlaysForCollection(t,Hs,zs){const Ys=__PRIVATE_newOverlayMap(),Zs=Hs.length+1,_u=new DocumentKey(Hs.child("")),Eu=this.overlays.getIteratorFrom(_u);for(;Eu.hasNext();){const Iu=Eu.getNext().value,Au=Iu.getKey();if(!Hs.isPrefixOf(Au.path))break;Au.path.length===Zs&&Iu.largestBatchId>zs&&Ys.set(Iu.getKey(),Iu)}return PersistencePromise.resolve(Ys)}getOverlaysForCollectionGroup(t,Hs,zs,Ys){let Zs=new SortedMap((Au,$u)=>Au-$u);const _u=this.overlays.getIterator();for(;_u.hasNext();){const Au=_u.getNext().value;if(Au.getKey().getCollectionGroup()===Hs&&Au.largestBatchId>zs){let $u=Zs.get(Au.largestBatchId);$u===null&&($u=__PRIVATE_newOverlayMap(),Zs=Zs.insert(Au.largestBatchId,$u)),$u.set(Au.getKey(),Au)}}const Eu=__PRIVATE_newOverlayMap(),Iu=Zs.getIterator();for(;Iu.hasNext()&&(Iu.getNext().value.forEach((Au,$u)=>Eu.set(Au,$u)),!(Eu.size()>=Ys)););return PersistencePromise.resolve(Eu)}bt(t,Hs,zs){const Ys=this.overlays.get(zs.key);if(Ys!==null){const _u=this.Lr.get(Ys.largestBatchId).delete(zs.key);this.Lr.set(Ys.largestBatchId,_u)}this.overlays=this.overlays.insert(zs.key,new Overlay(Hs,zs));let Zs=this.Lr.get(Hs);Zs===void 0&&(Zs=__PRIVATE_documentKeySet(),this.Lr.set(Hs,Zs)),this.Lr.set(Hs,Zs.add(zs.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_MemoryGlobalsCache{constructor(){this.sessionToken=ByteString.EMPTY_BYTE_STRING}getSessionToken(t){return PersistencePromise.resolve(this.sessionToken)}setSessionToken(t,Hs){return this.sessionToken=Hs,PersistencePromise.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_ReferenceSet{constructor(){this.kr=new SortedSet(__PRIVATE_DocReference.Kr),this.qr=new SortedSet(__PRIVATE_DocReference.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(t,Hs){const zs=new __PRIVATE_DocReference(t,Hs);this.kr=this.kr.add(zs),this.qr=this.qr.add(zs)}$r(t,Hs){t.forEach(zs=>this.addReference(zs,Hs))}removeReference(t,Hs){this.Wr(new __PRIVATE_DocReference(t,Hs))}Qr(t,Hs){t.forEach(zs=>this.removeReference(zs,Hs))}Gr(t){const Hs=new DocumentKey(new ResourcePath([])),zs=new __PRIVATE_DocReference(Hs,t),Ys=new __PRIVATE_DocReference(Hs,t+1),Zs=[];return this.qr.forEachInRange([zs,Ys],_u=>{this.Wr(_u),Zs.push(_u.key)}),Zs}zr(){this.kr.forEach(t=>this.Wr(t))}Wr(t){this.kr=this.kr.delete(t),this.qr=this.qr.delete(t)}jr(t){const Hs=new DocumentKey(new ResourcePath([])),zs=new __PRIVATE_DocReference(Hs,t),Ys=new __PRIVATE_DocReference(Hs,t+1);let Zs=__PRIVATE_documentKeySet();return this.qr.forEachInRange([zs,Ys],_u=>{Zs=Zs.add(_u.key)}),Zs}containsKey(t){const Hs=new __PRIVATE_DocReference(t,0),zs=this.kr.firstAfterOrEqual(Hs);return zs!==null&&t.isEqual(zs.key)}}class __PRIVATE_DocReference{constructor(t,Hs){this.key=t,this.Hr=Hs}static Kr(t,Hs){return DocumentKey.comparator(t.key,Hs.key)||__PRIVATE_primitiveComparator(t.Hr,Hs.Hr)}static Ur(t,Hs){return __PRIVATE_primitiveComparator(t.Hr,Hs.Hr)||DocumentKey.comparator(t.key,Hs.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_MemoryMutationQueue{constructor(t,Hs){this.indexManager=t,this.referenceDelegate=Hs,this.mutationQueue=[],this.Yn=1,this.Jr=new SortedSet(__PRIVATE_DocReference.Kr)}checkEmpty(t){return PersistencePromise.resolve(this.mutationQueue.length===0)}addMutationBatch(t,Hs,zs,Ys){const Zs=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const _u=new MutationBatch(Zs,Hs,zs,Ys);this.mutationQueue.push(_u);for(const Eu of Ys)this.Jr=this.Jr.add(new __PRIVATE_DocReference(Eu.key,Zs)),this.indexManager.addToCollectionParentIndex(t,Eu.key.path.popLast());return PersistencePromise.resolve(_u)}lookupMutationBatch(t,Hs){return PersistencePromise.resolve(this.Zr(Hs))}getNextMutationBatchAfterBatchId(t,Hs){const zs=Hs+1,Ys=this.Xr(zs),Zs=Ys<0?0:Ys;return PersistencePromise.resolve(this.mutationQueue.length>Zs?this.mutationQueue[Zs]:null)}getHighestUnacknowledgedBatchId(){return PersistencePromise.resolve(this.mutationQueue.length===0?U:this.Yn-1)}getAllMutationBatches(t){return PersistencePromise.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,Hs){const zs=new __PRIVATE_DocReference(Hs,0),Ys=new __PRIVATE_DocReference(Hs,Number.POSITIVE_INFINITY),Zs=[];return this.Jr.forEachInRange([zs,Ys],_u=>{const Eu=this.Zr(_u.Hr);Zs.push(Eu)}),PersistencePromise.resolve(Zs)}getAllMutationBatchesAffectingDocumentKeys(t,Hs){let zs=new SortedSet(__PRIVATE_primitiveComparator);return Hs.forEach(Ys=>{const Zs=new __PRIVATE_DocReference(Ys,0),_u=new __PRIVATE_DocReference(Ys,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([Zs,_u],Eu=>{zs=zs.add(Eu.Hr)})}),PersistencePromise.resolve(this.Yr(zs))}getAllMutationBatchesAffectingQuery(t,Hs){const zs=Hs.path,Ys=zs.length+1;let Zs=zs;DocumentKey.isDocumentKey(Zs)||(Zs=Zs.child(""));const _u=new __PRIVATE_DocReference(new DocumentKey(Zs),0);let Eu=new SortedSet(__PRIVATE_primitiveComparator);return this.Jr.forEachWhile(Iu=>{const Au=Iu.key.path;return!!zs.isPrefixOf(Au)&&(Au.length===Ys&&(Eu=Eu.add(Iu.Hr)),!0)},_u),PersistencePromise.resolve(this.Yr(Eu))}Yr(t){const Hs=[];return t.forEach(zs=>{const Ys=this.Zr(zs);Ys!==null&&Hs.push(Ys)}),Hs}removeMutationBatch(t,Hs){__PRIVATE_hardAssert(this.ei(Hs.batchId,"removed")===0,55003),this.mutationQueue.shift();let zs=this.Jr;return PersistencePromise.forEach(Hs.mutations,Ys=>{const Zs=new __PRIVATE_DocReference(Ys.key,Hs.batchId);return zs=zs.delete(Zs),this.referenceDelegate.markPotentiallyOrphaned(t,Ys.key)}).next(()=>{this.Jr=zs})}nr(t){}containsKey(t,Hs){const zs=new __PRIVATE_DocReference(Hs,0),Ys=this.Jr.firstAfterOrEqual(zs);return PersistencePromise.resolve(Hs.isEqual(Ys&&Ys.key))}performConsistencyCheck(t){return this.mutationQueue.length,PersistencePromise.resolve()}ei(t,Hs){return this.Xr(t)}Xr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Zr(t){const Hs=this.Xr(t);return Hs<0||Hs>=this.mutationQueue.length?null:this.mutationQueue[Hs]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_MemoryRemoteDocumentCacheImpl{constructor(t){this.ti=t,this.docs=function(){return new SortedMap(DocumentKey.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,Hs){const zs=Hs.key,Ys=this.docs.get(zs),Zs=Ys?Ys.size:0,_u=this.ti(Hs);return this.docs=this.docs.insert(zs,{document:Hs.mutableCopy(),size:_u}),this.size+=_u-Zs,this.indexManager.addToCollectionParentIndex(t,zs.path.popLast())}removeEntry(t){const Hs=this.docs.get(t);Hs&&(this.docs=this.docs.remove(t),this.size-=Hs.size)}getEntry(t,Hs){const zs=this.docs.get(Hs);return PersistencePromise.resolve(zs?zs.document.mutableCopy():MutableDocument.newInvalidDocument(Hs))}getEntries(t,Hs){let zs=__PRIVATE_mutableDocumentMap();return Hs.forEach(Ys=>{const Zs=this.docs.get(Ys);zs=zs.insert(Ys,Zs?Zs.document.mutableCopy():MutableDocument.newInvalidDocument(Ys))}),PersistencePromise.resolve(zs)}getDocumentsMatchingQuery(t,Hs,zs,Ys){let Zs=__PRIVATE_mutableDocumentMap();const _u=Hs.path,Eu=new DocumentKey(_u.child("__id-9223372036854775808__")),Iu=this.docs.getIteratorFrom(Eu);for(;Iu.hasNext();){const{key:Au,value:{document:$u}}=Iu.getNext();if(!_u.isPrefixOf(Au.path))break;Au.path.length>_u.length+1||__PRIVATE_indexOffsetComparator(__PRIVATE_newIndexOffsetFromDocument($u),zs)<=0||(Ys.has($u.key)||__PRIVATE_queryMatches(Hs,$u))&&(Zs=Zs.insert($u.key,$u.mutableCopy()))}return PersistencePromise.resolve(Zs)}getAllFromCollectionGroup(t,Hs,zs,Ys){fail(9500)}ni(t,Hs){return PersistencePromise.forEach(this.docs,zs=>Hs(zs))}newChangeBuffer(t){return new __PRIVATE_MemoryRemoteDocumentChangeBuffer(this)}getSize(t){return PersistencePromise.resolve(this.size)}}class __PRIVATE_MemoryRemoteDocumentChangeBuffer extends RemoteDocumentChangeBuffer{constructor(t){super(),this.Mr=t}applyChanges(t){const Hs=[];return this.changes.forEach((zs,Ys)=>{Ys.isValidDocument()?Hs.push(this.Mr.addEntry(t,Ys)):this.Mr.removeEntry(zs)}),PersistencePromise.waitFor(Hs)}getFromCache(t,Hs){return this.Mr.getEntry(t,Hs)}getAllFromCache(t,Hs){return this.Mr.getEntries(t,Hs)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_MemoryTargetCache{constructor(t){this.persistence=t,this.ri=new ObjectMap(Hs=>__PRIVATE_canonifyTarget(Hs),__PRIVATE_targetEquals),this.lastRemoteSnapshotVersion=SnapshotVersion.min(),this.highestTargetId=0,this.ii=0,this.si=new __PRIVATE_ReferenceSet,this.targetCount=0,this.oi=__PRIVATE_TargetIdGenerator._r()}forEachTarget(t,Hs){return this.ri.forEach((zs,Ys)=>Hs(Ys)),PersistencePromise.resolve()}getLastRemoteSnapshotVersion(t){return PersistencePromise.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return PersistencePromise.resolve(this.ii)}allocateTargetId(t){return this.highestTargetId=this.oi.next(),PersistencePromise.resolve(this.highestTargetId)}setTargetsMetadata(t,Hs,zs){return zs&&(this.lastRemoteSnapshotVersion=zs),Hs>this.ii&&(this.ii=Hs),PersistencePromise.resolve()}lr(t){this.ri.set(t.target,t);const Hs=t.targetId;Hs>this.highestTargetId&&(this.oi=new __PRIVATE_TargetIdGenerator(Hs),this.highestTargetId=Hs),t.sequenceNumber>this.ii&&(this.ii=t.sequenceNumber)}addTargetData(t,Hs){return this.lr(Hs),this.targetCount+=1,PersistencePromise.resolve()}updateTargetData(t,Hs){return this.lr(Hs),PersistencePromise.resolve()}removeTargetData(t,Hs){return this.ri.delete(Hs.target),this.si.Gr(Hs.targetId),this.targetCount-=1,PersistencePromise.resolve()}removeTargets(t,Hs,zs){let Ys=0;const Zs=[];return this.ri.forEach((_u,Eu)=>{Eu.sequenceNumber<=Hs&&zs.get(Eu.targetId)===null&&(this.ri.delete(_u),Zs.push(this.removeMatchingKeysForTargetId(t,Eu.targetId)),Ys++)}),PersistencePromise.waitFor(Zs).next(()=>Ys)}getTargetCount(t){return PersistencePromise.resolve(this.targetCount)}getTargetData(t,Hs){const zs=this.ri.get(Hs)||null;return PersistencePromise.resolve(zs)}addMatchingKeys(t,Hs,zs){return this.si.$r(Hs,zs),PersistencePromise.resolve()}removeMatchingKeys(t,Hs,zs){this.si.Qr(Hs,zs);const Ys=this.persistence.referenceDelegate,Zs=[];return Ys&&Hs.forEach(_u=>{Zs.push(Ys.markPotentiallyOrphaned(t,_u))}),PersistencePromise.waitFor(Zs)}removeMatchingKeysForTargetId(t,Hs){return this.si.Gr(Hs),PersistencePromise.resolve()}getMatchingKeysForTargetId(t,Hs){const zs=this.si.jr(Hs);return PersistencePromise.resolve(zs)}containsKey(t,Hs){return PersistencePromise.resolve(this.si.containsKey(Hs))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_MemoryPersistence{constructor(t,Hs){this._i={},this.overlays={},this.ai=new __PRIVATE_ListenSequence(0),this.ui=!1,this.ui=!0,this.ci=new __PRIVATE_MemoryGlobalsCache,this.referenceDelegate=t(this),this.li=new __PRIVATE_MemoryTargetCache(this),this.indexManager=new __PRIVATE_MemoryIndexManager,this.remoteDocumentCache=function(Ys){return new __PRIVATE_MemoryRemoteDocumentCacheImpl(Ys)}(zs=>this.referenceDelegate.hi(zs)),this.serializer=new __PRIVATE_LocalSerializer(Hs),this.Pi=new __PRIVATE_MemoryBundleCache(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let Hs=this.overlays[t.toKey()];return Hs||(Hs=new __PRIVATE_MemoryDocumentOverlayCache,this.overlays[t.toKey()]=Hs),Hs}getMutationQueue(t,Hs){let zs=this._i[t.toKey()];return zs||(zs=new __PRIVATE_MemoryMutationQueue(Hs,this.referenceDelegate),this._i[t.toKey()]=zs),zs}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(t,Hs,zs){__PRIVATE_logDebug("MemoryPersistence","Starting transaction:",t);const Ys=new __PRIVATE_MemoryTransaction(this.ai.next());return this.referenceDelegate.Ti(),zs(Ys).next(Zs=>this.referenceDelegate.Ii(Ys).next(()=>Zs)).toPromise().then(Zs=>(Ys.raiseOnCommittedEvent(),Zs))}Ei(t,Hs){return PersistencePromise.or(Object.values(this._i).map(zs=>()=>zs.containsKey(t,Hs)))}}class __PRIVATE_MemoryTransaction extends PersistenceTransaction{constructor(t){super(),this.currentSequenceNumber=t}}class __PRIVATE_MemoryEagerDelegate{constructor(t){this.persistence=t,this.Ri=new __PRIVATE_ReferenceSet,this.Ai=null}static Vi(t){return new __PRIVATE_MemoryEagerDelegate(t)}get di(){if(this.Ai)return this.Ai;throw fail(60996)}addReference(t,Hs,zs){return this.Ri.addReference(zs,Hs),this.di.delete(zs.toString()),PersistencePromise.resolve()}removeReference(t,Hs,zs){return this.Ri.removeReference(zs,Hs),this.di.add(zs.toString()),PersistencePromise.resolve()}markPotentiallyOrphaned(t,Hs){return this.di.add(Hs.toString()),PersistencePromise.resolve()}removeTarget(t,Hs){this.Ri.Gr(Hs.targetId).forEach(Ys=>this.di.add(Ys.toString()));const zs=this.persistence.getTargetCache();return zs.getMatchingKeysForTargetId(t,Hs.targetId).next(Ys=>{Ys.forEach(Zs=>this.di.add(Zs.toString()))}).next(()=>zs.removeTargetData(t,Hs))}Ti(){this.Ai=new Set}Ii(t){const Hs=this.persistence.getRemoteDocumentCache().newChangeBuffer();return PersistencePromise.forEach(this.di,zs=>{const Ys=DocumentKey.fromPath(zs);return this.mi(t,Ys).next(Zs=>{Zs||Hs.removeEntry(Ys,SnapshotVersion.min())})}).next(()=>(this.Ai=null,Hs.apply(t)))}updateLimboDocument(t,Hs){return this.mi(t,Hs).next(zs=>{zs?this.di.delete(Hs.toString()):this.di.add(Hs.toString())})}hi(t){return 0}mi(t,Hs){return PersistencePromise.or([()=>PersistencePromise.resolve(this.Ri.containsKey(Hs)),()=>this.persistence.getTargetCache().containsKey(t,Hs),()=>this.persistence.Ei(t,Hs)])}}class __PRIVATE_MemoryLruDelegate{constructor(t,Hs){this.persistence=t,this.fi=new ObjectMap(zs=>__PRIVATE_encodeResourcePath(zs.path),(zs,Ys)=>zs.isEqual(Ys)),this.garbageCollector=__PRIVATE_newLruGarbageCollector(this,Hs)}static Vi(t,Hs){return new __PRIVATE_MemoryLruDelegate(t,Hs)}Ti(){}Ii(t){return PersistencePromise.resolve()}forEachTarget(t,Hs){return this.persistence.getTargetCache().forEachTarget(t,Hs)}dr(t){const Hs=this.pr(t);return this.persistence.getTargetCache().getTargetCount(t).next(zs=>Hs.next(Ys=>zs+Ys))}pr(t){let Hs=0;return this.mr(t,zs=>{Hs++}).next(()=>Hs)}mr(t,Hs){return PersistencePromise.forEach(this.fi,(zs,Ys)=>this.wr(t,zs,Ys).next(Zs=>Zs?PersistencePromise.resolve():Hs(Ys)))}removeTargets(t,Hs,zs){return this.persistence.getTargetCache().removeTargets(t,Hs,zs)}removeOrphanedDocuments(t,Hs){let zs=0;const Ys=this.persistence.getRemoteDocumentCache(),Zs=Ys.newChangeBuffer();return Ys.ni(t,_u=>this.wr(t,_u,Hs).next(Eu=>{Eu||(zs++,Zs.removeEntry(_u,SnapshotVersion.min()))})).next(()=>Zs.apply(t)).next(()=>zs)}markPotentiallyOrphaned(t,Hs){return this.fi.set(Hs,t.currentSequenceNumber),PersistencePromise.resolve()}removeTarget(t,Hs){const zs=Hs.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,zs)}addReference(t,Hs,zs){return this.fi.set(zs,t.currentSequenceNumber),PersistencePromise.resolve()}removeReference(t,Hs,zs){return this.fi.set(zs,t.currentSequenceNumber),PersistencePromise.resolve()}updateLimboDocument(t,Hs){return this.fi.set(Hs,t.currentSequenceNumber),PersistencePromise.resolve()}hi(t){let Hs=t.key.toString().length;return t.isFoundDocument()&&(Hs+=__PRIVATE_estimateByteSize(t.data.value)),Hs}wr(t,Hs,zs){return PersistencePromise.or([()=>this.persistence.Ei(t,Hs),()=>this.persistence.getTargetCache().containsKey(t,Hs),()=>{const Ys=this.fi.get(Hs);return PersistencePromise.resolve(Ys!==void 0&&Ys>zs)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_LocalViewChanges{constructor(t,Hs,zs,Ys){this.targetId=t,this.fromCache=Hs,this.Ts=zs,this.Is=Ys}static Es(t,Hs){let zs=__PRIVATE_documentKeySet(),Ys=__PRIVATE_documentKeySet();for(const Zs of Hs.docChanges)switch(Zs.type){case 0:zs=zs.add(Zs.doc.key);break;case 1:Ys=Ys.add(Zs.doc.key)}return new __PRIVATE_LocalViewChanges(t,Hs.fromCache,zs,Ys)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QueryContext{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_QueryEngine{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=function(){return isSafari()?8:__PRIVATE_getAndroidVersion(getUA())>0?6:4}()}initialize(t,Hs){this.fs=t,this.indexManager=Hs,this.Rs=!0}getDocumentsMatchingQuery(t,Hs,zs,Ys){const Zs={result:null};return this.gs(t,Hs).next(_u=>{Zs.result=_u}).next(()=>{if(!Zs.result)return this.ps(t,Hs,Ys,zs).next(_u=>{Zs.result=_u})}).next(()=>{if(Zs.result)return;const _u=new QueryContext;return this.ys(t,Hs,_u).next(Eu=>{if(Zs.result=Eu,this.As)return this.ws(t,Hs,_u,Eu.size)})}).next(()=>Zs.result)}ws(t,Hs,zs,Ys){return zs.documentReadCount<this.Vs?(__PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("QueryEngine","SDK will not create cache indexes for query:",__PRIVATE_stringifyQuery(Hs),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),PersistencePromise.resolve()):(__PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("QueryEngine","Query:",__PRIVATE_stringifyQuery(Hs),"scans",zs.documentReadCount,"local documents and returns",Ys,"documents as results."),zs.documentReadCount>this.ds*Ys?(__PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("QueryEngine","The SDK decides to create cache indexes for query:",__PRIVATE_stringifyQuery(Hs),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,__PRIVATE_queryToTarget(Hs))):PersistencePromise.resolve())}gs(t,Hs){if(__PRIVATE_queryMatchesAllDocuments(Hs))return PersistencePromise.resolve(null);let zs=__PRIVATE_queryToTarget(Hs);return this.indexManager.getIndexType(t,zs).next(Ys=>Ys===0?null:(Hs.limit!==null&&Ys===1&&(Hs=__PRIVATE_queryWithLimit(Hs,null,"F"),zs=__PRIVATE_queryToTarget(Hs)),this.indexManager.getDocumentsMatchingTarget(t,zs).next(Zs=>{const _u=__PRIVATE_documentKeySet(...Zs);return this.fs.getDocuments(t,_u).next(Eu=>this.indexManager.getMinOffset(t,zs).next(Iu=>{const Au=this.bs(Hs,Eu);return this.Ss(Hs,Au,_u,Iu.readTime)?this.gs(t,__PRIVATE_queryWithLimit(Hs,null,"F")):this.Ds(t,Au,Hs,Iu)}))})))}ps(t,Hs,zs,Ys){return __PRIVATE_queryMatchesAllDocuments(Hs)||Ys.isEqual(SnapshotVersion.min())?PersistencePromise.resolve(null):this.fs.getDocuments(t,zs).next(Zs=>{const _u=this.bs(Hs,Zs);return this.Ss(Hs,_u,zs,Ys)?PersistencePromise.resolve(null):(__PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("QueryEngine","Re-using previous result from %s to execute query: %s",Ys.toString(),__PRIVATE_stringifyQuery(Hs)),this.Ds(t,_u,Hs,__PRIVATE_newIndexOffsetSuccessorFromReadTime(Ys,B)).next(Eu=>Eu))})}bs(t,Hs){let zs=new SortedSet(__PRIVATE_newQueryComparator(t));return Hs.forEach((Ys,Zs)=>{__PRIVATE_queryMatches(t,Zs)&&(zs=zs.add(Zs))}),zs}Ss(t,Hs,zs,Ys){if(t.limit===null)return!1;if(zs.size!==Hs.size)return!0;const Zs=t.limitType==="F"?Hs.last():Hs.first();return!!Zs&&(Zs.hasPendingWrites||Zs.version.compareTo(Ys)>0)}ys(t,Hs,zs){return __PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("QueryEngine","Using full collection scan to execute query:",__PRIVATE_stringifyQuery(Hs)),this.fs.getDocumentsMatchingQuery(t,Hs,IndexOffset.min(),zs)}Ds(t,Hs,zs,Ys){return this.fs.getDocumentsMatchingQuery(t,zs,Ys).next(Zs=>(Hs.forEach(_u=>{Zs=Zs.insert(_u.key,_u)}),Zs))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bt="LocalStore",Lt=3e8;class __PRIVATE_LocalStoreImpl{constructor(t,Hs,zs,Ys){this.persistence=t,this.Cs=Hs,this.serializer=Ys,this.vs=new SortedMap(__PRIVATE_primitiveComparator),this.Fs=new ObjectMap(Zs=>__PRIVATE_canonifyTarget(Zs),__PRIVATE_targetEquals),this.Ms=new Map,this.xs=t.getRemoteDocumentCache(),this.li=t.getTargetCache(),this.Pi=t.getBundleCache(),this.Os(zs)}Os(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new LocalDocumentsView(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",Hs=>t.collect(Hs,this.vs))}}function __PRIVATE_newLocalStore(Z,t,Hs,zs){return new __PRIVATE_LocalStoreImpl(Z,t,Hs,zs)}async function __PRIVATE_localStoreHandleUserChange(Z,t){const Hs=__PRIVATE_debugCast(Z);return await Hs.persistence.runTransaction("Handle user change","readonly",zs=>{let Ys;return Hs.mutationQueue.getAllMutationBatches(zs).next(Zs=>(Ys=Zs,Hs.Os(t),Hs.mutationQueue.getAllMutationBatches(zs))).next(Zs=>{const _u=[],Eu=[];let Iu=__PRIVATE_documentKeySet();for(const Au of Ys){_u.push(Au.batchId);for(const $u of Au.mutations)Iu=Iu.add($u.key)}for(const Au of Zs){Eu.push(Au.batchId);for(const $u of Au.mutations)Iu=Iu.add($u.key)}return Hs.localDocuments.getDocuments(zs,Iu).next(Au=>({Ns:Au,removedBatchIds:_u,addedBatchIds:Eu}))})})}function __PRIVATE_localStoreAcknowledgeBatch(Z,t){const Hs=__PRIVATE_debugCast(Z);return Hs.persistence.runTransaction("Acknowledge batch","readwrite-primary",zs=>{const Ys=t.batch.keys(),Zs=Hs.xs.newChangeBuffer({trackRemovals:!0});return function(Eu,Iu,Au,$u){const vu=Au.batch,Su=vu.keys();let Ru=PersistencePromise.resolve();return Su.forEach(Pu=>{Ru=Ru.next(()=>$u.getEntry(Iu,Pu)).next(Cu=>{const Bu=Au.docVersions.get(Pu);__PRIVATE_hardAssert(Bu!==null,48541),Cu.version.compareTo(Bu)<0&&(vu.applyToRemoteDocument(Cu,Au),Cu.isValidDocument()&&(Cu.setReadTime(Au.commitVersion),$u.addEntry(Cu)))})}),Ru.next(()=>Eu.mutationQueue.removeMutationBatch(Iu,vu))}(Hs,zs,t,Zs).next(()=>Zs.apply(zs)).next(()=>Hs.mutationQueue.performConsistencyCheck(zs)).next(()=>Hs.documentOverlayCache.removeOverlaysForBatchId(zs,Ys,t.batch.batchId)).next(()=>Hs.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(zs,function(Eu){let Iu=__PRIVATE_documentKeySet();for(let Au=0;Au<Eu.mutationResults.length;++Au)Eu.mutationResults[Au].transformResults.length>0&&(Iu=Iu.add(Eu.batch.mutations[Au].key));return Iu}(t))).next(()=>Hs.localDocuments.getDocuments(zs,Ys))})}function __PRIVATE_localStoreGetLastRemoteSnapshotVersion(Z){const t=__PRIVATE_debugCast(Z);return t.persistence.runTransaction("Get last remote snapshot version","readonly",Hs=>t.li.getLastRemoteSnapshotVersion(Hs))}function __PRIVATE_localStoreApplyRemoteEventToLocalCache(Z,t){const Hs=__PRIVATE_debugCast(Z),zs=t.snapshotVersion;let Ys=Hs.vs;return Hs.persistence.runTransaction("Apply remote event","readwrite-primary",Zs=>{const _u=Hs.xs.newChangeBuffer({trackRemovals:!0});Ys=Hs.vs;const Eu=[];t.targetChanges.forEach(($u,vu)=>{const Su=Ys.get(vu);if(!Su)return;Eu.push(Hs.li.removeMatchingKeys(Zs,$u.removedDocuments,vu).next(()=>Hs.li.addMatchingKeys(Zs,$u.addedDocuments,vu)));let Ru=Su.withSequenceNumber(Zs.currentSequenceNumber);t.targetMismatches.get(vu)!==null?Ru=Ru.withResumeToken(ByteString.EMPTY_BYTE_STRING,SnapshotVersion.min()).withLastLimboFreeSnapshotVersion(SnapshotVersion.min()):$u.resumeToken.approximateByteSize()>0&&(Ru=Ru.withResumeToken($u.resumeToken,zs)),Ys=Ys.insert(vu,Ru),function(Cu,Bu,Fu){return Cu.resumeToken.approximateByteSize()===0||Bu.snapshotVersion.toMicroseconds()-Cu.snapshotVersion.toMicroseconds()>=Lt?!0:Fu.addedDocuments.size+Fu.modifiedDocuments.size+Fu.removedDocuments.size>0}(Su,Ru,$u)&&Eu.push(Hs.li.updateTargetData(Zs,Ru))});let Iu=__PRIVATE_mutableDocumentMap(),Au=__PRIVATE_documentKeySet();if(t.documentUpdates.forEach($u=>{t.resolvedLimboDocuments.has($u)&&Eu.push(Hs.persistence.referenceDelegate.updateLimboDocument(Zs,$u))}),Eu.push(__PRIVATE_populateDocumentChangeBuffer(Zs,_u,t.documentUpdates).next($u=>{Iu=$u.Bs,Au=$u.Ls})),!zs.isEqual(SnapshotVersion.min())){const $u=Hs.li.getLastRemoteSnapshotVersion(Zs).next(vu=>Hs.li.setTargetsMetadata(Zs,Zs.currentSequenceNumber,zs));Eu.push($u)}return PersistencePromise.waitFor(Eu).next(()=>_u.apply(Zs)).next(()=>Hs.localDocuments.getLocalViewOfDocuments(Zs,Iu,Au)).next(()=>Iu)}).then(Zs=>(Hs.vs=Ys,Zs))}function __PRIVATE_populateDocumentChangeBuffer(Z,t,Hs){let zs=__PRIVATE_documentKeySet(),Ys=__PRIVATE_documentKeySet();return Hs.forEach(Zs=>zs=zs.add(Zs)),t.getEntries(Z,zs).next(Zs=>{let _u=__PRIVATE_mutableDocumentMap();return Hs.forEach((Eu,Iu)=>{const Au=Zs.get(Eu);Iu.isFoundDocument()!==Au.isFoundDocument()&&(Ys=Ys.add(Eu)),Iu.isNoDocument()&&Iu.version.isEqual(SnapshotVersion.min())?(t.removeEntry(Eu,Iu.readTime),_u=_u.insert(Eu,Iu)):!Au.isValidDocument()||Iu.version.compareTo(Au.version)>0||Iu.version.compareTo(Au.version)===0&&Au.hasPendingWrites?(t.addEntry(Iu),_u=_u.insert(Eu,Iu)):__PRIVATE_logDebug(Bt,"Ignoring outdated watch update for ",Eu,". Current version:",Au.version," Watch version:",Iu.version)}),{Bs:_u,Ls:Ys}})}function __PRIVATE_localStoreGetNextMutationBatch(Z,t){const Hs=__PRIVATE_debugCast(Z);return Hs.persistence.runTransaction("Get next mutation batch","readonly",zs=>(t===void 0&&(t=U),Hs.mutationQueue.getNextMutationBatchAfterBatchId(zs,t)))}function __PRIVATE_localStoreAllocateTarget(Z,t){const Hs=__PRIVATE_debugCast(Z);return Hs.persistence.runTransaction("Allocate target","readwrite",zs=>{let Ys;return Hs.li.getTargetData(zs,t).next(Zs=>Zs?(Ys=Zs,PersistencePromise.resolve(Ys)):Hs.li.allocateTargetId(zs).next(_u=>(Ys=new TargetData(t,_u,"TargetPurposeListen",zs.currentSequenceNumber),Hs.li.addTargetData(zs,Ys).next(()=>Ys))))}).then(zs=>{const Ys=Hs.vs.get(zs.targetId);return(Ys===null||zs.snapshotVersion.compareTo(Ys.snapshotVersion)>0)&&(Hs.vs=Hs.vs.insert(zs.targetId,zs),Hs.Fs.set(t,zs.targetId)),zs})}async function __PRIVATE_localStoreReleaseTarget(Z,t,Hs){const zs=__PRIVATE_debugCast(Z),Ys=zs.vs.get(t),Zs=Hs?"readwrite":"readwrite-primary";try{Hs||await zs.persistence.runTransaction("Release target",Zs,_u=>zs.persistence.referenceDelegate.removeTarget(_u,Ys))}catch(_u){if(!__PRIVATE_isIndexedDbTransactionError(_u))throw _u;__PRIVATE_logDebug(Bt,`Failed to update sequence numbers for target ${t}: ${_u}`)}zs.vs=zs.vs.remove(t),zs.Fs.delete(Ys.target)}function __PRIVATE_localStoreExecuteQuery(Z,t,Hs){const zs=__PRIVATE_debugCast(Z);let Ys=SnapshotVersion.min(),Zs=__PRIVATE_documentKeySet();return zs.persistence.runTransaction("Execute query","readwrite",_u=>function(Iu,Au,$u){const vu=__PRIVATE_debugCast(Iu),Su=vu.Fs.get($u);return Su!==void 0?PersistencePromise.resolve(vu.vs.get(Su)):vu.li.getTargetData(Au,$u)}(zs,_u,__PRIVATE_queryToTarget(t)).next(Eu=>{if(Eu)return Ys=Eu.lastLimboFreeSnapshotVersion,zs.li.getMatchingKeysForTargetId(_u,Eu.targetId).next(Iu=>{Zs=Iu})}).next(()=>zs.Cs.getDocumentsMatchingQuery(_u,t,Hs?Ys:SnapshotVersion.min(),Hs?Zs:__PRIVATE_documentKeySet())).next(Eu=>(__PRIVATE_setMaxReadTime(zs,__PRIVATE_queryCollectionGroup(t),Eu),{documents:Eu,ks:Zs})))}function __PRIVATE_setMaxReadTime(Z,t,Hs){let zs=Z.Ms.get(t)||SnapshotVersion.min();Hs.forEach((Ys,Zs)=>{Zs.readTime.compareTo(zs)>0&&(zs=Zs.readTime)}),Z.Ms.set(t,zs)}class __PRIVATE_LocalClientState{constructor(){this.activeTargetIds=__PRIVATE_targetIdSet()}Qs(t){this.activeTargetIds=this.activeTargetIds.add(t)}Gs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ws(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class __PRIVATE_MemorySharedClientState{constructor(){this.vo=new __PRIVATE_LocalClientState,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,Hs,zs){}addLocalQueryTarget(t,Hs=!0){return Hs&&this.vo.Qs(t),this.Fo[t]||"not-current"}updateQueryState(t,Hs,zs){this.Fo[t]=Hs}removeLocalQueryTarget(t){this.vo.Gs(t)}isLocalQueryTarget(t){return this.vo.activeTargetIds.has(t)}clearQueryState(t){delete this.Fo[t]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(t){return this.vo.activeTargetIds.has(t)}start(){return this.vo=new __PRIVATE_LocalClientState,Promise.resolve()}handleUserChange(t,Hs,zs){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_NoopConnectivityMonitor{Mo(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $t="ConnectivityMonitor";class __PRIVATE_BrowserConnectivityMonitor{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(t){this.Lo.push(t)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){__PRIVATE_logDebug($t,"Network connectivity changed: AVAILABLE");for(const t of this.Lo)t(0)}Bo(){__PRIVATE_logDebug($t,"Network connectivity changed: UNAVAILABLE");for(const t of this.Lo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Wt=null;function __PRIVATE_generateUniqueDebugId(){return Wt===null?Wt=function(){return 268435456+Math.round(2147483648*Math.random())}():Wt++,"0x"+Wt.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qt="RestConnection",Gt={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class __PRIVATE_RestConnection{get Ko(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const Hs=t.ssl?"https":"http",zs=encodeURIComponent(this.databaseId.projectId),Ys=encodeURIComponent(this.databaseId.database);this.qo=Hs+"://"+t.host,this.Uo=`projects/${zs}/databases/${Ys}`,this.$o=this.databaseId.database===st?`project_id=${zs}`:`project_id=${zs}&database_id=${Ys}`}Wo(t,Hs,zs,Ys,Zs){const _u=__PRIVATE_generateUniqueDebugId(),Eu=this.Qo(t,Hs.toUriEncodedString());__PRIVATE_logDebug(Qt,`Sending RPC '${t}' ${_u}:`,Eu,zs);const Iu={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(Iu,Ys,Zs);const{host:Au}=new URL(Eu),$u=isCloudWorkstation(Au);return this.zo(t,Eu,Iu,zs,$u).then(vu=>(__PRIVATE_logDebug(Qt,`Received RPC '${t}' ${_u}: `,vu),vu),vu=>{throw __PRIVATE_logWarn(Qt,`RPC '${t}' ${_u} failed with error: `,vu,"url: ",Eu,"request:",zs),vu})}jo(t,Hs,zs,Ys,Zs,_u){return this.Wo(t,Hs,zs,Ys,Zs)}Go(t,Hs,zs){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+S}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),Hs&&Hs.headers.forEach((Ys,Zs)=>t[Zs]=Ys),zs&&zs.headers.forEach((Ys,Zs)=>t[Zs]=Ys)}Qo(t,Hs){const zs=Gt[t];let Ys=`${this.qo}/v1/${Hs}:${zs}`;return this.databaseInfo.apiKey&&(Ys=`${Ys}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),Ys}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_StreamBridge{constructor(t){this.Ho=t.Ho,this.Jo=t.Jo}Zo(t){this.Xo=t}Yo(t){this.e_=t}t_(t){this.n_=t}onMessage(t){this.r_=t}close(){this.Jo()}send(t){this.Ho(t)}i_(){this.Xo()}s_(){this.e_()}o_(t){this.n_(t)}__(t){this.r_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zt="WebChannelConnection",__PRIVATE_unguardedEventListen=(Z,t,Hs)=>{Z.listen(t,zs=>{try{Hs(zs)}catch(Ys){setTimeout(()=>{throw Ys},0)}})};class __PRIVATE_WebChannelConnection extends __PRIVATE_RestConnection{constructor(t){super(t),this.a_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}static u_(){if(!__PRIVATE_WebChannelConnection.c_){const t=getStatEventTarget();__PRIVATE_unguardedEventListen(t,Event$1.STAT_EVENT,Hs=>{Hs.stat===Stat.PROXY?__PRIVATE_logDebug(zt,"STAT_EVENT: detected buffering proxy"):Hs.stat===Stat.NOPROXY&&__PRIVATE_logDebug(zt,"STAT_EVENT: detected no buffering proxy")}),__PRIVATE_WebChannelConnection.c_=!0}}zo(t,Hs,zs,Ys,Zs){const _u=__PRIVATE_generateUniqueDebugId();return new Promise((Eu,Iu)=>{const Au=new XhrIo;Au.setWithCredentials(!0),Au.listenOnce(EventType.COMPLETE,()=>{try{switch(Au.getLastErrorCode()){case ErrorCode.NO_ERROR:const vu=Au.getResponseJson();__PRIVATE_logDebug(zt,`XHR for RPC '${t}' ${_u} received:`,JSON.stringify(vu)),Eu(vu);break;case ErrorCode.TIMEOUT:__PRIVATE_logDebug(zt,`RPC '${t}' ${_u} timed out`),Iu(new FirestoreError(C.DEADLINE_EXCEEDED,"Request time out"));break;case ErrorCode.HTTP_ERROR:const Su=Au.getStatus();if(__PRIVATE_logDebug(zt,`RPC '${t}' ${_u} failed with status:`,Su,"response text:",Au.getResponseText()),Su>0){let Ru=Au.getResponseJson();Array.isArray(Ru)&&(Ru=Ru[0]);const Pu=Ru==null?void 0:Ru.error;if(Pu&&Pu.status&&Pu.message){const Cu=function(Fu){const zu=Fu.toLowerCase().replace(/_/g,"-");return Object.values(C).indexOf(zu)>=0?zu:C.UNKNOWN}(Pu.status);Iu(new FirestoreError(Cu,Pu.message))}else Iu(new FirestoreError(C.UNKNOWN,"Server responded with status "+Au.getStatus()))}else Iu(new FirestoreError(C.UNAVAILABLE,"Connection failed."));break;default:fail(9055,{l_:t,streamId:_u,h_:Au.getLastErrorCode(),P_:Au.getLastError()})}}finally{__PRIVATE_logDebug(zt,`RPC '${t}' ${_u} completed.`)}});const $u=JSON.stringify(Ys);__PRIVATE_logDebug(zt,`RPC '${t}' ${_u} sending request:`,Ys),Au.send(Hs,"POST",$u,zs,15)})}T_(t,Hs,zs){const Ys=__PRIVATE_generateUniqueDebugId(),Zs=[this.qo,"/","google.firestore.v1.Firestore","/",t,"/channel"],_u=this.createWebChannelTransport(),Eu={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},Iu=this.longPollingOptions.timeoutSeconds;Iu!==void 0&&(Eu.longPollingTimeout=Math.round(1e3*Iu)),this.useFetchStreams&&(Eu.useFetchStreams=!0),this.Go(Eu.initMessageHeaders,Hs,zs),Eu.encodeInitMessageHeaders=!0;const Au=Zs.join("");__PRIVATE_logDebug(zt,`Creating RPC '${t}' stream ${Ys}: ${Au}`,Eu);const $u=_u.createWebChannel(Au,Eu);this.I_($u);let vu=!1,Su=!1;const Ru=new __PRIVATE_StreamBridge({Ho:Pu=>{Su?__PRIVATE_logDebug(zt,`Not sending because RPC '${t}' stream ${Ys} is closed:`,Pu):(vu||(__PRIVATE_logDebug(zt,`Opening RPC '${t}' stream ${Ys} transport.`),$u.open(),vu=!0),__PRIVATE_logDebug(zt,`RPC '${t}' stream ${Ys} sending:`,Pu),$u.send(Pu))},Jo:()=>$u.close()});return __PRIVATE_unguardedEventListen($u,WebChannel.EventType.OPEN,()=>{Su||(__PRIVATE_logDebug(zt,`RPC '${t}' stream ${Ys} transport opened.`),Ru.i_())}),__PRIVATE_unguardedEventListen($u,WebChannel.EventType.CLOSE,()=>{Su||(Su=!0,__PRIVATE_logDebug(zt,`RPC '${t}' stream ${Ys} transport closed`),Ru.o_(),this.E_($u))}),__PRIVATE_unguardedEventListen($u,WebChannel.EventType.ERROR,Pu=>{Su||(Su=!0,__PRIVATE_logWarn(zt,`RPC '${t}' stream ${Ys} transport errored. Name:`,Pu.name,"Message:",Pu.message),Ru.o_(new FirestoreError(C.UNAVAILABLE,"The operation could not be completed")))}),__PRIVATE_unguardedEventListen($u,WebChannel.EventType.MESSAGE,Pu=>{var Cu;if(!Su){const Bu=Pu.data[0];__PRIVATE_hardAssert(!!Bu,16349);const Fu=Bu,zu=(Fu==null?void 0:Fu.error)||((Cu=Fu[0])==null?void 0:Cu.error);if(zu){__PRIVATE_logDebug(zt,`RPC '${t}' stream ${Ys} received error:`,zu);const Hu=zu.status;let Wu=function(ju){const ku=At[ju];if(ku!==void 0)return __PRIVATE_mapCodeFromRpcCode(ku)}(Hu),tl=zu.message;Wu===void 0&&(Wu=C.INTERNAL,tl="Unknown error status: "+Hu+" with message "+zu.message),Su=!0,Ru.o_(new FirestoreError(Wu,tl)),$u.close()}else __PRIVATE_logDebug(zt,`RPC '${t}' stream ${Ys} received:`,Bu),Ru.__(Bu)}}),__PRIVATE_WebChannelConnection.u_(),setTimeout(()=>{Ru.s_()},0),Ru}terminate(){this.a_.forEach(t=>t.close()),this.a_=[]}I_(t){this.a_.push(t)}E_(t){this.a_=this.a_.filter(Hs=>Hs===t)}Go(t,Hs,zs){super.Go(t,Hs,zs),this.databaseInfo.apiKey&&(t["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return createWebChannelTransport()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_newConnection(Z){return new __PRIVATE_WebChannelConnection(Z)}function getDocument(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_newSerializer(Z){return new JsonProtoSerializer(Z,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */__PRIVATE_WebChannelConnection.c_=!1;class __PRIVATE_ExponentialBackoff{constructor(t,Hs,zs=1e3,Ys=1.5,Zs=6e4){this.Ci=t,this.timerId=Hs,this.R_=zs,this.A_=Ys,this.V_=Zs,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(t){this.cancel();const Hs=Math.floor(this.d_+this.y_()),zs=Math.max(0,Date.now()-this.f_),Ys=Math.max(0,Hs-zs);Ys>0&&__PRIVATE_logDebug("ExponentialBackoff",`Backing off for ${Ys} ms (base delay: ${this.d_} ms, delay with jitter: ${Hs} ms, last attempt: ${zs} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,Ys,()=>(this.f_=Date.now(),t())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jt="PersistentStream";class __PRIVATE_PersistentStream{constructor(t,Hs,zs,Ys,Zs,_u,Eu,Iu){this.Ci=t,this.b_=zs,this.S_=Ys,this.connection=Zs,this.authCredentialsProvider=_u,this.appCheckCredentialsProvider=Eu,this.listener=Iu,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new __PRIVATE_ExponentialBackoff(t,Hs)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(t){this.q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,Hs){this.q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():Hs&&Hs.code===C.RESOURCE_EXHAUSTED?(__PRIVATE_logError(Hs.toString()),__PRIVATE_logError("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):Hs&&Hs.code===C.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.t_(Hs)}W_(){}auth(){this.state=1;const t=this.Q_(this.D_),Hs=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([zs,Ys])=>{this.D_===Hs&&this.G_(zs,Ys)},zs=>{t(()=>{const Ys=new FirestoreError(C.UNKNOWN,"Fetching auth token failed: "+zs.message);return this.z_(Ys)})})}G_(t,Hs){const zs=this.Q_(this.D_);this.stream=this.j_(t,Hs),this.stream.Zo(()=>{zs(()=>this.listener.Zo())}),this.stream.Yo(()=>{zs(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(Ys=>{zs(()=>this.z_(Ys))}),this.stream.onMessage(Ys=>{zs(()=>++this.F_==1?this.H_(Ys):this.onNext(Ys))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(t){return __PRIVATE_logDebug(jt,`close with error: ${t}`),this.stream=null,this.close(4,t)}Q_(t){return Hs=>{this.Ci.enqueueAndForget(()=>this.D_===t?Hs():(__PRIVATE_logDebug(jt,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class __PRIVATE_PersistentListenStream extends __PRIVATE_PersistentStream{constructor(t,Hs,zs,Ys,Zs,_u){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",Hs,zs,Ys,_u),this.serializer=Zs}j_(t,Hs){return this.connection.T_("Listen",t,Hs)}H_(t){return this.onNext(t)}onNext(t){this.M_.reset();const Hs=__PRIVATE_fromWatchChange(this.serializer,t),zs=function(Zs){if(!("targetChange"in Zs))return SnapshotVersion.min();const _u=Zs.targetChange;return _u.targetIds&&_u.targetIds.length?SnapshotVersion.min():_u.readTime?__PRIVATE_fromVersion(_u.readTime):SnapshotVersion.min()}(t);return this.listener.J_(Hs,zs)}Z_(t){const Hs={};Hs.database=__PRIVATE_getEncodedDatabaseId(this.serializer),Hs.addTarget=function(Zs,_u){let Eu;const Iu=_u.target;if(Eu=__PRIVATE_targetIsDocumentTarget(Iu)?{documents:__PRIVATE_toDocumentsTarget(Zs,Iu)}:{query:__PRIVATE_toQueryTarget(Zs,Iu).ft},Eu.targetId=_u.targetId,_u.resumeToken.approximateByteSize()>0){Eu.resumeToken=__PRIVATE_toBytes(Zs,_u.resumeToken);const Au=__PRIVATE_toInt32Proto(Zs,_u.expectedCount);Au!==null&&(Eu.expectedCount=Au)}else if(_u.snapshotVersion.compareTo(SnapshotVersion.min())>0){Eu.readTime=toTimestamp(Zs,_u.snapshotVersion.toTimestamp());const Au=__PRIVATE_toInt32Proto(Zs,_u.expectedCount);Au!==null&&(Eu.expectedCount=Au)}return Eu}(this.serializer,t);const zs=__PRIVATE_toListenRequestLabels(this.serializer,t);zs&&(Hs.labels=zs),this.K_(Hs)}X_(t){const Hs={};Hs.database=__PRIVATE_getEncodedDatabaseId(this.serializer),Hs.removeTarget=t,this.K_(Hs)}}class __PRIVATE_PersistentWriteStream extends __PRIVATE_PersistentStream{constructor(t,Hs,zs,Ys,Zs,_u){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",Hs,zs,Ys,_u),this.serializer=Zs}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(t,Hs){return this.connection.T_("Write",t,Hs)}H_(t){return __PRIVATE_hardAssert(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,__PRIVATE_hardAssert(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){__PRIVATE_hardAssert(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const Hs=__PRIVATE_fromWriteResults(t.writeResults,t.commitTime),zs=__PRIVATE_fromVersion(t.commitTime);return this.listener.na(zs,Hs)}ra(){const t={};t.database=__PRIVATE_getEncodedDatabaseId(this.serializer),this.K_(t)}ea(t){const Hs={streamToken:this.lastStreamToken,writes:t.map(zs=>toMutation(this.serializer,zs))};this.K_(Hs)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Datastore{}class __PRIVATE_DatastoreImpl extends Datastore{constructor(t,Hs,zs,Ys){super(),this.authCredentials=t,this.appCheckCredentials=Hs,this.connection=zs,this.serializer=Ys,this.ia=!1}sa(){if(this.ia)throw new FirestoreError(C.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(t,Hs,zs,Ys){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([Zs,_u])=>this.connection.Wo(t,__PRIVATE_toResourcePath(Hs,zs),Ys,Zs,_u)).catch(Zs=>{throw Zs.name==="FirebaseError"?(Zs.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),Zs):new FirestoreError(C.UNKNOWN,Zs.toString())})}jo(t,Hs,zs,Ys,Zs){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([_u,Eu])=>this.connection.jo(t,__PRIVATE_toResourcePath(Hs,zs),Ys,_u,Eu,Zs)).catch(_u=>{throw _u.name==="FirebaseError"?(_u.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),_u):new FirestoreError(C.UNKNOWN,_u.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}function __PRIVATE_newDatastore(Z,t,Hs,zs){return new __PRIVATE_DatastoreImpl(Z,t,Hs,zs)}class __PRIVATE_OnlineStateTracker{constructor(t,Hs){this.asyncQueue=t,this.onlineStateHandler=Hs,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const Hs=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(__PRIVATE_logError(Hs),this.aa=!1):__PRIVATE_logDebug("OnlineStateTracker",Hs)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ht$1="RemoteStore";class __PRIVATE_RemoteStoreImpl{constructor(t,Hs,zs,Ys,Zs){this.localStore=t,this.datastore=Hs,this.asyncQueue=zs,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=Zs,this.Aa.Mo(_u=>{zs.enqueueAndForget(async()=>{__PRIVATE_canUseNetwork(this)&&(__PRIVATE_logDebug(Ht$1,"Restarting streams for network reachability change."),await async function(Iu){const Au=__PRIVATE_debugCast(Iu);Au.Ea.add(4),await __PRIVATE_disableNetworkInternal(Au),Au.Va.set("Unknown"),Au.Ea.delete(4),await __PRIVATE_enableNetworkInternal(Au)}(this))})}),this.Va=new __PRIVATE_OnlineStateTracker(zs,Ys)}}async function __PRIVATE_enableNetworkInternal(Z){if(__PRIVATE_canUseNetwork(Z))for(const t of Z.Ra)await t(!0)}async function __PRIVATE_disableNetworkInternal(Z){for(const t of Z.Ra)await t(!1)}function __PRIVATE_remoteStoreListen(Z,t){const Hs=__PRIVATE_debugCast(Z);Hs.Ia.has(t.targetId)||(Hs.Ia.set(t.targetId,t),__PRIVATE_shouldStartWatchStream(Hs)?__PRIVATE_startWatchStream(Hs):__PRIVATE_ensureWatchStream(Hs).O_()&&__PRIVATE_sendWatchRequest(Hs,t))}function __PRIVATE_remoteStoreUnlisten(Z,t){const Hs=__PRIVATE_debugCast(Z),zs=__PRIVATE_ensureWatchStream(Hs);Hs.Ia.delete(t),zs.O_()&&__PRIVATE_sendUnwatchRequest(Hs,t),Hs.Ia.size===0&&(zs.O_()?zs.L_():__PRIVATE_canUseNetwork(Hs)&&Hs.Va.set("Unknown"))}function __PRIVATE_sendWatchRequest(Z,t){if(Z.da.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(SnapshotVersion.min())>0){const Hs=Z.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(Hs)}__PRIVATE_ensureWatchStream(Z).Z_(t)}function __PRIVATE_sendUnwatchRequest(Z,t){Z.da.$e(t),__PRIVATE_ensureWatchStream(Z).X_(t)}function __PRIVATE_startWatchStream(Z){Z.da=new __PRIVATE_WatchChangeAggregator({getRemoteKeysForTarget:t=>Z.remoteSyncer.getRemoteKeysForTarget(t),At:t=>Z.Ia.get(t)||null,ht:()=>Z.datastore.serializer.databaseId}),__PRIVATE_ensureWatchStream(Z).start(),Z.Va.ua()}function __PRIVATE_shouldStartWatchStream(Z){return __PRIVATE_canUseNetwork(Z)&&!__PRIVATE_ensureWatchStream(Z).x_()&&Z.Ia.size>0}function __PRIVATE_canUseNetwork(Z){return __PRIVATE_debugCast(Z).Ea.size===0}function __PRIVATE_cleanUpWatchStreamState(Z){Z.da=void 0}async function __PRIVATE_onWatchStreamConnected(Z){Z.Va.set("Online")}async function __PRIVATE_onWatchStreamOpen(Z){Z.Ia.forEach((t,Hs)=>{__PRIVATE_sendWatchRequest(Z,t)})}async function __PRIVATE_onWatchStreamClose(Z,t){__PRIVATE_cleanUpWatchStreamState(Z),__PRIVATE_shouldStartWatchStream(Z)?(Z.Va.ha(t),__PRIVATE_startWatchStream(Z)):Z.Va.set("Unknown")}async function __PRIVATE_onWatchStreamChange(Z,t,Hs){if(Z.Va.set("Online"),t instanceof __PRIVATE_WatchTargetChange&&t.state===2&&t.cause)try{await async function(Ys,Zs){const _u=Zs.cause;for(const Eu of Zs.targetIds)Ys.Ia.has(Eu)&&(await Ys.remoteSyncer.rejectListen(Eu,_u),Ys.Ia.delete(Eu),Ys.da.removeTarget(Eu))}(Z,t)}catch(zs){__PRIVATE_logDebug(Ht$1,"Failed to remove targets %s: %s ",t.targetIds.join(","),zs),await __PRIVATE_disableNetworkUntilRecovery(Z,zs)}else if(t instanceof __PRIVATE_DocumentWatchChange?Z.da.Xe(t):t instanceof __PRIVATE_ExistenceFilterChange?Z.da.st(t):Z.da.tt(t),!Hs.isEqual(SnapshotVersion.min()))try{const zs=await __PRIVATE_localStoreGetLastRemoteSnapshotVersion(Z.localStore);Hs.compareTo(zs)>=0&&await function(Zs,_u){const Eu=Zs.da.Tt(_u);return Eu.targetChanges.forEach((Iu,Au)=>{if(Iu.resumeToken.approximateByteSize()>0){const $u=Zs.Ia.get(Au);$u&&Zs.Ia.set(Au,$u.withResumeToken(Iu.resumeToken,_u))}}),Eu.targetMismatches.forEach((Iu,Au)=>{const $u=Zs.Ia.get(Iu);if(!$u)return;Zs.Ia.set(Iu,$u.withResumeToken(ByteString.EMPTY_BYTE_STRING,$u.snapshotVersion)),__PRIVATE_sendUnwatchRequest(Zs,Iu);const vu=new TargetData($u.target,Iu,Au,$u.sequenceNumber);__PRIVATE_sendWatchRequest(Zs,vu)}),Zs.remoteSyncer.applyRemoteEvent(Eu)}(Z,Hs)}catch(zs){__PRIVATE_logDebug(Ht$1,"Failed to raise snapshot:",zs),await __PRIVATE_disableNetworkUntilRecovery(Z,zs)}}async function __PRIVATE_disableNetworkUntilRecovery(Z,t,Hs){if(!__PRIVATE_isIndexedDbTransactionError(t))throw t;Z.Ea.add(1),await __PRIVATE_disableNetworkInternal(Z),Z.Va.set("Offline"),Hs||(Hs=()=>__PRIVATE_localStoreGetLastRemoteSnapshotVersion(Z.localStore)),Z.asyncQueue.enqueueRetryable(async()=>{__PRIVATE_logDebug(Ht$1,"Retrying IndexedDB access"),await Hs(),Z.Ea.delete(1),await __PRIVATE_enableNetworkInternal(Z)})}function __PRIVATE_executeWithRecovery(Z,t){return t().catch(Hs=>__PRIVATE_disableNetworkUntilRecovery(Z,Hs,t))}async function __PRIVATE_fillWritePipeline(Z){const t=__PRIVATE_debugCast(Z),Hs=__PRIVATE_ensureWriteStream(t);let zs=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:U;for(;__PRIVATE_canAddToWritePipeline(t);)try{const Ys=await __PRIVATE_localStoreGetNextMutationBatch(t.localStore,zs);if(Ys===null){t.Ta.length===0&&Hs.L_();break}zs=Ys.batchId,__PRIVATE_addToWritePipeline(t,Ys)}catch(Ys){await __PRIVATE_disableNetworkUntilRecovery(t,Ys)}__PRIVATE_shouldStartWriteStream(t)&&__PRIVATE_startWriteStream(t)}function __PRIVATE_canAddToWritePipeline(Z){return __PRIVATE_canUseNetwork(Z)&&Z.Ta.length<10}function __PRIVATE_addToWritePipeline(Z,t){Z.Ta.push(t);const Hs=__PRIVATE_ensureWriteStream(Z);Hs.O_()&&Hs.Y_&&Hs.ea(t.mutations)}function __PRIVATE_shouldStartWriteStream(Z){return __PRIVATE_canUseNetwork(Z)&&!__PRIVATE_ensureWriteStream(Z).x_()&&Z.Ta.length>0}function __PRIVATE_startWriteStream(Z){__PRIVATE_ensureWriteStream(Z).start()}async function __PRIVATE_onWriteStreamOpen(Z){__PRIVATE_ensureWriteStream(Z).ra()}async function __PRIVATE_onWriteHandshakeComplete(Z){const t=__PRIVATE_ensureWriteStream(Z);for(const Hs of Z.Ta)t.ea(Hs.mutations)}async function __PRIVATE_onMutationResult(Z,t,Hs){const zs=Z.Ta.shift(),Ys=MutationBatchResult.from(zs,t,Hs);await __PRIVATE_executeWithRecovery(Z,()=>Z.remoteSyncer.applySuccessfulWrite(Ys)),await __PRIVATE_fillWritePipeline(Z)}async function __PRIVATE_onWriteStreamClose(Z,t){t&&__PRIVATE_ensureWriteStream(Z).Y_&&await async function(zs,Ys){if(function(_u){return __PRIVATE_isPermanentError(_u)&&_u!==C.ABORTED}(Ys.code)){const Zs=zs.Ta.shift();__PRIVATE_ensureWriteStream(zs).B_(),await __PRIVATE_executeWithRecovery(zs,()=>zs.remoteSyncer.rejectFailedWrite(Zs.batchId,Ys)),await __PRIVATE_fillWritePipeline(zs)}}(Z,t),__PRIVATE_shouldStartWriteStream(Z)&&__PRIVATE_startWriteStream(Z)}async function __PRIVATE_remoteStoreHandleCredentialChange(Z,t){const Hs=__PRIVATE_debugCast(Z);Hs.asyncQueue.verifyOperationInProgress(),__PRIVATE_logDebug(Ht$1,"RemoteStore received new credentials");const zs=__PRIVATE_canUseNetwork(Hs);Hs.Ea.add(3),await __PRIVATE_disableNetworkInternal(Hs),zs&&Hs.Va.set("Unknown"),await Hs.remoteSyncer.handleCredentialChange(t),Hs.Ea.delete(3),await __PRIVATE_enableNetworkInternal(Hs)}async function __PRIVATE_remoteStoreApplyPrimaryState(Z,t){const Hs=__PRIVATE_debugCast(Z);t?(Hs.Ea.delete(2),await __PRIVATE_enableNetworkInternal(Hs)):t||(Hs.Ea.add(2),await __PRIVATE_disableNetworkInternal(Hs),Hs.Va.set("Unknown"))}function __PRIVATE_ensureWatchStream(Z){return Z.ma||(Z.ma=function(Hs,zs,Ys){const Zs=__PRIVATE_debugCast(Hs);return Zs.sa(),new __PRIVATE_PersistentListenStream(zs,Zs.connection,Zs.authCredentials,Zs.appCheckCredentials,Zs.serializer,Ys)}(Z.datastore,Z.asyncQueue,{Zo:__PRIVATE_onWatchStreamConnected.bind(null,Z),Yo:__PRIVATE_onWatchStreamOpen.bind(null,Z),t_:__PRIVATE_onWatchStreamClose.bind(null,Z),J_:__PRIVATE_onWatchStreamChange.bind(null,Z)}),Z.Ra.push(async t=>{t?(Z.ma.B_(),__PRIVATE_shouldStartWatchStream(Z)?__PRIVATE_startWatchStream(Z):Z.Va.set("Unknown")):(await Z.ma.stop(),__PRIVATE_cleanUpWatchStreamState(Z))})),Z.ma}function __PRIVATE_ensureWriteStream(Z){return Z.fa||(Z.fa=function(Hs,zs,Ys){const Zs=__PRIVATE_debugCast(Hs);return Zs.sa(),new __PRIVATE_PersistentWriteStream(zs,Zs.connection,Zs.authCredentials,Zs.appCheckCredentials,Zs.serializer,Ys)}(Z.datastore,Z.asyncQueue,{Zo:()=>Promise.resolve(),Yo:__PRIVATE_onWriteStreamOpen.bind(null,Z),t_:__PRIVATE_onWriteStreamClose.bind(null,Z),ta:__PRIVATE_onWriteHandshakeComplete.bind(null,Z),na:__PRIVATE_onMutationResult.bind(null,Z)}),Z.Ra.push(async t=>{t?(Z.fa.B_(),await __PRIVATE_fillWritePipeline(Z)):(await Z.fa.stop(),Z.Ta.length>0&&(__PRIVATE_logDebug(Ht$1,`Stopping write stream with ${Z.Ta.length} pending writes`),Z.Ta=[]))})),Z.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DelayedOperation{constructor(t,Hs,zs,Ys,Zs){this.asyncQueue=t,this.timerId=Hs,this.targetTimeMs=zs,this.op=Ys,this.removalCallback=Zs,this.deferred=new __PRIVATE_Deferred,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(_u=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,Hs,zs,Ys,Zs){const _u=Date.now()+zs,Eu=new DelayedOperation(t,Hs,_u,Ys,Zs);return Eu.start(zs),Eu}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new FirestoreError(C.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function __PRIVATE_wrapInUserErrorIfRecoverable(Z,t){if(__PRIVATE_logError("AsyncQueue",`${t}: ${Z}`),__PRIVATE_isIndexedDbTransactionError(Z))return new FirestoreError(C.UNAVAILABLE,`${t}: ${Z}`);throw Z}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DocumentSet{static emptySet(t){return new DocumentSet(t.comparator)}constructor(t){this.comparator=t?(Hs,zs)=>t(Hs,zs)||DocumentKey.comparator(Hs.key,zs.key):(Hs,zs)=>DocumentKey.comparator(Hs.key,zs.key),this.keyedMap=documentMap(),this.sortedSet=new SortedMap(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const Hs=this.keyedMap.get(t);return Hs?this.sortedSet.indexOf(Hs):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((Hs,zs)=>(t(Hs),!1))}add(t){const Hs=this.delete(t.key);return Hs.copy(Hs.keyedMap.insert(t.key,t),Hs.sortedSet.insert(t,null))}delete(t){const Hs=this.get(t);return Hs?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(Hs)):this}isEqual(t){if(!(t instanceof DocumentSet)||this.size!==t.size)return!1;const Hs=this.sortedSet.getIterator(),zs=t.sortedSet.getIterator();for(;Hs.hasNext();){const Ys=Hs.getNext().key,Zs=zs.getNext().key;if(!Ys.isEqual(Zs))return!1}return!0}toString(){const t=[];return this.forEach(Hs=>{t.push(Hs.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,Hs){const zs=new DocumentSet;return zs.comparator=this.comparator,zs.keyedMap=t,zs.sortedSet=Hs,zs}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_DocumentChangeSet{constructor(){this.ga=new SortedMap(DocumentKey.comparator)}track(t){const Hs=t.doc.key,zs=this.ga.get(Hs);zs?t.type!==0&&zs.type===3?this.ga=this.ga.insert(Hs,t):t.type===3&&zs.type!==1?this.ga=this.ga.insert(Hs,{type:zs.type,doc:t.doc}):t.type===2&&zs.type===2?this.ga=this.ga.insert(Hs,{type:2,doc:t.doc}):t.type===2&&zs.type===0?this.ga=this.ga.insert(Hs,{type:0,doc:t.doc}):t.type===1&&zs.type===0?this.ga=this.ga.remove(Hs):t.type===1&&zs.type===2?this.ga=this.ga.insert(Hs,{type:1,doc:zs.doc}):t.type===0&&zs.type===1?this.ga=this.ga.insert(Hs,{type:2,doc:t.doc}):fail(63341,{Vt:t,pa:zs}):this.ga=this.ga.insert(Hs,t)}ya(){const t=[];return this.ga.inorderTraversal((Hs,zs)=>{t.push(zs)}),t}}class ViewSnapshot{constructor(t,Hs,zs,Ys,Zs,_u,Eu,Iu,Au){this.query=t,this.docs=Hs,this.oldDocs=zs,this.docChanges=Ys,this.mutatedKeys=Zs,this.fromCache=_u,this.syncStateChanged=Eu,this.excludesMetadataChanges=Iu,this.hasCachedResults=Au}static fromInitialDocuments(t,Hs,zs,Ys,Zs){const _u=[];return Hs.forEach(Eu=>{_u.push({type:0,doc:Eu})}),new ViewSnapshot(t,Hs,DocumentSet.emptySet(Hs),_u,zs,Ys,!0,!1,Zs)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&__PRIVATE_queryEquals(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const Hs=this.docChanges,zs=t.docChanges;if(Hs.length!==zs.length)return!1;for(let Ys=0;Ys<Hs.length;Ys++)if(Hs[Ys].type!==zs[Ys].type||!Hs[Ys].doc.isEqual(zs[Ys].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_QueryListenersInfo{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(t=>t.Da())}}class __PRIVATE_EventManagerImpl{constructor(){this.queries=__PRIVATE_newQueriesObjectMap(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(Hs,zs){const Ys=__PRIVATE_debugCast(Hs),Zs=Ys.queries;Ys.queries=__PRIVATE_newQueriesObjectMap(),Zs.forEach((_u,Eu)=>{for(const Iu of Eu.ba)Iu.onError(zs)})})(this,new FirestoreError(C.ABORTED,"Firestore shutting down"))}}function __PRIVATE_newQueriesObjectMap(){return new ObjectMap(Z=>__PRIVATE_canonifyQuery(Z),__PRIVATE_queryEquals)}async function __PRIVATE_eventManagerListen(Z,t){const Hs=__PRIVATE_debugCast(Z);let zs=3;const Ys=t.query;let Zs=Hs.queries.get(Ys);Zs?!Zs.Sa()&&t.Da()&&(zs=2):(Zs=new __PRIVATE_QueryListenersInfo,zs=t.Da()?0:1);try{switch(zs){case 0:Zs.wa=await Hs.onListen(Ys,!0);break;case 1:Zs.wa=await Hs.onListen(Ys,!1);break;case 2:await Hs.onFirstRemoteStoreListen(Ys)}}catch(_u){const Eu=__PRIVATE_wrapInUserErrorIfRecoverable(_u,`Initialization of query '${__PRIVATE_stringifyQuery(t.query)}' failed`);return void t.onError(Eu)}Hs.queries.set(Ys,Zs),Zs.ba.push(t),t.va(Hs.onlineState),Zs.wa&&t.Fa(Zs.wa)&&__PRIVATE_raiseSnapshotsInSyncEvent(Hs)}async function __PRIVATE_eventManagerUnlisten(Z,t){const Hs=__PRIVATE_debugCast(Z),zs=t.query;let Ys=3;const Zs=Hs.queries.get(zs);if(Zs){const _u=Zs.ba.indexOf(t);_u>=0&&(Zs.ba.splice(_u,1),Zs.ba.length===0?Ys=t.Da()?0:1:!Zs.Sa()&&t.Da()&&(Ys=2))}switch(Ys){case 0:return Hs.queries.delete(zs),Hs.onUnlisten(zs,!0);case 1:return Hs.queries.delete(zs),Hs.onUnlisten(zs,!1);case 2:return Hs.onLastRemoteStoreUnlisten(zs);default:return}}function __PRIVATE_eventManagerOnWatchChange(Z,t){const Hs=__PRIVATE_debugCast(Z);let zs=!1;for(const Ys of t){const Zs=Ys.query,_u=Hs.queries.get(Zs);if(_u){for(const Eu of _u.ba)Eu.Fa(Ys)&&(zs=!0);_u.wa=Ys}}zs&&__PRIVATE_raiseSnapshotsInSyncEvent(Hs)}function __PRIVATE_eventManagerOnWatchError(Z,t,Hs){const zs=__PRIVATE_debugCast(Z),Ys=zs.queries.get(t);if(Ys)for(const Zs of Ys.ba)Zs.onError(Hs);zs.queries.delete(t)}function __PRIVATE_raiseSnapshotsInSyncEvent(Z){Z.Ca.forEach(t=>{t.next()})}var Jt,Zt;(Zt=Jt||(Jt={})).Ma="default",Zt.Cache="cache";class __PRIVATE_QueryListener{constructor(t,Hs,zs){this.query=t,this.xa=Hs,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=zs||{}}Fa(t){if(!this.options.includeMetadataChanges){const zs=[];for(const Ys of t.docChanges)Ys.type!==3&&zs.push(Ys);t=new ViewSnapshot(t.query,t.docs,t.oldDocs,zs,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let Hs=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),Hs=!0):this.La(t,this.onlineState)&&(this.ka(t),Hs=!0),this.Na=t,Hs}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let Hs=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),Hs=!0),Hs}La(t,Hs){if(!t.fromCache||!this.Da())return!0;const zs=Hs!=="Offline";return(!this.options.Ka||!zs)&&(!t.docs.isEmpty()||t.hasCachedResults||Hs==="Offline")}Ba(t){if(t.docChanges.length>0)return!0;const Hs=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!Hs)&&this.options.includeMetadataChanges===!0}ka(t){t=ViewSnapshot.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==Jt.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_AddedLimboDocument{constructor(t){this.key=t}}class __PRIVATE_RemovedLimboDocument{constructor(t){this.key=t}}class __PRIVATE_View{constructor(t,Hs){this.query=t,this.Za=Hs,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=__PRIVATE_documentKeySet(),this.mutatedKeys=__PRIVATE_documentKeySet(),this.eu=__PRIVATE_newQueryComparator(t),this.tu=new DocumentSet(this.eu)}get nu(){return this.Za}ru(t,Hs){const zs=Hs?Hs.iu:new __PRIVATE_DocumentChangeSet,Ys=Hs?Hs.tu:this.tu;let Zs=Hs?Hs.mutatedKeys:this.mutatedKeys,_u=Ys,Eu=!1;const Iu=this.query.limitType==="F"&&Ys.size===this.query.limit?Ys.last():null,Au=this.query.limitType==="L"&&Ys.size===this.query.limit?Ys.first():null;if(t.inorderTraversal(($u,vu)=>{const Su=Ys.get($u),Ru=__PRIVATE_queryMatches(this.query,vu)?vu:null,Pu=!!Su&&this.mutatedKeys.has(Su.key),Cu=!!Ru&&(Ru.hasLocalMutations||this.mutatedKeys.has(Ru.key)&&Ru.hasCommittedMutations);let Bu=!1;Su&&Ru?Su.data.isEqual(Ru.data)?Pu!==Cu&&(zs.track({type:3,doc:Ru}),Bu=!0):this.su(Su,Ru)||(zs.track({type:2,doc:Ru}),Bu=!0,(Iu&&this.eu(Ru,Iu)>0||Au&&this.eu(Ru,Au)<0)&&(Eu=!0)):!Su&&Ru?(zs.track({type:0,doc:Ru}),Bu=!0):Su&&!Ru&&(zs.track({type:1,doc:Su}),Bu=!0,(Iu||Au)&&(Eu=!0)),Bu&&(Ru?(_u=_u.add(Ru),Zs=Cu?Zs.add($u):Zs.delete($u)):(_u=_u.delete($u),Zs=Zs.delete($u)))}),this.query.limit!==null)for(;_u.size>this.query.limit;){const $u=this.query.limitType==="F"?_u.last():_u.first();_u=_u.delete($u.key),Zs=Zs.delete($u.key),zs.track({type:1,doc:$u})}return{tu:_u,iu:zs,Ss:Eu,mutatedKeys:Zs}}su(t,Hs){return t.hasLocalMutations&&Hs.hasCommittedMutations&&!Hs.hasLocalMutations}applyChanges(t,Hs,zs,Ys){const Zs=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const _u=t.iu.ya();_u.sort(($u,vu)=>function(Ru,Pu){const Cu=Bu=>{switch(Bu){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return fail(20277,{Vt:Bu})}};return Cu(Ru)-Cu(Pu)}($u.type,vu.type)||this.eu($u.doc,vu.doc)),this.ou(zs),Ys=Ys??!1;const Eu=Hs&&!Ys?this._u():[],Iu=this.Ya.size===0&&this.current&&!Ys?1:0,Au=Iu!==this.Xa;return this.Xa=Iu,_u.length!==0||Au?{snapshot:new ViewSnapshot(this.query,t.tu,Zs,_u,t.mutatedKeys,Iu===0,Au,!1,!!zs&&zs.resumeToken.approximateByteSize()>0),au:Eu}:{au:Eu}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new __PRIVATE_DocumentChangeSet,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(t){return!this.Za.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach(Hs=>this.Za=this.Za.add(Hs)),t.modifiedDocuments.forEach(Hs=>{}),t.removedDocuments.forEach(Hs=>this.Za=this.Za.delete(Hs)),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Ya;this.Ya=__PRIVATE_documentKeySet(),this.tu.forEach(zs=>{this.uu(zs.key)&&(this.Ya=this.Ya.add(zs.key))});const Hs=[];return t.forEach(zs=>{this.Ya.has(zs)||Hs.push(new __PRIVATE_RemovedLimboDocument(zs))}),this.Ya.forEach(zs=>{t.has(zs)||Hs.push(new __PRIVATE_AddedLimboDocument(zs))}),Hs}cu(t){this.Za=t.ks,this.Ya=__PRIVATE_documentKeySet();const Hs=this.ru(t.documents);return this.applyChanges(Hs,!0)}lu(){return ViewSnapshot.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const Xt="SyncEngine";class __PRIVATE_QueryView{constructor(t,Hs,zs){this.query=t,this.targetId=Hs,this.view=zs}}class LimboResolution{constructor(t){this.key=t,this.hu=!1}}class __PRIVATE_SyncEngineImpl{constructor(t,Hs,zs,Ys,Zs,_u){this.localStore=t,this.remoteStore=Hs,this.eventManager=zs,this.sharedClientState=Ys,this.currentUser=Zs,this.maxConcurrentLimboResolutions=_u,this.Pu={},this.Tu=new ObjectMap(Eu=>__PRIVATE_canonifyQuery(Eu),__PRIVATE_queryEquals),this.Iu=new Map,this.Eu=new Set,this.Ru=new SortedMap(DocumentKey.comparator),this.Au=new Map,this.Vu=new __PRIVATE_ReferenceSet,this.du={},this.mu=new Map,this.fu=__PRIVATE_TargetIdGenerator.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function __PRIVATE_syncEngineListen(Z,t,Hs=!0){const zs=__PRIVATE_ensureWatchCallbacks(Z);let Ys;const Zs=zs.Tu.get(t);return Zs?(zs.sharedClientState.addLocalQueryTarget(Zs.targetId),Ys=Zs.view.lu()):Ys=await __PRIVATE_allocateTargetAndMaybeListen(zs,t,Hs,!0),Ys}async function __PRIVATE_triggerRemoteStoreListen(Z,t){const Hs=__PRIVATE_ensureWatchCallbacks(Z);await __PRIVATE_allocateTargetAndMaybeListen(Hs,t,!0,!1)}async function __PRIVATE_allocateTargetAndMaybeListen(Z,t,Hs,zs){const Ys=await __PRIVATE_localStoreAllocateTarget(Z.localStore,__PRIVATE_queryToTarget(t)),Zs=Ys.targetId,_u=Z.sharedClientState.addLocalQueryTarget(Zs,Hs);let Eu;return zs&&(Eu=await __PRIVATE_initializeViewAndComputeSnapshot(Z,t,Zs,_u==="current",Ys.resumeToken)),Z.isPrimaryClient&&Hs&&__PRIVATE_remoteStoreListen(Z.remoteStore,Ys),Eu}async function __PRIVATE_initializeViewAndComputeSnapshot(Z,t,Hs,zs,Ys){Z.pu=(vu,Su,Ru)=>async function(Cu,Bu,Fu,zu){let Hu=Bu.view.ru(Fu);Hu.Ss&&(Hu=await __PRIVATE_localStoreExecuteQuery(Cu.localStore,Bu.query,!1).then(({documents:ju})=>Bu.view.ru(ju,Hu)));const Wu=zu&&zu.targetChanges.get(Bu.targetId),tl=zu&&zu.targetMismatches.get(Bu.targetId)!=null,Xu=Bu.view.applyChanges(Hu,Cu.isPrimaryClient,Wu,tl);return __PRIVATE_updateTrackedLimbos(Cu,Bu.targetId,Xu.au),Xu.snapshot}(Z,vu,Su,Ru);const Zs=await __PRIVATE_localStoreExecuteQuery(Z.localStore,t,!0),_u=new __PRIVATE_View(t,Zs.ks),Eu=_u.ru(Zs.documents),Iu=TargetChange.createSynthesizedTargetChangeForCurrentChange(Hs,zs&&Z.onlineState!=="Offline",Ys),Au=_u.applyChanges(Eu,Z.isPrimaryClient,Iu);__PRIVATE_updateTrackedLimbos(Z,Hs,Au.au);const $u=new __PRIVATE_QueryView(t,Hs,_u);return Z.Tu.set(t,$u),Z.Iu.has(Hs)?Z.Iu.get(Hs).push(t):Z.Iu.set(Hs,[t]),Au.snapshot}async function __PRIVATE_syncEngineUnlisten(Z,t,Hs){const zs=__PRIVATE_debugCast(Z),Ys=zs.Tu.get(t),Zs=zs.Iu.get(Ys.targetId);if(Zs.length>1)return zs.Iu.set(Ys.targetId,Zs.filter(_u=>!__PRIVATE_queryEquals(_u,t))),void zs.Tu.delete(t);zs.isPrimaryClient?(zs.sharedClientState.removeLocalQueryTarget(Ys.targetId),zs.sharedClientState.isActiveQueryTarget(Ys.targetId)||await __PRIVATE_localStoreReleaseTarget(zs.localStore,Ys.targetId,!1).then(()=>{zs.sharedClientState.clearQueryState(Ys.targetId),Hs&&__PRIVATE_remoteStoreUnlisten(zs.remoteStore,Ys.targetId),__PRIVATE_removeAndCleanupTarget(zs,Ys.targetId)}).catch(__PRIVATE_ignoreIfPrimaryLeaseLoss)):(__PRIVATE_removeAndCleanupTarget(zs,Ys.targetId),await __PRIVATE_localStoreReleaseTarget(zs.localStore,Ys.targetId,!0))}async function __PRIVATE_triggerRemoteStoreUnlisten(Z,t){const Hs=__PRIVATE_debugCast(Z),zs=Hs.Tu.get(t),Ys=Hs.Iu.get(zs.targetId);Hs.isPrimaryClient&&Ys.length===1&&(Hs.sharedClientState.removeLocalQueryTarget(zs.targetId),__PRIVATE_remoteStoreUnlisten(Hs.remoteStore,zs.targetId))}async function __PRIVATE_syncEngineWrite(Z,t,Hs){const zs=__PRIVATE_syncEngineEnsureWriteCallbacks(Z);try{const Ys=await function(_u,Eu){const Iu=__PRIVATE_debugCast(_u),Au=Timestamp.now(),$u=Eu.reduce((Ru,Pu)=>Ru.add(Pu.key),__PRIVATE_documentKeySet());let vu,Su;return Iu.persistence.runTransaction("Locally write mutations","readwrite",Ru=>{let Pu=__PRIVATE_mutableDocumentMap(),Cu=__PRIVATE_documentKeySet();return Iu.xs.getEntries(Ru,$u).next(Bu=>{Pu=Bu,Pu.forEach((Fu,zu)=>{zu.isValidDocument()||(Cu=Cu.add(Fu))})}).next(()=>Iu.localDocuments.getOverlayedDocuments(Ru,Pu)).next(Bu=>{vu=Bu;const Fu=[];for(const zu of Eu){const Hu=__PRIVATE_mutationExtractBaseValue(zu,vu.get(zu.key).overlayedDocument);Hu!=null&&Fu.push(new __PRIVATE_PatchMutation(zu.key,Hu,__PRIVATE_extractFieldMask(Hu.value.mapValue),Precondition.exists(!0)))}return Iu.mutationQueue.addMutationBatch(Ru,Au,Fu,Eu)}).next(Bu=>{Su=Bu;const Fu=Bu.applyToLocalDocumentSet(vu,Cu);return Iu.documentOverlayCache.saveOverlays(Ru,Bu.batchId,Fu)})}).then(()=>({batchId:Su.batchId,changes:__PRIVATE_convertOverlayedDocumentMapToDocumentMap(vu)}))}(zs.localStore,t);zs.sharedClientState.addPendingMutation(Ys.batchId),function(_u,Eu,Iu){let Au=_u.du[_u.currentUser.toKey()];Au||(Au=new SortedMap(__PRIVATE_primitiveComparator)),Au=Au.insert(Eu,Iu),_u.du[_u.currentUser.toKey()]=Au}(zs,Ys.batchId,Hs),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(zs,Ys.changes),await __PRIVATE_fillWritePipeline(zs.remoteStore)}catch(Ys){const Zs=__PRIVATE_wrapInUserErrorIfRecoverable(Ys,"Failed to persist write");Hs.reject(Zs)}}async function __PRIVATE_syncEngineApplyRemoteEvent(Z,t){const Hs=__PRIVATE_debugCast(Z);try{const zs=await __PRIVATE_localStoreApplyRemoteEventToLocalCache(Hs.localStore,t);t.targetChanges.forEach((Ys,Zs)=>{const _u=Hs.Au.get(Zs);_u&&(__PRIVATE_hardAssert(Ys.addedDocuments.size+Ys.modifiedDocuments.size+Ys.removedDocuments.size<=1,22616),Ys.addedDocuments.size>0?_u.hu=!0:Ys.modifiedDocuments.size>0?__PRIVATE_hardAssert(_u.hu,14607):Ys.removedDocuments.size>0&&(__PRIVATE_hardAssert(_u.hu,42227),_u.hu=!1))}),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(Hs,zs,t)}catch(zs){await __PRIVATE_ignoreIfPrimaryLeaseLoss(zs)}}function __PRIVATE_syncEngineApplyOnlineStateChange(Z,t,Hs){const zs=__PRIVATE_debugCast(Z);if(zs.isPrimaryClient&&Hs===0||!zs.isPrimaryClient&&Hs===1){const Ys=[];zs.Tu.forEach((Zs,_u)=>{const Eu=_u.view.va(t);Eu.snapshot&&Ys.push(Eu.snapshot)}),function(_u,Eu){const Iu=__PRIVATE_debugCast(_u);Iu.onlineState=Eu;let Au=!1;Iu.queries.forEach(($u,vu)=>{for(const Su of vu.ba)Su.va(Eu)&&(Au=!0)}),Au&&__PRIVATE_raiseSnapshotsInSyncEvent(Iu)}(zs.eventManager,t),Ys.length&&zs.Pu.J_(Ys),zs.onlineState=t,zs.isPrimaryClient&&zs.sharedClientState.setOnlineState(t)}}async function __PRIVATE_syncEngineRejectListen(Z,t,Hs){const zs=__PRIVATE_debugCast(Z);zs.sharedClientState.updateQueryState(t,"rejected",Hs);const Ys=zs.Au.get(t),Zs=Ys&&Ys.key;if(Zs){let _u=new SortedMap(DocumentKey.comparator);_u=_u.insert(Zs,MutableDocument.newNoDocument(Zs,SnapshotVersion.min()));const Eu=__PRIVATE_documentKeySet().add(Zs),Iu=new RemoteEvent(SnapshotVersion.min(),new Map,new SortedMap(__PRIVATE_primitiveComparator),_u,Eu);await __PRIVATE_syncEngineApplyRemoteEvent(zs,Iu),zs.Ru=zs.Ru.remove(Zs),zs.Au.delete(t),__PRIVATE_pumpEnqueuedLimboResolutions(zs)}else await __PRIVATE_localStoreReleaseTarget(zs.localStore,t,!1).then(()=>__PRIVATE_removeAndCleanupTarget(zs,t,Hs)).catch(__PRIVATE_ignoreIfPrimaryLeaseLoss)}async function __PRIVATE_syncEngineApplySuccessfulWrite(Z,t){const Hs=__PRIVATE_debugCast(Z),zs=t.batch.batchId;try{const Ys=await __PRIVATE_localStoreAcknowledgeBatch(Hs.localStore,t);__PRIVATE_processUserCallback(Hs,zs,null),__PRIVATE_triggerPendingWritesCallbacks(Hs,zs),Hs.sharedClientState.updateMutationState(zs,"acknowledged"),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(Hs,Ys)}catch(Ys){await __PRIVATE_ignoreIfPrimaryLeaseLoss(Ys)}}async function __PRIVATE_syncEngineRejectFailedWrite(Z,t,Hs){const zs=__PRIVATE_debugCast(Z);try{const Ys=await function(_u,Eu){const Iu=__PRIVATE_debugCast(_u);return Iu.persistence.runTransaction("Reject batch","readwrite-primary",Au=>{let $u;return Iu.mutationQueue.lookupMutationBatch(Au,Eu).next(vu=>(__PRIVATE_hardAssert(vu!==null,37113),$u=vu.keys(),Iu.mutationQueue.removeMutationBatch(Au,vu))).next(()=>Iu.mutationQueue.performConsistencyCheck(Au)).next(()=>Iu.documentOverlayCache.removeOverlaysForBatchId(Au,$u,Eu)).next(()=>Iu.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(Au,$u)).next(()=>Iu.localDocuments.getDocuments(Au,$u))})}(zs.localStore,t);__PRIVATE_processUserCallback(zs,t,Hs),__PRIVATE_triggerPendingWritesCallbacks(zs,t),zs.sharedClientState.updateMutationState(t,"rejected",Hs),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(zs,Ys)}catch(Ys){await __PRIVATE_ignoreIfPrimaryLeaseLoss(Ys)}}function __PRIVATE_triggerPendingWritesCallbacks(Z,t){(Z.mu.get(t)||[]).forEach(Hs=>{Hs.resolve()}),Z.mu.delete(t)}function __PRIVATE_processUserCallback(Z,t,Hs){const zs=__PRIVATE_debugCast(Z);let Ys=zs.du[zs.currentUser.toKey()];if(Ys){const Zs=Ys.get(t);Zs&&(Hs?Zs.reject(Hs):Zs.resolve(),Ys=Ys.remove(t)),zs.du[zs.currentUser.toKey()]=Ys}}function __PRIVATE_removeAndCleanupTarget(Z,t,Hs=null){Z.sharedClientState.removeLocalQueryTarget(t);for(const zs of Z.Iu.get(t))Z.Tu.delete(zs),Hs&&Z.Pu.yu(zs,Hs);Z.Iu.delete(t),Z.isPrimaryClient&&Z.Vu.Gr(t).forEach(zs=>{Z.Vu.containsKey(zs)||__PRIVATE_removeLimboTarget(Z,zs)})}function __PRIVATE_removeLimboTarget(Z,t){Z.Eu.delete(t.path.canonicalString());const Hs=Z.Ru.get(t);Hs!==null&&(__PRIVATE_remoteStoreUnlisten(Z.remoteStore,Hs),Z.Ru=Z.Ru.remove(t),Z.Au.delete(Hs),__PRIVATE_pumpEnqueuedLimboResolutions(Z))}function __PRIVATE_updateTrackedLimbos(Z,t,Hs){for(const zs of Hs)zs instanceof __PRIVATE_AddedLimboDocument?(Z.Vu.addReference(zs.key,t),__PRIVATE_trackLimboChange(Z,zs)):zs instanceof __PRIVATE_RemovedLimboDocument?(__PRIVATE_logDebug(Xt,"Document no longer in limbo: "+zs.key),Z.Vu.removeReference(zs.key,t),Z.Vu.containsKey(zs.key)||__PRIVATE_removeLimboTarget(Z,zs.key)):fail(19791,{wu:zs})}function __PRIVATE_trackLimboChange(Z,t){const Hs=t.key,zs=Hs.path.canonicalString();Z.Ru.get(Hs)||Z.Eu.has(zs)||(__PRIVATE_logDebug(Xt,"New document in limbo: "+Hs),Z.Eu.add(zs),__PRIVATE_pumpEnqueuedLimboResolutions(Z))}function __PRIVATE_pumpEnqueuedLimboResolutions(Z){for(;Z.Eu.size>0&&Z.Ru.size<Z.maxConcurrentLimboResolutions;){const t=Z.Eu.values().next().value;Z.Eu.delete(t);const Hs=new DocumentKey(ResourcePath.fromString(t)),zs=Z.fu.next();Z.Au.set(zs,new LimboResolution(Hs)),Z.Ru=Z.Ru.insert(Hs,zs),__PRIVATE_remoteStoreListen(Z.remoteStore,new TargetData(__PRIVATE_queryToTarget(__PRIVATE_newQueryForPath(Hs.path)),zs,"TargetPurposeLimboResolution",__PRIVATE_ListenSequence.ce))}}async function __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(Z,t,Hs){const zs=__PRIVATE_debugCast(Z),Ys=[],Zs=[],_u=[];zs.Tu.isEmpty()||(zs.Tu.forEach((Eu,Iu)=>{_u.push(zs.pu(Iu,t,Hs).then(Au=>{var $u;if((Au||Hs)&&zs.isPrimaryClient){const vu=Au?!Au.fromCache:($u=Hs==null?void 0:Hs.targetChanges.get(Iu.targetId))==null?void 0:$u.current;zs.sharedClientState.updateQueryState(Iu.targetId,vu?"current":"not-current")}if(Au){Ys.push(Au);const vu=__PRIVATE_LocalViewChanges.Es(Iu.targetId,Au);Zs.push(vu)}}))}),await Promise.all(_u),zs.Pu.J_(Ys),await async function(Iu,Au){const $u=__PRIVATE_debugCast(Iu);try{await $u.persistence.runTransaction("notifyLocalViewChanges","readwrite",vu=>PersistencePromise.forEach(Au,Su=>PersistencePromise.forEach(Su.Ts,Ru=>$u.persistence.referenceDelegate.addReference(vu,Su.targetId,Ru)).next(()=>PersistencePromise.forEach(Su.Is,Ru=>$u.persistence.referenceDelegate.removeReference(vu,Su.targetId,Ru)))))}catch(vu){if(!__PRIVATE_isIndexedDbTransactionError(vu))throw vu;__PRIVATE_logDebug(Bt,"Failed to update sequence numbers: "+vu)}for(const vu of Au){const Su=vu.targetId;if(!vu.fromCache){const Ru=$u.vs.get(Su),Pu=Ru.snapshotVersion,Cu=Ru.withLastLimboFreeSnapshotVersion(Pu);$u.vs=$u.vs.insert(Su,Cu)}}}(zs.localStore,Zs))}async function __PRIVATE_syncEngineHandleCredentialChange(Z,t){const Hs=__PRIVATE_debugCast(Z);if(!Hs.currentUser.isEqual(t)){__PRIVATE_logDebug(Xt,"User change. New user:",t.toKey());const zs=await __PRIVATE_localStoreHandleUserChange(Hs.localStore,t);Hs.currentUser=t,function(Zs,_u){Zs.mu.forEach(Eu=>{Eu.forEach(Iu=>{Iu.reject(new FirestoreError(C.CANCELLED,_u))})}),Zs.mu.clear()}(Hs,"'waitForPendingWrites' promise is rejected due to a user change."),Hs.sharedClientState.handleUserChange(t,zs.removedBatchIds,zs.addedBatchIds),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(Hs,zs.Ns)}}function __PRIVATE_syncEngineGetRemoteKeysForTarget(Z,t){const Hs=__PRIVATE_debugCast(Z),zs=Hs.Au.get(t);if(zs&&zs.hu)return __PRIVATE_documentKeySet().add(zs.key);{let Ys=__PRIVATE_documentKeySet();const Zs=Hs.Iu.get(t);if(!Zs)return Ys;for(const _u of Zs){const Eu=Hs.Tu.get(_u);Ys=Ys.unionWith(Eu.view.nu)}return Ys}}function __PRIVATE_ensureWatchCallbacks(Z){const t=__PRIVATE_debugCast(Z);return t.remoteStore.remoteSyncer.applyRemoteEvent=__PRIVATE_syncEngineApplyRemoteEvent.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=__PRIVATE_syncEngineGetRemoteKeysForTarget.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=__PRIVATE_syncEngineRejectListen.bind(null,t),t.Pu.J_=__PRIVATE_eventManagerOnWatchChange.bind(null,t.eventManager),t.Pu.yu=__PRIVATE_eventManagerOnWatchError.bind(null,t.eventManager),t}function __PRIVATE_syncEngineEnsureWriteCallbacks(Z){const t=__PRIVATE_debugCast(Z);return t.remoteStore.remoteSyncer.applySuccessfulWrite=__PRIVATE_syncEngineApplySuccessfulWrite.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=__PRIVATE_syncEngineRejectFailedWrite.bind(null,t),t}class __PRIVATE_MemoryOfflineComponentProvider{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=__PRIVATE_newSerializer(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,Hs){return null}Mu(t,Hs){return null}vu(t){return __PRIVATE_newLocalStore(this.persistence,new __PRIVATE_QueryEngine,t.initialUser,this.serializer)}Cu(t){return new __PRIVATE_MemoryPersistence(__PRIVATE_MemoryEagerDelegate.Vi,this.serializer)}Du(t){return new __PRIVATE_MemorySharedClientState}async terminate(){var t,Hs;(t=this.gcScheduler)==null||t.stop(),(Hs=this.indexBackfillerScheduler)==null||Hs.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}__PRIVATE_MemoryOfflineComponentProvider.provider={build:()=>new __PRIVATE_MemoryOfflineComponentProvider};class __PRIVATE_LruGcMemoryOfflineComponentProvider extends __PRIVATE_MemoryOfflineComponentProvider{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,Hs){__PRIVATE_hardAssert(this.persistence.referenceDelegate instanceof __PRIVATE_MemoryLruDelegate,46915);const zs=this.persistence.referenceDelegate.garbageCollector;return new __PRIVATE_LruScheduler(zs,t.asyncQueue,Hs)}Cu(t){const Hs=this.cacheSizeBytes!==void 0?LruParams.withCacheSize(this.cacheSizeBytes):LruParams.DEFAULT;return new __PRIVATE_MemoryPersistence(zs=>__PRIVATE_MemoryLruDelegate.Vi(zs,Hs),this.serializer)}}class OnlineComponentProvider{async initialize(t,Hs){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(Hs),this.remoteStore=this.createRemoteStore(Hs),this.eventManager=this.createEventManager(Hs),this.syncEngine=this.createSyncEngine(Hs,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=zs=>__PRIVATE_syncEngineApplyOnlineStateChange(this.syncEngine,zs,1),this.remoteStore.remoteSyncer.handleCredentialChange=__PRIVATE_syncEngineHandleCredentialChange.bind(null,this.syncEngine),await __PRIVATE_remoteStoreApplyPrimaryState(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return function(){return new __PRIVATE_EventManagerImpl}()}createDatastore(t){const Hs=__PRIVATE_newSerializer(t.databaseInfo.databaseId),zs=__PRIVATE_newConnection(t.databaseInfo);return __PRIVATE_newDatastore(t.authCredentials,t.appCheckCredentials,zs,Hs)}createRemoteStore(t){return function(zs,Ys,Zs,_u,Eu){return new __PRIVATE_RemoteStoreImpl(zs,Ys,Zs,_u,Eu)}(this.localStore,this.datastore,t.asyncQueue,Hs=>__PRIVATE_syncEngineApplyOnlineStateChange(this.syncEngine,Hs,0),function(){return __PRIVATE_BrowserConnectivityMonitor.v()?new __PRIVATE_BrowserConnectivityMonitor:new __PRIVATE_NoopConnectivityMonitor}())}createSyncEngine(t,Hs){return function(Ys,Zs,_u,Eu,Iu,Au,$u){const vu=new __PRIVATE_SyncEngineImpl(Ys,Zs,_u,Eu,Iu,Au);return $u&&(vu.gu=!0),vu}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,Hs)}async terminate(){var t,Hs;await async function(Ys){const Zs=__PRIVATE_debugCast(Ys);__PRIVATE_logDebug(Ht$1,"RemoteStore shutting down."),Zs.Ea.add(5),await __PRIVATE_disableNetworkInternal(Zs),Zs.Aa.shutdown(),Zs.Va.set("Unknown")}(this.remoteStore),(t=this.datastore)==null||t.terminate(),(Hs=this.eventManager)==null||Hs.terminate()}}OnlineComponentProvider.provider={build:()=>new OnlineComponentProvider};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_AsyncObserver{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):__PRIVATE_logError("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,Hs){setTimeout(()=>{this.muted||t(Hs)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yt="FirestoreClient";class FirestoreClient{constructor(t,Hs,zs,Ys,Zs){this.authCredentials=t,this.appCheckCredentials=Hs,this.asyncQueue=zs,this._databaseInfo=Ys,this.user=User.UNAUTHENTICATED,this.clientId=__PRIVATE_AutoId.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=Zs,this.authCredentials.start(zs,async _u=>{__PRIVATE_logDebug(Yt,"Received user=",_u.uid),await this.authCredentialListener(_u),this.user=_u}),this.appCheckCredentials.start(zs,_u=>(__PRIVATE_logDebug(Yt,"Received new app check token=",_u),this.appCheckCredentialListener(_u,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new __PRIVATE_Deferred;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(Hs){const zs=__PRIVATE_wrapInUserErrorIfRecoverable(Hs,"Failed to shutdown persistence");t.reject(zs)}}),t.promise}}async function __PRIVATE_setOfflineComponentProvider(Z,t){Z.asyncQueue.verifyOperationInProgress(),__PRIVATE_logDebug(Yt,"Initializing OfflineComponentProvider");const Hs=Z.configuration;await t.initialize(Hs);let zs=Hs.initialUser;Z.setCredentialChangeListener(async Ys=>{zs.isEqual(Ys)||(await __PRIVATE_localStoreHandleUserChange(t.localStore,Ys),zs=Ys)}),t.persistence.setDatabaseDeletedListener(()=>Z.terminate()),Z._offlineComponents=t}async function __PRIVATE_setOnlineComponentProvider(Z,t){Z.asyncQueue.verifyOperationInProgress();const Hs=await __PRIVATE_ensureOfflineComponents(Z);__PRIVATE_logDebug(Yt,"Initializing OnlineComponentProvider"),await t.initialize(Hs,Z.configuration),Z.setCredentialChangeListener(zs=>__PRIVATE_remoteStoreHandleCredentialChange(t.remoteStore,zs)),Z.setAppCheckTokenChangeListener((zs,Ys)=>__PRIVATE_remoteStoreHandleCredentialChange(t.remoteStore,Ys)),Z._onlineComponents=t}async function __PRIVATE_ensureOfflineComponents(Z){if(!Z._offlineComponents)if(Z._uninitializedComponentsProvider){__PRIVATE_logDebug(Yt,"Using user provided OfflineComponentProvider");try{await __PRIVATE_setOfflineComponentProvider(Z,Z._uninitializedComponentsProvider._offline)}catch(t){const Hs=t;if(!function(Ys){return Ys.name==="FirebaseError"?Ys.code===C.FAILED_PRECONDITION||Ys.code===C.UNIMPLEMENTED:!(typeof DOMException<"u"&&Ys instanceof DOMException)||Ys.code===22||Ys.code===20||Ys.code===11}(Hs))throw Hs;__PRIVATE_logWarn("Error using user provided cache. Falling back to memory cache: "+Hs),await __PRIVATE_setOfflineComponentProvider(Z,new __PRIVATE_MemoryOfflineComponentProvider)}}else __PRIVATE_logDebug(Yt,"Using default OfflineComponentProvider"),await __PRIVATE_setOfflineComponentProvider(Z,new __PRIVATE_LruGcMemoryOfflineComponentProvider(void 0));return Z._offlineComponents}async function __PRIVATE_ensureOnlineComponents(Z){return Z._onlineComponents||(Z._uninitializedComponentsProvider?(__PRIVATE_logDebug(Yt,"Using user provided OnlineComponentProvider"),await __PRIVATE_setOnlineComponentProvider(Z,Z._uninitializedComponentsProvider._online)):(__PRIVATE_logDebug(Yt,"Using default OnlineComponentProvider"),await __PRIVATE_setOnlineComponentProvider(Z,new OnlineComponentProvider))),Z._onlineComponents}function __PRIVATE_getSyncEngine(Z){return __PRIVATE_ensureOnlineComponents(Z).then(t=>t.syncEngine)}async function __PRIVATE_getEventManager(Z){const t=await __PRIVATE_ensureOnlineComponents(Z),Hs=t.eventManager;return Hs.onListen=__PRIVATE_syncEngineListen.bind(null,t.syncEngine),Hs.onUnlisten=__PRIVATE_syncEngineUnlisten.bind(null,t.syncEngine),Hs.onFirstRemoteStoreListen=__PRIVATE_triggerRemoteStoreListen.bind(null,t.syncEngine),Hs.onLastRemoteStoreUnlisten=__PRIVATE_triggerRemoteStoreUnlisten.bind(null,t.syncEngine),Hs}function __PRIVATE_firestoreClientGetDocumentViaSnapshotListener(Z,t,Hs={}){const zs=new __PRIVATE_Deferred;return Z.asyncQueue.enqueueAndForget(async()=>function(Zs,_u,Eu,Iu,Au){const $u=new __PRIVATE_AsyncObserver({next:Su=>{$u.Nu(),_u.enqueueAndForget(()=>__PRIVATE_eventManagerUnlisten(Zs,vu));const Ru=Su.docs.has(Eu);!Ru&&Su.fromCache?Au.reject(new FirestoreError(C.UNAVAILABLE,"Failed to get document because the client is offline.")):Ru&&Su.fromCache&&Iu&&Iu.source==="server"?Au.reject(new FirestoreError(C.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):Au.resolve(Su)},error:Su=>Au.reject(Su)}),vu=new __PRIVATE_QueryListener(__PRIVATE_newQueryForPath(Eu.path),$u,{includeMetadataChanges:!0,Ka:!0});return __PRIVATE_eventManagerListen(Zs,vu)}(await __PRIVATE_getEventManager(Z),Z.asyncQueue,t,Hs,zs)),zs.promise}function __PRIVATE_firestoreClientGetDocumentsViaSnapshotListener(Z,t,Hs={}){const zs=new __PRIVATE_Deferred;return Z.asyncQueue.enqueueAndForget(async()=>function(Zs,_u,Eu,Iu,Au){const $u=new __PRIVATE_AsyncObserver({next:Su=>{$u.Nu(),_u.enqueueAndForget(()=>__PRIVATE_eventManagerUnlisten(Zs,vu)),Su.fromCache&&Iu.source==="server"?Au.reject(new FirestoreError(C.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):Au.resolve(Su)},error:Su=>Au.reject(Su)}),vu=new __PRIVATE_QueryListener(Eu,$u,{includeMetadataChanges:!0,Ka:!0});return __PRIVATE_eventManagerListen(Zs,vu)}(await __PRIVATE_getEventManager(Z),Z.asyncQueue,t,Hs,zs)),zs.promise}function __PRIVATE_firestoreClientWrite(Z,t){const Hs=new __PRIVATE_Deferred;return Z.asyncQueue.enqueueAndForget(async()=>__PRIVATE_syncEngineWrite(await __PRIVATE_getSyncEngine(Z),t,Hs)),Hs.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_cloneLongPollingOptions(Z){const t={};return Z.timeoutSeconds!==void 0&&(t.timeoutSeconds=Z.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const en="ComponentProvider",tn=new Map;function __PRIVATE_makeDatabaseInfo(Z,t,Hs,zs,Ys){return new DatabaseInfo(Z,t,Hs,Ys.host,Ys.ssl,Ys.experimentalForceLongPolling,Ys.experimentalAutoDetectLongPolling,__PRIVATE_cloneLongPollingOptions(Ys.experimentalLongPollingOptions),Ys.useFetchStreams,Ys.isUsingEmulator,zs)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nn="firestore.googleapis.com",rn=!0;class FirestoreSettingsImpl{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new FirestoreError(C.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=nn,this.ssl=rn}else this.host=t.host,this.ssl=t.ssl??rn;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=Dt;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<vt)throw new FirestoreError(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}__PRIVATE_validateIsNotUsedTogether("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=__PRIVATE_cloneLongPollingOptions(t.experimentalLongPollingOptions??{}),function(zs){if(zs.timeoutSeconds!==void 0){if(isNaN(zs.timeoutSeconds))throw new FirestoreError(C.INVALID_ARGUMENT,`invalid long polling timeout: ${zs.timeoutSeconds} (must not be NaN)`);if(zs.timeoutSeconds<5)throw new FirestoreError(C.INVALID_ARGUMENT,`invalid long polling timeout: ${zs.timeoutSeconds} (minimum allowed value is 5)`);if(zs.timeoutSeconds>30)throw new FirestoreError(C.INVALID_ARGUMENT,`invalid long polling timeout: ${zs.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(zs,Ys){return zs.timeoutSeconds===Ys.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Firestore$1{constructor(t,Hs,zs,Ys){this._authCredentials=t,this._appCheckCredentials=Hs,this._databaseId=zs,this._app=Ys,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new FirestoreSettingsImpl({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new FirestoreError(C.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new FirestoreError(C.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new FirestoreSettingsImpl(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(zs){if(!zs)return new __PRIVATE_EmptyAuthCredentialsProvider;switch(zs.type){case"firstParty":return new __PRIVATE_FirstPartyAuthCredentialsProvider(zs.sessionIndex||"0",zs.iamToken||null,zs.authTokenFactory||null);case"provider":return zs.client;default:throw new FirestoreError(C.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(Hs){const zs=tn.get(Hs);zs&&(__PRIVATE_logDebug(en,"Removing Datastore"),tn.delete(Hs),zs.terminate())}(this),Promise.resolve()}}function connectFirestoreEmulator(Z,t,Hs,zs={}){var Au;Z=__PRIVATE_cast(Z,Firestore$1);const Ys=isCloudWorkstation(t),Zs=Z._getSettings(),_u={...Zs,emulatorOptions:Z._getEmulatorOptions()},Eu=`${t}:${Hs}`;Ys&&(pingServer(`https://${Eu}`),updateEmulatorBanner("Firestore",!0)),Zs.host!==nn&&Zs.host!==Eu&&__PRIVATE_logWarn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const Iu={...Zs,host:Eu,ssl:Ys,emulatorOptions:zs};if(!deepEqual(Iu,_u)&&(Z._setSettings(Iu),zs.mockUserToken)){let $u,vu;if(typeof zs.mockUserToken=="string")$u=zs.mockUserToken,vu=User.MOCK_USER;else{$u=createMockUserToken(zs.mockUserToken,(Au=Z._app)==null?void 0:Au.options.projectId);const Su=zs.mockUserToken.sub||zs.mockUserToken.user_id;if(!Su)throw new FirestoreError(C.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");vu=new User(Su)}Z._authCredentials=new __PRIVATE_EmulatorAuthCredentialsProvider(new __PRIVATE_OAuthToken($u,vu))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Query{constructor(t,Hs,zs){this.converter=Hs,this._query=zs,this.type="query",this.firestore=t}withConverter(t){return new Query(this.firestore,t,this._query)}}class DocumentReference{constructor(t,Hs,zs){this.converter=Hs,this._key=zs,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new CollectionReference(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new DocumentReference(this.firestore,t,this._key)}toJSON(){return{type:DocumentReference._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,Hs,zs){if(__PRIVATE_validateJSON(Hs,DocumentReference._jsonSchema))return new DocumentReference(t,zs||null,new DocumentKey(ResourcePath.fromString(Hs.referencePath)))}}DocumentReference._jsonSchemaVersion="firestore/documentReference/1.0",DocumentReference._jsonSchema={type:property("string",DocumentReference._jsonSchemaVersion),referencePath:property("string")};class CollectionReference extends Query{constructor(t,Hs,zs){super(t,Hs,__PRIVATE_newQueryForPath(zs)),this._path=zs,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new DocumentReference(this.firestore,null,new DocumentKey(t))}withConverter(t){return new CollectionReference(this.firestore,t,this._path)}}function collection(Z,t,...Hs){if(Z=getModularInstance(Z),__PRIVATE_validateNonEmptyArgument("collection","path",t),Z instanceof Firestore$1){const zs=ResourcePath.fromString(t,...Hs);return __PRIVATE_validateCollectionPath(zs),new CollectionReference(Z,null,zs)}{if(!(Z instanceof DocumentReference||Z instanceof CollectionReference))throw new FirestoreError(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const zs=Z._path.child(ResourcePath.fromString(t,...Hs));return __PRIVATE_validateCollectionPath(zs),new CollectionReference(Z.firestore,null,zs)}}function doc(Z,t,...Hs){if(Z=getModularInstance(Z),arguments.length===1&&(t=__PRIVATE_AutoId.newId()),__PRIVATE_validateNonEmptyArgument("doc","path",t),Z instanceof Firestore$1){const zs=ResourcePath.fromString(t,...Hs);return __PRIVATE_validateDocumentPath(zs),new DocumentReference(Z,null,new DocumentKey(zs))}{if(!(Z instanceof DocumentReference||Z instanceof CollectionReference))throw new FirestoreError(C.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const zs=Z._path.child(ResourcePath.fromString(t,...Hs));return __PRIVATE_validateDocumentPath(zs),new DocumentReference(Z.firestore,Z instanceof CollectionReference?Z.converter:null,new DocumentKey(zs))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sn="AsyncQueue";class __PRIVATE_AsyncQueueImpl{constructor(t=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new __PRIVATE_ExponentialBackoff(this,"async_queue_retry"),this._c=()=>{const zs=getDocument();zs&&__PRIVATE_logDebug(sn,"Visibility state changed to "+zs.visibilityState),this.M_.w_()},this.ac=t;const Hs=getDocument();Hs&&typeof Hs.addEventListener=="function"&&Hs.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const Hs=getDocument();Hs&&typeof Hs.removeEventListener=="function"&&Hs.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise(()=>{});const Hs=new __PRIVATE_Deferred;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(t().then(Hs.resolve,Hs.reject),Hs.promise)).then(()=>Hs.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Yu.push(t),this.lc()))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(t){if(!__PRIVATE_isIndexedDbTransactionError(t))throw t;__PRIVATE_logDebug(sn,"Operation failed with retryable error: "+t)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(t){const Hs=this.ac.then(()=>(this.rc=!0,t().catch(zs=>{throw this.nc=zs,this.rc=!1,__PRIVATE_logError("INTERNAL UNHANDLED ERROR: ",__PRIVATE_getMessageOrStack(zs)),zs}).then(zs=>(this.rc=!1,zs))));return this.ac=Hs,Hs}enqueueAfterDelay(t,Hs,zs){this.uc(),this.oc.indexOf(t)>-1&&(Hs=0);const Ys=DelayedOperation.createAndSchedule(this,t,Hs,zs,Zs=>this.hc(Zs));return this.tc.push(Ys),Ys}uc(){this.nc&&fail(47125,{Pc:__PRIVATE_getMessageOrStack(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do t=this.ac,await t;while(t!==this.ac)}Ic(t){for(const Hs of this.tc)if(Hs.timerId===t)return!0;return!1}Ec(t){return this.Tc().then(()=>{this.tc.sort((Hs,zs)=>Hs.targetTimeMs-zs.targetTimeMs);for(const Hs of this.tc)if(Hs.skipDelay(),t!=="all"&&Hs.timerId===t)break;return this.Tc()})}Rc(t){this.oc.push(t)}hc(t){const Hs=this.tc.indexOf(t);this.tc.splice(Hs,1)}}function __PRIVATE_getMessageOrStack(Z){let t=Z.message||"";return Z.stack&&(t=Z.stack.includes(Z.message)?Z.stack:Z.message+`
`+Z.stack),t}class Firestore extends Firestore$1{constructor(t,Hs,zs,Ys){super(t,Hs,zs,Ys),this.type="firestore",this._queue=new __PRIVATE_AsyncQueueImpl,this._persistenceKey=(Ys==null?void 0:Ys.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new __PRIVATE_AsyncQueueImpl(t),this._firestoreClient=void 0,await t}}}function getFirestore(Z,t){const Hs=typeof Z=="object"?Z:getApp(),zs=typeof Z=="string"?Z:t||st,Ys=_getProvider(Hs,"firestore").getImmediate({identifier:zs});if(!Ys._initialized){const Zs=getDefaultEmulatorHostnameAndPort("firestore");Zs&&connectFirestoreEmulator(Ys,...Zs)}return Ys}function ensureFirestoreConfigured(Z){if(Z._terminated)throw new FirestoreError(C.FAILED_PRECONDITION,"The client has already been terminated.");return Z._firestoreClient||__PRIVATE_configureFirestore(Z),Z._firestoreClient}function __PRIVATE_configureFirestore(Z){var zs,Ys,Zs,_u;const t=Z._freezeSettings(),Hs=__PRIVATE_makeDatabaseInfo(Z._databaseId,((zs=Z._app)==null?void 0:zs.options.appId)||"",Z._persistenceKey,(Ys=Z._app)==null?void 0:Ys.options.apiKey,t);Z._componentsProvider||(Zs=t.localCache)!=null&&Zs._offlineComponentProvider&&((_u=t.localCache)!=null&&_u._onlineComponentProvider)&&(Z._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),Z._firestoreClient=new FirestoreClient(Z._authCredentials,Z._appCheckCredentials,Z._queue,Hs,Z._componentsProvider&&function(Iu){const Au=Iu==null?void 0:Iu._online.build();return{_offline:Iu==null?void 0:Iu._offline.build(Au),_online:Au}}(Z._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bytes{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Bytes(ByteString.fromBase64String(t))}catch(Hs){throw new FirestoreError(C.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+Hs)}}static fromUint8Array(t){return new Bytes(ByteString.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:Bytes._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(__PRIVATE_validateJSON(t,Bytes._jsonSchema))return Bytes.fromBase64String(t.bytes)}}Bytes._jsonSchemaVersion="firestore/bytes/1.0",Bytes._jsonSchema={type:property("string",Bytes._jsonSchemaVersion),bytes:property("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FieldPath{constructor(...t){for(let Hs=0;Hs<t.length;++Hs)if(t[Hs].length===0)throw new FirestoreError(C.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new FieldPath$1(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FieldValue{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GeoPoint{constructor(t,Hs){if(!isFinite(t)||t<-90||t>90)throw new FirestoreError(C.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(Hs)||Hs<-180||Hs>180)throw new FirestoreError(C.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+Hs);this._lat=t,this._long=Hs}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return __PRIVATE_primitiveComparator(this._lat,t._lat)||__PRIVATE_primitiveComparator(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:GeoPoint._jsonSchemaVersion}}static fromJSON(t){if(__PRIVATE_validateJSON(t,GeoPoint._jsonSchema))return new GeoPoint(t.latitude,t.longitude)}}GeoPoint._jsonSchemaVersion="firestore/geoPoint/1.0",GeoPoint._jsonSchema={type:property("string",GeoPoint._jsonSchemaVersion),latitude:property("number"),longitude:property("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VectorValue{constructor(t){this._values=(t||[]).map(Hs=>Hs)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(zs,Ys){if(zs.length!==Ys.length)return!1;for(let Zs=0;Zs<zs.length;++Zs)if(zs[Zs]!==Ys[Zs])return!1;return!0}(this._values,t._values)}toJSON(){return{type:VectorValue._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(__PRIVATE_validateJSON(t,VectorValue._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every(Hs=>typeof Hs=="number"))return new VectorValue(t.vectorValues);throw new FirestoreError(C.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}VectorValue._jsonSchemaVersion="firestore/vectorValue/1.0",VectorValue._jsonSchema={type:property("string",VectorValue._jsonSchemaVersion),vectorValues:property("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _n=/^__.*__$/;class ParsedSetData{constructor(t,Hs,zs){this.data=t,this.fieldMask=Hs,this.fieldTransforms=zs}toMutation(t,Hs){return this.fieldMask!==null?new __PRIVATE_PatchMutation(t,this.data,this.fieldMask,Hs,this.fieldTransforms):new __PRIVATE_SetMutation(t,this.data,Hs,this.fieldTransforms)}}function __PRIVATE_isWrite(Z){switch(Z){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw fail(40011,{dataSource:Z})}}class ParseContextImpl{constructor(t,Hs,zs,Ys,Zs,_u){this.settings=t,this.databaseId=Hs,this.serializer=zs,this.ignoreUndefinedProperties=Ys,Zs===void 0&&this.validatePath(),this.fieldTransforms=Zs||[],this.fieldMask=_u||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(t){return new ParseContextImpl({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(t){var Ys;const Hs=(Ys=this.path)==null?void 0:Ys.child(t),zs=this.contextWith({path:Hs,arrayElement:!1});return zs.validatePathSegment(t),zs}childContextForFieldPath(t){var Ys;const Hs=(Ys=this.path)==null?void 0:Ys.child(t),zs=this.contextWith({path:Hs,arrayElement:!1});return zs.validatePath(),zs}childContextForArray(t){return this.contextWith({path:void 0,arrayElement:!0})}createError(t){return createError(t,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(t){return this.fieldMask.find(Hs=>t.isPrefixOf(Hs))!==void 0||this.fieldTransforms.find(Hs=>t.isPrefixOf(Hs.field))!==void 0}validatePath(){if(this.path)for(let t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))}validatePathSegment(t){if(t.length===0)throw this.createError("Document fields must not be empty");if(__PRIVATE_isWrite(this.dataSource)&&_n.test(t))throw this.createError('Document fields cannot begin and end with "__"')}}class UserDataReader{constructor(t,Hs,zs){this.databaseId=t,this.ignoreUndefinedProperties=Hs,this.serializer=zs||__PRIVATE_newSerializer(t)}createContext(t,Hs,zs,Ys=!1){return new ParseContextImpl({dataSource:t,methodName:Hs,targetDoc:zs,path:FieldPath$1.emptyPath(),arrayElement:!1,hasConverter:Ys},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function __PRIVATE_newUserDataReader(Z){const t=Z._freezeSettings(),Hs=__PRIVATE_newSerializer(Z._databaseId);return new UserDataReader(Z._databaseId,!!t.ignoreUndefinedProperties,Hs)}function __PRIVATE_parseSetData(Z,t,Hs,zs,Ys,Zs={}){const _u=Z.createContext(Zs.merge||Zs.mergeFields?2:0,t,Hs,Ys);__PRIVATE_validatePlainObject("Data must be an object, but it was:",_u,zs);const Eu=__PRIVATE_parseObject(zs,_u);let Iu,Au;if(Zs.merge)Iu=new FieldMask(_u.fieldMask),Au=_u.fieldTransforms;else if(Zs.mergeFields){const $u=[];for(const vu of Zs.mergeFields){const Su=__PRIVATE_fieldPathFromArgument(t,vu,Hs);if(!_u.contains(Su))throw new FirestoreError(C.INVALID_ARGUMENT,`Field '${Su}' is specified in your field mask but missing from your input data.`);__PRIVATE_fieldMaskContains($u,Su)||$u.push(Su)}Iu=new FieldMask($u),Au=_u.fieldTransforms.filter(vu=>Iu.covers(vu.field))}else Iu=null,Au=_u.fieldTransforms;return new ParsedSetData(new ObjectValue(Eu),Iu,Au)}function __PRIVATE_parseData(Z,t){if(__PRIVATE_looksLikeJsonObject(Z=getModularInstance(Z)))return __PRIVATE_validatePlainObject("Unsupported field value:",t,Z),__PRIVATE_parseObject(Z,t);if(Z instanceof FieldValue)return function(zs,Ys){if(!__PRIVATE_isWrite(Ys.dataSource))throw Ys.createError(`${zs._methodName}() can only be used with update() and set()`);if(!Ys.path)throw Ys.createError(`${zs._methodName}() is not currently supported inside arrays`);const Zs=zs._toFieldTransform(Ys);Zs&&Ys.fieldTransforms.push(Zs)}(Z,t),null;if(Z===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),Z instanceof Array){if(t.settings.arrayElement&&t.dataSource!==4)throw t.createError("Nested arrays are not supported");return function(zs,Ys){const Zs=[];let _u=0;for(const Eu of zs){let Iu=__PRIVATE_parseData(Eu,Ys.childContextForArray(_u));Iu==null&&(Iu={nullValue:"NULL_VALUE"}),Zs.push(Iu),_u++}return{arrayValue:{values:Zs}}}(Z,t)}return function(zs,Ys){if((zs=getModularInstance(zs))===null)return{nullValue:"NULL_VALUE"};if(typeof zs=="number")return toNumber(Ys.serializer,zs);if(typeof zs=="boolean")return{booleanValue:zs};if(typeof zs=="string")return{stringValue:zs};if(zs instanceof Date){const Zs=Timestamp.fromDate(zs);return{timestampValue:toTimestamp(Ys.serializer,Zs)}}if(zs instanceof Timestamp){const Zs=new Timestamp(zs.seconds,1e3*Math.floor(zs.nanoseconds/1e3));return{timestampValue:toTimestamp(Ys.serializer,Zs)}}if(zs instanceof GeoPoint)return{geoPointValue:{latitude:zs.latitude,longitude:zs.longitude}};if(zs instanceof Bytes)return{bytesValue:__PRIVATE_toBytes(Ys.serializer,zs._byteString)};if(zs instanceof DocumentReference){const Zs=Ys.databaseId,_u=zs.firestore._databaseId;if(!_u.isEqual(Zs))throw Ys.createError(`Document reference is for database ${_u.projectId}/${_u.database} but should be for database ${Zs.projectId}/${Zs.database}`);return{referenceValue:__PRIVATE_toResourceName(zs.firestore._databaseId||Ys.databaseId,zs._key.path)}}if(zs instanceof VectorValue)return function(_u,Eu){const Iu=_u instanceof VectorValue?_u.toArray():_u;return{mapValue:{fields:{[ot]:{stringValue:ut},[ct]:{arrayValue:{values:Iu.map($u=>{if(typeof $u!="number")throw Eu.createError("VectorValues must only contain numeric values.");return __PRIVATE_toDouble(Eu.serializer,$u)})}}}}}}(zs,Ys);if(__PRIVATE_isProtoValueSerializable(zs))return zs._toProto(Ys.serializer);throw Ys.createError(`Unsupported field value: ${__PRIVATE_valueDescription(zs)}`)}(Z,t)}function __PRIVATE_parseObject(Z,t){const Hs={};return isEmpty(Z)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):forEach(Z,(zs,Ys)=>{const Zs=__PRIVATE_parseData(Ys,t.childContextForField(zs));Zs!=null&&(Hs[zs]=Zs)}),{mapValue:{fields:Hs}}}function __PRIVATE_looksLikeJsonObject(Z){return!(typeof Z!="object"||Z===null||Z instanceof Array||Z instanceof Date||Z instanceof Timestamp||Z instanceof GeoPoint||Z instanceof Bytes||Z instanceof DocumentReference||Z instanceof FieldValue||Z instanceof VectorValue||__PRIVATE_isProtoValueSerializable(Z))}function __PRIVATE_validatePlainObject(Z,t,Hs){if(!__PRIVATE_looksLikeJsonObject(Hs)||!__PRIVATE_isPlainObject(Hs)){const zs=__PRIVATE_valueDescription(Hs);throw zs==="an object"?t.createError(Z+" a custom object"):t.createError(Z+" "+zs)}}function __PRIVATE_fieldPathFromArgument(Z,t,Hs){if((t=getModularInstance(t))instanceof FieldPath)return t._internalPath;if(typeof t=="string")return __PRIVATE_fieldPathFromDotSeparatedString(Z,t);throw createError("Field path arguments must be of type string or ",Z,!1,void 0,Hs)}const an=new RegExp("[~\\*/\\[\\]]");function __PRIVATE_fieldPathFromDotSeparatedString(Z,t,Hs){if(t.search(an)>=0)throw createError(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,Z,!1,void 0,Hs);try{return new FieldPath(...t.split("."))._internalPath}catch{throw createError(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,Z,!1,void 0,Hs)}}function createError(Z,t,Hs,zs,Ys){const Zs=zs&&!zs.isEmpty(),_u=Ys!==void 0;let Eu=`Function ${t}() called with invalid data`;Hs&&(Eu+=" (via `toFirestore()`)"),Eu+=". ";let Iu="";return(Zs||_u)&&(Iu+=" (found",Zs&&(Iu+=` in field ${zs}`),_u&&(Iu+=` in document ${Ys}`),Iu+=")"),new FirestoreError(C.INVALID_ARGUMENT,Eu+Z+Iu)}function __PRIVATE_fieldMaskContains(Z,t){return Z.some(Hs=>Hs.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AbstractUserDataWriter{convertValue(t,Hs="none"){switch(__PRIVATE_typeOrder(t)){case 0:return null;case 1:return t.booleanValue;case 2:return __PRIVATE_normalizeNumber(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,Hs);case 5:return t.stringValue;case 6:return this.convertBytes(__PRIVATE_normalizeByteString(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,Hs);case 11:return this.convertObject(t.mapValue,Hs);case 10:return this.convertVectorValue(t.mapValue);default:throw fail(62114,{value:t})}}convertObject(t,Hs){return this.convertObjectMap(t.fields,Hs)}convertObjectMap(t,Hs="none"){const zs={};return forEach(t,(Ys,Zs)=>{zs[Ys]=this.convertValue(Zs,Hs)}),zs}convertVectorValue(t){var zs,Ys,Zs;const Hs=(Zs=(Ys=(zs=t.fields)==null?void 0:zs[ct].arrayValue)==null?void 0:Ys.values)==null?void 0:Zs.map(_u=>__PRIVATE_normalizeNumber(_u.doubleValue));return new VectorValue(Hs)}convertGeoPoint(t){return new GeoPoint(__PRIVATE_normalizeNumber(t.latitude),__PRIVATE_normalizeNumber(t.longitude))}convertArray(t,Hs){return(t.values||[]).map(zs=>this.convertValue(zs,Hs))}convertServerTimestamp(t,Hs){switch(Hs){case"previous":const zs=__PRIVATE_getPreviousValue(t);return zs==null?null:this.convertValue(zs,Hs);case"estimate":return this.convertTimestamp(__PRIVATE_getLocalWriteTime(t));default:return null}}convertTimestamp(t){const Hs=__PRIVATE_normalizeTimestamp(t);return new Timestamp(Hs.seconds,Hs.nanos)}convertDocumentKey(t,Hs){const zs=ResourcePath.fromString(t);__PRIVATE_hardAssert(__PRIVATE_isValidResourceName(zs),9688,{name:t});const Ys=new DatabaseId(zs.get(1),zs.get(3)),Zs=new DocumentKey(zs.popFirst(5));return Ys.isEqual(Hs)||__PRIVATE_logError(`Document ${Zs} contains a document reference within a different database (${Ys.projectId}/${Ys.database}) which is not supported. It will be treated as a reference in the current database (${Hs.projectId}/${Hs.database}) instead.`),Zs}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_ExpUserDataWriter extends AbstractUserDataWriter{constructor(t){super(),this.firestore=t}convertBytes(t){return new Bytes(t)}convertReference(t){const Hs=this.convertDocumentKey(t,this.firestore._databaseId);return new DocumentReference(this.firestore,null,Hs)}}const Ut="@firebase/firestore",Ht="4.10.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DocumentSnapshot$1{constructor(t,Hs,zs,Ys,Zs){this._firestore=t,this._userDataWriter=Hs,this._key=zs,this._document=Ys,this._converter=Zs}get id(){return this._key.path.lastSegment()}get ref(){return new DocumentReference(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new QueryDocumentSnapshot$1(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){var t;return((t=this._document)==null?void 0:t.data.clone().value.mapValue.fields)??void 0}get(t){if(this._document){const Hs=this._document.data.field(__PRIVATE_fieldPathFromArgument("DocumentSnapshot.get",t));if(Hs!==null)return this._userDataWriter.convertValue(Hs)}}}class QueryDocumentSnapshot$1 extends DocumentSnapshot$1{data(){return super.data()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_validateHasExplicitOrderByForLimitToLast(Z){if(Z.limitType==="L"&&Z.explicitOrderBy.length===0)throw new FirestoreError(C.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function __PRIVATE_applyFirestoreDataConverter(Z,t,Hs){let zs;return zs=Z?Hs&&(Hs.merge||Hs.mergeFields)?Z.toFirestore(t,Hs):Z.toFirestore(t):t,zs}class SnapshotMetadata{constructor(t,Hs){this.hasPendingWrites=t,this.fromCache=Hs}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class DocumentSnapshot extends DocumentSnapshot$1{constructor(t,Hs,zs,Ys,Zs,_u){super(t,Hs,zs,Ys,_u),this._firestore=t,this._firestoreImpl=t,this.metadata=Zs}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const Hs=new QueryDocumentSnapshot(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(Hs,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,Hs={}){if(this._document){const zs=this._document.data.field(__PRIVATE_fieldPathFromArgument("DocumentSnapshot.get",t));if(zs!==null)return this._userDataWriter.convertValue(zs,Hs.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new FirestoreError(C.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,Hs={};return Hs.type=DocumentSnapshot._jsonSchemaVersion,Hs.bundle="",Hs.bundleSource="DocumentSnapshot",Hs.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?Hs:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),Hs.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),Hs)}}DocumentSnapshot._jsonSchemaVersion="firestore/documentSnapshot/1.0",DocumentSnapshot._jsonSchema={type:property("string",DocumentSnapshot._jsonSchemaVersion),bundleSource:property("string","DocumentSnapshot"),bundleName:property("string"),bundle:property("string")};class QueryDocumentSnapshot extends DocumentSnapshot{data(t={}){return super.data(t)}}class QuerySnapshot{constructor(t,Hs,zs,Ys){this._firestore=t,this._userDataWriter=Hs,this._snapshot=Ys,this.metadata=new SnapshotMetadata(Ys.hasPendingWrites,Ys.fromCache),this.query=zs}get docs(){const t=[];return this.forEach(Hs=>t.push(Hs)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,Hs){this._snapshot.docs.forEach(zs=>{t.call(Hs,new QueryDocumentSnapshot(this._firestore,this._userDataWriter,zs.key,zs,new SnapshotMetadata(this._snapshot.mutatedKeys.has(zs.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const Hs=!!t.includeMetadataChanges;if(Hs&&this._snapshot.excludesMetadataChanges)throw new FirestoreError(C.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===Hs||(this._cachedChanges=function(Ys,Zs){if(Ys._snapshot.oldDocs.isEmpty()){let _u=0;return Ys._snapshot.docChanges.map(Eu=>{const Iu=new QueryDocumentSnapshot(Ys._firestore,Ys._userDataWriter,Eu.doc.key,Eu.doc,new SnapshotMetadata(Ys._snapshot.mutatedKeys.has(Eu.doc.key),Ys._snapshot.fromCache),Ys.query.converter);return Eu.doc,{type:"added",doc:Iu,oldIndex:-1,newIndex:_u++}})}{let _u=Ys._snapshot.oldDocs;return Ys._snapshot.docChanges.filter(Eu=>Zs||Eu.type!==3).map(Eu=>{const Iu=new QueryDocumentSnapshot(Ys._firestore,Ys._userDataWriter,Eu.doc.key,Eu.doc,new SnapshotMetadata(Ys._snapshot.mutatedKeys.has(Eu.doc.key),Ys._snapshot.fromCache),Ys.query.converter);let Au=-1,$u=-1;return Eu.type!==0&&(Au=_u.indexOf(Eu.doc.key),_u=_u.delete(Eu.doc.key)),Eu.type!==1&&(_u=_u.add(Eu.doc),$u=_u.indexOf(Eu.doc.key)),{type:__PRIVATE_resultChangeType(Eu.type),doc:Iu,oldIndex:Au,newIndex:$u}})}}(this,Hs),this._cachedChangesIncludeMetadataChanges=Hs),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new FirestoreError(C.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=QuerySnapshot._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=__PRIVATE_AutoId.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const Hs=[],zs=[],Ys=[];return this.docs.forEach(Zs=>{Zs._document!==null&&(Hs.push(Zs._document),zs.push(this._userDataWriter.convertObjectMap(Zs._document.data.value.mapValue.fields,"previous")),Ys.push(Zs.ref.path))}),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function __PRIVATE_resultChangeType(Z){switch(Z){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return fail(61501,{type:Z})}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */QuerySnapshot._jsonSchemaVersion="firestore/querySnapshot/1.0",QuerySnapshot._jsonSchema={type:property("string",QuerySnapshot._jsonSchemaVersion),bundleSource:property("string","QuerySnapshot"),bundleName:property("string"),bundle:property("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getDoc(Z){Z=__PRIVATE_cast(Z,DocumentReference);const t=__PRIVATE_cast(Z.firestore,Firestore),Hs=ensureFirestoreConfigured(t);return __PRIVATE_firestoreClientGetDocumentViaSnapshotListener(Hs,Z._key).then(zs=>__PRIVATE_convertToDocSnapshot(t,Z,zs))}function getDocs(Z){Z=__PRIVATE_cast(Z,Query);const t=__PRIVATE_cast(Z.firestore,Firestore),Hs=ensureFirestoreConfigured(t),zs=new __PRIVATE_ExpUserDataWriter(t);return __PRIVATE_validateHasExplicitOrderByForLimitToLast(Z._query),__PRIVATE_firestoreClientGetDocumentsViaSnapshotListener(Hs,Z._query).then(Ys=>new QuerySnapshot(t,zs,Z,Ys))}function setDoc(Z,t,Hs){Z=__PRIVATE_cast(Z,DocumentReference);const zs=__PRIVATE_cast(Z.firestore,Firestore),Ys=__PRIVATE_applyFirestoreDataConverter(Z.converter,t,Hs),Zs=__PRIVATE_newUserDataReader(zs);return executeWrite(zs,[__PRIVATE_parseSetData(Zs,"setDoc",Z._key,Ys,Z.converter!==null,Hs).toMutation(Z._key,Precondition.none())])}function executeWrite(Z,t){const Hs=ensureFirestoreConfigured(Z);return __PRIVATE_firestoreClientWrite(Hs,t)}function __PRIVATE_convertToDocSnapshot(Z,t,Hs){const zs=Hs.docs.get(t._key),Ys=new __PRIVATE_ExpUserDataWriter(Z);return new DocumentSnapshot(Z,Ys,t._key,zs,new SnapshotMetadata(Hs.hasPendingWrites,Hs.fromCache),t.converter)}(function Z(t,Hs=!0){__PRIVATE_setSDKVersion(SDK_VERSION),_registerComponent(new Component("firestore",(zs,{instanceIdentifier:Ys,options:Zs})=>{const _u=zs.getProvider("app").getImmediate(),Eu=new Firestore(new __PRIVATE_FirebaseAuthCredentialsProvider(zs.getProvider("auth-internal")),new __PRIVATE_FirebaseAppCheckTokenProvider(_u,zs.getProvider("app-check-internal")),__PRIVATE_databaseIdFromApp(_u,Ys),_u);return Zs={useFetchStreams:Hs,...Zs},Eu._setSettings(Zs),Eu},"PUBLIC").setMultipleInstances(!0)),registerVersion(Ut,Ht,t),registerVersion(Ut,Ht,"esm2020")})();window.process=process$1;window.Buffer=Buffer$1$1;window.currentUserAddress=null;window.selectedCombatNft=null;window.enemyCombatNft=null;window.usedCombatNfts=new Set;const COLLECTION_ODINS="ODINSDECK-4e300a",firebaseConfig={apiKey:"AIzaSyCTvZ8uBFquJyQafDoFxaMnTtQosbm2cc8",authDomain:"odinverse-68f9a.firebaseapp.com",projectId:"odinverse-68f9a",storageBucket:"odinverse-68f9a.firebasestorage.app",messagingSenderId:"1008100514502",appId:"1:1008100514502:web:a2792d928c1ff4600855c7",measurementId:"G-NG4N10WTRD"},app=initializeApp(firebaseConfig),db=getFirestore(app);collection(db,"combatStats");document.addEventListener("DOMContentLoaded",()=>{const Z=document.getElementById("status"),t=document.getElementById("address"),Hs=document.getElementById("connectBtn"),zs=document.getElementById("disconnectBtn"),Ys=document.getElementById("walletChoices"),Zs=document.getElementById("connectExtension"),_u=document.getElementById("connectWalletConnect"),Eu=document.getElementById("connectXPortal"),Iu=document.getElementById("MyWalletConnectQRContainer"),Au=document.querySelector(".wallet-balances"),$u=document.getElementById("aboutSection"),vu=document.getElementById("nftSectionOdins"),Su=document.getElementById("nftSectionOthers"),Ru=document.getElementById("odinsList"),Pu=document.getElementById("otherNftsList"),Cu=document.getElementById("postConnectActions"),Bu=document.getElementById("odinsCount"),Fu=document.getElementById("odinsAttributesTable"),zu=document.getElementById("otherNftSearch");document.getElementById("topHoldersdeck");const Hu=document.getElementById("nftModal"),Wu=document.getElementById("modalTitle"),tl=document.getElementById("modalAttributes"),Xu=document.getElementById("modalMediaContainer"),ju=document.getElementById("closeModal");document.querySelector(".wallet-actions");const ku=document.getElementById("walletBackBtn"),Uu="ODINSDECK-4e300a",Gu="TSK-4c0988",Yu="34e304e844296ede8b06875106a3276c",Qu="wss://relay.walletconnect.com",Lu="D";let cl=null,el=!1;function Zu($l){var Bl;return Array.isArray((Bl=$l.metadata)==null?void 0:Bl.attributes)?$l.metadata.attributes:Array.isArray($l.attributes)?$l.attributes:[]}function dl($l){Wu.textContent=`${$l.name} nonce ${$l.nonce}`,Xu.innerHTML="",Xu.appendChild(Nu($l.image,"modal-image",!0));const Bl=(Zu==null?void 0:Zu($l))||[];tl.innerHTML=Bl.length?Bl.map(xl=>`
		  <div class="attr">
			<strong>${xl.trait_type}</strong>
			<span>${xl.value}</span>
		  </div>
		`).join(""):`
		  <p style="
			opacity: 0.6;
			font-family: 'Cinzel', serif;
			letter-spacing: 0.12em;
			text-transform: uppercase;
		  ">
			No attributes
		  </p>
		`,Hu.style.display="flex"}ju.onclick=()=>Hu.style.display="none",Hu.onclick=$l=>{$l.target===Hu&&(Hu.style.display="none")};function El($l,Bl,xl){if(Bl.innerHTML="",!$l.length){Bl.innerHTML=`<p>${xl}</p>`;return}$l.forEach(Ol=>{const Nl=document.createElement("div");Nl.className="nft-card";const kl=Nu(Ol.image,""),Ul=document.createElement("div");Ul.className="nft-name",Ul.textContent=Ol.name;const zl=document.createElement("div");zl.className="nft-nonce",zl.textContent=`nonce ${Ol.nonce}`,Nl.append(kl,Ul,zl),Nl.onclick=()=>dl(Ol),Bl.appendChild(Nl)})}async function hl(){const $l=document.getElementById("odinsRow");if(!$l)return;$l.innerHTML="";const Bl=new IntersectionObserver(xl=>{xl.forEach(Ol=>{const Nl=Ol.target;Nl.tagName==="VIDEO"&&(Ol.isIntersecting?Nl.play().catch(()=>{}):Nl.pause())})},{threshold:.2});try{const xl=await fetch("https://api.multiversx.com/nfts?collection=ODINSDECK-4e300a&size=100");if(!xl.ok)return;(await xl.json()).sort(()=>.5-Math.random()).slice(0,6).forEach(kl=>{var nh,ch;const Ul=(nh=kl.media)==null?void 0:nh[0];if(!Ul)return;const zl=Ul.originalUrl||Ul.url;if(!zl)return;const ih=document.createElement("div");ih.className="odins-item";let Kl;(ch=Ul.fileType)!=null&&ch.startsWith("video")?(Kl=document.createElement("video"),Kl.src=zl,Kl.autoplay=!0,Kl.loop=!0,Kl.muted=!0,Kl.playsInline=!0,Kl.preload="metadata",Kl.loading="lazy",Kl.disablePictureInPicture=!0,Kl.controls=!1,Kl.pointerEvents="none",Kl.width=180,Kl.height=180,Bl.observe(Kl)):(Kl=document.createElement("img"),Kl.src=zl,Kl.loading="lazy",Kl.decoding="async",Kl.width=180,Kl.height=180),ih.appendChild(Kl),$l.appendChild(ih)})}catch(xl){console.error("Odin preview error:",xl)}}function _l($l){return String($l||"").trim().toLowerCase()}function Rl($l=[]){const Bl=document.getElementById("odinsAttributesTable");if(!Bl)return;const xl="Type",Ol="Category",Nl=7,kl=new Set([176,224,91,127,152,301]),Ul=1,zl=.17,ih={strength:.02,resilience:.01,darkness:.01,command:.012,nature:.013,agility:.013,technology:.013,magic:.014,monster:.014,light:.014,chaos:.017,knowledge:.017,awareness:.018,stealth:.018,craftsmanship:.018},Kl={strength:.005,resilience:.001,darkness:.001,command:.002,nature:.002,agility:.002,technology:.002,magic:.003,monster:.003,light:.003,chaos:.003,knowledge:.004,awareness:.005,stealth:.005,craftsmanship:.005},nh={strength:"",resilience:"",darkness:"",command:"",nature:"",agility:"",technology:"",magic:"",monster:"",light:"",chaos:"",knowledge:"",awareness:"",stealth:"",craftsmanship:""},ch={};let uh=0;if($l.forEach(Zl=>{const yh=Number(Zl.nonce);kl.has(yh)&&uh++,((Zu==null?void 0:Zu(Zl))||[]).forEach(Ah=>{if(Ah.trait_type!==xl)return;const Eh=_l(Ah.value);ch[Eh]=(ch[Eh]||0)+1})}),!Object.keys(ch).length){Bl.innerHTML=`
		<div style="
		  opacity: 0.6;
		  text-align: center;
		  font-family: 'Cinzel', serif;
		  letter-spacing: 0.14em;
		  text-transform: uppercase;
		  color: #ffd700;
		">
		  No data
		</div>
	  `;return}let dh=0,ah=0;const Wl=Object.entries(ch).sort((Zl,yh)=>yh[1]-Zl[1]).map(([Zl,yh])=>{const Ah=ih[Zl]||0,Eh=yh*Ah;dh+=Eh;const Th=yh>=Nl&&Kl[Zl]||0;return ah+=Th,{key:Zl,label:Zl.charAt(0).toUpperCase()+Zl.slice(1),emoji:nh[Zl]||"",count:yh,earned:Eh,bonus:Th}}),gh=uh>=Ul?zl:0;ah+=gh;const mh=dh+ah;Bl.innerHTML=`
    <div class="attr-row">
      <strong>${Ol}</strong>
      <span>
        ${Wl.map(Zl=>`${Zl.emoji} ${Zl.label} ( ${Zl.count} )`).join("  ")}
      </span>
    </div>

    <div class="attr-row">
      <strong>Earnings by trait</strong>
      <span>
        ${Wl.map(Zl=>`${Zl.emoji} ${Zl.label}: ${Zl.earned.toFixed(3)} $EGLD`).join("  ")}
      </span>
    </div>

    <div class="attr-row">
      <strong> Trait Bonuses (  ${Nl} )</strong>
      <span>
        ${Wl.filter(Zl=>Zl.bonus>0).map(Zl=>`${Zl.emoji} ${Zl.label}: +${Zl.bonus.toFixed(3)} $EGLD`).join("  ")||"<span style='opacity:.6'>No bonus</span>"}
      </span>
    </div>

    <div class="attr-row">
      <strong> Seer Bonus ( ${Ul} )</strong>
      <span>
        ${uh} Seer(s)
        ${gh?` +${zl.toFixed(2)} $EGLD`:"<span style='opacity:.6'>No bonus</span>"}
      </span>
    </div>

    <div class="attr-row" style="font-size:1rem;font-weight:800;">
      <strong> Total Earnings</strong>
      <span>${mh.toFixed(3)} $EGLD</span>
    </div>
  `}window.addEventListener("load",async()=>{var $l,Bl;if(cl){try{await(($l=cl.logout)==null?void 0:$l.call(cl)),await((Bl=cl.disconnect)==null?void 0:Bl.call(cl))}catch(xl){console.warn("Auto logout on refresh failed",xl)}cl=null}gl()}),window.addEventListener("beforeunload",()=>{var $l,Bl;try{($l=cl==null?void 0:cl.logout)==null||$l.call(cl),(Bl=cl==null?void 0:cl.disconnect)==null||Bl.call(cl)}catch{}cl=null});function ol(){walletMainActions.style.display="flex",Ys.style.display="none",Hs.style.display="none",zs.style.display="inline-flex"}function gl(){Z.textContent="Status: Not connected",t.textContent="";const $l=document.getElementById("mainTabs");$l&&($l.style.display="none"),document.querySelectorAll(".main-tab").forEach(kl=>kl.classList.remove("active"));const Bl=document.querySelector('[data-main-tab="collection"]');Bl&&Bl.classList.add("active");const xl=document.querySelector('[data-main-content="combat"]');xl&&(xl.style.display="none"),Au.innerHTML="",Au.style.display="none",Ru.innerHTML="",Pu.innerHTML="",vu.style.display="none",Su.style.display="none";const Ol=document.getElementById("otherNftSearch");Ol&&(Ol.style.display="none");const Nl=document.getElementById("topHoldersDeck");Nl&&(Nl.style.display="none"),Bu&&(Bu.textContent="0"),Fu&&(Fu.innerHTML=""),Ys.style.display="none",Hs.style.display="inline-flex",zs.style.display="none",odinsPreview&&(odinsPreview.style.display="flex"),postconnectactions&&(postconnectactions.style.display="flex"),Iu.innerHTML="",$u&&($u.style.display="block")}async function nl($l){console.log(" Login success:",$l),window.currentUserAddress=$l,window.walletProvider=cl,Z.textContent="Status: Connected",t.textContent=$l,Ml();const Bl=document.getElementById("mainTabs");Bl&&(Bl.style.display="flex");const xl=document.getElementById("combatTabBtn");xl&&(xl.style.display="inline-flex");const Ol=document.getElementById("combatTabContent");Ol&&(Ol.style.display="none",Ol.classList.remove("active")),document.querySelectorAll(".main-tab-content").forEach(ah=>{ah.style.display="none",ah.classList.remove("active")}),document.querySelectorAll(".main-tab").forEach(ah=>ah.classList.remove("active"));const Nl=document.querySelector('.main-tab[data-main-tab="collection"]'),kl=document.querySelector('.main-tab-content[data-main-content="collection"]');Nl&&Nl.classList.add("active"),kl&&(kl.style.display="block",kl.classList.add("active")),odinsPreview&&(odinsPreview.style.display="none"),postconnectactions&&(postconnectactions.style.display="none"),ol(),Iu.innerHTML="",$u&&($u.style.display="none"),Cu&&(Cu.style.display="none"),vu.style.display="block",Su.style.display="block";const Ul=document.getElementById("otherNftSearch");Ul&&(Ul.style.display="block");const zl=document.getElementById("topHoldersDeck");zl&&(zl.style.display="block"),Al(),Au.style.display="flex";const[ih,Kl]=await Promise.all([ll($l),ul($l,Gu)]);Tl("egld",ih),Tl("tsk",Kl);const nh=await qu($l),ch=nh.filter(ah=>ah.collection===Uu),uh=nh.filter(ah=>ah.collection!==Uu);El(ch,Ru,`<span style="font-family:'Cinzel',serif;letter-spacing:.14em;text-transform:uppercase;color:#ffd700;opacity:.6;white-space:nowrap;">No Odin'sDeck NFT</span>`),window.playerNfts=ch,El(uh,Pu,`<span style="font-family:'Cinzel',serif;letter-spacing:.14em;text-transform:uppercase;color:#ffd700;opacity:.6;white-space:nowrap;">No other NFT</span>`),Bu.textContent=ch.length,Rl(ch);const dh=await il(Uu);sl(dh),await Rh(),bl(),console.log(" App fully initialized")}Hs.addEventListener("click",()=>{walletMainActions.style.display="none",Ys.style.display="flex"}),ku.addEventListener("click",()=>{Ys.style.display="none",walletMainActions.style.display="flex"}),zs.onclick=async()=>{var $l,Bl;try{await(($l=cl==null?void 0:cl.logout)==null?void 0:$l.call(cl)),await((Bl=cl==null?void 0:cl.disconnect)==null?void 0:Bl.call(cl))}catch(xl){console.warn("Disconnect error",xl)}cl=null,gl()},Zs.onclick=async()=>{cl=out.ExtensionProvider.getInstance(),await cl.init(),await cl.login(),nl(await cl.getAddress())},Eu.onclick=async()=>{cl&&(await cl.logout().catch(()=>{}),cl=null),cl=new out$1.WalletConnectV2Provider({metadata:{name:"Odinverse",description:"Odinverse  MultiversX Viking Ecosystem",url:"https://www.odinverse.app",icons:["https://www.odinverse.app/logo-walletconnect.png"]},onClientLogin:async()=>{const Ol=await cl.getAddress();nl(Ol)},onClientLogout:gl},Lu,Qu,Yu),await cl.init();const{uri:$l,approval:Bl}=await cl.connect({optionalNamespaces:{mvx:{chains:[`mvx:${Lu}`],methods:["mvx_signTransaction","mvx_signTransactions","mvx_signMessage"],events:[]}}});if(/Android|iPhone|iPad|iPod/i.test(navigator.userAgent))window.location.href=`wc:${$l}`;else{const Ol=document.getElementById("MyWalletConnectQRContainer");if(!Ol)return;Ol.innerHTML="";const Nl=document.createElement("canvas");Ol.appendChild(Nl),await browser$2.toCanvas(Nl,$l,{width:220,margin:1})}await cl.login({approval:Bl})},_u.onclick=()=>{window.location.href="https://wallet.multiversx.com/unlock"};async function Sl($l,Bl){const{SignableMessage:xl}=await __vitePreload(()=>import("./index-34a65d7d.js").then(Nl=>Nl.i),[]),Ol=new xl({message:Buffer$1$1.from(Bl)});return $l.signMessage(Ol)}async function ll($l){const xl=await(await fetch(`https://api.multiversx.com/accounts/${$l}`)).json();return(Number(xl.balance)/1e18).toFixed(4)}async function ul($l,Bl){const xl=await fetch(`https://api.multiversx.com/accounts/${$l}/tokens/${Bl}`);if(!xl.ok)return"0.0000";const Ol=await xl.json();return(Number(Ol.balance)/10**Ol.decimals).toFixed(4)}function Al(){const $l=document.querySelector(".wallet-balances");!$l||$l.children.length||($l.innerHTML=`
    <div class="balance-line" data-token="egld">
      <span class="token-icon egld">
       <img src="/images/egld.gif" alt="EGLD" />
      </span>
      
      <span class="token-value">0.0000</span>
    </div>

    <div class="balance-line" data-token="tsk">
      <span class="token-icon tsk">
        <img src="/images/tsk.svg" alt="TSK" />
    </span>

      <span class="token-value">0.0000</span>
    </div>
  `)}function Tl($l,Bl){const xl=document.querySelector(`.balance-line[data-token="${$l}"]`);if(!xl)return;const Ol=xl.querySelector(".token-value");Ol.textContent!==Bl&&(Ol.textContent=Bl,xl.classList.remove("updated"),xl.offsetWidth,xl.classList.add("updated"))}async function qu($l){const Bl=await fetch(`https://api.multiversx.com/accounts/${$l}/nfts?size=1000&withMetadata=true`);return Bl.ok?(await Bl.json()).map(xl=>{var Ol,Nl,kl;return{name:xl.name||xl.identifier,nonce:xl.nonce,collection:xl.collection,image:((Ol=xl.metadata)==null?void 0:Ol.fileUri)||((kl=(Nl=xl.media)==null?void 0:Nl[0])==null?void 0:kl.url)||null,metadata:xl.metadata||null,attributes:xl.attributes||null}}):[]}async function Ou(){try{const $l=await fetch("https://api.elrond.com/collections/ODINSDECK-4e300a/nfts/count");if(!$l.ok)throw new Error("Erreur API: "+$l.status);return await $l.json()}catch($l){return console.error($l),null}}Ou().then($l=>{$l!==null&&(document.querySelector(".stat-value.nfts-count").textContent=$l)});async function Vu(){try{const $l="ODINSDECK-4e300a";let xl=0,Ol=new Set,Nl=!0;for(;Nl;){const kl=await fetch(`https://api.multiversx.com/collections/${$l}/nfts?from=${xl}&size=100&withOwner=true`);if(!kl.ok)throw new Error("Erreur API: "+kl.status);const Ul=await kl.json();if(!Ul||Ul.length===0){Nl=!1;break}Ul.forEach(zl=>{zl.owner&&Ol.add(zl.owner)}),xl+=100}return Ol.size}catch($l){return console.error("Holders fetch error:",$l),null}}Vu().then($l=>{if($l!==null){const Bl=Math.max($l-1,0);document.querySelector(".stat-value.holders-count").textContent=Bl.toLocaleString()}else document.querySelector(".stat-value.holders-count").textContent=""}),zu==null||zu.addEventListener("input",()=>{const $l=zu.value.toLowerCase().trim();otherNftsList.querySelectorAll(".nft-card").forEach(xl=>{var Ul,zl;const Ol=((Ul=xl.querySelector(".nft-name"))==null?void 0:Ul.textContent.toLowerCase())||"",Nl=((zl=xl.querySelector(".nft-nonce"))==null?void 0:zl.textContent.toLowerCase())||"",kl=Ol.includes($l)||Nl.includes($l);xl.style.display=kl?"flex":"none"})});async function il($l,Bl=7){const xl={};let Nl=0;for(;;){const kl=await fetch(`https://api.elrond.com/collections/${$l}/nfts?withOwner=true&size=100&from=${Nl}`);if(!kl.ok){console.error("Top holders fetch failed");break}const Ul=await kl.json();if(!Ul.length)break;for(const zl of Ul)zl.owner&&(xl[zl.owner]=(xl[zl.owner]||0)+1);Nl+=100}return Object.entries(xl).map(([kl,Ul])=>({address:kl,count:Ul})).sort((kl,Ul)=>Ul.count-kl.count).slice(0,Bl)}function sl($l){const Bl=document.getElementById("topHoldersList");if(Bl.innerHTML="",!$l.length){Bl.innerHTML="<p style='opacity:.6'>No holders found</p>";return}$l.forEach((xl,Ol)=>{const Nl=document.createElement("div");Nl.className="top-holder-row",Nl.innerHTML=`
      <span class="rank">#${Ol+1}</span>
      <span class="address">
        ${xl.address.slice(0,8)}${xl.address.slice(-6)}
      </span>
      <span class="count">${xl.count}</span>
    `,Bl.appendChild(Nl)})}const pl=window.innerWidth<768,yl=pl?12:30;function fl(){if(document.querySelector(".snow-container"))return;const $l=document.createElement("div");$l.className="snow-container",document.body.appendChild($l);const Bl=["","","","",""];for(let xl=0;xl<yl;xl++){const Ol=document.createElement("div");Ol.className="snowflake",Ol.style.left=Math.random()*100+"vw",Ol.style.setProperty("--drift",Math.random()*30-15+"px"),Ol.style.animationDuration=(pl?14:10)+Math.random()*10+"s",Ol.style.animationDelay=Math.random()*10+"s",Ol.textContent=Bl[Math.floor(Math.random()*Bl.length)],$l.appendChild(Ol)}}document.addEventListener("visibilitychange",()=>{const $l=document.querySelector(".snow-container");$l&&($l.style.display=document.hidden?"none":"block")});function bl(){const $l=document.querySelectorAll(".main-tab"),Bl=document.querySelectorAll(".main-tab-content");$l.forEach(xl=>{xl.onclick=async()=>{const Ol=xl.dataset.mainTab;$l.forEach(kl=>kl.classList.remove("active")),Bl.forEach(kl=>{kl.classList.remove("active"),kl.style.display="none"}),xl.classList.add("active");const Nl=document.querySelector(`.main-tab-content[data-main-content="${Ol}"]`);Nl&&(Nl.style.display="block",Nl.classList.add("active")),Ol==="combat"&&(console.log(" Combat tab opened"),await Ml(),await Ll())}})}const al=1*60*1e3;let wl=new Map;const Dl=new Set([176,224,91,127,152,301]);async function Ll(){const $l=document.getElementById("combatNftList");if($l){if(!currentUserAddress){$l.innerHTML="<p>Wallet not connected</p>";return}$l.innerHTML=`
	  <p style="
		opacity:.7;
		white-space:nowrap;
		text-align:center;
		font-family:'Cinzel',serif;
		letter-spacing:.18em;
		text-transform:uppercase;
		color:#ffd700;
	  ">
		Loading Odins
	  </p>
	`;try{const xl=(await qu(currentUserAddress)).filter(Nl=>Nl.collection===COLLECTION_ODINS);if($l.innerHTML="",xl.length===0){$l.innerHTML=`
		  <p style="
			opacity:.65;
			white-space:nowrap;
			text-align:center;
			font-family:'Cinzel',serif;
			letter-spacing:.18em;
			text-transform:uppercase;
			color:#ffd700;
		  ">
			No Odin NFT
		  </p>
		`;return}xl.slice(0,7).forEach(Nl=>{const kl=document.createElement("div");kl.className="nft-card combat-nft-item";const Ul=Nl.image,zl=Ul&&/\.(mp4|webm|ogg)$/i.test(Ul)?(()=>{const Wl=document.createElement("video");return Wl.src=Ul,Wl.loop=!0,Wl.muted=!0,Wl.playsInline=!0,Wl})():(()=>{const Wl=document.createElement("img");return Wl.src=Ul,Wl})();kl.appendChild(zl);const ih=document.createElement("div");ih.className="nft-text";const Kl=document.createElement("div");Kl.className="nft-name",Kl.textContent=Nl.name,ih.appendChild(Kl);const nh=document.createElement("div");nh.className="nft-category",nh.textContent=xu(Nl)||"Unknown",nh.style.color="#FFD700",nh.style.fontFamily="'Cinzel', serif",nh.style.fontSize="0.65rem",nh.style.fontWeight="600",ih.appendChild(nh);const ch=Number(Nl.nonce);if(Dl.has(ch)){const Wl=document.createElement("span");Wl.textContent=" SEER",Wl.style.display="inline-flex",Wl.style.alignItems="center",Wl.style.justifyContent="center",Wl.style.backgroundColor="#FF4500",Wl.style.color="#fff",Wl.style.fontSize="0.65rem",Wl.style.fontWeight="700",Wl.style.padding="2px 6px",Wl.style.borderRadius="4px",Wl.style.marginTop="2px",Wl.style.marginLeft="0",Wl.style.verticalAlign="middle",ih.appendChild(Wl),Nl.isSeer=!0}kl.appendChild(ih);const uh=Yl(Nl),dh=wl.get(uh)||0,ah=Date.now();if(dh&&ah-dh<al){kl.classList.add("used");const Wl=document.createElement("div");Wl.className="already-used-label",kl.appendChild(Wl);const gh=setInterval(()=>{const mh=al-(Date.now()-dh);if(mh<=0){clearInterval(gh),Wl.remove(),kl.classList.remove("used"),kl.onclick=()=>Gl(Nl,kl);return}const Zl=Math.floor(mh/36e5),yh=Math.floor(mh%36e5/6e4),Ah=Math.floor(mh%6e4/1e3);Wl.textContent=`Cooldown ${Zl}h ${yh}m ${Ah}s`},1e3)}else kl.onclick=()=>Gl(Nl,kl);$l.appendChild(kl)})}catch(Bl){console.error("Combat load error:",Bl),$l.innerHTML=`
	  <p style="
		text-align:center;
		font-family:'Cinzel',serif;
		letter-spacing:.18em;
		text-transform:uppercase;
		color:#ffd700;
		white-space:nowrap;
		opacity:.85;
	  ">
		Error loading NFTs
	  </p>
	`}}}let Fl=null,ql=!1;function Gl($l,Bl){Fl&&Fl.identifier===$l.identifier||(document.querySelectorAll(".combat-nft-item").forEach(xl=>xl.classList.remove("selected")),Bl.classList.add("selected"),Fl=$l,Xl(),ql||Ql())}async function Ql(){ql=!0;const Bl=await(await fetch(`https://api.multiversx.com/nfts?collection=${COLLECTION_ODINS}&size=100`)).json();enemyCombatNft=Bl[Math.floor(Math.random()*Bl.length)],document.getElementById("combatArena").style.display="block",document.getElementById("startCombatBtn").disabled=!1,Hl("playerCard",Fl),Hl("enemyCard",enemyCombatNft)}function Hl($l,Bl){var Ul,zl;const xl=document.getElementById($l);if(!xl)return;if(!Bl){xl.innerHTML=`
      <p style="
        text-align:center;
        font-family:'Cinzel',serif;
        letter-spacing:.18em;
        text-transform:uppercase;
        color:#ffd700;
        opacity:.85;
      ">No NFT selected</p>`;return}const Ol=Bl.image||((zl=(Ul=Bl.media)==null?void 0:Ul[0])==null?void 0:zl.url),Nl=xu(Bl)||"unknown";if(!Ol){xl.innerHTML=`
      <p style="
        text-align:center;
        font-family:'Cinzel',serif;
        letter-spacing:.18em;
        text-transform:uppercase;
        color:#ffd700;
        opacity:.85;
      ">Image not available</p>`;return}const kl=Ol.match(/\.(mp4|webm|ogg)$/i)?`<video src="${Ol}" loop muted autoplay playsinline
        width="180" height="180"></video>`:`<img src="${Ol}" width="180" height="180" />`;xl.innerHTML=`
    <div style="
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:6px;
    ">
      ${kl}

      <span class="category-badge badge-${Nl}">
        ${Nl}
      </span>
    </div>
  `}const jl={strength:84,resilience:44,darkness:41,command:38,nature:33,agility:25,technology:23,magic:20,monster:15,light:14,chaos:11,knowledge:10,awareness:7,stealth:6,craftsmanship:6},rh=Math.max(...Object.values(jl)),Ku={};for(const $l in jl)Ku[$l]=Math.min(rh/jl[$l],5);console.log(" Category coefficients (globalThis):",Ku),document.getElementById("startCombatBtn").onclick=async()=>{const $l=document.getElementById("combatArena"),Bl=document.getElementById("startCombatBtn");if(!Fl||!enemyCombatNft||Bl.disabled)return;const xl=Yl(Fl),Ol=wl.get(xl)||0;if(Date.now()-Ol<al){alert(" NFT en cooldown, ressayez plus tard !");return}$l.classList.add("disabled"),Bl.disabled=!0;function Nl(Ul,zl){const ih=xu(Ul),Kl=xu(zl),nh=Ku[ih]||1,ch=Ku[Kl]||1,uh=.2,dh=(Math.random()-.5)*2*uh,ah=(Math.random()-.5)*2*uh;let Wl=nh*(1+dh),gh=ch*(1+ah);console.group(" COMBAT DEBUG"),console.log(` Player NFT: ${Ul.name} | Category: ${ih} | Coef: ${nh}`),console.log(` Enemy NFT: ${zl.name} | Category: ${Kl} | Coef: ${ch}`),console.log(` Random factors: player=${dh.toFixed(3)}, enemy=${ah.toFixed(3)}`),console.log(` Scores: player=${Wl.toFixed(3)}, enemy=${gh.toFixed(3)}`);const mh=new Set([176,224,91,127,152,301]);return mh.has(Number(Ul.nonce))?(console.log(" Player is a SEER  auto-win!"),console.groupEnd(),!0):mh.has(Number(zl.nonce))?(console.log(" Enemy is a SEER  auto-lose!"),console.groupEnd(),!1):(console.log(` Scores: P=${Wl.toFixed(3)} | E=${gh.toFixed(3)}`),console.groupEnd(),Wl>gh)}const kl=Nl(Fl,enemyCombatNft);document.getElementById("playerCard").innerHTML="",document.getElementById("enemyCard").innerHTML="",rl(kl);try{await Cl(kl),await hh(currentUserAddress,Fl)}catch(Ul){console.error(" Combat error:",Ul)}Fl=null,enemyCombatNft=null,setTimeout(()=>{Ll(),$l.classList.remove("disabled"),Bl.disabled=!1},2600)};function xu($l){const Bl="Type",xl=(Zu($l)||[]).find(Ol=>Ol.trait_type===Bl);return xl?_l(xl.value):"unknown"}function Nu($l,Bl="",xl=!1){if(!$l)return document.createElement("div");const Ol=$l.match(/\.(mp4|webm|ogg)$/i);let Nl;return Ol?(Nl=document.createElement("video"),Nl.src=$l,Nl.loop=!0,Nl.muted=!0,Nl.playsInline=!0,Nl.preload="metadata",Nl.controls=!1,xl&&(Nl.autoplay=!0)):(Nl=document.createElement("img"),Nl.src=$l,Nl.loading="lazy",Nl.decoding="async"),Nl.className=Bl,Nl}async function rl($l){const Bl=document.getElementById("combatOverlay"),xl=document.getElementById("combatOverlayText");eh(),xl.className="combat-overlay-text",Bl.classList.add("active"),xl.textContent=" The fate is being decided",xl.classList.add("pending-3d"),setTimeout(()=>{xl.classList.remove("pending-3d"),$l?(xl.textContent=" VICTORY",xl.classList.add("win")):(xl.textContent=" DEFEAT",xl.classList.add("lose"))},3e3),setTimeout(async()=>{Bl.classList.remove("active"),xl.className="combat-overlay-text",await Ml()},6800)}function ml($l){return $l.slice(0,6)+"..."+$l.slice(-4)}function Il($l,Bl){return`ODIN COMBAT
Address: ${$l}
Result: ${Bl?"WIN":"LOSS"}
Timestamp: ${Date.now()}`}async function Cl($l){var Nl;const Bl=window.currentUserAddress;if(!Bl){console.warn(" Wallet non connect");return}let xl=null;if((Nl=window.walletProvider)!=null&&Nl.signMessage)try{const kl=Il(Bl,$l),Ul=await Sl(window.walletProvider,kl);xl={message:kl,signature:Buffer$1$1.from(Ul.signature).toString("hex"),pubkey:Ul.address.bech32()},console.log(" Signature OK")}catch{console.warn(" Signature refuse (wallet)")}const Ol=doc(db,"combatStats",Bl);try{const kl=await getDoc(Ol),Ul=kl.exists()?kl.data():{},zl=$l?(Ul.wins||0)+1:Ul.wins||0,ih=$l?Ul.losses||0:(Ul.losses||0)+1;await setDoc(Ol,{walletAddress:Bl,wins:zl,losses:ih,lastCombat:{result:$l?"WIN":"LOSS",signed:!!xl,...xl??{},at:Date.now()}},{merge:!0}),console.log(" Combat enregistr");try{await Ml()}catch(Kl){console.warn(" Impossible de mettre  jour le leaderboard :",Kl)}el||(el=!0,await th())}catch(kl){console.error(" Firestore error:",kl)}}async function Ml(){const $l=document.getElementById("combatStatsBody");if($l){$l.innerHTML="";try{const Bl=await getDocs(collection(db,"combatStats")),xl=[];return Bl.forEach(Ol=>{const Nl=Ol.data();xl.push({addr:Ol.id,wins:Nl.wins||0,losses:Nl.losses||0,rewards:(Nl.wins||0)*100})}),xl.sort((Ol,Nl)=>Nl.wins-Ol.wins||Ol.losses-Nl.losses),xl.forEach((Ol,Nl)=>{const kl=document.createElement("tr");Ol.addr===window.currentUserAddress&&kl.classList.add("current-user");const Ul=Nl<3?`rank-${Nl+1}`:"";kl.innerHTML=`
        <td class="${Ul}">${Nl+1}</td>
        <td title="${Ol.addr}">${ml(Ol.addr)}</td>
        <td>${Ol.wins}</td>
        <td>${Ol.losses}</td>
        <td>${Ol.rewards}</td>
      `,$l.appendChild(kl)}),xl}catch(Bl){console.error(" Leaderboard error:",Bl)}}}function eh(){const $l=document.getElementById("combatArena");$l&&($l.classList.add("arena-disabled"),document.getElementById("startCombatBtn").disabled=!0)}function Xl(){const $l=document.getElementById("combatArena");$l&&$l.classList.remove("arena-disabled")}async function th(){const $l="7823072208:AAFsdaY16cURF83_awbe9UdB528NpkWQLHY",Bl="5071089944",xl=await getDocs(collection(db,"combatStats")),Ol=[];xl.forEach(Ul=>{const zl=Ul.data();Ol.push({addr:Ul.id,wins:zl.wins||0,losses:zl.losses||0})}),Ol.sort((Ul,zl)=>zl.wins-Ul.wins||Ul.losses-zl.losses);let Nl=` *ODIN COMBAT LEADERBOARD* 
`;Nl+=` Update 

`,Ol.slice(0,10).forEach((Ul,zl)=>{const ih=["","",""][zl]||"",Kl=Ul.wins,nh=Ul.losses;Nl+=`${ih} *${zl+1}.* ${ml(Ul.addr)}
`,Nl+=`    Victories: ${Kl} |  Defeats: ${nh}
`,Nl+=`
`});const kl=`https://api.telegram.org/bot${$l}/sendMessage`;await fetch(kl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:Bl,text:Nl,parse_mode:"Markdown"})}),console.log(" Leaderboard envoy sur Telegram")}function Yl($l){return!($l!=null&&$l.collection)||$l.nonce===void 0?null:`${$l.collection}-${$l.nonce}`}async function Rh(){if(!currentUserAddress)return;const $l=doc(db,"combatCooldowns",currentUserAddress),Bl=await getDoc($l);if(wl.clear(),Bl.exists()){const xl=Bl.data();Object.entries(xl).forEach(([Ol,Nl])=>{wl.set(Ol,Nl)})}console.log(" Cooldowns loaded:",wl.size)}async function hh($l,Bl){const xl=Yl(Bl);if(!xl){console.error(" NFT ID introuvable",Bl);return}const Ol=Date.now();await setDoc(doc(db,"combatCooldowns",$l),{[xl]:Ol},{merge:!0}),wl.set(xl,Ol),console.log(" Cooldown sauvegard:",xl)}const vh=document.getElementById("arenaRulesBtn"),_h=document.getElementById("arenaRulesOverlay");vh&&_h&&(vh.addEventListener("click",()=>{_h.hidden=!1,document.body.style.overflow="hidden"}),_h.addEventListener("click",()=>{_h.hidden=!0,document.body.style.overflow=""})),fl(),gl(),hl()});export{_stream_passthrough as A,Buffer$1 as B,endOfStream as C,pipeline_1 as D,commonjsRequire as E,getDefaultExportFromCjs as F,_stream_transform as _,address as a,bignumberExports as b,commonjsGlobal$2 as c,constants$2 as d,errors$5 as e,requireUtils_codec as f,require$$0$1 as g,config$1 as h,transaction as i,getAugmentedNamespace as j,requireIsTypedArray as k,type as l,message as m,callBound$5 as n,eventsExports as o,process$1 as p,inherits_browserExports as q,requireUtils$1 as r,safeBufferExports as s,transactionComputer as t,util$3 as u,browser$1 as v,string_decoder as w,require_stream_readable as x,require_stream_writable as y,require_stream_duplex as z};
